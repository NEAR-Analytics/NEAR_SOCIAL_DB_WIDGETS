{"tx_hash": "GMhzTweCR725A23msHeowyswVNWhozMTvPimYBzzaDWV", "action_id_social": "7vfYreL2hSqsod9pJeQVs7QojBFPNJ9x81XPaQSWpgXu-0-widget", "block_id": 80730516, "block_timestamp": "2022-12-15 21:01:14.451", "signer_id": "edwardkcyu.near", "widget_name": "AstroBountiesCommentEditor", "source_code": "const myAccountId = props.accountId ?? context.accountId;\nif (!myAccountId) {\n  return \"Please sign in with NEAR wallet \";\n}\n\nconst bountyId = props.bountyId;\nif (!bountyId) {\n  return \"Please provide a bounty id\";\n}\n\nconst collapsedOnCommentsAvailable = props.collapsedOnCommentsAvailable ?? true;\n\nState.init({ message: \"\" });\n\nconst data =\n  Social.get(`*/astrosocial/bounties/${bountyId}/comments`, \"final\") || {};\n\nconst accounts = Object.keys(data);\n\nlet myComments = [];\nconst allComments = accounts.reduce((acc, accountId) => {\n  const accountData = data[accountId];\n\n  const comments = JSON.parse(\n    accountData.astrosocial.bounties[bountyId].comments\n  );\n\n  const enrichedComments = comments.map((comment) => {\n    return {\n      ...comment,\n      accountId,\n    };\n  });\n\n  if (accountId === myAccountId) {\n    myComments = enrichedComments;\n  }\n\n  return acc.concat(enrichedComments);\n}, []);\nallComments.sort((a, b) => {\n  if (a.createdAt < b.createdAt) return -1;\n  if (a.createdAt > b.createdAt) return 1;\n  return 0;\n});\n\n// variables for rendering\nconst sanitizedBountyId = props.bountyId.replaceAll(\".\", \"\");\nconst collapsedClass =\n  !allComments.length || collapsedOnCommentsAvailable\n    ? \"collapse\"\n    : \"collapse.show\";\n\nreturn (\n  <div>\n    <div>\n      <a\n        class=\"card-link\"\n        data-bs-toggle=\"collapse\"\n        href={`#collapseCommentEditorComment-${sanitizedBountyId}`}\n        role=\"button\"\n        aria-expanded2=\"false\"\n        aria-controls={`collapseCommentEditorComment-${sanitizedBountyId}`}\n      >\n        <i class={commentBtnClass}> </i> Comment ({allComments.length ?? 0})\n      </a>\n    </div>\n\n    <div\n      class={\n        !allComments.length || collapsedOnCommentsAvailable\n          ? \"collapse\"\n          : \"collapse.show\"\n      }\n      id={`collapseCommentEditorComment-${sanitizedBountyId}`}\n    >\n      <div>\n        <ul>\n          {allComments.map((comment) => {\n            const createdAt = new Date(comment.createdAt);\n            const formattedCreatedAt = `${createdAt.toLocaleDateString()} ${createdAt.toLocaleTimeString()}`;\n            return (\n              <li>\n                {formattedCreatedAt} <b>{comment.accountId}: </b>{\" \"}\n                {comment.message}\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n\n      <div className=\"mb-2\">\n        <textarea\n          cols=\"50\"\n          rows=\"5\"\n          value={state.message}\n          onChange={(event) => {\n            State.update({ message: event.target.value });\n          }}\n        />\n      </div>\n      <CommitButton\n        data={{\n          astrosocial: {\n            bounties: {\n              [bountyId]: {\n                comments: [\n                  ...myComments,\n                  {\n                    message: state.message,\n                    createdAt: new Date().getTime(),\n                  },\n                ],\n              },\n            },\n          },\n        }}\n      >\n        Submit\n      </CommitButton>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/edwardkcyu.near/widget/AstroBountiesCommentEditor"}