{"tx_hash": "FQ4ifaf6dkF2kP2yTw9jeGz2kMVdwrV3TqjsNigW8vfR", "action_id_social": "2XXcCfxYB73BVSPk9xfWtxUzue7BVQBuomJLyECckpea-0-widget", "block_id": 80748833, "block_timestamp": "2022-12-16 02:54:59.357", "signer_id": "edwardkcyu.near", "widget_name": "InfiniteScrollAstro", "source_code": "const PAGING_SIZE = 50;\n\nconst fetchBounties = (term, from) => {\n  const response = fetch(\n    `https://5s59j8guu9.execute-api.us-east-1.amazonaws.com/my-test/bounty/_search?size=${PAGING_SIZE}&from=${from}`,\n    {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        query: {\n          query_string: {\n            query: term,\n            default_field: \"description\",\n            type: \"best_fields\",\n            fuzziness: \"AUTO\",\n            fuzzy_transpositions: true,\n            fuzzy_max_expansions: 50,\n            fuzzy_prefix_length: 0,\n            minimum_should_match: 1,\n            default_operator: \"or\",\n            analyzer: \"standard\",\n            lenient: false,\n            boost: 1,\n            allow_leading_wildcard: true,\n            enable_position_increments: true,\n            phrase_slop: 3,\n            quote_field_suffix: \"\",\n            quote_analyzer: \"standard\",\n            analyze_wildcard: false,\n            auto_generate_synonyms_phrase_query: true,\n          },\n        },\n        sort: [\n          {\n            createTimestamp: {\n              order: \"desc\",\n            },\n          },\n        ],\n      }),\n    }\n  );\n\n  console.log(\"fetch\", { from, response });\n  const bounties = response.body?.hits?.hits;\n  const total = response.body?.hits?.total?.value;\n\n  return {\n    bounties,\n    total,\n  };\n};\n\nconst term = props.searchTerm ? props.searchTerm + \"*\" : \"*\";\n\nif (!state) {\n  const bountiesData = fetchBounties(term, 0);\n\n  if (bountiesData.bounties) {\n    State.init({\n      term,\n      bounties: bountiesData.bounties,\n      total: bountiesData.total || state.total,\n    });\n    console.log(\"init state\", { state });\n  }\n}\n\nconst fetchMoreBounties = (page) => {\n  const bountiesData = fetchBounties(term, page * PAGING_SIZE);\n\n  console.log(\"fetch more\", { page, bountiesData });\n\n  State.update({\n    total: bountiesData.total,\n    bounties: state.bounties.concat(bountiesData.bounties),\n  });\n};\n\nconsole.log({ state });\n\nreturn state.bounties ? (\n  <InfiniteScroll\n    pageStart={0}\n    initialLoad={true}\n    loadMore={fetchMoreBounties}\n    hasMore={state.total && state.bounties.length < state.total}\n    loader={<div className=\"loader\">Loading ...</div>}\n  >\n    <ol>\n      {state.bounties.map((bounty) => {\n        const bountyId = bounty._source.id;\n        return (\n          <li>\n            <div>{bountyId}</div>\n          </li>\n        );\n      })}\n    </ol>\n  </InfiniteScroll>\n) : (\n  \"Fetching \"\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/edwardkcyu.near/widget/InfiniteScrollAstro"}