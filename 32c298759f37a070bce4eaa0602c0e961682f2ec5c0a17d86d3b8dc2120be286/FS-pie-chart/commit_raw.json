{"tx_hash": "8YDa18bEvpzXanweD9xpazLcMdD2DDE3YmHrSEjgAmxE", "action_id_social": "2Jw8YJB1ivFy2qFbfbvjL5GZSoUwgs8CZgQGcR8BRBhi-0-widget", "block_id": 86751671, "block_timestamp": "2023-03-07 10:00:55.643", "signer_id": "32c298759f37a070bce4eaa0602c0e961682f2ec5c0a17d86d3b8dc2120be286", "widget_name": "FS-pie-chart", "source_code": "State.init({\r\n  imgSrc: \"\",\r\n});\r\n\r\n// Query API\r\nconst options = {\r\n  method: \"POST\",\r\n  body: `{ \"query\": \"${props.query}\" }`,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n};\r\n\r\nasyncFetch(\"https://flipside-api.antonyip.com/getCachedQuery\", options).then(\r\n  (res) => {\r\n    if (!res.ok) {\r\n      return;\r\n    }\r\n\r\n    if (res.body.error) {\r\n      return;\r\n    }\r\n\r\n    let queryResults = res.body;\r\n\r\n    console.log(\"queryResults\", queryResults);\r\n    const chartType = `\"pie\"`;\r\n    let chartBottomAxisLabels = \"[\";\r\n    let chartValues = \"[\";\r\n    // parsing of data from flipside\r\n    if (queryResults !== \"\") {\r\n      // parsing of labels\r\n      queryResults.rows.map((d, i) => {\r\n        if (i !== 0) {\r\n          chartBottomAxisLabels += \",\";\r\n          chartValues += \",\";\r\n        } else {\r\n          chartValues += `{label: '${props.title}', data:[`;\r\n        }\r\n        chartBottomAxisLabels += \"'\";\r\n        chartBottomAxisLabels += d[0];\r\n        chartBottomAxisLabels += \"'\";\r\n\r\n        chartValues += \"'\";\r\n        chartValues += d[1];\r\n        chartValues += \"'\";\r\n      });\r\n\r\n      chartValues += \"]}]\";\r\n      chartBottomAxisLabels += \"]\";\r\n      const imgTemplate = `https://quickchart.io/chart?width=${props.chartWidth}&height=${props.chartHeight}&chart={type:${chartType},data:{labels:${chartBottomAxisLabels}, datasets:${chartValues}}}`;\r\n      State.update({\r\n        imgSrc: imgTemplate,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\nreturn (\r\n  <>\r\n    {state.imgSrc === \"\" ? <div>Loading ...</div> : <img src={state.imgSrc} />}\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/32c298759f37a070bce4eaa0602c0e961682f2ec5c0a17d86d3b8dc2120be286/widget/FS-pie-chart"}