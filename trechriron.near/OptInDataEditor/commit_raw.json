{"tx_hash": "DTQJsp71zHMHPRnFqGTyid9BhF87GpFNFaGJqNDZ1GCS", "action_id_social": "DjCL6Y4HWRdwDVe86dAM9vTNrPbe3AjQT17ips3Hy4NQ-0-widget", "block_id": 80745857, "block_timestamp": "2022-12-16 01:57:59.153", "signer_id": "trechriron.near", "widget_name": "OptInDataEditor", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst onChange = props.onChange;\nconst options = props.options;\nlet optInInfo = {};\nlet changeLog = [];\n\nconst initialState = {\n  accountId,\n  birthday: \"\",\n  astrological_sign: \"\",\n  age: \"\",\n  gender: \"\",\n  profession: \"\",\n  income: \"\",\n  preferred_wallet: \"\",\n  preffered_nft_marketplace: \"\",\n  preffered_crypto: \"\",\n  saveState: \"Started\",\n};\n\nState.init(initialState);\n\nfunction setOptInInfoObject() {\n  optInInfo = { ...state };\n  console.log(optInInfo);\n}\n\nfunction fetchDataFromAPI() {\n  const data = fetch(``, {\n    method: \"GET\",\n    headers: {\n      Accept: \"application/json\",\n      \"Content-Type\": \"application/json\",\n    },\n  });\n}\n\nfunction reportEventToAPI() {\n  const data = fetch(`https://dev.kitwallet.app/producer/${accountId}/event`, {\n    method: \"POST\",\n    headers: {\n      Accept: \"application/json\",\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      accountId,\n      events: [{ type: \"updateProfile\", data: \"coolwhip\" }],\n    }),\n  });\n}\n\nfunction registerProfileToAPI() {\n  const data = fetch(`https://dev.kitwallet.app/producer`, {\n    method: \"POST\",\n    headers: {\n      Accept: \"application/json\",\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      accountId,\n      profile: state,\n    }),\n  });\n}\n\nfunction setFormStatusOnAccount() {\n  State.update({ optInInfoFormStatus: \"completed\" });\n}\n\nfunction addChangeLogEntry() {\n  const dateTime = Date.now();\n  // const timestampUTC = dateTime.toUTCString();\n  const changeEvent = { thisEvent: \"form submitted\", timestamp: dateTime };\n  changeLog.push(changeEvent);\n  return changeLog;\n}\n\nfunction handleOnCommit() {\n  console.log(\"doing the thing...\");\n  reportEventToAPI();\n  registerProfileToAPI();\n  console.log({ state });\n}\n\nfunction handleChangeOnInput(event) {\n  State.update({\n    [event.target.id]: event.target.value,\n  });\n  State.update({ saveState: \"in progress...\" });\n}\n\nreturn (\n  <div id=\"optInDataForm\">\n    {options.birthday.label ?? \"Birthday\"}\n    <input\n      id=\"birthday\"\n      type=\"date\"\n      value={state.birthday}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.astrological_sign.label ?? \"Astrological Sign\"}\n    <input\n      id=\"astrological_sign\"\n      type=\"text\"\n      value={state.astrological_sign}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.age.label ?? \"Age\"}\n    <input\n      id=\"age\"\n      type=\"text\"\n      value={state.age}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.gender.label ?? \"Gender\"}\n    <input\n      id=\"gender\"\n      type=\"text\"\n      value={state.gender}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.profession.label ?? \"Profession\"}\n    <input\n      id=\"profession\"\n      type=\"text\"\n      value={state.profession}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.income.label ?? \"Income\"}\n    <input\n      id=\"income\"\n      type=\"text\"\n      value={state.income}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.preferred_wallet.label ?? \"Preferred Wallet\"}\n    <input\n      id=\"preferred_wallet\"\n      type=\"text\"\n      value={state.preferred_wallet}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.preffered_nft_marketplace.label ?? \"Preferred NFT Marketplace\"}\n    <input\n      id=\"preffered_nft_marketplace\"\n      type=\"text\"\n      value={state.preffered_nft_marketplace}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    {options.preffered_crypto.label ?? \"Preferred Crypto\"}\n    <input\n      id=\"preffered_crypto\"\n      type=\"text\"\n      value={state.preffered_crypto}\n      onChange={(event) => handleChangeOnInput(event, input.id)}\n    />\n    <p></p>\n    <CommitButton\n      data={{ optInInfoFormStatus: state.saveState }}\n      onClick={handleOnCommit}\n      onCommit={handleOnCommit}\n    >\n      Save Opt-In Info\n    </CommitButton>\n    <button onClick={() => State.update(initialState)}>Reset Form</button>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/trechriron.near/widget/OptInDataEditor"}