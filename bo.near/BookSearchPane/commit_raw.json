{"tx_hash": "DKF2MX9pzGJjx2uYg9QEQ3b5P3mtiQENYJyYV34BidSA", "action_id_social": "2znQPK6Z91ekFHtK5Z8tEWnfq9jdZicNKJnKNqsD5Ffa-0-widget", "block_id": 80689692, "block_timestamp": "2022-12-15 07:41:05.973", "signer_id": "bo.near", "widget_name": "BookSearchPane", "source_code": "initState({\n  text: null,\n  books: null,\n});\n\nconst update = (text) => {\n  State.update({\n    text,\n  });\n};\n\nconst search = (text) => {\n  // NOTE: provided encodeURIComponent not available\n  const encodeURIComponent = (str) => {\n    return str.replace(\" \", \"%20\");\n  };\n  const query = encodeURIComponent(text);\n  const resp = fetch(\n    `https://www.googleapis.com/books/v1/volumes?q=intitle:${query}`\n  );\n\n  if (!resp.ok) {\n    console.log(`ERR: cannot query for ${text}`);\n    console.log(resp);\n    return;\n  }\n\n  const books = resp.body.items.map((item) => {\n    const info = item.volumeInfo;\n    return {\n      id: info.industryIdentifiers.reduce(\n        (a, v) => ({ ...a, [v.type]: v.identifier }),\n        {}\n      )[\"ISBN_13\"],\n      title: info.title,\n      author: info.authors[0],\n      pageCount: info.pageCount,\n      genre: \"Novel\",\n      onAdd: onAddBook,\n      cover: {\n        url:\n          info.imageLinks.thumbnail ||\n          info.imageLinks.small ||\n          info.imageLinks.medium,\n      },\n    };\n  });\n\n  State.update({\n    books,\n  });\n};\n\nconst onAddBook = (book) => {\n  console.log(`ADDING BOOK ${book}`);\n  Social.set();\n};\n\nreturn (\n  <div>\n    <input\n      type=\"text\"\n      className=\"form-control\"\n      value={state.text ?? \"\"}\n      onChange={(e) => {\n        const text = e.target.value;\n        update(text);\n        search(text);\n      }}\n      placeholder={props.placeholder ?? `\ud83d\udd0d Search Books`}\n    />\n\n    <div className=\"d-flex gap-1 flex-wrap\">\n      {state.books &&\n        state.books.map((book) => (\n          <Widget key={i} src={\"bo.near/widget/BookTile\"} props={{ book }} />\n        ))}\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bo.near/widget/BookSearchPane"}