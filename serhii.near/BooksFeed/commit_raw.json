{"tx_hash": "DgtrsD4bb11xyGEkJH61MLwAujomQgUHKPufkJWxauu7", "action_id_social": "13WAEE8toNyVY4JoFs7GYBQXjcY6V4ebq9jAEKtrpKGc-0-widget", "block_id": 81384366, "block_timestamp": "2022-12-24 21:06:56.580", "signer_id": "serhii.near", "widget_name": "BooksFeed", "source_code": "const accountId = context.accountId;\nconst defaultDate = \"Dec 15 2022 10:00:00 AM\";\n\nif (!accountId) {\n  return \"\";\n}\n\nconst peopleIFollow = Social.get(`${accountId}/graph/follow/**`) ?? {};\n\nif (!peopleIFollow) {\n  return \"You are not following anybody\";\n}\n\nconst peopleIFollowWithBooks = {};\nObject.keys(peopleIFollow).map((follow) => {\n  const followBooks = Social.get(`${follow}/books/read/**`);\n  if (followBooks) {\n    peopleIFollowWithBooks[follow] = followBooks;\n  }\n});\n\nconsole.log(\"followBooks\", peopleIFollowWithBooks);\n\nif (!peopleIFollowWithBooks) {\n  return \"Your friend dos not have any books\";\n}\n\nconst timeline = Object.entries(peopleIFollowWithBooks).flatMap(\n  ([acc, books]) => Object.values(books).map((book) => [acc, book])\n);\ntimeline.sort(\n  ([_accA, bookA], [_accB, bookB]) =>\n    new Date(bookB[\"createdAt\"] ?? defaultDate) -\n    new Date(bookA[\"createdAt\"] ?? defaultDate)\n);\nconsole.log(\"timeline\", timeline);\n\nconst BookRows = styled.p`{\n  display: \"flex\",\n  flexDirection: \"column\",\n  alignItems: \"left\",\n  justifyContent: \"space-between\",\n  width: \"100%\",\n  height: \"100%\",\n  padding: \"1rem\",\n}`;\n\nconst ReadBox = styled.div`\n  display: flex;\n  justifyContent: 'space-between'\n  padding: 10px;\n  margin: 10px;\n  width: \"100%\";\n  height: \"100%\";\n`;\n\nreturn (\n  <BookRows>\n    {timeline.map(([acc, book]) => {\n      return (\n        <div>\n          <div className=\"flex-grow-1 text-truncate\">\n            <a\n              className=\"text-dark text-decoration-none text-truncate\"\n              href={`#/mob.near/widget/ProfilePage?accountId=${acc}`}\n            >\n              <ReadBox>\n                <Widget\n                  src=\"mob.near/widget/Profile.ShortInlineBlock\"\n                  props={{ accountId: acc }}\n                />\n                <div>{book.createdAt ?? defaultDate}</div>\n              </ReadBox>\n            </a>\n          </div>\n          <div>\n            <Widget\n              key={i}\n              src={\"serhii.near/widget/BookTile\"}\n              props={{ book, showAddToRead: true, showAddToWantToRead: true }}\n            />\n          </div>\n        </div>\n      );\n    })}\n  </BookRows>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/serhii.near/widget/BooksFeed"}