{"tx_hash": "EbiH4uraHVRMfMS8aBvdaPg7AALhRT73Ao17sZMwFkRN", "action_id_social": "6tZgNzJpG2a6Vk4hBXMP7V3NqDDGQHgYPk88e1PhKVhk-0-widget", "block_id": 80710743, "block_timestamp": "2022-12-15 14:32:13.028", "signer_id": "serhii.near", "widget_name": "BookSearchPane", "source_code": "initState({\n  text: null,\n  books: null,\n});\n\nconst update = (text) => {\n  State.update({\n    text,\n  });\n};\n\nconst search = (text) => {\n  if (!text) {\n    console.log(\"clearing books\");\n    State.update({\n      books: null,\n      showBooks: false,\n    });\n    return;\n  } else {\n    // NOTE: provided encodeURIComponent not available\n    const encodeURIComponent = (str) => {\n      return str.replace(\" \", \"%20\");\n    };\n    const query = encodeURIComponent(text);\n    const resp = fetch(\n      `https://www.googleapis.com/books/v1/volumes?q=intitle:${query}`\n    );\n\n    if (!resp.ok) {\n      console.log(`ERR: cannot query for ${text}`);\n      console.log(resp);\n      return;\n    }\n\n    const books = resp.body.items.map((item) => {\n      const info = item.volumeInfo;\n      return {\n        id: info.industryIdentifiers.reduce(\n          (a, v) => ({ ...a, [v.type]: v.identifier }),\n          {}\n        )[\"ISBN_13\"],\n        title: info.title,\n        author: info.authors[0],\n        pageCount: info.pageCount,\n        genre: \"Novel\",\n        onAdd: onAddBook,\n        cover: {\n          url:\n            info.imageLinks.thumbnail ||\n            info.imageLinks.small ||\n            info.imageLinks.medium,\n        },\n      };\n    });\n\n    State.update({\n      books,\n      showBooks: true,\n    });\n  }\n};\n\nconst onAddBook = (book_id) => {\n  console.log(`ADDING BOOK ${book_id}`);\n};\n\nreturn (\n  <div>\n    <input\n      style={{ marginTop: \"1rem\", marginBottom: \"1rem\" }}\n      type=\"text\"\n      className=\"form-control\"\n      value={state.text ?? \"\"}\n      onChange={(e) => {\n        const text = e.target.value;\n        update(text);\n        search(text);\n      }}\n      placeholder={props.placeholder ?? `\ud83d\udd0d Search Books`}\n    />\n\n    <div className=\"d-flex gap-1 flex-wrap\">\n      {state.showBooks &&\n        state.books &&\n        state.books.map((book) => (\n          <Widget\n            key={i}\n            src={\"serhii.near/widget/BookTile\"}\n            props={{ book, showAddToRead: true, showAddToWantToRead: true }}\n          />\n        ))}\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/serhii.near/widget/BookSearchPane"}