{"tx_hash": "2RFfsi8r8ZYLbEHXzkttmbF6DfSs8LdVxpY9arRj4o7X", "action_id_social": "3H2wrtXZobKMHGSKGDYc4wcAkPha8yjFNXkKZafZa6fk-0-widget", "block_id": 83685853, "block_timestamp": "2023-01-24 12:28:25.080", "signer_id": "maxdev.near", "widget_name": "GenieQuestionList", "source_code": "const ownerId = \"maxdev.near\";\nconst { searchString, setSelectedQuestion, moderators } = props;\nlet questionRefsData = Social.index(\"neardevs_beta1\", \"asked\") || [];\n\nconst isModerator = moderators.includes(context.accountId);\n\nconst blockedQuestions =\n  Social.index(\"neardevs_beta1\", \"blocked\", {\n    accountId: moderators,\n  }) || [];\nconsole.log(blockedQuestions);\n// const unblockedQuestions = Social.index(\"neardevs_beta1\", \"unblocked\") || [];\n\n// const finalBlockedQuestions = [...blockedQuestions, ...unblockedQuestions]\n//   .filter(q => moderators.includes(q.accountId))\n//   .sort((a, b) => a.blockHeight < b.blockHeight)\n//   .reduce((acc, q) => (acc.find((a) => q.value === a.value) ? null : q), [])\n//   .filter((q) => q !== null);\n\nconst blockedQuestionsMap = Object.fromEntries(\n  blockedQuestions.map((q) => [q.value, true])\n);\nlet notBlockedQuestions = questionRefsData.filter(\n  (q) => !blockedQuestionsMap[q.value]\n);\n\nnotBlockedQuestions = notBlockedQuestions.reverse();\n\nreturn (\n  <div className=\"d-flex flex-column gap-1\">\n    <div className=\"d-flex justify-content-end\"></div>\n    <div className=\"d-flex flex-column gap-3\">\n      {notBlockedQuestions.map((q) => {\n        const asker = q.value.split(\"--\")[0];\n        const question = Social.getr(\n          `${asker}/neardevs_beta1/questions/${q.value}`\n        );\n        // return nothing if data does not meet schema\n        if (!question?.title || !question?.content) {\n          return <></>;\n        }\n\n        // return nothing if question does not meet search criteria\n        if (\n          searchString &&\n          !question.title.toLowerCase().includes(searchString.toLowerCase()) &&\n          !question.content.toLowerCase().includes(searchString.toLowerCase())\n        ) {\n          return <></>;\n        }\n        return (\n          <div>\n            <div\n              key={q.value}\n              className=\"d-flex flex-column gap-1\"\n              style={{\n                borderTop: \"0.5px solid #D3D3D3\",\n                padding: \"1.5rem 0 0 0\",\n              }}\n              onClick={() => {\n                setSelectedQuestion(q.value);\n              }}\n            >\n              <Widget\n                src={`${ownerId}/widget/GenieQuestionView`}\n                props={{\n                  questionRef: q.value,\n                  searchString: props.searchString,\n                }}\n              />\n            </div>\n            <div>\n              {isModerator && (\n                <CommitButton\n                  className=\"btn btn-secondary\"\n                  style={{ width: 100 }}\n                  onCommit={() => {}}\n                  // const questionRef = `${context.accountId}--${Date.now()}`;\n                  data={{\n                    index: {\n                      neardevs_beta1: JSON.stringify({\n                        key: \"blocked\",\n                        value: q.value,\n                      }),\n                    },\n                  }}\n                >\n                  Block\n                </CommitButton>\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/maxdev.near/widget/GenieQuestionList"}