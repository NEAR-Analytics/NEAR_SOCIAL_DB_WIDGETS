{"tx_hash": "Akb9VYUEaAGxKSE4LCHZoRREuEtJoeyR65X2c8N2gcwR", "action_id_social": "EeXNecUak3jXSUzmX2jTm1EYkLpNxYFCXP3AXgJVmC2x-0-widget", "block_id": 94246395, "block_timestamp": "2023-06-15T14:46:29.871Z", "signer_id": "simplar.near", "widget_name": "Community.Create.Create", "source_code": "const profile = Social.get(`${context.accountId}/profile/**`)\nconst community = Social.get(`${context.accountId}/community/**`)\n\nif (context.loading || !profile) return <div> Loading... </div>\n\nconst defaultMenu = [\n  { label: \"Home\", icon: \"house\", component: \"simplar.near/widget/HomePage\" },\n  { label: \"Events\", icon: \"calendar-date\", component: \"simplar.near/widget/Events\" },\n]\n\nState.init({\n  profile: {\n    name: profile.name || \"\", description: profile.description || \"\", tags: profile.tags || [\"community\"]\n  },\n  community: {\n    widgets: JSON.parse(community.widgets) || [], menu: JSON.parse(community.menu) || defaultMenu, channels: community.channels || []\n  },\n  UI: {\n    discussions: !!community.channels,\n    channels: [],\n    personalizedPage: { icon: \"trophy\", label: \"\", component: \"\" }\n  }\n})\n\nconst options = [\"General\", \"News\", \"Q&A\", \"Help\", \"Off-Topic\", \"Meta\"];\n\nconst onIconPick = (s) => State.update(state.UI.personalizedPage.icon = s)\n\nfunction toggleDiscussions() {\n  state.UI.discussions = !state.UI.discussions\n  state.community.channels = state.UI.discussions ? state.UI.channels : []\n  State.update()\n}\n\nfunction removePage(label) {\n  state.community.menu = state.community.menu.filter(p => p.label !== label)\n  State.update()\n}\n\nfunction onAddChannel(selected) {\n  state.UI.channels = selected\n  state.community.channels = selected\n  State.update()\n}\n\nfunction menuElement(label, icon, component) {\n  if (!component && !icon) return \" \"\n\n  return <div class=\"input-group mt-2 mb-3\" key={label}>\n    <span class=\"input-group-text\"><i class={`bi bi-${icon}`}></i></span>\n    <span class=\"input-group-text\"> {label} </span>\n    <span class=\"input-group-text\">{\"->\"}</span>\n    <span class=\"input-group-text\"> {component} </span>\n    <span class=\"input-group-text pointer text-danger\" onClick={() => removePage(label)}> x </span>\n  </div>\n}\n\nfunction onWidgetChange(selected) {\n  const selectedLabels = []\n  for (const widget of selected) {\n    if (typeof (widget) == \"string\") {\n      selectedLabels.push(widget)\n    } else {\n      selectedLabels.push(widget.label)\n    }\n  }\n  State.update(state.community.widgets = selectedLabels)\n}\n\nfunction addMenuLink() {\n  state.community.menu.push(state.UI.personalizedPage)\n  State.update()\n}\n\nfunction submit() {\n  Social.set(\n    {\n      profile: state.profile,\n      community: state.community\n    }\n  )\n}\n\nreturn (\n  <>\n    <h3 class=\"mb-3 text-center\"> Create Your Community </h3>\n\n    <h5 class=\"mb-3\"> Basic Info </h5>\n    <div class=\"input-group mb-3\">\n      <span class=\"input-group-text\">Community's Name</span>\n      <input type=\"text\" class=\"form-control\" placeholder=\"Barcelona Dance Lovers\" value={state.profile.name} onChange={(e) => { State.update(state.profile.name = e.target.value) }} />\n    </div>\n    <div class=\"mb-3\">\n      <label class=\"form-label\">Brief Description ({state.profile.description.length}/250)</label>\n      <textarea class=\"form-control\" rows={3}\n        value={state.profile.description}\n        maxLength={250}\n        onChange={(e) => { State.update(state.profile.description = e.target.value) }}>\n      </textarea>\n    </div>\n\n    <hr />\n\n    <h5 class=\"my-3\"> Menu </h5>\n\n    {state.community.menu.map(({ label, icon, component }) => menuElement(label, icon, component))}\n    <div class=\"input-group mt-2 mb-3\">\n      <Widget src=\"simplar.near/widget/Community.Create.IconPicker\" props={{ onIconPick }} />\n      <input type=\"text\" onChange={e => { State.update(State.update(state.UI.personalizedPage.label = e.target.value)) }} />\n      <span class=\"input-group-text\">{\"->\"}</span>\n      <input type=\"text\" onChange={e => { State.update(state.UI.personalizedPage.component = e.target.value) }} />\n\n      <button onClick={addMenuLink}> Add </button>\n    </div>\n\n    <div class=\"mt-2\">\n      <div class=\"form-check form-switch\">\n        <input class=\"form-check-input\" type=\"checkbox\"\n          checked={state.UI.discussions} onClick={toggleDiscussions} /> Discussions\n      </div>\n      {state.UI.discussions &&\n        <div class=\"mt-2 mb-3\">\n          <Typeahead\n            multiple\n            allowNew\n            newSelectionPrefix=\"Add a new channel: \"\n            options={options}\n            defaultSelected={JSON.parse(state.community.channels)}\n            onChange={onAddChannel}\n            placeholder='Discussion Channels'\n          />\n        </div>\n      }\n    </div>\n\n    <hr />\n\n    <h5 class=\"mt-3\"> Community Widgets </h5>\n\n    <div class=\"input-group mb-3\">\n      <Typeahead\n        multiple\n        allowNew\n        options={[\"r\"]}\n        newSelectionPrefix=\"Widget: \"\n        defaultSelected={state.community.widgets}\n        onChange={onWidgetChange}\n        placeholder='Community Widgets'\n      />\n    </div>\n\n    <hr />\n\n    <button onClick={submit}> Create </button>\n  </>\n)", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/simplar.near/widget/Community.Create.Create", "__row_index": 0}