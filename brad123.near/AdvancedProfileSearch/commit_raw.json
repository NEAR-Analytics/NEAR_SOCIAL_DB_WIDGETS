{"tx_hash": "Arb8tgNrwSBeunx1JknkbnGAiExGNKX9QHMomtcVUaof", "action_id_social": "5E29QwjyM2QAuaKy6PB89fvTo1W2t7dDa7cibC53FjR9-0-widget", "block_id": 85993605, "block_timestamp": "2023-02-25 06:05:18.604", "signer_id": "brad123.near", "widget_name": "AdvancedProfileSearch", "source_code": "const profiles =\n  Social.get([\"*/profile/name\", \"*/profile/tags/*\"], \"final\") || {};\n\nconst profilesWithTags = { ...profiles };\nObject.entries(profiles).forEach(([key, valueObj]) => {\n  if (!valueObj?.profile?.hasOwnProperty(\"tags\")) {\n    delete profilesWithTags[key];\n  }\n});\nconst taggedProfiles = Social.keys(`*/profile/tags/*`, \"final\") || {};\n\n// console.log(\"private\", taggedProfiles);\n\nconst computeResults = (term) => {\n  const terms = (term || \"\")\n    .toLowerCase()\n    .split(/[^\\w._-]/)\n    .filter((s) => !!s.trim());\n  const matchedAccountIds = [];\n\n  const limit = props.limit ?? 30;\n\n  const MaxSingleScore = 20;\n  const MaxScore = MaxSingleScore * 3;\n\n  const computeScore = (s) => {\n    s = s.toLowerCase();\n    return (\n      terms\n        .map((term) => {\n          const pos = s.indexOf(term);\n          return pos >= 0 ? Math.max(1, 20 - pos) : 0;\n        })\n        .reduce((s, v) => s + v, 0) / terms.length\n    );\n  };\n\n  Object.entries(profiles).forEach(([accountId, data]) => {\n    const accountIdScore = computeScore(accountId);\n    const name = data.profile.name || \"\";\n    const tags = Object.keys(data.profile.tags || {}).slice(0, 10);\n    const nameScore = computeScore(name);\n    const tagsScore = Math.min(\n      20,\n      tags.map(computeScore).reduce((s, v) => s + v, 0)\n    );\n    let score;\n    if (state.searchType === \"tag\") {\n      score = tagsScore;\n    } else if (state.searchType === \"accountId\") {\n      score = accountIdScore;\n    } else {\n      score = nameScore;\n    }\n\n    const finalScore = score / MaxScore;\n    if (finalScore > 0) {\n      matchedAccountIds.push({ score: finalScore, accountId, name, tags });\n    }\n  });\n\n  matchedAccountIds.sort((a, b) => b.score - a.score);\n  const result = matchedAccountIds.slice(0, limit);\n\n  State.update({\n    term,\n    result,\n  });\n\n  if (props.onChange) {\n    props.onChange({ term, result });\n  }\n};\n\nreturn (\n  <>\n    <div className=\"input-group\">\n      <select\n        name=\"cars\"\n        id=\"cars\"\n        onChange={(e) => State.update({ searchType: e.target.value })}\n      >\n        <option value=\"name\">Name</option>\n        <option value=\"tag\">Tag</option>\n        <option value=\"accountId\">Account Id</option>\n      </select>\n      <input\n        type=\"text\"\n        className={`form-control ${state.term ? \"border-end-0\" : \"\"}`}\n        value={state.term ?? \"\"}\n        onChange={(e) => computeResults(e.target.value)}\n        placeholder=\"\ud83d\udd0d Search\"\n      />\n      {state.term && (\n        <button\n          className=\"btn btn-outline-secondary border border-start-0\"\n          type=\"button\"\n          onClick={() => computeResults(\"\")}\n        >\n          <i className=\"bi bi-x\"></i>\n        </button>\n      )}\n    </div>\n    {props.debug && <pre>{JSON.stringify(state.result, undefined, 2)}</pre>}\n  </>\n);\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/brad123.near/widget/AdvancedProfileSearch", "metadata.description": NaN, "metadata.name": NaN, "metadata.tags.dao": NaN, "metadata.tags.near-social": NaN, "metadata.tags.search": NaN, "metadata": NaN}