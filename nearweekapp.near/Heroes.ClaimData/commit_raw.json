{"tx_hash": "4rnvdcP4REs4fC7UuVDpXwkaVSUkYgRvYKLcHd3p4dCQ", "action_id_social": "5gsgmXkMg6sy1wxbHRSvJSabi2ynhUp5qgkZatF6Ji1W-0-widget", "block_id": 90920885, "block_timestamp": "2023-05-02 09:56:20.238", "signer_id": "nearweekapp.near", "widget_name": "Heroes.ClaimData", "source_code": "const tokenMap = {\n  \"a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48.factory.bridge.near\": {\n    symbol: \"USDC.e\",\n    decimals: 6,\n  },\n  \"dac17f958d2ee523a2206206994597c13d831ec7.factory.bridge.near\": {\n    symbol: \"USDT.e\",\n    decimals: 6,\n  },\n  \"6b175474e89094c44da98b954eedeac495271d0f.factory.bridge.near\": {\n    symbol: \"DAI\",\n    decimals: 18,\n  },\n};\n\nfunction dayToEpoch(days) {\n  const now = Date.now();\n  const xDay = Number(days) * 24 * 60 * 60 * 1000;\n  const nextDay = now + xDay;\n  const epochSeconds = Math.floor(nextDay * 1000000);\n\n  return epochSeconds.toString();\n}\n\nconst kycMinAmount = 150;\nconst matchToken = (token) => tokenMap[token].symbol;\nconst convertAmount = (amount, token) =>\n  amount / Math.pow(10, tokenMap[token].decimals);\nconst amountToReadable = (amount) =>\n  amount\n    .toFixed(0)\n    .toString()\n    .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\nconst isDisabled =\n  convertAmount(props.amount, props.token) > kycMinAmount ||\n  props.bountyClaimed ||\n  !context.accountId\n    ? \" disabled\"\n    : \"\";\n\nState.init({\n  message: \"\",\n  deadline: 1,\n});\n\nconst onChangeMessage = (message) => {\n  State.update({\n    message,\n  });\n};\n\nconst onChangeDeadline = (deadline) => {\n  State.update({\n    deadline,\n  });\n};\n\nconst handleClick = () => {\n  Near.call([\n    {\n      contractName: props.contract,\n      methodName: \"bounty_claim\",\n      args: {\n        id: props.bountyId,\n        deadline: dayToEpoch(state.deadline),\n        description: state.message,\n      },\n      gas: 300000000000000,\n      deposit: 1000000000000000000000000,\n    },\n  ]);\n};\n\nreturn (\n  <div css=\"min-width: 300px; max-width: 400px;\">\n    <div class=\"card\">\n      <div class=\"card-body\">\n        <span class=\"fw-bold\">{matchToken(props.token)} </span>\n        <span class=\"fw-bold fs-2\">\n          ${amountToReadable(convertAmount(props.amount, props.token))}\n        </span>\n        <h6 class=\"card-title\">{props.bountyTitle}</h6>\n        <p class=\"card-text\"></p>\n        {convertAmount(props.amount, props.token) > kycMinAmount &&\n        !props.bountyCompleted ? (\n          <div>\n            <span class=\"badge text-bg-dark p-2\">\n              <span class=\"fs-5\">KYC requied</span>\n            </span>{\" \"}\n            <hr />\n            <div class=\"blockquote-footer figcaption\">\n              KYC is required for bounties over $400, please head to\n              <a href=\"https://heroes.build\" target=\"_blank\">\n                https://heroes.build/\n              </a>{\" \"}\n              to pass KYC before claiming this bounty\n            </div>\n          </div>\n        ) : (\n          \"\"\n        )}\n        {!props.bountyCompleted ? (\n          <>\n            {!isDisabled ? (\n              <>\n                <div class=\"input-group mb-3\">\n                  <span class=\"input-group-text\" id=\"message\">\n                    -\n                  </span>\n                  <input\n                    type=\"text\"\n                    class=\"form-control\"\n                    onChange={(e) => onChangeMessage(e.target.value)}\n                    placeholder=\"Enter short message\"\n                    aria-label=\"message\"\n                    aria-describedby=\"message\"\n                  />\n                </div>\n                <select\n                  class=\"form-select mb-2\"\n                  aria-label=\"Default select example\"\n                  onChange={(e) => onChangeDeadline(e.target.value)}\n                >\n                  <option value=\"1\" selected>\n                    Will complete in{\" \"}\n                  </option>\n                  <option value=\"1\">1 Day</option>\n                  <option value=\"2\">2 Days</option>\n                  <option value=\"3\">3 Days</option>\n                  <option value=\"7\">7 Days</option>\n                </select>\n              </>\n            ) : (\n              \"\"\n            )}\n\n            <a\n              class={\"btn bg-warning float-end \" + isDisabled}\n              onClick={handleClick}\n            >\n              Claim\n            </a>\n            <p class=\"font-monospace small align-text-top\">\n              Bounty ID: {props.bountyId}\n            </p>\n          </>\n        ) : (\n          <>\n            <span class=\"badge text-bg-success p-2\">\n              <span class=\"fs-5\">Completed</span>\n            </span>{\" \"}\n            <hr />\n            <div class=\"blockquote-footer figcaption\">\n              Bounty completed and can't be claimed any more, check details on\n              <a\n                href={\"https://heroes.build/bounties/bounty/\" + props.bountyId}\n                target=\"_blank\"\n              >\n                https://heroes.build/\n              </a>{\" \"}\n            </div>\n          </>\n        )}\n      </div>\n      {!context.accountId && !props.bountyCompleted ? (\n        <div class=\"m-2\">\n          <p class=\"blockquote-footer text-end\">\n            Sign-in NEAR wallet to be able to interact\n          </p>\n        </div>\n      ) : (\n        \"\"\n      )}\n    </div>\n  </div>\n);\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nearweekapp.near/widget/Heroes.ClaimData", "metadata.description": NaN, "metadata.name": NaN}