{"tx_hash": "6R28MHxTmzGWntrLzZab2efBvQUNs3g9FbxTGZNP5pmo", "action_id_social": "HaNY817aH82zCL55Zp26Fm35dqzbnbJUjtHMWravMUus-0-widget", "block_id": 93599745, "block_timestamp": "2023-06-06T17:03:21.881Z", "signer_id": "nearweekapp.near", "widget_name": "NEARWEEKNews", "source_code": "const accountId = \"near\";\nconst limit = 5;\nlet posts = [];\n\nconst indexedPosts = Social.index(\"post\", \"main\", {\n  accountId,\n  limit: 20,\n  order: \"desc\",\n});\n\nif (indexedPosts?.length > 0) {\n  posts = [];\n\n  indexedPosts.forEach((post) => {\n    const data = Social.get(`${post.accountId}/post/main`, post.blockHeight);\n    if (data) {\n      const json = JSON.parse(data);\n      const content = json.text.split(\"\\n\");\n      const title = content[0] || \"\";\n      const url = content[1] || content[2] || \"\";\n      const lastLine = content.pop() || \"\";\n      const hasNewsTag = lastLine.indexOf(\"#news\") > -1;\n      const isValid = hasNewsTag && url.indexOf(\"https://\") > -1;\n\n      if (isValid) {\n        const block = Near.block(post.blockHeight);\n        let createdAt = \"\";\n        if (block) {\n          const timeMs = parseFloat(block.header.timestamp_nanosec) / 1e6;\n          createdAt = new Date(timeMs).toISOString();\n        }\n        posts.push({\n          blockHeight: post.blockHeight,\n          title,\n          url,\n          thumbnail: \"https://near.org/favicon.png\",\n          createdAt,\n          categories: [\"Near ORG\", \"blog\"],\n        });\n\n        posts.sort((a, b) => b.blockHeight - a.blockHeight);\n      }\n    }\n  });\n}\n\nconst data = fetch(\n  \"https://nearweek.com/api/md/dao-news?populate=deep&sort=createdAt:desc&pagination[pageSize]=5\",\n  {\n    //subscribe: true,\n    method: \"GET\",\n    headers: {\n      Accept: \"*/*\",\n      Authorization:\n        \"Bearer 15699f0723aa9fe9f655b1a94e450552476c08807f67b525b5a3c8011eecc8aee6d45923443620f17815b897858be058cd7bd89ddf23a28aabaecb178e7ebc55d380293beeb51a8ce87b40e1518ce4708e4d51a06b115f27fa64ab5cbee5a3511cec785d7ae6a155ecd05ac8196aadae3e9b8e9401b8df8d8b69904f7364f925\",\n    },\n  }\n);\n\nif (!state.theme) {\n  State.update({\n    theme: styled.div`\n    font-family: \"Mona Sans\", sans-serif;\n`,\n  });\n}\nconst Theme = state.theme;\n\nconst Wrapper = styled.div`\n  display: grid;\n  margin-bottom: 12px;\n  gap: 2px;\n`;\n\nconst H2 = styled.h2`\n  font-size: 19px;\n  font-weight: 700;\n  line-height: 22px;\n  color: #11181C;\n  margin: 0;\n`;\n\nconst ClockIconSVG = () => {\n  return (\n    <svg\n      width=\"10\"\n      height=\"10\"\n      viewBox=\"0 0 10 10\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M4.91345 2.39779V5.19946H7.01471M9.11597 5.19946C9.11597 5.75134 9.00727 6.29782 8.79607 6.8077C8.58487 7.31757 8.27532 7.78085 7.88508 8.17109C7.49484 8.56133 7.03156 8.87088 6.52168 9.08208C6.01181 9.29328 5.46533 9.40198 4.91345 9.40198C4.36157 9.40198 3.81509 9.29328 3.30522 9.08208C2.79535 8.87088 2.33206 8.56133 1.94183 8.17109C1.55159 7.78085 1.24203 7.31757 1.03083 6.8077C0.819639 6.29782 0.710937 5.75134 0.710938 5.19946C0.710938 4.08489 1.1537 3.01596 1.94183 2.22784C2.72995 1.43971 3.79888 0.996948 4.91345 0.996948C6.02803 0.996948 7.09695 1.43971 7.88508 2.22784C8.6732 3.01596 9.11597 4.08489 9.11597 5.19946Z\"\n        stroke=\"#6F7679\"\n        stroke-width=\"0.7\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n    </svg>\n  );\n};\n\nconst Content = styled.div`\n  display: grid;\n  margin: 36px 0 24px 0;\n  gap: 24px;\n  width: 100%;`;\n\nconst Card = styled.div`\n    display: flex;\n    @media (max-width: 768px) {\n      display:   ${(props) => (props.index > 4 ? \"none\" : \"flex\")}; \n    }\n`;\n\nconst CardContent = styled.div`\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    margin-top: 0;\n    margin-left: 1rem;\n`;\n\nconst CardTitle = styled.div`\n    font-style: normal;\n    font-weight: 600;\n    font-size: 13px;\n    line-height: 16px;\n    letter-spacing: -0.02em;\n    color: #000000;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;  \n    overflow: hidden;\n    a {\n        color: inherit;\n    }\n`;\n\nconst CardImage = styled.img`\n    border-radius: var(--bs-border-radius);\n    border: 0.5px solid hsla(210, 12%, 93%, 1);\n    min-width: 78px;\n`;\n\nconst CardFooter = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n`;\n\nconst CardDate = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    color: hsla(198, 4%, 45%, 1);\n    font-style: normal;\n    font-weight: 400;\n    font-size: 10px;\n    line-height: 8px;\n    letter-spacing: -0.02em;\n`;\n\nconst Badges = styled.div`\n    display: flex;\n    gap: 6px;\n`;\n\nconst Badge = styled.span`\n    border: 1px solid;    \n    border-color: hsla(214, 10%, 86%, 1);\n    border-radius: 4px;\n    font-weight: 500;\n    font-size: 8px;\n    line-height: 8px;\n    padding: 2px 4px;\n    text-transform: uppercase;\n    color: hsla(204, 5%, 44%, 1);\n`;\n\nconst ButtonLink = styled.a`\n  display: block;\n  width: 100%;\n  padding: 8px;\n  height: 32px;\n  background: #FBFCFD;\n  border: 1px solid #D7DBDF;\n  border-radius: 50px;\n  font-weight: 600;\n  font-size: 12px;\n  line-height: 15px;\n  text-align: center;\n  cursor: pointer;\n  color: #11181C !important;\n  margin: 0;\n\n  &:hover,\n  &:focus {\n    background: #ECEDEE;\n    text-decoration: none;\n    outline: none;\n  }\n`;\n\nconst news = [...data.body.data, ...posts]\n  .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))\n  .slice(0, limit);\nconst nwSite = \"https://nearweek.com\";\n\nfunction dateToDays(date) {\n  const timeAgo = (diffSec) =>\n    diffSec < 60000\n      ? `${(diffSec / 1000) | 0}s`\n      : diffSec < 3600000\n      ? `${(diffSec / 60000) | 0}m`\n      : diffSec < 86400000\n      ? `${(diffSec / 3600000) | 0}h`\n      : `${(diffSec / 86400000) | 0}d`;\n\n  var d = new Date(date);\n  return timeAgo(Date.now() - d.getTime());\n}\n\nreturn (\n  <Theme>\n    {data !== null ? (\n      <Wrapper>\n        <H2>News</H2>\n        <Content>\n          {news.map((item, index) => (\n            <Card index={index}>\n              <div class=\"d-flex\">\n                <CardImage width=\"78\" height=\"78\" src={item.thumbnail} alt=\"\" />\n                <CardContent>\n                  <CardTitle>\n                    <a href={article.url} target=\"_blank\">\n                      {item.title}\n                    </a>\n                  </CardTitle>\n                  <CardFooter>\n                    <Badges>\n                      {item.categories.length > 0 &&\n                        item.categories.map((category) => (\n                          <Badge>{category}</Badge>\n                        ))}\n                    </Badges>\n                    <CardDate>\n                      <ClockIconSVG />\n                      {item.createdAt\n                        ? `${dateToDays(item.createdAt)} ago`\n                        : \"\"}\n                    </CardDate>\n                  </CardFooter>\n                </CardContent>\n              </div>\n            </Card>\n          ))}\n        </Content>\n        <ButtonLink href=\"https://nearweek.com\" target=\"_blank\">\n          View All News\n        </ButtonLink>\n      </Wrapper>\n    ) : (\n      <div>Loading ...</div>\n    )}\n  </Theme>\n);\n", "metadata": null, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/nearweekapp.near/widget/NEARWEEKNews", "__row_index": 2}