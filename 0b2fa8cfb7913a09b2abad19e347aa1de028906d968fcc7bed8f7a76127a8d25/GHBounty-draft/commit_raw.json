{"tx_hash": "71VyQ6HML8qBfXqL1fmjDpoFeXpykjcJc7kCt1bFGxpe", "action_id_social": "F4bW75W8tXdap4YKi6B3d9MYE9Twxc5q6rmq4vxV2Th8-0-widget", "block_id": 90007553, "block_timestamp": "2023-04-20 09:25:20.320", "signer_id": "0b2fa8cfb7913a09b2abad19e347aa1de028906d968fcc7bed8f7a76127a8d25", "widget_name": "GHBounty-draft", "source_code": "// FETCH CSS\nconst cssFont = fetch(\n  \"https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800\"\n).body;\n// const css = fetch(\n//   \"https://pluminite.mypinata.cloud/ipfs/Qmboz8aoSvVXLeP5pZbRtNKtDD3kX5D9DEnfMn2ZGSJWtP\"\n// ).body;\nconst css = fetch(\n  \"https://github.com/armanddid/hackathon/blob/main/githuboracle.css\"\n);\n\nconsole.log(css);\n\ninitState({\n  bountyContractAddress: \"0x6a5324A3D7BfEb6D2EBeEAA9D73350051d9E3691\",\n  activePage: \"Create Bounty\",\n  prURL: \"\",\n  rewardAsset: \"0x7ACAf6167a39BE1dfFBb542Ac848030dcDF141CF\",\n  rewardAmount: \"\",\n  lockPeriod: 5000000,\n  debuglogs: \"\",\n});\n\nconst erc20Abi = fetch(\n  \"https://gist.githubusercontent.com/veox/8800debbf56e24718f9f483e1e40c35c/raw/f853187315486225002ba56e5283c1dba0556e6f/erc20.abi.json\"\n);\nif (!erc20Abi.ok) {\n  return \"scam\";\n}\n\nconst bountyContractAbi = fetch(\n  \"https://gist.githubusercontent.com/birchmd/f52cc8244be64eca036d9156486307d4/raw/6aefe23dbeda1592bd7c9c12119ac8e8faa83564/BountyProgram.abi.json\"\n);\nif (!bountyContractAbi.ok) {\n  return \"scam\";\n}\n\nif (state.sender === undefined) {\n  State.update({ sender: Ethers.send(\"eth_requestAccounts\", [])[0] });\n}\n\nconst tokens = {\n  \"Select Token\": \"\",\n  BYC: \"0x7ACAf6167a39BE1dfFBb542Ac848030dcDF141CF\",\n};\n\nconst tokensMenuItems = Object.keys(tokens).map((token) => (\n  <option value={tokens[token]}>{token}</option>\n));\n\nconst setActive = (type) => {\n  State.update({ activePage: type });\n};\n\nconst Theme = styled.div`font-family: Manrope, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif; ${cssFont} ${css}`;\n\nconst Tab = styled.button`\n  padding: 10px 40px;\n  cursor: pointer;\n  border: 0;\n  outline: 0;\n  color: white;\n  background-color: transparent;\n  border-bottom: 2px solid black;\n  ${({ active }) =>\n    active &&\n    `     \n    border-bottom: 2px solid white;\n  `}\n`;\nconst types = [\n  \"Create Bounty\",\n  \"Browse Bounties\",\n  \"Apply to Bounty\",\n  \"Applications\",\n  \"My Bounties\",\n  \"Info\",\n];\nconst ButtonGroup = styled.div`\n  display: flex;\n`;\n\nconst approveSpending = () => {\n  const erc20 = new ethers.Contract(\n    state.rewardAsset,\n    erc20Abi.body,\n    Ethers.provider().getSigner()\n  );\n\n  let amount = 1000000000;\n\n  const output = erc20.approve(state.bountyContractAddress, amount);\n\n  State.update({ debuglogs: JSON.stringify(output) });\n};\n\nconst bountyObject = new ethers.Contract(\n  state.bountyContractAddress,\n  bountyContractAbi.body,\n  Ethers.provider().getSigner()\n);\n\nconst createBounty = () => {\n  const output = bountyObject.createBounty(\n    state.prURL,\n    state.rewardAsset,\n    state.rewardAmount,\n    state.lockPeriod\n  );\n};\n\nconst iface = new ethers.utils.Interface(erc20Abi.body);\n\nconst getTokenBalance = (sender) => {\n  const encodedData = iface.encodeFunctionData(\"balanceOf\", [sender]);\n\n  return Ethers.provider()\n    .call({\n      to: state.rewardAsset,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      const receiverBalanceHex = iface.decodeFunctionResult(\n        \"balanceOf\",\n        rawBalance\n      );\n\n      const value = Big(receiverBalanceHex.toString())\n        .div(Big(10).pow(state.tokenDecimals))\n        .toFixed(2)\n        .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n\n      return value;\n    });\n};\n\nconst getTokenDecimals = () => {\n  const encodedData = iface.encodeFunctionData(\"decimals\", []);\n\n  return Ethers.provider()\n    .call({\n      to: state.rewardAsset,\n      data: encodedData,\n    })\n    .then((tokenDecimals) => {\n      State.update({ tokenDecimals: parseInt(Number(tokenDecimals)) });\n    });\n};\n\nconst setToken = (token) => {\n  State.update({ token });\n  getTokenDecimals();\n};\n\nsetToken(state.rewardAsset);\n\ngetTokenBalance(state.sender).then((value) => {\n  State.update({ senderBalance: value });\n});\n\nconst ifaceBrowse = new ethers.utils.Interface(bountyContractAbi.body);\n\nconst hex2BN = (hex) => {\n  let input;\n  if (hex.startsWith(\"0x\")) {\n    input = hex.substring(2);\n  } else {\n    input = hex;\n  }\n  return new BN(input, 16);\n};\n\nconst tableBounties = [\n  {\n    id: 1,\n    prURL: \"link URL\",\n    rewardAsset: \"BYC\",\n    rewardAmount: 2000,\n  },\n];\n\nState.update({ tableBounties: tableBounties });\n\nconst parseBounty = (value) => {\n  const xs = JSON.parse(JSON.stringify(value));\n  const id = hex2BN(xs[0][\"hex\"]);\n  const prURL = xs[1];\n  const rewardAsset = xs[2];\n  const rewardAmount = hex2BN(xs[3][\"hex\"]);\n  const lockPeriod = hex2BN(xs[4][\"hex\"]);\n  const owner = xs[5];\n  return {\n    id,\n    prURL,\n    rewardAsset,\n    rewardAmount,\n    lockPeriod,\n    owner,\n  };\n};\n\nconst listOpenBounties = () => {\n  const encodedData = ifaceBrowse.encodeFunctionData(\"listOpenBounties\", []);\n\n  Ethers.provider()\n    .call({\n      to: state.bountyContractAddress,\n      data: encodedData,\n    })\n    .then((response) => {\n      const bounties = ifaceBrowse\n        .decodeFunctionResult(\"listOpenBounties\", response)[0]\n        .map(parseBounty);\n      State.update({ bounties: JSON.stringify(bounties) });\n    });\n};\n\nconst fetchBounties = () => {\n  listOpenBounties();\n};\n\nState.update({ payeeAddress: state.sender });\n\nconst applyToBounty = () => {\n  const output = bountyObject.submitApplication(\n    state.bountyID,\n    state.payeeAddress,\n    state.githubHandle,\n    state.comments\n  );\n};\n\nconst listApplications = () => {\n  const id = parseInt(state.bountyID);\n  const encodedData = ifaceBrowse.encodeFunctionData(\"listApplications\", [id]);\n\n  Ethers.provider()\n    .call({\n      to: state.bountyContractAddress,\n      data: encodedData,\n    })\n    .then((response) => {\n      const applications = ifaceBrowse\n        .decodeFunctionResult(\"listApplications\", response)[0]\n        .map((value) => {\n          const xs = JSON.parse(JSON.stringify(value));\n          const id = hex2BN(xs[0][\"hex\"]);\n          const payee = xs[1];\n          const ghUsername = xs[2];\n          const comment = xs[3];\n          return {\n            id,\n            payee,\n            ghUsername,\n            comment,\n          };\n        });\n      State.update({ applications: JSON.stringify(applications) });\n    });\n};\n\nconst approveApplication = () => {\n  bountyObject.approveApplication(state.applicationID, state.payeeAddress);\n};\n\nconst listActiveBountiesBy = () => {\n  const payeeAddress = state.payeeAddress;\n  const encodedData = ifaceBrowse.encodeFunctionData(\"listActiveBountiesBy\", [\n    payeeAddress,\n  ]);\n\n  Ethers.provider()\n    .call({\n      to: state.bountyContractAddress,\n      data: encodedData,\n    })\n    .then((response) => {\n      const bounties = ifaceBrowse\n        .decodeFunctionResult(\"listActiveBountiesBy\", response)[0]\n        .map((value) => {\n          const xs = JSON.parse(JSON.stringify(value));\n          const bounty = parseBounty(xs[0]);\n          const payee = xs[1];\n          const ghUsername = xs[2];\n          const lockHeight = hex2BN(xs[3][\"hex\"]);\n          return {\n            bounty,\n            payee,\n            ghUsername,\n            lockHeight,\n          };\n        });\n      State.update({ myActiveBounties: JSON.stringify(bounties) });\n    });\n};\n\nconst tryClaimBounty = () => {\n  bountyObject.tryClaimBounty(state.bountyIdToClaim).then((hash) => {\n    console.log(hash);\n  });\n};\n\nconst finishClaimBounty = () => {\n  bountyObject.finishClaimBounty(state.bountyIdToClaim).then((hash) => {\n    console.log(hash);\n  });\n};\n\nreturn (\n  <>\n    <div class=\"mainContainer\">\n      <ButtonGroup>\n        {types.map((type) => (\n          <Tab\n            key={type}\n            active={state.activePage === type}\n            onClick={() => setActive(type)}\n          >\n            {type}\n          </Tab>\n        ))}\n      </ButtonGroup>\n\n      <div\n        style={\n          state.activePage == \"Create Bounty\"\n            ? { display: \"\" }\n            : { display: \"none\" }\n        }\n      >\n        <h1> Create a new bounty </h1>\n        <div>\n          <div> {state.debuglogs ?? \"the logs will appear here\"} </div>\n          <label htmlFor=\"name\">Github PR URL</label>\n          <input\n            value={state.prURL}\n            id=\"prurl\"\n            type=\"text\"\n            onChange={(e) => State.update({ prURL: e.target.value })}\n            placeholder=\"Paste here the URL of your github PR\"\n            required\n          />\n          <div>\n            Your balance ={\" \"}\n            {state.senderBalance ?? (!state.sender ? \"0\" : \"...\")}\n            &nbsp;BYC{\" \"}\n          </div>\n          <label htmlFor=\"amount\">Bounty amount:</label>\n          <input\n            id=\"amount\"\n            type=\"number\"\n            value={state.rewardAmount}\n            onChange={(e) => State.update({ rewardAmount: e.target.value })}\n            placeholder=\"0.0\"\n            required\n          />\n          <label for=\"selectToken\">Select token</label>\n          <select\n            class=\"form-select\"\n            id=\"selectToken\"\n            onChange={(e) => State.update({ rewardAsset: e.target.value })}\n          >\n            {tokensMenuItems}\n          </select>\n          <br />\n\n          {!!state.sender ? (\n            <button\n              class=\"LidoStakeFormSubmitContainer\"\n              onClick={approveSpending}\n            >\n              <span>Approve</span>\n            </button>\n          ) : (\n            <Web3Connect\n              className=\"LidoStakeFormSubmitContainer\"\n              connectLabel=\"Connect with Web3\"\n            />\n          )}\n\n          <br />\n\n          {!!state.sender ? (\n            <button class=\"LidoStakeFormSubmitContainer\" onClick={createBounty}>\n              <span>Submit</span>\n            </button>\n          ) : (\n            <Web3Connect\n              className=\"LidoStakeFormSubmitContainer\"\n              connectLabel=\"Connect with Web3\"\n            />\n          )}\n        </div>\n      </div>\n      <div\n        style={\n          state.activePage == \"Apply to Bounty\"\n            ? { display: \"\" }\n            : { display: \"none\" }\n        }\n      >\n        <h1>Apply to an existing Bounty</h1>\n\n        <label htmlFor=\"bountyID\">Bounty ID</label>\n        <input\n          value={state.bountyID}\n          id=\"bountyID\"\n          type=\"text\"\n          onChange={(e) => State.update({ bountyID: e.target.value })}\n          placeholder=\"Enter the bountyID\"\n          required\n        />\n        <label htmlFor=\"payeeAddress\">Your address</label>\n        <input\n          value={state.sender}\n          id=\"payeeAddress\"\n          type=\"text\"\n          onChange={(e) => State.update({ payeeAddress: e.target.value })}\n          placeholder=\"Add the address you will receive the bounty to\"\n          required\n        />\n        <label htmlFor=\"githubHandle\">Your github handle</label>\n        <input\n          value={state.githubHandle}\n          id=\"githubHandle\"\n          type=\"text\"\n          onChange={(e) => State.update({ githubHandle: e.target.value })}\n          placeholder=\"Enter your github handle\"\n          required\n        />\n        <label htmlFor=\"comments\">Comments</label>\n        <input\n          value={state.comments}\n          id=\"comments\"\n          type=\"text\"\n          onChange={(e) => State.update({ comments: e.target.value })}\n          placeholder=\"Please add your comments here\"\n          required\n        />\n        <br />\n        {!!state.sender ? (\n          <button class=\"LidoStakeFormSubmitContainer\" onClick={applyToBounty}>\n            <span>Apply</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n      </div>\n\n      <div\n        class=\"\"\n        style={\n          state.activePage == \"Browse Bounties\"\n            ? { display: \"\" }\n            : { display: \"none\" }\n        }\n      >\n        <h1> See all bounties </h1>\n\n        <button class=\"LidoStakeFormSubmitContainer\" onClick={fetchBounties}>\n          <span>List bounties</span>\n        </button>\n\n        <div>{state.bounties ?? \"the list of bounties will appear here\"}</div>\n      </div>\n      <div\n        style={\n          state.activePage == \"Applications\"\n            ? { display: \"\" }\n            : { display: \"none\" }\n        }\n      >\n        <h1>Approve applications</h1>\n        <h3>1. Retrieve applications for a bounty</h3>\n        <label htmlFor=\"bountyID\">Bounty ID</label>\n        <input\n          value={state.bountyID}\n          id=\"comments\"\n          type=\"text\"\n          onChange={(e) => State.update({ bountyID: e.target.value })}\n          placeholder=\"Add the bounty ID to retrieve its applications\"\n          required\n        />\n        <br />\n        {!!state.sender ? (\n          <button\n            class=\"LidoStakeFormSubmitContainer\"\n            onClick={listApplications}\n          >\n            <span>Retrieve Applications</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n        <br />\n        <div> {state.applications ?? \"the applications will appear here\"} </div>\n\n        <br />\n        <h3>2. Approve an application</h3>\n        <label htmlFor=\"applicationID\">Application ID</label>\n        <input\n          value={state.applicationID}\n          id=\"applicationID\"\n          type=\"text\"\n          onChange={(e) => State.update({ applicationID: e.target.value })}\n          placeholder=\"Enter the applicationID to approve\"\n          required\n        />\n        <label htmlFor=\"payeeAddress\">Payee address</label>\n        <input\n          value={state.payeeAddress}\n          id=\"payeeAdress\"\n          type=\"text\"\n          onChange={(e) => State.update({ payeeAdress: e.target.value })}\n          placeholder=\"Enter the payee address\"\n          required\n        />\n        <br />\n        {!!state.sender ? (\n          <button\n            class=\"LidoStakeFormSubmitContainer\"\n            onClick={approveApplication}\n          >\n            <span>Approve application</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n      </div>\n\n      <div\n        class=\"\"\n        style={\n          state.activePage == \"My Bounties\"\n            ? { display: \"\" }\n            : { display: \"none\" }\n        }\n      >\n        <h1> My bounties </h1>\n        <h3>1. See all your approved bounties</h3>\n        <label htmlFor=\"payeeAddress\">Payee Address</label>\n        <input\n          value={state.payeeAddress}\n          id=\"payeeAddress\"\n          type=\"text\"\n          onChange={(e) => State.update({ payeeAddress: e.target.value })}\n          placeholder=\"Enter the address you applied with\"\n          required\n        />\n        <br />\n        {!!state.sender ? (\n          <button\n            class=\"LidoStakeFormSubmitContainer\"\n            onClick={listActiveBountiesBy}\n          >\n            <span>See my bounties</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n        <div>\n          {state.myActiveBounties ?? \"your approved bounties will appear here\"}\n        </div>\n\n        <br />\n        <h3>2. Claim your bounty</h3>\n        <label htmlFor=\"bountyIdToClaim\">Bounty ID to claim</label>\n        <input\n          id=\"bountyIdToClaim\"\n          type=\"text\"\n          onChange={(e) => State.update({ bountyIdToClaim: e.target.value })}\n          required\n        />\n        <br />\n        {!!state.sender ? (\n          <button class=\"LidoStakeFormSubmitContainer\" onClick={tryClaimBounty}>\n            <span>Start claim bounty</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n        {!!state.sender ? (\n          <button\n            class=\"LidoStakeFormSubmitContainer\"\n            onClick={finishClaimBounty}\n          >\n            <span>Finish claim bounty</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n      </div>\n\n      <div\n        style={\n          state.activePage == \"Info\" ? { display: \"\" } : { display: \"none\" }\n        }\n      >\n        <div>Address = {state.sender ?? \"...\"}</div>\n        <div>\n          Balance = {state.balance ?? (!state.sender ? \"0\" : \"...\")}&nbsp;ETH{\" \"}\n        </div>\n        <div> {state.debuglogs ?? \"the logs will appear here\"} </div>\n      </div>\n    </div>\n  </>\n);\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/0b2fa8cfb7913a09b2abad19e347aa1de028906d968fcc7bed8f7a76127a8d25/widget/GHBounty-draft", "metadata.tags.ethdenver2023": NaN}