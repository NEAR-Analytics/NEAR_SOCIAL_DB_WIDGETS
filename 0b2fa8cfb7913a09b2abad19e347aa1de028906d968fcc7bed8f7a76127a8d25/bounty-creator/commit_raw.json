{"tx_hash": "8FnBCVYLEjqrdPEKkiUuDehkJ59gekRCkyy7VWXMQ81h", "action_id_social": "8EpRneqZn57rCoRuqC4YqkuwbGhda2ZbA1LZrXSGhVdC-0-widget", "block_id": 89573119, "block_timestamp": "2023-04-14 15:35:31.699", "signer_id": "0b2fa8cfb7913a09b2abad19e347aa1de028906d968fcc7bed8f7a76127a8d25", "widget_name": "bounty-creator", "source_code": "initState({\n  prURL: \"https://github.com/aurora-is-near/aurora-engine/pull/739\",\n  rewardAsset: \"0x7ACAf6167a39BE1dfFBb542Ac848030dcDF141CF\", //dummy USDC\n  rewardAmount: 1000,\n  lockPeriod: 5000000,\n  debuglogs: \"\",\n});\n\nif (state.sender === undefined) {\n  State.update({ sender: Ethers.send(\"eth_requestAccounts\", [])[0] });\n}\n\n// if (!state.sender) return \"Please login first\";\n\n//Retrieve ETH balance\nif (state.balance === undefined && state.sender) {\n  Ethers.provider()\n    .getBalance(state.sender)\n    .then((balance) => {\n      State.update({ balance: Big(balance).div(Big(10).pow(18)).toFixed(2) });\n    });\n}\n\n// const sender = Ethers.send(\"eth_requestAccounts\", [])[0];\n// if (!sender) return \"Please login first\";\n\n// return <p>Account: {sender}</p>;\n\n//CONTRACT INTERACTIONS\n\n//testnet\nconst bountyContractAddress = \"0xb405a96238ca46E9d3268271F87dbBf90E4903Bf\";\n\n//Approve spending\nconst erc20Abi = fetch(\n  \"https://gist.githubusercontent.com/veox/8800debbf56e24718f9f483e1e40c35c/raw/f853187315486225002ba56e5283c1dba0556e6f/erc20.abi.json\"\n);\nif (!erc20Abi.ok) {\n  return \"scam\";\n}\n\nconst approveSpending = () => {\n  const erc20 = new ethers.Contract(\n    state.rewardAsset,\n    erc20Abi.body,\n    Ethers.provider().getSigner()\n  );\n\n  let amount = 1000000000;\n\n  const output = erc20.approve(bountyContractAddress, amount);\n\n  State.update({ debuglogs: JSON.stringify(output) });\n};\n\n//fetch the ABI\nconst bountyContractAbi = fetch(\n  \"https://gist.githubusercontent.com/birchmd/f52cc8244be64eca036d9156486307d4/raw/66da5745b22c140bdf4eff848ab4e3aa5f0b666e/BountyProgram.abi.json\"\n);\nif (!bountyContractAbi.ok) {\n  return \"scam\";\n}\n\nconst bountyObject = new ethers.Contract(\n  bountyContractAddress,\n  bountyContractAbi.body,\n  Ethers.provider().getSigner()\n);\n\nconst createBounty = () => {\n  // State.update({ debuglogs: \"starting\" });\n\n  const output = bountyObject.createBounty(\n    state.prURL,\n    state.rewardAsset,\n    state.rewardAmount,\n    state.lockPeriod\n  );\n\n  State.update({ debuglogs: JSON.stringify(output) });\n};\n\n//initiate functions with etherjs ? only needed if we do queries\n// const iface = new ethers.utils.Interface(bountyContractAbi.body);\n\n// const tokens = {\n//   \"Select Token\": \"\",\n//   USDT: \"0xdac17f958d2ee523a2206206994597c13d831ec7\",\n//   DAI: \"0x6b175474e89094c44da98b954eedeac495271d0f\",\n//   USDC: \"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48\",\n//   MKR: \"0x9f8f72aa9304c8b593d555f12ef6589cc3a579a2\",\n// };\n\n//functions for UI\n// const tokensMenuItems = Object.keys(tokens).map((token) => (\n//   <option value={tokens[token]}>{token}</option>\n// ));\n\n// const setToken = (token) => {\n//   State.update({ token });\n//   getTokenDecimals();\n// };\n\n// FETCH CSS\nconst cssFont = fetch(\n  \"https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800\"\n).body;\nconst css = fetch(\n  \"https://pluminite.mypinata.cloud/ipfs/Qmboz8aoSvVXLeP5pZbRtNKtDD3kX5D9DEnfMn2ZGSJWtP\"\n).body;\n\nif (!cssFont || !css) return \"\";\n\nif (!state.theme) {\n  State.update({\n    theme: styled.div`\n    font-family: Manrope, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\n    ${cssFont}\n    ${css}\n`,\n  });\n}\nconst Theme = state.theme;\n\n// RETURN UI\nreturn (\n  <Theme>\n    <div class=\"LidoContainer\">\n      <div onSubmit={handleSubmit}>\n        <label htmlFor=\"name\">Task name:</label>\n        <input\n          id=\"name\"\n          type=\"text\"\n          value={name}\n          onChange={(event) => setName(event.target.value)}\n          placeholder=\"Enter the name of your task\"\n          required\n        />\n        <br />\n        <label htmlFor=\"description\">Description:</label>\n        <input\n          id=\"description\"\n          type=\"text\"\n          value={description}\n          onChange={(event) => setEmail(event.target.value)}\n          placeholder=\"Enter the description of your task\"\n          required\n        />\n        <br />\n        <div>Address = {state.sender ?? \"...\"}</div>\n        <div>\n          Balance = {state.balance ?? (!state.sender ? \"0\" : \"...\")}&nbsp;ETH{\" \"}\n        </div>\n        <label htmlFor=\"amount\">Bounty amount:</label>\n        <input\n          id=\"amount\"\n          type=\"number\"\n          value={amount}\n          onChange={(event) => setNearAddress(event.target.value)}\n          placeholder=\"0.0\"\n          required\n        />\n        <label for=\"selectToken\">Select token</label>\n        <select\n          class=\"form-select\"\n          id=\"selectToken\"\n          onChange={(e) => {\n            setToken(e.target.value);\n          }}\n        >\n          {tokensMenuItems}\n        </select>\n        <br />\n        {!!state.sender ? (\n          <button\n            class=\"LidoStakeFormSubmitContainer\"\n            onClick={approveSpending}\n          >\n            <span>Approve</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n        <br />\n\n        {!!state.sender ? (\n          <button class=\"LidoStakeFormSubmitContainer\" onClick={createBounty}>\n            <span>Submit</span>\n          </button>\n        ) : (\n          <Web3Connect\n            className=\"LidoStakeFormSubmitContainer\"\n            connectLabel=\"Connect with Web3\"\n          />\n        )}\n      </div>\n\n      <div> {state.debuglogs ?? \"the logs will appear here\"} </div>\n    </div>\n  </Theme>\n);\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/0b2fa8cfb7913a09b2abad19e347aa1de028906d968fcc7bed8f7a76127a8d25/widget/bounty-creator", "metadata.tags.ethdenver2023": NaN}