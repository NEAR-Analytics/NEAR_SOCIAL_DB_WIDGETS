{"tx_hash": "CxcPAo4U7zv3Gat34gA6ZgZnHqbbt5BQJa2a1QL6d5sx", "action_id_social": "9SidHDtpGPRaRGzerUFFbUieyPN9RsEjewsm4MkANhYA-0-widget", "block_id": 91640257, "block_timestamp": "2023-05-11T23:13:31.769Z", "signer_id": "efiz.near", "widget_name": "Node", "source_code": "const key = props.key;\nconst label = props.label;\nconst node = props.node;\nconst path = props.path;\nconst setPath = props.setPath;\nconst history = props.history;\nconst setHistory = props.setHistory;\nconst isRoot = props.isRoot;\n\nState.init({\n  expanded: false,\n});\n\nfunction handleExpand() {\n  State.update({ expanded: !state.expanded });\n}\n\nfunction handleInto() {\n  setPath(path);\n  setHistory([...history, path]);\n}\n\nfunction handleBack() {\n  const newPath = history[history.length - 2] || \"\";\n  setPath(newPath);\n  setHistory(history.slice(0, -1));\n}\n\nconst Button = styled.button`\n  text-transform: lowercase !important;\n`;\n\nconst ChildNode = styled.div`\n  margin-left: ${path.split(\"/\").length * 4}px\n`;\n\nconst renderThing = () => {\n  const parts = path.split(\"/\");\n  if (parts.length > 2) {\n    const standard = parts[1];\n    let value = {};\n    let type = standard;\n    if (standard === \"graph\") {\n      parts.push(\"**\");\n      value = Social.get(parts.join(\"/\"), \"final\");\n    } else if (standard === \"index\") {\n      return null;\n    } else if (standard === \"profile\") {\n      value = Social.get(parts.join(\"/\"), \"final\");\n    } else if (standard === \"widget\") {\n      // This is a hack because a widget is saved under \"\"\n      if (path.endsWith(\"/\")) {\n        path = path.slice(0, -1);\n      }\n      return <Widget src={path} />;\n    } else if (standard === \"post\") {\n      const index = {\n        action: parts[1],\n        key: parts[2],\n        options: {\n          limit: 10,\n          order: \"desc\",\n          accountId: parts[0],\n        },\n      };\n\n      function renderItem(a) {\n        if (a.value.type === \"md\") {\n          const edges = Social.index(\"edge\", a.blockHeight, {\n            limit: 10,\n            order: \"desc\",\n            accountId: undefined,\n          });\n          console.log(\"edges: \" + JSON.stringify(edges));\n          // {edges.map(([key, val]) => (\n          //       <ChildNode>\n          //         <Widget\n          //           src=\"efiz.near/widget/Node\"\n          //           props={{\n          //             key,\n          //             label: key,\n          //             node: val,\n          //             path: `${path}/${key}`,\n          //             setPath: setPath,\n          //             history,\n          //             setHistory: setHistory,\n          //             isRoot: false,\n          //           }}\n          //         />\n          //       </ChildNode>\n          //     ))}\n          return (\n            <>\n              <Widget\n                src=\"near/widget/Posts.Post\"\n                props={{ accountId: a.accountId, blockHeight: a.blockHeight }}\n              />\n            </>\n          );\n        } else {\n          return <p>lol no</p>;\n        }\n      }\n      return (\n        <Widget\n          src=\"efiz.near/widget/MergedIndexFeed\"\n          props={{ index, renderItem, disableCaching: true }}\n        />\n      );\n\n      //   value = Social.get(path, \"final\");\n      //   value = JSON.parse(value);\n      //   return <Widget src=\"efiz.near/widget/Post.View\" props={{ value }} />;\n    } else {\n      value = Social.get(parts.join(\"/\"), \"final\");\n      value = JSON.parse(value);\n    }\n  } else {\n    console.log(\"uncaught path: \", path);\n  }\n\n  const text = `\n\\`\\`\\`json\n${JSON.stringify(value, undefined, 2)}\n\\`\\`\\`\n`;\n  return <Markdown text={text} />;\n};\n\nreturn (\n  <div>\n    {history.length > 1 && isRoot && <Button onClick={handleBack}>back</Button>}\n    <Button onClick={handleInto}>{label}</Button>\n    <Button onClick={handleExpand}>{state.expanded ? \"-\" : \"+\"}</Button>\n    {state.expanded && (\n      <div>\n        {node && typeof node === \"object\" ? (\n          Object.entries(node).map(([key, val]) => (\n            <ChildNode>\n              <Widget\n                src=\"efiz.near/widget/Node\"\n                props={{\n                  key,\n                  label: key,\n                  node: val,\n                  path: `${path}/${key}`,\n                  setPath: setPath,\n                  history,\n                  setHistory: setHistory,\n                  isRoot: false,\n                }}\n              />\n            </ChildNode>\n          ))\n        ) : (\n          <div>{renderThing()}</div>\n        )}\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/efiz.near/widget/Node", "__row_index": 67}