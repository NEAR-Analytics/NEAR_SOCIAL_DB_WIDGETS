{"tx_hash": "H4RmNKfBcqUrDMYr48pAHy9o2cez1rGBLJZPFFxGVdV3", "action_id_social": "9f9BBBaLG2kv9AHN929CFnqGH9RKJZDxbjckc4iZPRzG-0-widget", "block_id": 87078493, "block_timestamp": "2023-03-11 20:54:06.603", "signer_id": "efiz.near", "widget_name": "Create", "source_code": "/*\r\n---props---\r\n\r\nprops.widgetPath?: string,\r\n\r\n*/\r\n\r\n// How can I access the widget path dynamically?\r\nconst initWidgetPath = \"efiz.near/widget/Create\";\r\n\r\nState.init({\r\n  widgetPath: initWidgetPath,\r\n  color: \"\",\r\n  brand: \"\",\r\n  size: \"\",\r\n  material: \"\",\r\n  img: null,\r\n});\r\n\r\n// START GET THE WIDGET COMMIT\r\nconst historyBlocksRequest = Social.keys(`${initWidgetPath}`, \"final\", {\r\n  return_type: \"History\",\r\n});\r\n\r\nif (historyBlocksRequest === null) return \"loading...\";\r\n\r\nconst [widgetAccountId, _, widgetName] = initWidgetPath.split(\"/\");\r\n\r\nlet blocksChanges =\r\n  historyBlocksRequest[widgetAccountId]?.[\"widget\"]?.[widgetName];\r\n\r\n// Latest commit sits at blocksChanges[0]\r\n// How do we know this is the one they are using though?\r\n// END GET THE WIDGET COMMIT\r\n\r\nconst composeData = () => {\r\n  const data = {\r\n    thing: {\r\n      main: JSON.stringify({\r\n        color: state.color,\r\n        brand: state.brand,\r\n        size: state.size,\r\n        material: state.material,\r\n        commit: blocksChanges[0],\r\n        img: state.img ? `https://ipfs.near.social/ipfs/${state.img.cid}` : null\r\n      }),\r\n    },\r\n    index: {\r\n      thing: JSON.stringify({\r\n        key: \"main\",\r\n        value: {\r\n          type: \"thing\",\r\n        },\r\n      }),\r\n    },\r\n  };\r\n\r\n  return data;\r\n};\r\n\r\nconst handleImageUpload = (files) => {\r\n  if (files?.length > 0) {\r\n    State.update({\r\n      img: {\r\n        uploading: true,\r\n        cid: null,\r\n      },\r\n    });\r\n    const body = files[0];\r\n    State.update({\r\n      img: body,\r\n    });\r\n    asyncFetch(\"https://ipfs.near.social/add\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n      },\r\n      body,\r\n    }).then((res) => {\r\n      const cid = res.body.cid;\r\n\r\n      State.update({\r\n        img: {\r\n          cid,\r\n        },\r\n      });\r\n    });\r\n  } else {\r\n    State.update({\r\n      img: null,\r\n    });\r\n  }\r\n};\r\n\r\nreturn (\r\n  <div>\r\n    <h1 class=\"text-center\">Thing</h1>\r\n    {state.img ? (\r\n      <img\r\n        class=\"rounded w-100 h-100\"\r\n        style={{ objectFit: \"cover\" }}\r\n        src={`https://ipfs.near.social/ipfs/${state.img.cid}`}\r\n        alt=\"upload preview\"\r\n      />\r\n    ) : (\r\n      null\r\n    )}\r\n    <Files\r\n      multiple={false}\r\n      accepts={[\"image/*\"]}\r\n      minFileSize={1}\r\n      clickable\r\n      onChange={handleImageUpload}\r\n      style={{\r\n        cursor: \"pointer\",\r\n      }}\r\n      class=\"text-center d-flex justify-content-center align-items-center\"\r\n    >\r\n      <div class=\"d-flex m-4 px-2 py-1 rounded bg-black text-white justify-content-center align-items-center\">\r\n        {state.img?.uploading ? (\r\n          <>...</>\r\n        ) : state.img?.cid ? (\r\n          \"Replace\"\r\n        ) : (\r\n          \"Take photo\"\r\n        )}\r\n      </div>\r\n    </Files>\r\n    <div class=\"input-group mb-3\">\r\n      <input\r\n        class=\"form-control\"\r\n        placeholder={\"color\"}\r\n        onChange={({ target }) => State.update({ color: target.value })}\r\n      />\r\n      <input\r\n        class=\"form-control\"\r\n        placeholder={\"brand\"}\r\n        onChange={({ target }) => State.update({ brand: target.value })}\r\n      />\r\n      <input\r\n        class=\"form-control\"\r\n        placeholder={\"size\"}\r\n        onChange={({ target }) => State.update({ size: target.value })}\r\n      />\r\n      <input\r\n        class=\"form-control\"\r\n        placeholder={\"material\"}\r\n        onChange={({ target }) => State.update({ material: target.value })}\r\n      />\r\n    </div>\r\n    <div>\r\n      <div className={\"list-group-item list-group-item-action \"}>\r\n        #{blocksChanges[0]}\r\n      </div>\r\n      <div className={\"list-group-item list-group-item-action \"}>\r\n        {state.color}\r\n      </div>\r\n      <div className={\"list-group-item list-group-item-action \"}>\r\n        {state.brand}\r\n      </div>\r\n      <div className={\"list-group-item list-group-item-action \"}>\r\n        {state.size}\r\n      </div>\r\n      <div className={\"list-group-item list-group-item-action \"}>\r\n        {state.material}\r\n      </div>\r\n    </div>\r\n    <CommitButton\r\n      disabled={false}\r\n      force\r\n      className=\"btn btn-dark rounded-3\"\r\n      data={composeData}\r\n    >\r\n      Create\r\n    </CommitButton>\r\n  </div>\r\n);\r\n", "metadata": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/efiz.near/widget/Create", "branch.draft.": NaN, "branch.draft.metadata": NaN, "branch": NaN, "metadata.image.ipfs_cid": NaN, "metadata.linktree.website": NaN, "metadata.name": NaN, "metadata.tags.action": NaN}