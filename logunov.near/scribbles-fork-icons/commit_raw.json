{"tx_hash": "9yRRtpknvzJTWvRH5D27jGZr9bMaodnXy2haE9dSwXBe", "action_id_social": "9WyN8zVQFAGYUEyaR7BQksUCb9CgppbtuLqHZCgwRAaj-0-widget", "block_id": 80800470, "block_timestamp": "2022-12-16 19:45:23.123", "signer_id": "logunov.near", "widget_name": "scribbles-fork-icons", "source_code": "// \u2022 Can be used as company confluence secured with a multisig owning and symmetric key encryption\n// \u2022 Markdown support\n\nconst accountId = context.accountId;\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\n// const scribbles = Social.get(`${accountId}/scribbles/**`, \"final\") || [];\nconst inodes = Social.get(`${accountId}/scribbles/inode/**`, \"final\");\nconsole.log(inodes);\n\nif (!inodes) {\n  return (\n    <>\n      <CommitButton type=\"button\" data={{}}>\n        Refresh\n      </CommitButton>\n    </>\n  );\n}\n\nconst dbNextInode = parseInt(\n  Social.get(`${accountId}/scribbles/next_inode`, \"final\")\n);\n\nState.init({\n  fs: {\n    root: 0,\n    nextInode: dbNextInode,\n    inodes: inodes,\n    parentInodes: parentInodes,\n  },\n  selectedIdx: 0,\n  showEditView: false,\n  editView: {\n    editViewText: \"\",\n    fileName: null,\n  },\n  dir: \"/\",\n});\n\nfunction inodeByPath(path, fileType) {\n  let splitPath = path\n    .split(\"/\")\n    .filter((a) => !!a);\n  let newScribbles = {};\n  splitPath\n    .entries()\n    .reduce(((listIndex, inodeIndex), fname) => {\n        const inode = Social.get(`${accountId}/scribbles/inode/${inodeIndex}`, \"final\");\n        if !inode {\n            if listIndex + 1 < splitPath.length || fileType === 1 {\n              // create new folder\n              newScribbles[next]\n            } else {\n\n            }\n        }\n\n    }, 0);\n}\n\nfunction makeDbUpdateForNote(path, fileName, text) {\n  let inode = inodeByFolder(path);\n  return {\n    scribbles: {\n      inode,\n    },\n  };\n}\n\nfunction makeSubmitNoteButton() {\n  <CommitButton\n    data={makeDbUpdateForNote(\n      state.dir,\n      state.editView.fileName,\n      state.editView.editViewText\n    )}\n  >\n    Submit Note \ud83d\udcc4\n  </CommitButton>;\n}\n\nif (state.showEditView) {\n  return (\n    <>\n      <div\n        class=\"input-group-append\"\n        style={{\n          display: \"flex\",\n          alignItems: \"center\",\n        }}\n      >\n        <button\n          class=\"btn btn-outline-secondary\"\n          type=\"button\"\n          onClick={() =>\n            State.update({\n              showEditView: false,\n              editView: { ...state.editView, editViewText: \"\", fileName: null },\n            })\n          }\n          style={{ fontSize: 22, border: \"none\" }}\n        >\n          \u2716\n        </button>\n        <h5 style={{ marginLeft: 10, marginBottom: 0 }}>\n          {state.editView.fileName}\n        </h5>\n      </div>\n      <hr style={{ marginTop: 5 }} />\n      <textarea\n        class=\"form-control\"\n        id=\"notetext\"\n        rows=\"10\"\n        value={state.editView.editViewText}\n        onChange={(e) =>\n          State.update({\n            editView: { ...state.editView, editViewText: e.target.value },\n          })\n        }\n      ></textarea>\n      <hr />\n      makeSubmitNoteButton();\n    </>\n  );\n}\n\nlet currDir = state.dir\n  .split(\"/\")\n  .filter((a) => !!a)\n  .reduce((acc, curr) => acc[curr], scribbles);\nif (currDir == \"**FOLDER**\" || !currDir) {\n  currDir = {};\n}\n\nconsole.log(state.dir);\n\nreturn (\n  <>\n    <div class=\"input-group mb-3\" style={{ marginTop: 20 }}>\n      <input\n        type=\"text\"\n        class=\"form-control\"\n        placeholder=\"Note name\"\n        aria-describedby=\"basic-addon2\"\n        value={state.editView.fileName}\n        onChange={(e) => {\n          if (e.data != \" \") {\n            State.update({\n              editView: { ...state.editView, fileName: e.target.value },\n            });\n          }\n        }}\n      />\n      <div class=\"input-group-append\">\n        <button\n          class=\"btn btn-outline-secondary\"\n          type=\"button\"\n          disabled={!state.editView.fileName}\n          onClick={() =>\n            State.update({\n              showEditView: true,\n              editView: { ...state.editView, editViewText: \"\" },\n            })\n          }\n        >\n          Add Note \ud83d\udcc4\n        </button>\n      </div>\n    </div>\n    <div class=\"input-group mb-3\" style={{ marginTop: 20 }}>\n      <input\n        type=\"text\"\n        class=\"form-control\"\n        placeholder=\"Folder name\"\n        aria-describedby=\"basic-addon2\"\n        value={state.folderName}\n        onChange={(e) => {\n          if (e.data != \" \") {\n            State.update({\n              folderName: e.target.value,\n            });\n          }\n        }}\n      />\n      <div class=\"input-group-append\">\n        <CommitButton\n          class=\"btn btn-outline-secondary\"\n          type=\"button\"\n          disabled={!state.folderName}\n          data={{\n            scribbles: state.dir\n              .split(\"/\")\n              .filter((a) => !!a)\n              .reduceRight((acc, curr) => ({ [curr]: acc }), {\n                [state.folderName]: \"**FOLDER**\",\n              }),\n          }}\n        >\n          Add Folder \ud83d\udcc1\n        </CommitButton>\n      </div>\n    </div>\n    <div aria-label=\"breadcrumb\">\n      <ol class=\"breadcrumb\">\n        <li class=\"breadcrumb-item active\" aria-current=\"page\">\n          <a\n            onClick={(e) => {\n              State.update({ dir: \"/\" });\n            }}\n            style={{ cursor: \"pointer\" }}\n          >\n            \ud83c\udfe0\n          </a>\n        </li>\n        {state.dir\n          .split(\"/\")\n          .filter((a) => !!a)\n          .map((str, i, arr) => (\n            <li\n              class=\"breadcrumb-item active\"\n              aria-current=\"page\"\n              style={i !== arr.length - 1 ? { color: \"#007bff\" } : {}}\n            >\n              <a\n                onClick={(e) => {\n                  if (i !== arr.length - 1) {\n                    State.update({ dir: arr.slice(0, i + 1).join(\"/\") + \"/\" });\n                  }\n                }}\n                style={i !== arr.length - 1 ? { cursor: \"pointer\" } : {}}\n              >\n                {str}\n              </a>\n            </li>\n          ))}\n      </ol>\n    </div>\n    <div class=\"list-group\">\n      {state.dir !== \"/\" && state.dir ? (\n        <button\n          class=\"list-group-item\"\n          type=\"button\"\n          style={{ textAlign: \"left\" }}\n          onClick={() =>\n            State.update({\n              dir:\n                state.dir\n                  .split(\"/\")\n                  .filter((a) => !!a)\n                  .slice(0, -1)\n                  .join(\"/\") + \"/\",\n            })\n          }\n        >\n          <span style={{ fontSize: 24, fontWeight: 800 }}>\u293a</span> ..\n        </button>\n      ) : null}\n      {Object.keys(currDir)\n        .filter((a) => !!a)\n        .map((str, i) => (\n          <button\n            type=\"button\"\n            class={`list-group-item list-group-item-action ${\n              i === state.selectedIdx ? \"active\" : \"\"\n            }`}\n            onDoubleClick={() =>\n              currDir[str] === \"**FOLDER**\" || typeof currDir[str] != \"string\"\n                ? State.update({ dir: state.dir + `${str}/` })\n                : State.update({\n                    showEditView: true,\n                    editView: {\n                      editViewText: currDir[str],\n                      fileName: str,\n                    },\n                  })\n            }\n            onClick={() => State.update({ selectedIdx: i })}\n          >\n            {currDir[str] === \"**FOLDER**\" || typeof currDir[str] != \"string\"\n              ? \"\ud83d\udcc1\"\n              : \"\ud83d\udcc4\"}{\" \"}\n            {str}\n          </button>\n        ))}\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/logunov.near/widget/scribbles-fork-icons"}