{"tx_hash": "BNM4HpLsPLeW8jNtzoSfpZKtyC1FrEUf4SFbW3YKDzNo", "action_id_social": "DPUzHfJQj9RmvpiXPhrTM4npbfKm1NY54KNqgv3L6M8R-0-widget", "block_id": 80733892, "block_timestamp": "2022-12-15 22:08:29.203", "signer_id": "logunov.near", "widget_name": "inodes", "source_code": "const accountId = context.accountId;\n\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nconst data = Social.get(`${accountId}/scribbles/inode/0/type`, \"final\");\n\n// File:\n// {\n//     type: 0,\n//     data: \"...\"\n// }\n\n// Folder:\n// {\n//     type: 1,\n//     entries: {}\n// }\n\nif (!data) {\n  // Ask to initialize storage\n  return (\n    <div>\n      <CommitButton\n        data={{\n          scribbles: {\n            inode: {\n              [0]: {\n                type: 1,\n                entries: {},\n              },\n            },\n            next_inode: 1,\n          },\n        }}\n      >\n        Initialize storage\n      </CommitButton>\n    </div>\n  );\n}\n\nconst next_inode = parseInt(\n  Social.get(`${accountId}/scribbles/next_inode`, \"final\")\n);\n\nState.init({\n  fs: {\n    root: 0,\n    next_inode: next_inode,\n    new_filename: \"\",\n    new_data: \"\",\n  },\n});\n\nreturn (\n  <div>\n    fs = {JSON.stringify(state.fs)}\n    <div className=\"mb-2\">\n      <h4>Set root</h4>\n      <input\n        type=\"text\"\n        className=\"form-control\"\n        placeholder=\"0\"\n        onChange={(e) =>\n          State.update({\n            fs: { ...state.fs, root: parseInt(e.target.value) },\n          })\n        }\n      />\n    </div>\n    <div className=\"mb-2\">\n      <h4>Add file or folder (leave data empty for that)</h4>\n      <input\n        type=\"text\"\n        className=\"form-control\"\n        placeholder=\"filename\"\n        onChange={(e) =>\n          State.update({\n            fs: { ...state.fs, new_filename: e.target.value },\n          })\n        }\n      />\n      <input\n        type=\"text\"\n        className=\"form-control\"\n        placeholder=\"data\"\n        onChange={(e) =>\n          State.update({\n            fs: { ...state.fs, new_data: e.target.value },\n          })\n        }\n      />\n      <CommitButton\n        data={{\n          scribbles: {\n            inode: {\n              [state.fs.root]: {\n                entries: {\n                  [state.fs.new_filename]: state.fs.next_inode,\n                },\n              },\n              [state.fs.next_inode]: state.fs.new_data.length\n                ? {\n                    type: 0,\n                    data: state.fs.new_data,\n                  }\n                : {\n                    type: 1,\n                    entries: {},\n                  },\n            },\n            next_inode: state.fs.next_inode + 1,\n          },\n        }}\n        onClick={(e) =>\n          State.update({\n            fs: { ...state.fs, next_inode: state.fs.next_inode + 1 },\n          })\n        }\n      >\n        Add file/folder\n      </CommitButton>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/logunov.near/widget/inodes"}