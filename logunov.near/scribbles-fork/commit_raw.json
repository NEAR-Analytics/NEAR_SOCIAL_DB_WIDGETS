{"tx_hash": "89QzSuW2tqoJkZ1kLYVHbKM5reLv1HdnYpEmV7J4CxxF", "action_id_social": "AiBrkwTRKHsFTg3DpVrgBp7k2eyczpSdjgWngVR26s3d-0-widget", "block_id": 80782104, "block_timestamp": "2022-12-16 13:40:11.593", "signer_id": "logunov.near", "widget_name": "scribbles-fork", "source_code": "const accountId = context.accountId;\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nconst inodes = Social.get(`${accountId}/scribbles/inode/**`, \"final\") || [];\nconsole.log(inodes);\nconst scribbles = [];\n\nState.init({\n  fs: {\n    root: 0,\n    next_inode: next_inode,\n    new_filename: \"\",\n    new_data: \"\",\n  },\n  selectedIdx: 0,\n  showEditView: false,\n  editView: {\n    editViewText: \"\",\n    fileName: null,\n  },\n  dir: \"/\",\n});\n\nfunction traverse(inode, path, fs_map) {\n  if (inodes[inode].entries) {\n    fs_map = {};\n    Object.entries(inodes[inode].entries).map(([filename, other_inode]) => {\n      fs_map[filename] = traverse(parseInt(other_inode), path + `${filename}/`);\n    });\n    return fs_map;\n  } else {\n    console.log(path, inodes[inode].data);\n    return inodes[inode].data;\n  }\n}\n\nscribbles = traverse(state.fs.root, \"/\");\nconsole.log(scribbles);\n\nif (state.showEditView) {\n  return (\n    <>\n      <div class=\"input-group-append\">\n        <button\n          class=\"btn btn-outline-secondary\"\n          type=\"button\"\n          onClick={() =>\n            State.update({\n              showEditView: false,\n              editView: { ...state.editView, editViewText: \"\", fileName: null },\n            })\n          }\n        >\n          Back\n        </button>\n        <h5>{state.editView.fileName}</h5>\n      </div>\n      <textarea\n        class=\"form-control\"\n        id=\"notetext\"\n        rows=\"10\"\n        value={state.editView.editViewText}\n        onChange={(e) =>\n          State.update({\n            editView: { ...state.editView, editViewText: e.target.value },\n          })\n        }\n      ></textarea>\n      <CommitButton\n        data={{\n          scribbles: state.dir\n            .split(\"/\")\n            .filter((a) => !!a)\n            .reduceRight((acc, curr) => ({ [curr]: acc }), {\n              [state.editView.fileName]: state.editView.editViewText,\n            }),\n        }}\n      >\n        Submit note\n      </CommitButton>\n    </>\n  );\n}\nlet currDir = state.dir\n  .split(\"/\")\n  .filter((a) => !!a)\n  .reduce((acc, curr) => acc[curr], scribbles);\nif (currDir == \"**FOLDER**\") {\n  currDir = {};\n}\n\nreturn (\n  <>\n    <div class=\"input-group mb-3\" style={{ marginTop: 20 }}>\n      <input\n        type=\"text\"\n        class=\"form-control\"\n        placeholder=\"Note name\"\n        aria-describedby=\"basic-addon2\"\n        value={state.editView.fileName}\n        onChange={(e) => {\n          if (e.data != \" \") {\n            State.update({\n              editView: { ...state.editView, fileName: e.target.value },\n            });\n          }\n        }}\n      />\n      <div class=\"input-group-append\">\n        <button\n          class=\"btn btn-outline-secondary\"\n          type=\"button\"\n          disabled={!state.editView.fileName}\n          onClick={() =>\n            State.update({\n              showEditView: true,\n              editView: { ...state.editView, editViewText: \"\" },\n            })\n          }\n        >\n          Add note\n        </button>\n      </div>\n    </div>\n    <div class=\"input-group mb-3\" style={{ marginTop: 20 }}>\n      <input\n        type=\"text\"\n        class=\"form-control\"\n        placeholder=\"Folder name\"\n        aria-describedby=\"basic-addon2\"\n        value={state.folderName}\n        onChange={(e) => {\n          if (e.data != \" \") {\n            State.update({\n              folderName: e.target.value,\n            });\n          }\n        }}\n      />\n      <div class=\"input-group-append\">\n        <CommitButton\n          class=\"btn btn-outline-secondary\"\n          type=\"button\"\n          disabled={!state.folderName}\n          data={{\n            scribbles: state.dir\n              .split(\"/\")\n              .filter((a) => !!a)\n              .reduceRight((acc, curr) => ({ [curr]: acc }), {\n                [state.folderName]: \"**FOLDER**\",\n              }),\n          }}\n        >\n          Add Folder\n        </CommitButton>\n      </div>\n    </div>\n    <div class=\"input-group-append\">\n      <button\n        class=\"btn btn-outline-secondary\"\n        type=\"button\"\n        onClick={() =>\n          State.update({\n            dir: state.dir\n              .split(\"/\")\n              .filter((a) => !!a)\n              .slice(0, -1)\n              .join(\"/\"),\n          })\n        }\n      >\n        ..\n      </button>\n    </div>\n    <ul class=\"list-group\">\n      {Object.keys(currDir).map((str, i) => (\n        <li\n          class={`list-group-item ${i === state.selectedIdx ? \"active\" : \"\"}`}\n          onClick={() =>\n            state.selectedIdx === i\n              ? currDir[str] === \"**FOLDER**\" || typeof currDir[str] != \"string\"\n                ? State.update({ dir: state.dir + `${str}/` })\n                : State.update({\n                    showEditView: true,\n                    editView: {\n                      editViewText: currDir[str],\n                      fileName: str,\n                    },\n                  })\n              : State.update({ selectedIdx: i })\n          }\n          style={{ cursor: \"pointer\" }}\n        >\n          {str}\n        </li>\n      ))}\n    </ul>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/logunov.near/widget/scribbles-fork"}