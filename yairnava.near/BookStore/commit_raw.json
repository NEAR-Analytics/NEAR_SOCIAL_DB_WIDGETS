{"tx_hash": "DSxpd7VUsA4yf4JxJMfSEFf2u4qcMSitmWEXHy6CnVgm", "action_id_social": "93SfW3wBTtHrVsp79wdVDtnbgQs1y5U72Pc1pq9ZTux6-0-widget", "block_id": 92043788, "block_timestamp": "2023-05-17T05:17:14.340Z", "signer_id": "yairnava.near", "widget_name": "BookStore", "source_code": "// Contrato Inteligente a utilizar\nconst contract = \"bookstorebos.near\";\n\n// M\u00e9todos de consulta para obtener el listado de libros\nconst books = Near.view(contract, \"all_books\", {});\nconst booksbuy = context.accountId\n  ? Near.view(contract, \"books_for_owner\", {\n      account_id: context.accountId,\n    })\n  : [];\n\n// Inicializaci\u00f3n del objeto de estado con propiedades\nState.init({\n  title: \"\",\n  description: \"\",\n  author: \"\",\n  year: \"\",\n  price: \"\",\n  stock: \"\",\n});\n\n// M\u00e9todo para crear un nuevo libro\nconst createBook = () => {\n  if (state.title == \"\") {\n    return console.log(\"El nombre del libro no debe estar vacio\");\n  }\n  if (state.description == \"\") {\n    return console.log(\"La descripcion del libro no debe estar vacio\");\n  }\n  if (state.author == \"\") {\n    return console.log(\"El autor del libro no debe estar vacio\");\n  }\n  if (state.year == \"\") {\n    return console.log(\"El a\u00f1o del libro no debe estar vacio\");\n  }\n  if (state.price == \"\") {\n    return console.log(\"El precio del libro no debe estar vacio\");\n  }\n  if (state.stock == \"\") {\n    return console.log(\"El stock del libro no debe estar vacio\");\n  }\n\n  Near.call(contract, \"create_book\", {\n    title: state.title,\n    description: state.description,\n    author: state.author,\n    year: parseInt(state.year),\n    price: parseInt(state.price),\n    stock: parseInt(state.stock),\n  });\n};\n\n// M\u00e9todo para comprar un libro\nconst buyBook = (book_id, price) => {\n  const amount = price * 1000000000000000000000;\n  Near.call(\n    contract,\n    \"buy_book\",\n    {\n      book_id: book_id,\n    },\n    300000000000000,\n    amount\n  );\n};\n\n// Renderizado de la UI\nreturn (\n  <>\n    <div class=\"container border border-info p-3\">\n      <h3 class=\"text-center\">Book Store (BOS + NEAR)</h3>\n      <br />\n      {context.accountId ? (\n        <div class=\"border border-black p-3\">\n          <h3>Nuevo Libro</h3>\n          <div class=\"container\">\n            <div class=\"row\">\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"T\u00edtulo\"\n                  onChange={(e) => State.update({ title: e.target.value })}\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Descripci\u00f3n\"\n                  onChange={(e) =>\n                    State.update({ description: e.target.value })\n                  }\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Autor\"\n                  onChange={(e) => State.update({ author: e.target.value })}\n                />\n              </div>\n            </div>\n            <br />\n            <div class=\"row\">\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"A\u00f1o\"\n                  onChange={(e) => State.update({ year: e.target.value })}\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Precio\"\n                  onChange={(e) => State.update({ price: e.target.value })}\n                />\n              </div>\n              <div class=\"col-sm\">\n                <input\n                  placeholder=\"Stock\"\n                  onChange={(e) => State.update({ stock: e.target.value })}\n                />\n              </div>\n            </div>\n            <br />\n            <button\n              class=\"btn btn-primary mt-2\"\n              onClick={async () => {\n                createBook();\n              }}\n            >\n              Guardar\n            </button>\n          </div>\n        </div>\n      ) : (\n        <p class=\"text-center py-2\">\n          Debes iniciar sesi\u00f3n para crear y comprar libros\n        </p>\n      )}\n      <br />\n      <div class=\"border border-black p-3\">\n        <h3>Libros Disponibles</h3>\n        <table className=\"table table-hover table-sm\">\n          <thead>\n            <tr class=\"p-3 mb-2 bg-primary bg-gradient text-white rounded-5 text-center\">\n              <th>Nombre</th>\n              <th>Autor</th>\n              <th>Stock</th>\n              <th>Precio \u24c3</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody>\n            {books.map((data, key) => {\n              return (\n                <>\n                  <tr class=\"text-center\">\n                    <td>{data.title}</td>\n                    <td>{data.author}</td>\n                    <td>{data.stock}</td>\n                    <td>{data.price}</td>\n                    <td>\n                      {context.accountId ? (\n                        <button\n                          class=\"btn btn-primary\"\n                          onClick={async () => {\n                            buyBook(data.book_id, data.price);\n                          }}\n                        >\n                          Comprar\n                        </button>\n                      ) : (\n                        <span></span>\n                      )}\n                    </td>\n                  </tr>\n                </>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n      <br />\n      {context.accountId ? (\n        <div class=\"border border-black p-3\">\n          <h3>Libros Comprados</h3>\n          <table className=\"table table-hover table-sm\">\n            <thead>\n              <tr class=\"p-3 mb-2 bg-primary bg-gradient text-white rounded-5 text-center\">\n                <th>Nombre</th>\n                <th>Autor</th>\n              </tr>\n            </thead>\n            <tbody>\n              {booksbuy.map((data, key) => {\n                return (\n                  <>\n                    <tr class=\"text-center\">\n                      <td>{data.title}</td>\n                      <td>{data.author}</td>\n                    </tr>\n                  </>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <span></span>\n      )}\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/yairnava.near/widget/BookStore", "__row_index": 2}