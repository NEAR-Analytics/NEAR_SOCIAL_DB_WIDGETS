{"tx_hash": "4TDREm5Q9C41Ezg73hGy7bY8aVSnZZeTMZuFXD1R1pkQ", "action_id_social": "AiWAKPX3SCoKub9ovukMxeVDwQQhJzndpaSrQk9HzJqm-0-widget", "block_id": 94992073, "block_timestamp": "2023-06-25T10:51:36.919Z", "signer_id": "yairnava.near", "widget_name": "TokenVesting", "source_code": "const tokenVestingContract = \"0xf3ebedb4AF312d9F702778d15Ae47D145D1F3833\";\n\nconst tokenVestingAbi = fetch(\n  \"https://indigo-fluttering-emu-841.mypinata.cloud/ipfs/QmWgiPS57myEEEgjT1caTwMzTKcxNbquf3QGwMepjq3s1b\"\n);\n\nif (!tokenVestingAbi.ok) {\n  return \"Loading\";\n}\n\nconst iface = new ethers.utils.Interface(tokenVestingAbi.body);\nconst pillsVesting = [\n  { id: \"vesting\", title: \"Vesting\" },\n  { id: \"release\", title: \"Release\" },\n];\n\nState.init({\n  error: \"\",\n  general: true,\n  _beneficiary: \"0x000000000\",\n  _cliffDuration: null,\n  _vestingDuration: null,\n  _start: null,\n  _totalTokens: null,\n  _tokenAddress: \"0x000000000\",\n});\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n  }\n}\n\nconst setVesting = () => {\n  console.log(\"setVesting\");\n  validates_fields();\n\n  const contract = new ethers.Contract(\n    tokenVestingContract,\n    tokenVestingAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  console.log(state);\n\n  contract\n    .setVesting(\n      state._beneficiary,\n      state._cliffDuration,\n      state._vestingDuration,\n      state._start,\n      state._totalTokens,\n      state._tokenAddress\n    )\n    .then((res) => {\n      State.update({\n        _beneficiary: \"0x000000000\",\n        _cliffDuration: null,\n        _vestingDuration: null,\n        _start: null,\n        _totalTokens: null,\n        _tokenAddress: \"0x000000000\",\n      });\n    });\n};\n\nconst releaseVesting = () => {\n  const contract = new ethers.Contract(\n    tokenVestingContract,\n    tokenVestingAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  try {\n    contract.release().then((res) => {\n      if (res) {\n        console.log(res);\n      } else {\n        console.log(\"error\");\n      }\n    });\n  } catch (error) {\n    console.log(error);\n    console.log(error.error);\n  }\n};\n\nconst ItemBackground = styled.div`\n        width: 100%;\n        display: flex;\n        justify-content: center;\n        background-repeat: no-repeat;\n        background-size: cover;\n        margin-bottom: -50px;\n        `;\n\nconst ItemContainer = styled.div`\n        margin-top: 30px;\n        box-sizing: border-box;\n        min-width: 320px;\n        max-width: 560px;\n        width: 100%;\n        padding: 0px 32px;\n        position: relative;\n        `;\n\nconst ItemTitle = styled.h3`\n        text-align: center;\n        color: white;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        margin-bottom: 1rem;\n        `;\n\nconst ItemImage = styled.img`\n            width: 40px;\n            margin-right: 15px;\n        `;\n\nconst ItemSubTitle = styled.div`\n        text-align: center;\n        color: yellow;\n        margin-bottom: 5px;\n        `;\n\nconst ItemHeader = styled.div`\n        background: rgb(50,129,130);\n        font-weight: 400;\n        font-size: 12px;\n        line-height: 1.6em;\n        border-radius: 20px;\n        margin: 0px;\n        padding: 20px;\n        box-shadow: none;\n        color: rgb(255, 255, 255);\n        `;\n\nconst ItemBody = styled.div`\n        font-weight: 400;\n        font-size: 1em;\n        line-height: 1.6em;\n        border-radius: 0px 0px 20px 20px;\n        margin: -20px 0px 0px;\n        padding: 32px;\n        box-shadow: none;\n        background: rgb(31,82,82);\n        color: black;\n        `;\n\nconst ItemMintNumber = styled.label`\n        font-size: 20px;\n        font-weight: 800;\n        color: black;\n        `;\n\nconst ItemMintButton = styled.button`\n        background: #f54866;\n        color: white;\n        font-weight: 700;\n        padding: 15px 20px;\n        border-radius: 1rem;\n        border: none;\n        &:hover {\n            background: rgb(146 0 0);\n        }\n        `;\n\n// FETCH CSS\nconst cssFont = fetch(\n  \"https://fonts.googleapis.com/css2?family=Lexend:wght@200;300;400;500;600;700;800\"\n).body;\nconst css = fetch(\n  \"https://indigo-fluttering-emu-841.mypinata.cloud/ipfs/QmRR5YSEY4ot49AGGTY5i7UoyH4FNx7KDRvVjDPuSbzEdn\"\n).body;\n\nif (!cssFont || !css) return \"\";\n\nif (!state.theme) {\n  State.update({\n    theme: styled.div`\n    font-family: Lexend;\n    ${cssFont}\n    ${css}\n`,\n  });\n}\n\nconst validates_fields = () => {\n  const isEmpty = (field) => {\n    return field === \"\" ? true : false;\n  };\n  const isDateEmpty = (field) => {\n    return field === null ? true : false;\n  };\n  if (isEmpty(state._beneficiary)) {\n    console.log(\"Fill the beneficiary\");\n    State.update({ error: \"Fill the beneficiary\" });\n    return;\n  }\n  if (isDateEmpty(state._cliffDuration)) {\n    console.log(\"Fill the _cliffDuration\");\n    State.update({ error: \"Fill the cliff duration\" });\n    return;\n  }\n  if (isDateEmpty(state._totalTokens)) {\n    console.log(\"Fill the TotalTokens\");\n    State.update({ error: \"Fill the total tokens\" });\n    return;\n  }\n  if (isEmpty(state._tokenAddress)) {\n    console.log(\"Fill the TotalTokens\");\n    State.update({ error: \"Fill the tokens address\" });\n    return;\n  }\n  if (isDateEmpty(state._vestingDuration)) {\n    console.log(\"Fill the _vestingDuration\");\n    State.update({ error: \"Fill the vesting duration\" });\n    return;\n  }\n  if (isDateEmpty(state._start)) {\n    console.log(\"Fill the start\");\n    State.update({ error: \"Fill the start\" });\n    return;\n  }\n};\n\nconst TabSection = styled.div`\ndisplay:flex;\nwidth:100%; \nflex-direction: row;\n@media screen and (min-width: 480px) {\n  \n}\n`;\nconst toTimestamp = (strDate) => {\n  const dt = new Date(strDate).getTime();\n  return dt / 1000;\n};\nconst Theme = state.theme;\n\nreturn (\n  <Theme>\n    <ItemBackground>\n      <ItemContainer>\n        <ItemHeader>\n          <ItemTitle>\n            <ItemImage src=\"https://pin.ski/3X5pX3n\"></ItemImage>\n            <label>Token Vesting</label>\n          </ItemTitle>\n        </ItemHeader>\n        <ItemBody>\n          {state.sender ? (\n            <>\n              <ul\n                className=\"nav nav-pills nav-fill mb-4\"\n                id=\"pills-tab\"\n                role=\"tablist\"\n              >\n                {pillsVesting.map(({ id, title }, i) => (\n                  <li className=\"nav-item\" role=\"presentation\" key={i}>\n                    <button\n                      className={`nav-link ${i === 0 ? \"active\" : \"\"}`}\n                      id={`pills-${id}-tab`}\n                      data-bs-toggle=\"pill\"\n                      data-bs-target={`#pills-${id}`}\n                      type=\"button\"\n                      role=\"tab\"\n                      aria-controls={`pills-${id}`}\n                      aria-selected={i === 0}\n                      onClick={() => {\n                        const key = `load${id}`;\n                        !state[key] && State.update({ [key]: true });\n                      }}\n                    >\n                      {title}\n                    </button>\n                  </li>\n                ))}\n              </ul>\n              <div className=\"tab-content\" id=\"pills-tabContent\">\n                <div\n                  className=\"tab-pane fade show active\"\n                  id=\"pills-vesting\"\n                  role=\"tabpanel\"\n                  aria-labelledby=\"pills-vesting-tab\"\n                >\n                  <div name=\"ADD\">\n                    <div class=\"row w-100 \">\n                      <div class=\"col-5 mx-auto px-auto\">\n                        <label\n                          for=\"sender\"\n                          class=\"form-label\"\n                          style={{ color: \"#ffffff\" }}\n                        >\n                          Beneficiary\n                        </label>\n                        <input\n                          value={state._beneficiary}\n                          class=\"form-control\"\n                          id=\"sender\"\n                          type=\"text\"\n                          placeholder=\"Beneficiary address\"\n                          onChange={(e) =>\n                            State.update({\n                              _beneficiary: e.target.value,\n                              error: \"\",\n                            })\n                          }\n                        />\n                      </div>\n                      <div class=\"col-5 mx-auto px-auto\">\n                        <label\n                          for=\"sender\"\n                          class=\"form-label\"\n                          style={{ color: \"#ffffff\" }}\n                        >\n                          Cliff Duration\n                        </label>\n                        <input\n                          value={state._cliffDuration}\n                          class=\"form-control\"\n                          id=\"sender\"\n                          type=\"number\"\n                          placeholder=\"In timestamp\"\n                          onChange={(e) => {\n                            console.log(e, toTimestamp(\"2021-01-01\"));\n                            State.update({\n                              _cliffDuration: e.target.value,\n                              error: \"\",\n                            });\n                          }}\n                        />\n                      </div>\n                    </div>\n\n                    <div class=\"row w-100 \">\n                      <div class=\"col-5 mx-auto px-auto\">\n                        <label\n                          for=\"sender\"\n                          class=\"form-label\"\n                          style={{ color: \"#ffffff\" }}\n                        >\n                          Total Tokens\n                        </label>\n                        <input\n                          value={state._totalTokens}\n                          class=\"form-control\"\n                          id=\"sender\"\n                          type=\"number\"\n                          placeholder=\"Amount to vest\"\n                          onChange={(e) =>\n                            State.update({\n                              _totalTokens: e.target.value,\n                              error: \"\",\n                            })\n                          }\n                        />\n                      </div>\n                      <div class=\"col-5 mx-auto px-auto\">\n                        <label\n                          for=\"sender\"\n                          class=\"form-label\"\n                          style={{ color: \"#ffffff\" }}\n                        >\n                          Token Address\n                        </label>\n                        <input\n                          value={state._tokenAddress}\n                          class=\"form-control\"\n                          id=\"sender\"\n                          placeholder=\"Token address to vest\"\n                          onChange={(e) =>\n                            State.update({\n                              _tokenAddress: e.target.value,\n                              error: \"\",\n                            })\n                          }\n                        />\n                      </div>\n                    </div>\n\n                    <div class=\"row w-100 \">\n                      <div class=\"col-5 mx-auto px-auto\">\n                        <label\n                          for=\"sender\"\n                          class=\"form-label\"\n                          style={{ color: \"#ffffff\" }}\n                        >\n                          Vesting Duration\n                        </label>\n                        <input\n                          type=\"number\"\n                          value={state._vestingDuration}\n                          class=\"form-control bg-white text-black\"\n                          id=\"sender\"\n                          placeholder=\"Duration in timestamp\"\n                          onChange={(e) =>\n                            State.update({\n                              _vestingDuration: e.target.value,\n                              error: \"\",\n                            })\n                          }\n                        />\n                      </div>\n                      <div class=\"col-5 mx-auto px-auto \">\n                        <label\n                          for=\"sender\"\n                          class=\"form-label \"\n                          style={{ color: \"#ffffff\" }}\n                        >\n                          Start\n                        </label>\n                        <input\n                          value={state._start}\n                          class=\"form-control\"\n                          id=\"sender\"\n                          type=\"number\"\n                          placeholder=\"Start in timestamp\"\n                          onChange={(e) =>\n                            State.update({\n                              _start: e.target.value,\n                              error: \"\",\n                            })\n                          }\n                        />\n                      </div>\n                    </div>\n                    <div\n                      class=\"col-12\"\n                      style={{ display: \"flex\", \"justify-content\": \"center\" }}\n                    >\n                      <div class=\"mb-3  mt-4 \">\n                        {state.error != \"\" ? (\n                          <label class=\"text-danger bg-white rounded mx-2 px-2 \">\n                            {state.error}\n                          </label>\n                        ) : (\n                          <button\n                            style={{ \"text-align\": \"center\" }}\n                            onClick={async () => {\n                              setVesting();\n                            }}\n                          >\n                            Set Vesting\n                          </button>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div\n                  className=\"tab-pane fade release\"\n                  id=\"pills-release\"\n                  role=\"tabpanel\"\n                  aria-labelledby=\"pills-release-tab\"\n                >\n                  <div\n                    class=\"col-12\"\n                    style={{ display: \"flex\", \"justify-content\": \"center\" }}\n                  >\n                    <div class=\"mb-3  mt-4 \">\n                      <button\n                        style={{ \"text-align\": \"center\" }}\n                        onClick={async () => {\n                          releaseVesting();\n                        }}\n                      >\n                        Release Vesting\n                      </button>\n                    </div>\n                  </div>\n                </div>\n                <div\n                  className=\"tab-pane fade vesting\"\n                  id=\"pills-vesting\"\n                  role=\"tabpanel\"\n                  aria-labelledby=\"pills-vesting-tab\"\n                >\n                  <label>VESTING </label>\n                </div>\n              </div>\n            </>\n          ) : (\n            <div style={{ \"text-align\": \"center\" }}>\n              <Web3Connect\n                className=\"ConnectButton\"\n                connectLabel=\"Connect with Web3\"\n              />\n            </div>\n          )}\n        </ItemBody>\n      </ItemContainer>\n    </ItemBackground>\n  </Theme>\n);\n", "metadata": {"tags": {"ethdenver2023": ""}}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/yairnava.near/widget/TokenVesting", "__row_index": 2}