{"tx_hash": "FrgpuuCtLkpFzKZCvZVNYdQ1hUDxRNsUJxW21sPQLT72", "action_id_social": "xHeUZWEg26Da872nexpiVXpgew1raPFezhmtFMiwLCp-0-widget", "block_id": 95174022, "block_timestamp": "2023-06-27T19:56:55.348Z", "signer_id": "achildhoodhero.near", "widget_name": "nearweek.medium.bos", "source_code": "const accountId = \"near\";\nState.init({ active: 0 });\nconst nwSite = \"https://nearweek.com\";\nlet posts = [];\nlet mediumPosts = [];\n\nconst indexedPosts = Social.index(\"post\", \"main\", {\n  accountId,\n  limit: 20,\n  order: \"desc\",\n});\n\nif (indexedPosts?.length > 0) {\n  posts = [];\n\n  indexedPosts.forEach((post) => {\n    const data = Social.get(`${post.accountId}/post/main`, post.blockHeight);\n    if (data) {\n      const json = JSON.parse(data);\n      const content = json.text.split(\"\\n\");\n      const title = content[0] || \"\";\n      const url = content[1] || content[2] || \"\";\n      const lastLine = content.pop() || \"\";\n      const hasNewsTag = lastLine.indexOf(\"#news\") > -1;\n      const isValid = hasNewsTag && url.indexOf(\"https://\") > -1;\n\n      if (isValid) {\n        const block = Near.block(post.blockHeight);\n        let createdAt = \"\";\n        if (block) {\n          const timeMs = parseFloat(block.header.timestamp_nanosec) / 1e6;\n          createdAt = new Date(timeMs).toISOString();\n        }\n        posts.push({\n          blockHeight: post.blockHeight,\n          title,\n          url,\n          thumbnail: \"https://near.org/favicon.png\",\n          createdAt,\n          categories: [\"Near ORG\", \"blog\"],\n        });\n\n        posts.sort((a, b) => b.blockHeight - a.blockHeight);\n      }\n    }\n  });\n}\n\nconst fetchData = (url) => {\n  return fetch(url, {\n    method: \"GET\",\n    headers: {\n      Accept: \"*/*\",\n      Authorization:\n        \"Bearer 15699f0723aa9fe9f655b1a94e450552476c08807f67b525b5a3c8011eecc8aee6d45923443620f17815b897858be058cd7bd89ddf23a28aabaecb178e7ebc55d380293beeb51a8ce87b40e1518ce4708e4d51a06b115f27fa64ab5cbee5a3511cec785d7ae6a155ecd05ac8196aadae3e9b8e9401b8df8d8b69904f7364f925\",\n    },\n  });\n};\n\nconst fetchMedium = fetch(\n  \"https://api.rss2json.com/v1/api.json?rss_url=https://medium.com/feed/@nearweek\",\n  { method: \"GET\" }\n);\n\nif (fetchMedium && fetchMedium?.body?.items?.length > 0) {\n  fetchMedium.body.items.forEach((item) => {\n    mediumPosts.push({\n      title: item.title,\n      url: item.link,\n      thumbnail: item.thumbnail,\n      createdAt: item.pubDate,\n      categories: item.categories,\n    });\n  });\n}\n\nfunction dateToDays(date) {\n  const timeAgo = (diffSec) =>\n    diffSec < 60000\n      ? `${(diffSec / 1000) | 0}s`\n      : diffSec < 3600000\n      ? `${(diffSec / 60000) | 0}m`\n      : diffSec < 86400000\n      ? `${(diffSec / 3600000) | 0}h`\n      : `${(diffSec / 86400000) | 0}d`;\n\n  var d = new Date(date);\n  return timeAgo(Date.now() - d.getTime()) + \" ago\";\n}\n\nconst news = [...(fetchDaoNews?.body.data ?? []), ...posts]\n  .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))\n  .slice(0, 12);\n\nconst articles = [...mediumPosts];\nconst audio = [...(fetchAudio?.body.data ?? [])].map((item) => {\n  return {\n    title: item.Title,\n    thumbnail: nwSite + item.Thumbnail.formats.thumbnail.url,\n    categories: [...item.categories.map((category) => category.Name)],\n    createdAt: item.createdAt,\n    url: nwSite + \"/audio/\" + item.slug,\n  };\n});\n\nconst handleTabClick = (e) => {\n  const index = parseInt(e.target.id, 0);\n  if (index !== state.active) {\n    State.update({ active: index });\n  }\n};\n\nconst cssFont = fetch(\n  \"https://fonts.googleapis.com/css2?family=Space+Grotesk\"\n).body;\n\nif (!cssFont) return \"\";\n\nif (!state.theme) {\n  State.update({\n    theme: styled.div`\n    font-family: sans-serif;\n    ${cssFont}\n`,\n  });\n}\nconst Theme = state.theme;\n\nconst NwWidget = styled.div`\n  border-radius: 16px;\n  background: hsla(0, 0%, 100%, 1);\n  margin-bottom: 20px;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  align-items:center;\n  justify-content: space-between;\n`;\n\nconst H2 = styled.h2`\n  font-style: normal;\n  font-weight: 600;\n  font-size: 30px;\n  line-height: 8px;\n  letter-spacing: -0.02em;\n  margin-bottom: 36px;\n`;\n\nconst Tabs = styled.div`\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 25px;\n  align-items: center;\n  overflow: hidden;\n  border-bottom: 1px solid hsla(210, 12%, 93%, 1);\n`;\n\nconst TabNavs = styled.div`\n  display: flex;  \n`;\n\nconst Tab = styled.button`\n  font-weight: ${(props) => (props.active ? 600 : 400)}; \n  font-style: normal;\n  font-size: 19px;\n  line-height: 22px;\n  letter-spacing: -0.03em;\n  border: none;\n  outline: none;\n  cursor: pointer;\n  background: none;\n  padding: 12px 22px;\n  color: ${(props) =>\n    props.active ? \"hsla(204, 22%, 9%, 1)\" : \"hsla(204, 22%, 9%, 0.5)\"}; \n  border-bottom: ${(props) =>\n    props.active ? \"2px solid hsla(126, 53%, 77%, 1)\" : \"none\"}; \n  &:hover {\n    color: hsla(204, 22%, 9%, 1);    \n  }\n`;\nconst TabContent = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(286px, 1fr));\n  gap: 24px;\n  width: 100%;\n  ${(props) => (props.active ? \"\" : \"display:none\")}\n  `;\n\nconst TabContentFooter = styled.div`\n    display: flex;\n    grid-column: 1/-1;\n`;\n\nconst Card = styled.div`\n    display: flex;\n    flex-direction: column;\n    border: 1px solid #D8DBDF;\n    border-radius: 8px;\n`;\n\nconst CardContent = styled.div`\n    display: flex;\n    flex: 1;\n    flex-direction: column;\n    justify-content: space-between;\n    padding-left: 16px;\n    padding-right: 16px;\n    margin-top: 0;\n`;\n\nconst CardTitle = styled.div`\n    margin-top: 16px;\n    margin-bottom: 16px;\n    font-style: normal;\n    font-weight: 600;\n    font-size: 12px;\n    line-height: 15px;\n    letter-spacing: -0.01em;\n    color: #000000;\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;  \n    overflow: hidden;\n    a {\n        color: inherit;\n    }\n`;\n\nconst CardImage = styled.img`\n    width: 100%;\n    height: auto;\n    aspect-ratio: 16 / 9;\n    border-radius: 8px 8px 0 0;\n`;\n\nconst CardFooter = styled.div`\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n`;\n\nconst CardDate = styled.div`\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    color: hsla(198, 4%, 45%, 1);\n    font-style: normal;\n    font-weight: 400;\n    font-size: 12px;\n    line-height: 8px;\n    white-space: nowrap;\n    letter-spacing: 0.01em;\n`;\n\nconst ClockIconSVG = () => {\n  return (\n    <svg\n      width=\"12\"\n      height=\"12\"\n      viewBox=\"0 0 12 12\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M5.66406 2.22685V5.56018H8.16406M10.6641 5.56018C10.6641 6.21679 10.5347 6.86697 10.2835 7.4736C10.0322 8.08023 9.66389 8.63142 9.1996 9.09571C8.7353 9.56001 8.18411 9.92831 7.57748 10.1796C6.97085 10.4309 6.32067 10.5602 5.66406 10.5602C5.00745 10.5602 4.35727 10.4309 3.75065 10.1796C3.14402 9.92831 2.59282 9.56001 2.12853 9.09571C1.66424 8.63142 1.29594 8.08023 1.04466 7.4736C0.793391 6.86697 0.664062 6.21679 0.664063 5.56018C0.664063 4.2341 1.19085 2.96233 2.12853 2.02465C3.06621 1.08696 4.33798 0.560181 5.66406 0.560181C6.99015 0.560181 8.26191 1.08696 9.1996 2.02465C10.1373 2.96233 10.6641 4.2341 10.6641 5.56018Z\"\n        stroke=\"#6F7679\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  );\n};\n\nconst Badges = styled.div`\n    display: flex;\n    gap: 6px;\n`;\n\nconst Badge = styled.span`\n    border: 1px solid;    \n    border-color: hsla(214, 10%, 86%, 1);\n    border-radius: 4px;\n    font-weight: 500;\n    font-size: 12px;\n    line-height: 8px;\n    padding: 4px 8px;\n    white-space: nowrap;\n    letter-spacing: 0.01em;    \n    color: hsla(204, 5%, 44%, 1);\n    display:   ${(props) => (props.index > 1 ? \"none\" : \"block\")}; \n`;\n\nconst Promo = styled.div`\n    border: 1px solid hsla(226, 82%, 52%, 1);\n    border-radius: 4px;\n    font-style: normal;\n    font-weight: 500;\n    font-size: 12px;\n    line-height: 8px;\n    display: flex;\n    align-items: center;\n    text-align: center;\n    letter-spacing: -0.02em;\n    color: hsla(226, 82%, 52%, 1);\n    a {\n        white-space: nowrap;\n        padding: 4px 12px;\n    }\n    a:hover {\n    text-decoration: none;\n}\n`;\n\nconst ButtonLink = styled.a`\n  width: 100%;\n  padding: 8px;\n  height: 32px;\n  border: 1px solid #d7dbdf;\n  border-radius: 100px;\n  font-weight: 600;\n  font-size: 12px;\n  line-height: 22px;\n  letter-spacing: -0.03em;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  cursor: pointer;\n  white-space: nowrap;\n  color: hsla(204, 22%, 9%, 1);\n  &:hover,\n  &:focus {\n    text-decoration: none;\n    outline: none;\n  }\n`;\n\nconst Post = (props) => {\n  const { key, post } = props;\n  return (\n    <Card key={key} index={props.index}>\n      <CardImage src={post.thumbnail} alt=\"\" />\n      <CardContent>\n        <CardTitle>\n          <a href={post.url} target=\"_blank\">\n            {post.title}\n          </a>\n        </CardTitle>\n        <CardFooter>\n          <Badges>\n            {post.categories &&\n              post.categories.length > 0 &&\n              post.categories.map((category, index) => (\n                <Badge index={index}>{category}</Badge>\n              ))}\n          </Badges>\n          <CardDate>\n            <ClockIconSVG />\n            {post.createdAt ? dateToDays(post.createdAt) : \"\"}\n          </CardDate>\n        </CardFooter>\n      </CardContent>\n    </Card>\n  );\n};\n\nreturn (\n  <Theme>\n    <NwWidget>\n      <Header>\n        <H2>News</H2>\n        <Promo>\n          <a href={nwSite} target=\"_blank\">\n            Widget by Nearweek\n          </a>\n        </Promo>\n      </Header>\n      <Tabs>\n        <TabNavs>\n          <Tab\n            mobile={false}\n            onClick={handleTabClick}\n            active={state.active === 1}\n            id={1}\n          >\n            Articles\n          </Tab>\n        </TabNavs>\n      </Tabs>\n      <>\n        <TabContent active={state.active === 0}>\n          <>\n            {articles.length > 0 ? (\n              articles.map((article, index) => (\n                <Post post={article} index={index} />\n              ))\n            ) : (\n              <div>Loading ...</div>\n            )}\n            <TabContentFooter>\n              <ButtonLink href=\"//nearweek.medium.com\" target=\"_blank\">\n                View All\n              </ButtonLink>\n            </TabContentFooter>\n          </>\n        </TabContent>\n      </>\n    </NwWidget>\n  </Theme>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/achildhoodhero.near/widget/nearweek.medium.bos", "__row_index": 5}