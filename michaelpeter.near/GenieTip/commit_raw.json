{"tx_hash": "6iJdqgygxHhLsnLDDC2SrY73qxCWuffuQMMdjPDguj9h", "action_id_social": "5zcS852aiHewtBPFhMMc47JBiXQT6bg2dcbdEXaW7dLg-0-widget", "block_id": 80735685, "block_timestamp": "2022-12-15 22:44:09.003", "signer_id": "michaelpeter.near", "widget_name": "GenieTip", "source_code": "const { answeredBy, questionRef } = props;\n\nif (!answeredBy || !questionRef) {\n  return \"Missing prop\";\n}\n\nState.init({ tipAmount: null, showTipForm: false, timestamp: Date.now() });\n\nconst tips = Social.index(\"genie\", `tip2/${answeredBy}`);\nconst tipAmount = tips.reduce((acc, v) => acc + parseInt(v.value), 0);\n// console.log(tipAmount);\nconst questionSpecificTips = Social.index(\n  \"genie\",\n  `tip2/${questionRef}/${answeredBy}`\n);\nconst qTip = questionSpecificTips.reduce(\n  (acc, v) => acc + parseInt(v.value.amount),\n  0\n);\nconsole.log(questionSpecificTip);\n\nconst onSubmitClick = () => {\n  const gas = 300 * 100000000000;\n  const deposit = parseInt(state.tipAmount) + \"000000000000000000000000\";\n  //   const deposit = parseInt(state.tipAmount) + \"000000000000000000000\";\n  Near.call(\n    \"passthrough.near\",\n    \"transfer\",\n    { receiver_id: answeredBy },\n    gas,\n    deposit\n  );\n};\n\nreturn (\n  <div className=\"d-flex flex-row gap-4 align-items-center\">\n    <span>\n      <span style={{ fontSize: \"1.5rem\" }}>\u22c8 {qTip}</span>\n    </span>\n    <div>\n      <button\n        className=\"btn btn-outline-dark\"\n        onClick={() => {\n          State.update({ showTipForm: true });\n        }}\n      >\n        <i class=\"bi bi-wallet\" />\n        Tip\n      </button>\n    </div>\n    {state.showTipForm && (\n      <div\n        className=\"d-flex flex-row align-items-center gap-1\"\n        style={{ paddingLeft: \"1rem\" }}\n      >\n        <span>Amount:</span>\n        <input\n          value={state.tipAmount}\n          placeholder=\"1\"\n          onChange={(e) => State.update({ tipAmount: e.target.value })}\n        />\n        <div>\n          <CommitButton\n            disabled={\n              context.loading ||\n              !(answeredBy && state.tipAmount) ||\n              !parseInt(state.tipAmount)\n            }\n            data={{\n              index: {\n                genie: JSON.stringify([\n                  {\n                    key: `tip2/${answeredBy}`,\n                    value: state.tipAmount,\n                  },\n                  {\n                    key: `tip2/${questionRef}/${answeredBy}`,\n                    value: {\n                      amount: state.tipAmount,\n                      timestamp: state.timestamp,\n                    },\n                  },\n                ]),\n              },\n            }}\n            className={`btn ${\n              context.loading ? \"btn-outline-dark\" : \"btn-primary\"\n            }`}\n            onClick={() => {\n              State.update({ timestamp: Date.now() });\n            }}\n            onCommit={onSubmitClick}\n          >\n            Submit\n          </CommitButton>\n        </div>\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/michaelpeter.near/widget/GenieTip"}