{"tx_hash": "8TfvtEpAihi7vh8d9nyYLFF7urHgyc99PyTuqDdcvhXd", "action_id_social": "3p4Gw4AejDUZEjL55ejqhbwRqQ35GN7RJ36NTubPzRzM-0-widget", "block_id": 89926002, "block_timestamp": "2023-04-19 07:37:13.441", "signer_id": "contribut3.near", "widget_name": "Inputs.PrivateText", "source_code": "const iframeCode = `\n  <script src=\"https://cdn.jsdelivr.net/npm/libsodium@0.7.11/dist/modules/libsodium.min.js\"></script>\n  <script src=\"https://cdn.jsdelivr.net/npm/libsodium-wrappers@0.7.11/dist/modules/libsodium-wrappers.min.js\"></script>\n  <script src=\"https://cdn.jsdelivr.net/npm/near-api-js@2.0.4/dist/near-api-js.min.js\" integrity=\"sha256-KOzR3jJG5npydkwoDZHaUyNi0xKa+qUEYItBetrLiPY=\" crossorigin=\"anonymous\"></script>\n\n  <script>\n    async function getBlockHash() {\n      const connection = await nearApi.connect({\n        networkId: \"mainnet\",\n        keyStore: new nearApi.keyStores.InMemoryKeyStore(),\n        nodeUrl: \"https://rpc.mainnet.near.org\",\n        walletUrl: \"https://wallet.mainnet.near.org\",\n        helperUrl: \"https://helper.mainnet.near.org\",\n        explorerUrl: \"https://explorer.mainnet.near.org\",\n      });\n      const block = await connection.connection.provider.block({ finality: \"final\" });\n      return block.header.hash;\n    }\n\n    function getKey(accountId) {\n      return localStorage.getItem(\"near-api-js:keystore:\" + accountId + \":mainnet\");\n    }\n\n    function sendRequest(url, body, headers) {}\n\n    window.addEventListener(\"message\", ({data}) => {});\n\n    sodium.ready.then(async function() {\n      const sk = nearApi.utils.PublicKey.fromString(key.secretKey).data;\n      const pk = key.publicKey.data;\n      const blockHash = await getBlockHash();\n      const body = { win_reason: \"devet hiljada\" };\n      const signed = sodium.crypto_sign_detached(`petarvujovic.near\\n${ sodium.to_hex(pk)}\\n${ blockHash } \\n${ JSON.stringify(body) } `, sk);\n      const signature = sodium.to_hex(signed);\n      const result = await fetch(\"http://localhost:3000/encrypt/contribut3.near\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-Near-Public-Key\": sodium.to_hex(pk),\n          \"X-Near-Account-Id\": \"petarvujovic.near\",\n          \"X-Near-Signature\": signature,\n          \"X-Near-Block-Hash\": blockHash,\n          \"Origin\": \"https://google.com\",\n        },\n        body: JSON.stringify(body),\n      });\n      const json = await result.json();\n      console.log({ json });\n      encryptSecretForAccount(\"petarvujovic.near\", \"Hello World\").then((encrypted) => {\n        tryDecrypt(key.secretKey, encrypted).then((decrypted) => {\n          console.log({ decrypted });\n        });\n      });\n    });\n  </script>\n`;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/Inputs.PrivateText"}