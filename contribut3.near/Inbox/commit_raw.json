{"tx_hash": "2dnvjkq55mZStiqmDrQ1MRSEzyxeBSb25dE5uXNx7ihj", "action_id_social": "FeAiKebhHQRKq9WvspvqGew8Y7i5hb1rCmQuYidMbzzH-0-widget", "block_id": 90399169, "block_timestamp": "2023-04-25 13:06:17.775", "signer_id": "contribut3.near", "widget_name": "Inbox", "source_code": "const ownerId = \"contribut3.near\";\n\nif (!context.accountId) {\n  return <Widget src={`${ownerId}/widget/InfoSegment`} props={{ title: \"Not logged in!\", description: \"You must log in to look at your notifications!\" }} />;\n}\n\nconst Wrapper = styled.div`\n  padding-bottom: 48px;\n\n  > div {\n    > * {\n      margin-bottom: 12px;\n\n      &:last-child {\n        margin-bottom: 0;\n      }\n    }\n  }\n`;\n\nconst Header = styled.h1`\n  font-style: normal;\n  font-weight: 700;\n  font-size: 2em;\n  color: #101828;\n`;\n\nconst header = <Header>Inbox</Header>;\n\nconst index = {\n  action: \"inbox\",\n  key: context.accountId,\n  options: {\n    limit: 10,\n    order: \"desc\",\n    subscribe: true,\n  },\n};\n\nconst renderItem = (item, i) => {\n  if (i === 0) {\n    Storage.set(\"lastBlockHeight\", item.blockHeight);\n  }\n  return (\n    <Widget src={`${ownerId}/widget/Notification.Index`} key={i} props={item} />\n  );\n};\n\nState.init({\n  projects: null,\n  projectsIsFetched: false,\n  vendors: null,\n  vendorsIsFetched: false,\n});\n\nif (!state.projectsIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_admin_projects\",\n    { account_id: context.accountId },\n    \"final\",\n    false\n  ).then((projects) => State.update({ projects, projectsIsFetched: true }));\n}\n\nif (!state.vendorsIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_admin_vendors\",\n    { account_id: context.accountId },\n    \"final\",\n    false\n  ).then((vendors) => State.update({ vendors, vendorsIsFetched: true }));\n}\n\nif (!state.projectsIsFetched || !state.vendorsIsFetched) {\n  return <>Loading...</>;\n}\n\nconst projects = state.projects.reduce((acc, project) => {\n  const projectNotifications = Social.index(\"inbox\", project, { order: \"desc\", subscribe: true });\n  return [...acc, ...projectNotifications];\n}, []);\n\nreturn (\n  <Wrapper>\n    <Header>{header}</Header>\n    <Widget src=\"near/widget/IndexFeed\" props={{ index, renderItem }} />\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/Inbox"}