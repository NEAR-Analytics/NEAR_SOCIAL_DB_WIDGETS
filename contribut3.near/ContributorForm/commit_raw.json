{"tx_hash": "7Ufn9Ji3TQuX1xrZ2kEupWXVzy12eeYJLGXgL1v3qn7c", "action_id_social": "BTBbde6YcWUo7mFSQQMXrEc63cU6YjDHfWeiqxKtFP4y-0-widget", "block_id": 84286743, "block_timestamp": "2023-02-01 15:04:29.716", "signer_id": "contribut3.near", "widget_name": "ContributorForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId ?? \"\";\r\nconst kind = props.kind ? [{ name: props.kind }] : [];\r\nconst startDate = props.startDate ?? \"\";\r\nconst allContributionTypes = (\r\n  Near.view(ownerId, \"get_contribution_types\", {}, \"final\", true) ?? []\r\n).map((name) => ({ name }));\r\n\r\nconst convertType = (contributionType) => {\r\n  if (allContributionTypes.some(({ name }) => name === contributionType.name)) {\r\n    return contributionType.name;\r\n  }\r\n\r\n  return { Other: contributionType.name };\r\n};\r\n\r\ninitState({\r\n  contributionTypes: [],\r\n  skills: [],\r\n  resume: \"\",\r\n  lookingForWork: true,\r\n  existing: false,\r\n});\r\n\r\nNear.asyncView(\r\n  ownerId,\r\n  \"get_contributor\",\r\n  { account_id: context.accountId },\r\n  \"final\",\r\n  true\r\n).then((contributor) => {\r\n  if (contributor) {\r\n    console.log(contributor);\r\n    State.update({\r\n      contributionTypes: contributor.contribution_types.map((t) =>\r\n        typeof t === \"string\" ? { name: t } : { name: t.Other }\r\n      ),\r\n      skills: contributor.skills.map((name) => ({ name })),\r\n      resume: contributor.resume,\r\n      lookingForWork: contributor.looking_for_work,\r\n      existing: true,\r\n    });\r\n  }\r\n});\r\n\r\nconst contributionTypesInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <label htmlFor=\"contribution-types\">Contribution types:</label>\r\n    <Typeahead\r\n      id=\"contribution-types\"\r\n      labelKey=\"name\"\r\n      onChange={(contributionTypes) => State.update({ contributionTypes })}\r\n      options={allContributionTypes}\r\n      placeholder=\"Development, Investment, Legal...\"\r\n      selected={state.contributionTypes}\r\n      positionFixed\r\n      multiple\r\n      allowNew\r\n    />\r\n  </div>\r\n);\r\n\r\nconst skillsInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <label htmlFor=\"skills\">Skills:</label>\r\n    <Typeahead\r\n      id=\"skills\"\r\n      labelKey=\"name\"\r\n      onChange={(skills) => State.update({ skills })}\r\n      options={[]}\r\n      placeholder=\"Rust, JavaScript, React...\"\r\n      selected={state.skills}\r\n      positionFixed\r\n      multiple\r\n      allowNew\r\n    />\r\n  </div>\r\n);\r\n\r\nconst resumeInput = (\r\n  <div className=\"col-lg-12  mb-2\">\r\n    <label htmlFor=\"Resume\">Resume:</label>\r\n    <textarea\r\n      id=\"Resume\"\r\n      value={state.resume}\r\n      type=\"text\"\r\n      rows={6}\r\n      className=\"form-control\"\r\n      onChange={(event) => State.update({ resume: event.target.value })}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst lookingForWorkInput = !state.existing ? null : (\r\n  <div className=\"col-lg-6  mb-2\">\r\n    <div className=\"form-check\">\r\n      <label htmlFor=\"looking-for-work\" className=\"form-check-label\">\r\n        Looking for work\r\n      </label>\r\n      <input\r\n        id=\"looking-for-work\"\r\n        type=\"checkbox\"\r\n        className=\"form-check-input\"\r\n        checked={state.lookingForWork}\r\n        onChange={(e) => State.update({ lookingForWork: e.target.checked })}\r\n      />\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  const args = {\r\n    contribution_types: state.contributionTypes.map((t) => convertType(t)),\r\n    skills: state.skills.map(({ name }) => name),\r\n    resume: state.resume,\r\n    looking_for_work: state.lookingForWork,\r\n  };\r\n\r\n  if (state.existing) {\r\n    Near.call(ownerId, \"edit_contributor\", args);\r\n  } else {\r\n    Near.call(ownerId, \"register\", args, \"30000000000000\", \"1\");\r\n  }\r\n};\r\n\r\nconst header = (\r\n  <div className=\"card-header\">\r\n    {state.existing ? \"Edit profile\" : \"Register as a contributor\"}\r\n  </div>\r\n);\r\n\r\nconst body = (\r\n  <div className=\"card-body\">\r\n    <div className=\"row\">\r\n      {contributionTypesInput}\r\n      {skillsInput}\r\n      {resumeInput}\r\n      {lookingForWorkInput}\r\n    </div>\r\n\r\n    <a className=\"btn btn-primary mb-2\" onClick={onSubmit}>\r\n      Submit\r\n    </a>\r\n  </div>\r\n);\r\n\r\nconst footer = (\r\n  <div className=\"card-footer\">\r\n    Preview:\r\n    <Widget\r\n      src={`${ownerId}/widget/Contributor`}\r\n      props={{\r\n        isPreview: true,\r\n        accountId: context.accountId,\r\n        contributor: {\r\n          contribution_types: state.contributionTypes.map((t) =>\r\n            convertType(t)\r\n          ),\r\n          skills: state.skills.map(({ name }) => name),\r\n          resume: state.resume,\r\n        },\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nreturn (\r\n  <div className=\"card\">\r\n    {header}\r\n    {body}\r\n    {footer}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/ContributorForm"}