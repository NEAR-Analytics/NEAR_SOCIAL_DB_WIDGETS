{"tx_hash": "7Gmh9MyYS1zwqwcJmWH2z8TMNyXJxTK9GCDrCDwNL1cY", "action_id_social": "YQjX1ofWLM9fX7n6vBpsuYfpbwGS2XviJTsZ6nwjozv-0-widget", "block_id": 83839711, "block_timestamp": "2023-01-26 13:27:49.404", "signer_id": "contribut3.near", "widget_name": "ModeratorEntityForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId ? [{ name: props.accountId }] : [];\r\n\r\nconst kind = props.kind ? [{ name: props.kind }] : [];\r\nconst entityStatus = props.status ? [{ name: props.status }] : [];\r\nconst startDate = props.startDate ?? \"\";\r\nconst endDate = props.endDate ?? \"\";\r\n\r\ninitState({\r\n  fixed: !!props.accountId,\r\n  accountId,\r\n  kind,\r\n  entityStatus,\r\n  startDate,\r\n  endDate,\r\n  updated: false,\r\n  existing: accountId.name\r\n    ? Near.view(ownerId, \"get_entity\", { account_id: accountId.name }, \"final\")\r\n    : null,\r\n});\r\n\r\nconst allKinds = [\"Project\", \"Organization\", \"DAO\"].map((name) => ({ name }));\r\nconst allStatuses = [\"Active\", \"Flagged\"].map((name) => ({ name }));\r\nconst allAccountIds = (\r\n  Near.view(ownerId, \"get_entities\", {}, \"final\", true) ?? []\r\n).map(([name]) => ({ name }));\r\n\r\nconst accountIdInput = (\r\n  <Widget\r\n    src={`${ownerId}/widget/ModeratorAccountIdInput`}\r\n    props={{\r\n      accountId: state.accountId,\r\n      allAccountIds,\r\n      fixed: state.fixed,\r\n      update: (updatedState) => State.update(updatedState),\r\n    }}\r\n  />\r\n);\r\n\r\nconst kindInput = (\r\n  <div className=\"col-lg-6  mb-2\">\r\n    Type of entity:\r\n    <Typeahead\r\n      labelKey=\"name\"\r\n      onChange={(kind) => State.update({ kind, updated: true })}\r\n      options={allKinds}\r\n      placeholder=\"Project, Organization or DAO\"\r\n      selected={state.kind}\r\n      positionFixed\r\n    />\r\n  </div>\r\n);\r\n\r\nconst statusInput = (\r\n  <div className=\"col-lg-6  mb-2\">\r\n    Status of entity:\r\n    <Typeahead\r\n      labelKey=\"name\"\r\n      onChange={(entityStatus) => State.update({ entityStatus, updated: true })}\r\n      options={allStatuses}\r\n      placeholder=\"Active or Flagged\"\r\n      selected={state.entityStatus}\r\n      positionFixed\r\n    />\r\n  </div>\r\n);\r\n\r\nconst startDateInput = (\r\n  <div className=\"col-lg-6 mb-2\">\r\n    Start date of entity:\r\n    <input\r\n      type=\"date\"\r\n      value={state.startDate}\r\n      onChange={(e) =>\r\n        State.update({ startDate: e.target.value, updated: true })\r\n      }\r\n    />\r\n  </div>\r\n);\r\n\r\nconst endDateInput = (\r\n  <div className=\"col-lg-6 mb-2\">\r\n    End date of entity (optional):\r\n    <input\r\n      type=\"date\"\r\n      value={state.endDate}\r\n      onChange={(e) => State.update({ endDate: e.target.value, updated: true })}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  const args = {\r\n    account_id: state.accountId[0].name,\r\n    entity: {\r\n      status: state.entityStatus[0].name,\r\n      kind: state.kind[0].name,\r\n      start_date: `${new Date(state.startDate).getTime()}`,\r\n    },\r\n  };\r\n\r\n  if (state.endDate) {\r\n    args.entity.end_date = `${new Date(state.endDate).getTime()}`;\r\n  }\r\n\r\n  Near.call(ownerId, \"set_entity\", args);\r\n};\r\n\r\nconst header = (\r\n  <div className=\"card-header\">\r\n    {state.fixed ? \"Update\" : \"Edit/Create\"} an entity\r\n  </div>\r\n);\r\n\r\nconst body = (\r\n  <div className=\"card-body\">\r\n    <div className=\"row\">\r\n      {accountIdInput}\r\n      {kindInput}\r\n      {statusInput}\r\n      {startDateInput}\r\n      {endDateInput}\r\n    </div>\r\n\r\n    <a className=\"btn btn-outline-primary mb-2\" onClick={onSubmit}>\r\n      Submit\r\n    </a>\r\n  </div>\r\n);\r\n\r\nconst footer = (\r\n  <div className=\"card-footer\">\r\n    Preview:\r\n    <Widget\r\n      src={`${ownerId}/widget/Entity`}\r\n      props={{\r\n        isPreview: true,\r\n        id: 0, // irrelevant\r\n        accountId: state.accountId[0].name,\r\n        notStandalone: true,\r\n        entity:\r\n          state.updated || !state.existing\r\n            ? {\r\n                kind: state.kind[0].name,\r\n                status: state.entityStatus[0].name,\r\n                start_date: `${new Date(state.startDate).getTime()}`,\r\n                end_date: `${new Date(state.endDate).getTime()}`,\r\n              }\r\n            : state.existing,\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nreturn (\r\n  <div className=\"card\">\r\n    {header}\r\n    {body}\r\n    {footer}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/ModeratorEntityForm"}