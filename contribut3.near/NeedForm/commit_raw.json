{"tx_hash": "Get3wKKHUmJSsjxvGUAzVapa8oUuRUHvEKRpxj1GjaYY", "action_id_social": "AWst2PCsf3qdKYBx63CBhCVkZEvHo7A3y2YQ7Au89CPj-0-widget", "block_id": 86831925, "block_timestamp": "2023-03-08 12:08:57.920", "signer_id": "contribut3.near", "widget_name": "NeedForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId;\r\nconst contributionType = props.contributionType\r\n  ? [{ name: props.contributionType }]\r\n  : [];\r\nconst allContributionTypes = (\r\n  Near.view(ownerId, \"get_contribution_types\", {}, \"final\", true) ?? []\r\n).map((name) => ({ name }));\r\n\r\nconst convertType = (contributionType) => {\r\n  if (allContributionTypes.some(({ name }) => name === contributionType.name)) {\r\n    return contributionType.name;\r\n  }\r\n\r\n  return { Other: contributionType.name };\r\n};\r\n\r\nState.init({\r\n  contributionType: [],\r\n  entityId: accountId ? [{ name: accountId }] : [],\r\n  description: \"\",\r\n});\r\n\r\nconst Label = styled.label`\r\n  font-weight: 600;\r\n  color: #344054;\r\n`;\r\n\r\nconst EntityInput = styled.div`\r\n  margin-bottom: 0.5em;\r\n`;\r\n\r\nconst SelectedEntity = styled.div`\r\n  border-radius: 4px;\r\n  background-color: #f2f4f7;\r\n  height: 5em;\r\n`;\r\n\r\nconst entityEditor = (\r\n  <EntityInput>\r\n    <Label htmlFor=\"enity-id\">Request for:</Label>\r\n    {props.entity ? (\r\n      <SelectedEntity id=\"entity-id\">\r\n        <Widget\r\n          src={`${ownerId}/widget/ProfileLine`}\r\n          props={{\r\n            accountId: props.entity,\r\n            imageSize: \"4em\",\r\n            isEntity: true,\r\n          }}\r\n        />\r\n      </SelectedEntity>\r\n    ) : (\r\n      <Widget\r\n        src={`${ownerId}/widget/AdminEntityAccountIdInput`}\r\n        props={{\r\n          update: (entityId) => {\r\n            State.update({ entityId });\r\n            Near.asyncView(\r\n              ownerId,\r\n              \"get_entity_invites\",\r\n              { account_id: entityId[0].name },\r\n              \"final\"\r\n            ).then((invites) =>\r\n              State.update({\r\n                forbiddenIds: new Set(Object.keys(invites)),\r\n              })\r\n            );\r\n          },\r\n          accountId: context.accountId,\r\n          selected: state.entityId,\r\n        }}\r\n      />\r\n    )}\r\n  </EntityInput>\r\n);\r\n\r\nconst InputWrapper = styled.div`\r\n  margin-bottom: 0.5em;\r\n`;\r\n\r\nconst contributionTypeInput = (\r\n  <InputWrapper>\r\n    <Widget\r\n      src={`${ownerId}/widget/ContributionTypeInput`}\r\n      props={{\r\n        contributionType: state.contributionType,\r\n        update: (contributionType) => State.update({ contributionType }),\r\n        allContributionTypes,\r\n      }}\r\n    />\r\n  </InputWrapper>\r\n);\r\n\r\nconst descriptionInput = (\r\n  <InputWrapper>\r\n    <Widget\r\n      src={`${ownerId}/widget/DescriptionInput`}\r\n      props={{\r\n        description: state.description,\r\n        text: \"Details:\",\r\n        update: (description) => State.update({ description }),\r\n      }}\r\n    />\r\n  </InputWrapper>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  if (state.contributionType.length !== 1 || state.description.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const args = {\r\n    entity_id: state.entityId[0].name,\r\n    description: state.description,\r\n    contribution_type: convertType(state.contributionType[0]),\r\n  };\r\n\r\n  Near.call(ownerId, \"post_contribution_need\", args);\r\n};\r\n\r\nconst Page = styled.div`\r\n  padding: 0 0.75em;\r\n  max-width: 100%;\r\n\r\n  h1 {\r\n    font-size: 2.5em;\r\n    margin-bottom: 0.75em;\r\n    padding-bottom: 0.75em;\r\n  }\r\n`;\r\n\r\nconst Form = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-bottom: 0.75em;\r\n  padding: 1em;\r\n  border-radius: 4px;\r\n  background-color: #f9fafb;\r\n`;\r\n\r\nconst Controls = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n`;\r\n\r\nconst CloseButton = styled.a`\r\n  background-color: white;\r\n  padding: 0.7em;\r\n  border-radius: 4px;\r\n  border: 0;\r\n  box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\r\n  color: #344054;\r\n\r\n  &:hover {\r\n    text-decoration: none;\r\n    color: unset;\r\n  }\r\n`;\r\n\r\nconst ConfirmButton = styled.button`\r\n  padding: 0.7em;\r\n  border-radius: 4px;\r\n  border: 0;\r\n  box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\r\n  background-color: ${({ valid }) => (valid ? \"#12b76a\" : \"#344054\")};\r\n  color: white;\r\n  transition: background-color 0.2s ease-in-out;\r\n\r\n  &:hover {\r\n    ${({ valid }) => (valid ? \"background-color: #0e9f5d;\" : \"\")}\r\n  }\r\n`;\r\n\r\nreturn (\r\n  <Page>\r\n    <h1>Create new contribution request</h1>\r\n    <Form>\r\n      {entityEditor}\r\n      {contributionTypeInput}\r\n      {descriptionInput}\r\n    </Form>\r\n    <Controls>\r\n      <CloseButton\r\n        href={`/#/${ownerId}/widget/Index?tab=home`}\r\n        onClick={() => props.update({ tab: \"home\" })}\r\n      >\r\n        Cancel\r\n      </CloseButton>\r\n      <ConfirmButton\r\n        valid={\r\n          state.contributionType.length === 1 && state.description.length > 0\r\n        }\r\n        onClick={onSubmit}\r\n      >\r\n        Create request\r\n      </ConfirmButton>\r\n    </Controls>\r\n  </Page>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/NeedForm"}