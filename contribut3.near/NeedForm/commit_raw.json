{"tx_hash": "9iY2H4ZkcafmZCVyEv9gRt2GqbKR3LScyz41WE7jjFi2", "action_id_social": "A3uKZYnyS54zr7nvw8zyEFUSyh9dnT4VCF5jg2fFD8nm-0-widget", "block_id": 84412158, "block_timestamp": "2023-02-03 09:22:10.338", "signer_id": "contribut3.near", "widget_name": "NeedForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId;\r\nconst contributionType = props.contributionType\r\n  ? [{ name: props.contributionType }]\r\n  : [];\r\nconst allContributionTypes = (\r\n  Near.view(ownerId, \"get_contribution_types\", {}, \"final\", true) ?? []\r\n).map((name) => ({ name }));\r\n\r\nconst convertType = (contributionType) => {\r\n  if (allContributionTypes.some(({ name }) => name === contributionType.name)) {\r\n    return contributionType.name;\r\n  }\r\n\r\n  return { Other: contributionType.name };\r\n};\r\n\r\ninitState({\r\n  contributionType: [],\r\n  description: \"\",\r\n});\r\n\r\nif (!accountId) {\r\n  return \"Cannot render contribution need form widget without account ID!\";\r\n}\r\n\r\nconst contributionTypeInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/ContributionTypeInput`}\r\n      props={{\r\n        contributionType: state.contributionType,\r\n        update: (contributionType) => State.update({ contributionType }),\r\n        allContributionTypes,\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst descriptionDiv = (\r\n  <div className=\"col-lg-12  mb-2\">\r\n    <label htmlFor=\"description\">Description:</label>\r\n    <textarea\r\n      id=\"description\"\r\n      value={state.description}\r\n      type=\"text\"\r\n      rows={6}\r\n      className=\"form-control\"\r\n      onChange={(event) => State.update({ description: event.target.value })}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  if (state.contributionType.length !== 1 || state.description.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const args = {\r\n    entity_id: accountId,\r\n    description: state.description,\r\n    contribution_type: convertType(state.contributionType[0]),\r\n  };\r\n\r\n  Near.call(ownerId, \"post_contribution_need\", args);\r\n};\r\n\r\nconst header = <div className=\"card-header\">Post need</div>;\r\n\r\nconst body = (\r\n  <div className=\"card-body\">\r\n    <div className=\"row\">\r\n      {descriptionDiv}\r\n      {contributionTypeInput}\r\n    </div>\r\n\r\n    <a\r\n      className={`btn ${\r\n        state.contributionType.length !== 1 || state.description.length === 0\r\n          ? \"btn-secondary\"\r\n          : \"btn-primary\"\r\n      } mb-2`}\r\n      onClick={onSubmit}\r\n    >\r\n      Post\r\n    </a>\r\n  </div>\r\n);\r\n\r\nconst footer = (\r\n  <div className=\"card-footer\">\r\n    Preview:\r\n    {state.accountIdValid ? (\r\n      <Widget\r\n        src={`${ownerId}/widget/Need`}\r\n        props={{\r\n          isPreview: true,\r\n          accountId: state.accountId,\r\n          contributionNeed: {\r\n            description: state.description,\r\n            contribution_type: convertType(state.contributionType[0]),\r\n            active: true,\r\n          },\r\n        }}\r\n      />\r\n    ) : null}\r\n  </div>\r\n);\r\n\r\nreturn (\r\n  <div className=\"card\">\r\n    {header}\r\n    {body}\r\n    {footer}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/NeedForm"}