{"tx_hash": "BbvM4UGX3s2NnzwnbogEeRt3H7CCMaivBmm9ckqLx199", "action_id_social": "8rkTT3KkGmKZEHgTBnkcSqv7WDPhVNRPXwGVGmzG8Dfu-0-widget", "block_id": 85861147, "block_timestamp": "2023-02-23 11:11:43.127", "signer_id": "contribut3.near", "widget_name": "NeedForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId;\r\nconst contributionType = props.contributionType\r\n  ? [{ name: props.contributionType }]\r\n  : [];\r\nconst allContributionTypes = (\r\n  Near.view(ownerId, \"get_contribution_types\", {}, \"final\", true) ?? []\r\n).map((name) => ({ name }));\r\n\r\nconst convertType = (contributionType) => {\r\n  if (allContributionTypes.some(({ name }) => name === contributionType.name)) {\r\n    return contributionType.name;\r\n  }\r\n\r\n  return { Other: contributionType.name };\r\n};\r\n\r\nState.init({\r\n  contributionType: [],\r\n  entityId: accountId ? [{ name: accountId }] : [],\r\n  description: \"\",\r\n});\r\n\r\nconst entityIdInput = (\r\n  <Widget\r\n    src={`${ownerId}/widget/AdminEntityAccountIdInput`}\r\n    props={{\r\n      label: \"Request as:\",\r\n      update: (entityId) => {\r\n        State.update({ entityId });\r\n        Near.asyncView(\r\n          ownerId,\r\n          \"get_entity_invites\",\r\n          { account_id: entityId[0].name },\r\n          \"final\"\r\n        ).then((invites) =>\r\n          State.update({\r\n            forbiddenIds: new Set(Object.keys(invites)),\r\n          })\r\n        );\r\n      },\r\n      accountId: context.accountId,\r\n      selected: state.entityId,\r\n    }}\r\n  />\r\n);\r\n\r\nconst contributionTypeInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/ContributionTypeInput`}\r\n      props={{\r\n        contributionType: state.contributionType,\r\n        update: (contributionType) => State.update({ contributionType }),\r\n        allContributionTypes,\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst descriptionInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/DescriptionInput`}\r\n      props={{\r\n        description: state.description,\r\n        text: \"Details:\",\r\n        update: (description) => State.update({ description }),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  if (state.contributionType.length !== 1 || state.description.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const args = {\r\n    entity_id: accountId,\r\n    description: state.description,\r\n    contribution_type: convertType(state.contributionType[0]),\r\n  };\r\n\r\n  Near.call(ownerId, \"post_contribution_need\", args);\r\n};\r\n\r\nreturn (\r\n  <div className=\"px-3\" style={{ maxWidth: \"45em\" }}>\r\n    <h1 className=\"fs-2 mb-3 pb-3\">Create new contribution request</h1>\r\n    <div className=\"bg-light mb-3 p-4 rounded-2\">\r\n      <div className=\"row\">\r\n        {entityIdInput}\r\n        {contributionTypeInput}\r\n        {descriptionInput}\r\n      </div>\r\n    </div>\r\n    <div className=\"d-flex flex-row justify-content-between\">\r\n      <a\r\n        className=\"btn btn-outline-secondary\"\r\n        href={`https://near.social/#/${ownerId}/widget/Index`}\r\n        onClick={() => props.update(\"\")}\r\n      >\r\n        Cancel\r\n      </a>\r\n      <a\r\n        className={`btn ${state.contributionType.length !== 1 || state.description.length === 0\r\n            ? \"btn-secondary\"\r\n            : \"btn-primary\"\r\n          } mb-2`}\r\n        onClick={onSubmit}\r\n      >\r\n        Create request\r\n      </a>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/NeedForm"}