{"tx_hash": "J8eTDWaU7o3XDvA8VCZFdq544rWjfavGvtgyVKVUpmee", "action_id_social": "9JanvkvXQ42toCHKUz5fpwfWygGGUJGjZX6gnvqHwKjY-0-widget", "block_id": 85856260, "block_timestamp": "2023-02-23 09:31:01.835", "signer_id": "contribut3.near", "widget_name": "InviteForm", "source_code": "const createDate = () => {\r\n  const date = new Date();\r\n  const year = date.getFullYear();\r\n  const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\r\n  const day = date.getDate().toString().padStart(2, \"0\");\r\n\r\n  return `${year}-${month}-${day}`;\r\n};\r\n\r\nconst ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId ?? \"\";\r\nconst kind = props.kind ? [{ name: props.kind }] : [];\r\nconst startDate = props.startDate ?? createDate();\r\nconst id = props.id;\r\n\r\nconst allContributionTypes = (\r\n  Near.view(ownerId, \"get_contribution_types\", {}, \"final\", true) ?? []\r\n).map((name) => ({ name }));\r\n\r\nconst convertType = (contributionType) => {\r\n  if (allContributionTypes.some(({ name }) => name === contributionType.name)) {\r\n    return contributionType.name;\r\n  }\r\n\r\n  return { Other: contributionType.name };\r\n};\r\n\r\nState.init({\r\n  entityId: [],\r\n  accountId,\r\n  permissions: [],\r\n  description: props.description ?? \"\",\r\n  contributionType: [],\r\n  accountIdValid: true,\r\n  startDate,\r\n  forbiddenIds: new Set(),\r\n});\r\n\r\nconst accountIdInput = accountId ? (\r\n  <div>\r\n    <label htmlFor=\"account-id\" className=\"text-muted fw-semibold\">\r\n      You're inviting:\r\n    </label>\r\n    <div className=\"rounded-5 bg-secondary\" id=\"account-id\">\r\n      <Widget\r\n        src={`${ownerId}/widget/ProfileLine`}\r\n        props={{ accountId, size: \"4em\" }}\r\n      />\r\n    </div>\r\n  </div>\r\n) : (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/ValidatedAccountIdInput`}\r\n      props={{\r\n        label: \"Account ID of contributor:\",\r\n        value: state.accountId,\r\n        update: (accountId, accountIdValid) =>\r\n          State.update({ accountId, accountIdValid }),\r\n        forbiddenIds: state.forbiddenIds,\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst descriptionInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/DescriptionInput`}\r\n      props={{\r\n        description: state.description,\r\n        text: \"Details:\",\r\n        update: (description) => State.update({ description }),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst contributionTypeInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/ContributionTypeInput`}\r\n      props={{\r\n        contributionType: state.contributionType,\r\n        update: (contributionType) => State.update({ contributionType }),\r\n        allContributionTypes,\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst startDateInput = (\r\n  <div className=\"col-lg-6 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/DateInput`}\r\n      props={{\r\n        id: \"start-date\",\r\n        text: \" Start date of contribution:\",\r\n        date: state.startDate,\r\n        update: (startDate) => State.update({ startDate }),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst permissionsInput = (\r\n  <div className=\"col-lg-6 mb-2\">\r\n    <label htmlFor=\"permissions-input\">Permissions for contributor:</label>\r\n    <Typeahead\r\n      id=\"permissions-input\"\r\n      labelKey=\"name\"\r\n      onChange={(permissions) =>\r\n        State.update({\r\n          permissions,\r\n        })\r\n      }\r\n      options={[{ name: \"Admin\" }]}\r\n      placeholder=\"Admin or leave blank\"\r\n      selected={state.permissions}\r\n      positionFixed\r\n    />\r\n  </div>\r\n);\r\n\r\nconst entityIdInput = (\r\n  <Widget\r\n    src={`${ownerId}/widget/AdminEntityAccountIdInput`}\r\n    props={{\r\n      update: (entityId) => {\r\n        State.update({ entityId });\r\n        Near.asyncView(\r\n          ownerId,\r\n          \"get_entity_invites\",\r\n          { account_id: entityId[0].name },\r\n          \"final\"\r\n        ).then((invites) =>\r\n          State.update({\r\n            forbiddenIds: new Set(Object.keys(invites)),\r\n          })\r\n        );\r\n      },\r\n      accountId: context.accountId,\r\n      selected: state.entityId,\r\n    }}\r\n  />\r\n);\r\n//   (\r\n//   <div className=\"col-lg-12 mb-2\">\r\n//     <label htmlFor=\"entity-id-input\">Invite to:</label>\r\n//     <Typeahead\r\n//       id=\"entity-id-input\"\r\n//       labelKey=\"name\"\r\n//       onChange={(entityId) => {\r\n//         State.update({ entityId });\r\n//         Near.asyncView(\r\n//           ownerId,\r\n//           \"get_entity_invites\",\r\n//           { account_id: entityId[0].name },\r\n//           \"final\"\r\n//         ).then((invites) =>\r\n//           State.update({\r\n//             forbiddenIds: new Set(Object.keys(invites)),\r\n//           })\r\n//         );\r\n//       }}\r\n//       options={(\r\n//         Near.view(\r\n//           ownerId,\r\n//           \"get_contributor_admin_entities\",\r\n//           { account_id: context.accountId },\r\n//           \"final\",\r\n//           true\r\n//         ) ?? []\r\n//       ).map((name) => ({ name }))}\r\n//       placeholder=\"contribut3.near, social.near...\"\r\n//       selected={state.entityId}\r\n//       positionFixed\r\n//     />\r\n//   </div>\r\n// );\r\n\r\nconst onSubmit = () => {\r\n  if (!state.accountIdValid) {\r\n    return;\r\n  }\r\n\r\n  const args = {\r\n    entity_id: state.entityId[0].name,\r\n    contributor_id: state.accountId,\r\n    description: state.description,\r\n    start_date: `${new Date(state.startDate).getTime()}`,\r\n    contribution_type: convertType(state.contributionType[0]),\r\n    permissions: state.permissions.map(({ name }) => name),\r\n  };\r\n\r\n  Near.call(ownerId, \"invite_contributor\", args);\r\n};\r\n\r\nconst header = <div className=\"card-header\">Invite contributor</div>;\r\n\r\nconst body = (\r\n  <div className=\"card-body\">\r\n    <div className=\"row\">\r\n      {entityIdInput}\r\n      {accountIdInput}\r\n      {contributionTypeInput}\r\n      {startDateInput}\r\n      {permissionsInput}\r\n      {descriptionInput}\r\n    </div>\r\n\r\n    <a\r\n      className={`btn ${!state.accountIdValid ? \"btn-secondary\" : \"btn-primary\"\r\n        } mb-2`}\r\n      onClick={onSubmit}\r\n    >\r\n      Invite\r\n    </a>\r\n  </div>\r\n);\r\n\r\nconst form = (\r\n  <Widget\r\n    src={`${ownerId}/widget/Modal`}\r\n    props={{\r\n      title: \"Invite to contribute\",\r\n      confirmText: (\r\n        <>\r\n          <i className=\"bi-send\" />\r\n          <span>Send invitation</span>\r\n        </>\r\n      ),\r\n      body,\r\n      id,\r\n    }}\r\n  />\r\n);\r\n\r\nreturn (\r\n  <div className=\"card\">\r\n    {header}\r\n    {body}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/InviteForm"}