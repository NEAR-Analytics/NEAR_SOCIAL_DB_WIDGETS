{"tx_hash": "FaKiL8rmteLGEJLrGNGWcBnzbrtgQeFuxzbV15dunQSg", "action_id_social": "2iJpcFtMtUWpRLMoFVrHzNThPKM4WN87Wc9GCJGLHZyJ-0-widget", "block_id": 89941993, "block_timestamp": "2023-04-19 12:42:48.070", "signer_id": "contribut3.near", "widget_name": "Inputs.SetUpPermissions", "source_code": "const ownerId = \"contribut3.near\";\nconst onSave = props.onSave ?? (() => { });\n\nState.init({\n  following: [],\n  followingIsFetched: false,\n  value: [],\n  accountsWithPermissions: [],\n  accountsWithPermissionsIsFetched: false,\n})\n\nif (!state.followingIsFetched) {\n  Near.asyncView(\n    \"social.near\",\n    \"get\",\n    { keys: [`${context.accountId}/graph/follow/*`] },\n    \"final\",\n    false,\n  ).then((data) => State.update({\n    following: Object.keys(data[context.accountId].graph.follow).map((name) => ({ name })),\n    followingIsFetched: true,\n  }));\n}\n\nif (!state.accountsWithPermissionsIsFetched) {\n  Near.asyncView(\n    \"social.near\",\n    \"debug_get_permissions\",\n    { account_id: context.accountId },\n    \"final\",\n    false,\n  ).then((data) => State.update({\n    accountsWithPermissions: data.map(([info]) => info).filter((info) => \"AccountId\" in info).map(({ AccountId }) => AccountId),\n    accountsWithPermissionsIsFetched: true,\n  }));\n}\n\nconsole.log(state.accountsWithPermissions);\n\nif (!state.followingIsFetched || !state.accountsWithPermissionsIsFetched) {\n  return <>Loading...</>;\n}\n\nconst Accounts = styled.ul`\n  font-style: normal;\n  font-weight: 600;\n  font-size: 1.125em;\n  line-height: 1em;\n  color: #344054;\n`;\n\nconst Existing = styled.div`\n  h3 {\n    font-style: normal;\n    font-weight: 600;\n    font-size: 1.5em;\n    line-height: 1.5em;\n    color: #344054;\n  }\n`;\n\nreturn (\n  <>\n    <Widget\n      src={`${ownerId}/widget/Inputs.MultiSelect`}\n      props={{\n        label: \"Accounts to add permissions to\",\n        placeholder: \"Add accounts\",\n        options: state.following,\n        value: state.value,\n        onChange: (value) => State.update({ value }),\n      }}\n    />\n    <Existing>\n      <h3>Existing permissions</h3>\n      <Accounts>\n        {state.accountsWithPermissions.map((accountId) => (<li key={accountId}>{accountId}</li>))}\n      </Accounts>\n    </Existing>\n  </>);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/Inputs.SetUpPermissions"}