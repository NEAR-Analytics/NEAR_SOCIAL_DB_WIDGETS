{"tx_hash": "DC9V5PukPVfthpq3xtVih5U4qEJyxGtWvBKJKtRvpZGo", "action_id_social": "4Lqd7vHF7Sc9aGWfCjH574NjTzz2p3L9Cy2atHJCbFxm-0-widget", "block_id": 85938304, "block_timestamp": "2023-02-24 12:17:18.420", "signer_id": "contribut3.near", "widget_name": "EntityForm", "source_code": "const createDate = (input) => {\r\n  const date = input || new Date();\r\n  console.log(date, input);\r\n  const year = date.getFullYear();\r\n  const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\r\n  const day = date.getDate().toString().padStart(2, \"0\");\r\n\r\n  return `${year}-${month}-${day}`;\r\n};\r\n\r\nconst ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId ?? \"\";\r\nconst kind = props.kind ? [{ name: props.kind }] : [];\r\nconst startDate = props.startDate ?? createDate();\r\nconst forbiddenIds = new Set(\r\n  (Near.view(ownerId, \"get_entities\", {}, \"final\", true) ?? []).map(\r\n    ([accountId]) => accountId\r\n  )\r\n);\r\n\r\nState.init({\r\n  accountId,\r\n  name: props.name ?? \"\",\r\n  accountIdValid: true,\r\n  kind,\r\n  startDate,\r\n});\r\n\r\nif (accountId) {\r\n  Near.asyncView(\r\n    ownerId,\r\n    \"get_entity\",\r\n    { account_id: accountId },\r\n    \"final\"\r\n  ).then((entity) => {\r\n    console.log({\r\n      name: entity.name,\r\n      kind: [{ name: entity.kind }],\r\n      startDate: createDate(new Date(Number(entity.start_date))),\r\n    });\r\n    State.update({\r\n      name: entity.name,\r\n      kind: [{ name: entity.kind }],\r\n      startDate: createDate(new Date(Number(entity.start_date))),\r\n    });\r\n  });\r\n}\r\n\r\nconst accountIdInput = accountId ? (\r\n  <div>\r\n    <label htmlFor=\"account-id\" className=\"text-muted fw-semibold\">\r\n      Project account ID\r\n    </label>\r\n    <div\r\n      className=\"rounded-3 bg-light\"\r\n      style={{ height: \"5em\" }}\r\n      id=\"account-id\"\r\n    >\r\n      <Widget\r\n        src={`${ownerId}/widget/ProfileLine`}\r\n        props={{ accountId, imageSize: \"4em\", isEntity: true }}\r\n      />\r\n    </div>\r\n  </div>\r\n) : (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/ValidatedAccountIdInput`}\r\n      props={{\r\n        label: \"Project account ID *\",\r\n        value: state.accountId,\r\n        update: (accountId, accountIdValid) =>\r\n          State.update({ accountId, accountIdValid }),\r\n        forbiddenIds,\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst nameInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/NameInput`}\r\n      props={{\r\n        label: \"Project name *\",\r\n        value: state.name,\r\n        update: (name) => State.update({ name }),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst kindInput = (\r\n  <div className=\"col-lg-6  mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/EntityTypeInput`}\r\n      props={{\r\n        kind: state.kind,\r\n        update: (kind) => State.update({ kind }),\r\n        text: \"Type of project *\",\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst startDateInput = (\r\n  <div className=\"col-lg-6 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/DateInput`}\r\n      props={{\r\n        id: \"start-date\",\r\n        text: \"Founding date\",\r\n        date: state.startDate,\r\n        update: (startDate) => State.update({ startDate }),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  if (!state.accountIdValid) {\r\n    return;\r\n  }\r\n\r\n  const args = {\r\n    account_id: state.accountId,\r\n    name: state.name,\r\n    kind: state.kind[0].name,\r\n    start_date: `${new Date(state.startDate).getTime()}`,\r\n  };\r\n\r\n  Near.call(ownerId, \"add_entity\", args);\r\n};\r\n\r\nreturn (\r\n  <div className=\"px-3\" style={{ maxWidth: \"45em\" }}>\r\n    <h1 className=\"fs-2 mb-3 pb-3\">\r\n      {accountId ? \"Create new\" : \"Edit\"} project\r\n    </h1>\r\n    <div className=\"bg-light mb-3 p-4 rounded-2\">\r\n      <div className=\"row\">\r\n        {accountIdInput}\r\n        {nameInput}\r\n        {kindInput}\r\n        {startDateInput}\r\n      </div>\r\n    </div>\r\n    <div className=\"d-flex flex-row justify-content-between\">\r\n      <a\r\n        className=\"btn btn-outline-secondary\"\r\n        href={`https://near.social/#/${ownerId}/widget/Index?tab=home`}\r\n        onClick={() => props.update({ tab: \"home\" })}\r\n      >\r\n        Cancel\r\n      </a>\r\n      <a\r\n        className={`btn ${!state.accountIdValid ? \"btn-secondary\" : \"btn-primary\"\r\n          }`}\r\n        onClick={onSubmit}\r\n      >\r\n        Create project\r\n      </a>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/EntityForm"}