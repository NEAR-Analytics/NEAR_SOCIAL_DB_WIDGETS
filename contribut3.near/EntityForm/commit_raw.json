{"tx_hash": "Bma9f6wY5FxhCh8WrWFwbXB22V57FxzkQc7MTq2LoSSD", "action_id_social": "rLKqRF9S3dvmgu2C6uo9g8q8Zutb1SLfjSgRbsWLSc6-0-widget", "block_id": 86843452, "block_timestamp": "2023-03-08 16:13:17.864", "signer_id": "contribut3.near", "widget_name": "EntityForm", "source_code": "const createDate = () => {\r\n  const date = new Date();\r\n  const year = date.getFullYear();\r\n  const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\r\n  const day = date.getDate().toString().padStart(2, \"0\");\r\n\r\n  return `${year}-${month}-${day}`;\r\n};\r\n\r\nconst ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId ?? \"\";\r\nconst kind = props.kind ? [{ name: props.kind }] : [];\r\nconst startDate = props.startDate ?? createDate();\r\nconst forbiddenIds = new Set(\r\n  Near.view(ownerId, \"get_entities\", {}, \"final\", true) ?? []\r\n);\r\n\r\nState.init({\r\n  accountId,\r\n  name: props.name ?? \"\",\r\n  accountIdValid: true,\r\n  kind,\r\n  startDate,\r\n  entityFetched: false,\r\n});\r\n\r\nif (accountId && !state.entityFetched) {\r\n  Near.asyncView(\r\n    ownerId,\r\n    \"get_entity\",\r\n    { account_id: accountId },\r\n    \"final\"\r\n  ).then((entity) => {\r\n    const date = new Date(Number(entity.start_date));\r\n    const year = date.getFullYear();\r\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\r\n    const day = date.getDate().toString().padStart(2, \"0\");\r\n\r\n    State.update({\r\n      name: entity.name,\r\n      entityFetched: true,\r\n      kind: [{ name: entity.kind }],\r\n      startDate: `${year}-${month}-${day}`,\r\n    });\r\n  });\r\n}\r\n\r\nconst Label = styled.label`\r\n  font-weight: 600;\r\n  color: #344054;\r\n`;\r\n\r\nconst InputWrapper = styled.div`\r\n  margin-bottom: 0.5em;\r\n`;\r\n\r\nconst accountIdInput = (\r\n  <InputWrapper>\r\n    {accountId ? (\r\n      <>\r\n        <Label htmlFor=\"account-id\">Project account ID</Label>\r\n        <div\r\n          className=\"rounded-3 bg-light\"\r\n          style={{ height: \"5em\" }}\r\n          id=\"account-id\"\r\n        >\r\n          <Widget\r\n            src={`${ownerId}/widget/ProfileLine`}\r\n            props={{ accountId, imageSize: \"4em\", isEntity: true }}\r\n          />\r\n        </div>\r\n      </>\r\n    ) : (\r\n      <Widget\r\n        src={`${ownerId}/widget/ValidatedAccountIdInput`}\r\n        props={{\r\n          label: \"Project account ID *\",\r\n          value: state.accountId,\r\n          update: (accountId, accountIdValid) =>\r\n            State.update({ accountId, accountIdValid }),\r\n          forbiddenIds,\r\n        }}\r\n      />\r\n    )}\r\n  </InputWrapper>\r\n);\r\nconst nameInput = (\r\n  <InputWrapper>\r\n    <Widget\r\n      src={`${ownerId}/widget/NameInput`}\r\n      props={{\r\n        label: \"Project name *\",\r\n        value: state.name,\r\n        update: (name) => State.update({ name }),\r\n      }}\r\n    />\r\n  </InputWrapper>\r\n);\r\n\r\nconst kindInput = (\r\n  <InputWrapper>\r\n    <Widget\r\n      src={`${ownerId}/widget/EntityTypeInput`}\r\n      props={{\r\n        kind: state.kind,\r\n        update: (kind) => State.update({ kind }),\r\n        text: \"Type of project *\",\r\n      }}\r\n    />\r\n  </InputWrapper>\r\n);\r\n\r\nconst startDateInput = (\r\n  <InputWrapper>\r\n    <Widget\r\n      src={`${ownerId}/widget/DateInput`}\r\n      props={{\r\n        id: \"start-date\",\r\n        text: \"Founding date\",\r\n        date: state.startDate,\r\n        update: (startDate) => State.update({ startDate }),\r\n      }}\r\n    />\r\n  </InputWrapper>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  if (!state.accountIdValid) {\r\n    return;\r\n  }\r\n\r\n  const args = {\r\n    account_id: state.accountId,\r\n    name: state.name,\r\n    kind: state.kind[0].name,\r\n    start_date: `${new Date(state.startDate).getTime()}`,\r\n  };\r\n\r\n  Near.call(ownerId, \"add_entity\", args);\r\n};\r\n\r\nconst Page = styled.div`\r\n  padding: 0 0.75em;\r\n  max-width: 100%;\r\n\r\n  h1 {\r\n    font-size: 2em;\r\n    margin-bottom: 0.75em;\r\n    padding-bottom: 0.75em;\r\n  }\r\n`;\r\n\r\nconst Form = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-bottom: 0.75em;\r\n  padding: 1em;\r\n  border-radius: 4px;\r\n  background-color: #f9fafb;\r\n`;\r\n\r\nconst Controls = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n`;\r\n\r\nconst CloseButton = styled.a`\r\n  background-color: white;\r\n  padding: 0.7em;\r\n  border-radius: 4px;\r\n  border: 0;\r\n  color: #344054;\r\n  transition: box-shadow 0.2s ease-in-out;\r\n\r\n  &:hover {\r\n    text-decoration: none;\r\n    color: unset;\r\n    box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\r\n  }\r\n`;\r\n\r\nconst ConfirmButton = styled.button`\r\n  padding: 0.7em;\r\n  border-radius: 4px;\r\n  border: 0;\r\n  box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\r\n  background-color: ${({ valid }) => (valid ? \"#7f56d9\" : \"#344054\")};\r\n  color: white;\r\n  transition: background-color 0.2s ease-in-out;\r\n\r\n  &:hover {\r\n    ${({ valid }) => (valid ? \"background-color: #4f56d9;\" : \"\")}\r\n  }\r\n`;\r\n\r\nreturn (\r\n  <Page>\r\n    <h1>{!props.accountId ? \"Create new\" : \"Edit\"} project</h1>\r\n    <Form>\r\n      {accountIdInput}\r\n      {nameInput}\r\n      {kindInput}\r\n      {startDateInput}\r\n    </Form>\r\n    <Controls>\r\n      <CloseButton\r\n        href={`/#/${ownerId}/widget/Index?tab=home`}\r\n        onClick={() => props.update({ tab: \"home\" })}\r\n      >\r\n        Cancel\r\n      </CloseButton>\r\n      <ConfirmButton\r\n        valid={\r\n          state.name.length > 1 &&\r\n          state.accountIdValid &&\r\n          state.kind.length === 1\r\n        }\r\n        onClick={onSubmit}\r\n      >\r\n        {!props.accountId ? \"Create\" : \"Edit\"} project\r\n      </ConfirmButton>\r\n    </Controls>\r\n  </Page>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/EntityForm"}