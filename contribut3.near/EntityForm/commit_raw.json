{"tx_hash": "4Mx64RgCWRESQy6J7C7um5e7jDR8LhKaKNQct7k8CCa5", "action_id_social": "CHbY6dzEbHYoepu6EUtDGs9a9QE3mr2ke6Z4iLVuyJXe-0-widget", "block_id": 83853884, "block_timestamp": "2023-01-26 18:01:54.887", "signer_id": "contribut3.near", "widget_name": "EntityForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst accountId = props.accountId ?? \"\";\r\nconst kind = props.kind ? [{ name: props.kind }] : [];\r\nconst startDate = props.startDate ?? \"\";\r\n\r\ninitState({\r\n  accountId,\r\n  kind,\r\n  startDate,\r\n  exists: false,\r\n});\r\n\r\nconst allKinds = [\"Project\", \"Organization\", \"DAO\"].map((name) => ({ name }));\r\n\r\nconst accountIdInput = (\r\n  <div className=\"col-lg-12  mb-2\">\r\n    Account ID of entity:\r\n    <input\r\n      type=\"text\"\r\n      value={state.accountId}\r\n      onChange={(event) => State.update({ accountId: event.target.value })}\r\n      onBlur={() =>\r\n        Near.asyncView(\r\n          ownerId,\r\n          \"get_entity\",\r\n          { account_id: state.accountId },\r\n          \"final\"\r\n        ).then((entity) => State.update({ exists: !!entity }))\r\n      }\r\n      style={{\r\n        ...(state.exists ? { borderColor: \"red\" } : {}),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst kindInput = (\r\n  <div className=\"col-lg-6  mb-2\">\r\n    Type of entity:\r\n    <Typeahead\r\n      labelKey=\"name\"\r\n      onChange={(kind) => State.update({ kind })}\r\n      options={allKinds}\r\n      placeholder=\"Project, Organization or DAO\"\r\n      selected={state.kind}\r\n      positionFixed\r\n    />\r\n  </div>\r\n);\r\n\r\nconst startDateInput = (\r\n  <div className=\"col-lg-6 mb-2\">\r\n    Start date of entity\r\n    <input\r\n      type=\"date\"\r\n      value={state.startDate}\r\n      onChange={(e) => State.update({ startDate: e.target.value })}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst onSubmit = () => {\r\n  if (state.exists) {\r\n    return;\r\n  }\r\n\r\n  const args = {\r\n    account_id: state.accountId,\r\n    kind: state.kind[0].name,\r\n    start_date: `${new Date(state.startDate).getTime()}`,\r\n  };\r\n\r\n  Near.call(ownerId, \"add_entity\", args);\r\n};\r\n\r\nconst header = <div className=\"card-header\">Create an entity</div>;\r\n\r\nconst body = (\r\n  <div className=\"card-body\">\r\n    <div className=\"row\">\r\n      {accountIdInput}\r\n      {kindInput}\r\n      {startDateInput}\r\n    </div>\r\n\r\n    <a\r\n      className={`btn ${state.exists ? \"btn-secondary\" : \"btn-primary\"} mb-2`}\r\n      onClick={onSubmit}\r\n    >\r\n      Submit\r\n    </a>\r\n  </div>\r\n);\r\n\r\nconst footer = (\r\n  <div className=\"card-footer\">\r\n    Preview:\r\n    <Widget\r\n      src={`${ownerId}/widget/Entity`}\r\n      props={{\r\n        isPreview: true,\r\n        id: 0, // irrelevant\r\n        accountId: state.accountId,\r\n        notStandalone: true,\r\n        entity: {\r\n          entity: state.entity,\r\n          kind: state.kind[0].name,\r\n          start_date: `${new Date(state.startDate).getTime()}`,\r\n        },\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nreturn (\r\n  <div className=\"card\">\r\n    {header}\r\n    {body}\r\n    {footer}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/EntityForm"}