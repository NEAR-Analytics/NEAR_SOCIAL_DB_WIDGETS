{"tx_hash": "7RfcFukXo9Gpoo1sXYfFqKweuiWk8TKSp1hBZ4SNp74V", "action_id_social": "CuQ1Q6DU1ngpr3cnbyc2eeFtXyfbLZgQXYePHPajz28a-0-widget", "block_id": 86697524, "block_timestamp": "2023-03-06 16:26:34.842", "signer_id": "contribut3.near", "widget_name": "NeedPage", "source_code": "const ownerId = \"contribut3.near\";\nconst accountId = props.accountId;\nconst cid = props.cid;\n\nif (!accountId || !cid) {\n  return \"Cannot show the request page without an account ID and a CID!\";\n}\n\nconst availableContent = [\"contributors\", \"proposals\"];\n\nconst getContent = (content) => {\n  if (!content || !availableContent.includes(content)) {\n    return \"contributors\";\n  }\n\n  return content;\n};\n\nconst need = Near.view(\n  ownerId,\n  \"get_contribution_need\",\n  { account_id: accountId, cid },\n  \"final\",\n  true\n);\n\nconst isAuthorized = Near.view(\n  ownerId,\n  \"check_is_manager_or_higher\",\n  { entity_id: accountId, account_id: context.accountId },\n  \"final\"\n);\n\nconst needString =\n  typeof need.contribution_type === \"string\"\n    ? need.contribution_type\n    : need.contribution_type.Other;\n\nconst body = (\n  <div className=\"px-3\">\n    <div className=\"d-flex flex-row justify-content-start\" id={accountId}>\n      <div className=\"flex-grow-1 py-3\">\n        <div className=\"d-flex flex-row justify-content-between align-items-start\">\n          <h1 className=\"flex-grow-1\">Need for {needString}</h1>\n          <div className=\"d-flex flex-row justify-content-between align-items-center\">\n            <a\n              className=\"btn me-2 text-light\"\n              style={{\n                backgroundColor: \"#6941C6\",\n                borderColor: \"#6941C6\",\n              }}\n            // href={`/#/${ownerId}/widget/Entity?accountId=${accountId}`}\n            >\n              <i className=\"bi-person-plus\" />\n              <span className=\"text-nowrap\">Invite contributor</span>\n            </a>\n            <Widget\n              src={`${ownerId}/widget/CardMenu`}\n              props={{\n                update: props.update,\n                items: [\n                  {\n                    text: \"Create new request\",\n                    icon: \"bi-boxes\",\n                  },\n                  {\n                    text: \"Invite contributors\",\n                    icon: \"bi-person-plus\",\n                  },\n                  {\n                    text: \"Delete project\",\n                    icon: \"bi-trash\",\n                  },\n                ],\n              }}\n            />\n          </div>\n        </div>\n        <div>\n          <div className=\"d-flex flex-row align-items-center text-muted me-2\">\n            <span className=\"me-2\">By</span>\n            <Widget\n              src={`${ownerId}/widget/ProfileLine`}\n              props={{ accountId, isEntity: true, update: props.update }}\n            />\n          </div>\n          <Widget\n            src={`${ownerId}/widget/ActiveIndicator`}\n            props={{\n              active: need.active,\n              activeText: \"Open for proposals\",\n              inactiveText: \"Closed\",\n            }}\n          />\n        </div>\n        <Widget\n          src={`${ownerId}/widget/Tags`}\n          pros={{ tags: { [needString]: \"\" } }}\n        />\n      </div>\n    </div>\n    <Markdown text={need.description} />\n  </div>\n);\n\nconst proposalsCount = Object.keys(\n  Near.view(\n    ownerId,\n    \"get_need_contribution_requests\",\n    { account_id: accountId, cid },\n    \"final\",\n    true\n  ) ?? {}\n).length;\n\nconst contributorsCount = Object.keys(\n  Near.view(\n    ownerId,\n    \"get_need_contributions\",\n    { account_id: accountId, cid },\n    \"final\",\n    true\n  ) ?? {}\n).length;\n\nconst contentSelector = (\n  <Widget\n    src={`${ownerId}/widget/TabSelector`}\n    props={{\n      tab: \"need\",\n      content: getContent(props.content),\n      search: props.search,\n      accountId: props.accountId,\n      cid: props.cid,\n      update: props.update,\n      buttons: [\n        {\n          id: \"contributors\",\n          text: \"Contributors\",\n          count: contributorsCount,\n          icon: (\n            <svg\n              width=\"15\"\n              height=\"15\"\n              viewBox=\"0 0 20 20\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                d=\"M13.3332 2.8898C14.5679 3.50343 15.4165 4.77762 15.4165 6.25C15.4165 7.72238 14.5679 8.99657 13.3332 9.6102M14.9998 13.972C16.2594 14.5419 17.3936 15.4708 18.3332 16.6667M1.6665 16.6667C3.28858 14.6021 5.49082 13.3333 7.9165 13.3333C10.3422 13.3333 12.5444 14.6021 14.1665 16.6667M11.6665 6.25C11.6665 8.32107 9.98757 10 7.9165 10C5.84544 10 4.1665 8.32107 4.1665 6.25C4.1665 4.17893 5.84544 2.5 7.9165 2.5C9.98757 2.5 11.6665 4.17893 11.6665 6.25Z\"\n                stroke=\"#475467\"\n                stroke-width=\"1.66667\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n              />\n            </svg>\n          ),\n        },\n        {\n          id: \"proposals\",\n          text: \"Proposals\",\n          count: proposalsCount,\n          icon: (\n            <svg\n              width=\"15\"\n              height=\"15\"\n              viewBox=\"0 0 20 20\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                d=\"M15.8333 7.5L13.3333 5M13.3333 5L15.8333 2.5M13.3333 5L18.3333 5M13.3333 17.5V16.5C13.3333 15.0999 13.3333 14.3998 13.0608 13.865C12.8211 13.3946 12.4387 13.0122 11.9683 12.7725C11.4335 12.5 10.7334 12.5 9.33329 12.5H5.66663C4.26649 12.5 3.56643 12.5 3.03165 12.7725C2.56124 13.0122 2.17879 13.3946 1.93911 13.865C1.66663 14.3998 1.66663 15.0999 1.66663 16.5V17.5M10.4166 6.25C10.4166 7.86083 9.11079 9.16667 7.49996 9.16667C5.88913 9.16667 4.58329 7.86083 4.58329 6.25C4.58329 4.63917 5.88913 3.33333 7.49996 3.33333C9.11079 3.33333 10.4166 4.63917 10.4166 6.25Z\"\n                stroke=\"#667085\"\n                stroke-width=\"1.66667\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n              />\n            </svg>\n          ),\n        },\n      ],\n    }}\n  />\n);\n\nconst searchBar = (\n  <div className=\"w-25 col-12 col-md-10 col-lg-8\">\n    <div className=\"card card-sm\">\n      <div className=\"card-body row p-0 ps-2 align-items-center\">\n        <div className=\"col-auto pe-0 me-0\">\n          <i className=\"bi-search\" />\n        </div>\n        <div className=\"col ms-0\">\n          <input\n            className=\"form-control border-0\"\n            type=\"search\"\n            value={props.search}\n            placeholder=\"Search\"\n            onChange={(e) => props.update({ search: e.target.value })}\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n);\n\nconst content = {\n  proposals: (\n    <Widget\n      src={`${ownerId}/widget/ContributionRequestList`}\n      props={{ accountId, search: props.search, update: props.update, cid }}\n    />\n  ),\n  contributors: (\n    <Widget\n      src={`${ownerId}/widget/ContributorList`}\n      props={{ accountId, search: props.search, update: props.update, cid }}\n    />\n  ),\n}[getContent(props.content)];\n\nreturn (\n  <div className=\"\">\n    <div className=\"mb-5\">{body}</div>\n    <div className=\"d-flex flex-row justify-content-between ps-3\">\n      {contentSelector}\n      {searchBar}\n    </div>\n    <div className=\"px-3 pt-3\">{content}</div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/NeedPage"}