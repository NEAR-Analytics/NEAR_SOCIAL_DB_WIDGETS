{"tx_hash": "9rnZPqhsdnoJP364cTwNZVR2CeeSmHNfWQCGMjSPRpMi", "action_id_social": "FEryFvsuTuhP52TaVpAjB3EJd8JTbeJLQDag5a4qVFx6-0-widget", "block_id": 86838783, "block_timestamp": "2023-03-08 14:31:25.814", "signer_id": "contribut3.near", "widget_name": "ContributionRequestForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst id = props.id;\r\n\r\nconst convertType = (contributionType) => {\r\n  if (state.types.some(({ name }) => name === contributionType.name)) {\r\n    return contributionType.name;\r\n  }\r\n\r\n  return { Other: contributionType.name };\r\n};\r\n\r\nState.init({\r\n  need: props.cid ?? null,\r\n  needFetched: false,\r\n  entity: props.accountId ? [{ name: props.accountId }] : [],\r\n  entitiesFetched: !!props.accountId,\r\n  description: props.description ?? \"\",\r\n  contributionType: props.contributionType\r\n    ? [{ name: props.contributionType }]\r\n    : [],\r\n  existingEntities: [],\r\n  types: [],\r\n  typesFetched: false,\r\n});\r\n\r\nif (!state.entitiesFetched) {\r\n  Near.asyncView(ownerId, \"get_entities\", {}, \"final\", false).then((entities) =>\r\n    State.update({\r\n      existingEntities: entities.map((name) => ({ name })),\r\n      entitiesFetched: true,\r\n    })\r\n  );\r\n}\r\n\r\nif (!state.typesFetched) {\r\n  Near.asyncView(ownerId, \"get_contribution_types\", {}, \"final\", false).then(\r\n    (types) =>\r\n      State.update({\r\n        typesFetched: true,\r\n        types: types.map((name) => ({ name })),\r\n      })\r\n  );\r\n}\r\n\r\nif (!state.needFetched && !!state.need) {\r\n  Near.asyncView(\r\n    ownerId,\r\n    \"get_contribution_need\",\r\n    { account_id: props.accountId, cid: props.cid },\r\n    \"final\",\r\n    false\r\n  ).then((need) =>\r\n    State.update({\r\n      contributionType: convertType({ name: need.conibtribution_type }),\r\n      needFetched: true,\r\n    })\r\n  );\r\n}\r\n\r\nconst Label = styled.label`\r\n  font-weight: 600;\r\n  color: #344054;\r\n`;\r\n\r\nconst EntityInput = styled.div`\r\n  margin-bottom: 0.5em;\r\n`;\r\n\r\nconst SelectedEntity = styled.div`\r\n  border-radius: 4px;\r\n  background-color: #f2f4f7;\r\n  height: 5em;\r\n`;\r\n\r\nconst InputWrapper = styled.div`\r\n  margin-bottom: 0.5em;\r\n`;\r\n\r\nconst confirmText = (\r\n  <>\r\n    <i>\r\n      <svg\r\n        width=\"20\"\r\n        height=\"20\"\r\n        viewBox=\"0 0 20 20\"\r\n        fill=\"none\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n      >\r\n        <g clip-path=\"url(#clip0_778_24981)\">\r\n          <path\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            d=\"M8.74952 11.25L17.4995 2.50002M8.85584 11.5234L11.0459 17.1551C11.2389 17.6512 11.3353 17.8993 11.4743 17.9717C11.5948 18.0345 11.7384 18.0345 11.859 17.9719C11.998 17.8997 12.0948 17.6517 12.2883 17.1558L17.7803 3.08269C17.955 2.63504 18.0423 2.41121 17.9945 2.26819C17.953 2.14398 17.8556 2.04651 17.7314 2.00501C17.5883 1.95723 17.3645 2.04458 16.9169 2.21927L2.84373 7.71122C2.34784 7.90474 2.09989 8.0015 2.02763 8.14059C1.96499 8.26116 1.96508 8.4047 2.02786 8.5252C2.10028 8.66421 2.34834 8.76067 2.84446 8.95361L8.47613 11.1437C8.57684 11.1829 8.62719 11.2024 8.66959 11.2327C8.70717 11.2595 8.74004 11.2924 8.76685 11.3299C8.79709 11.3723 8.81667 11.4227 8.85584 11.5234Z\"\r\n            stroke=\"white\"\r\n            stroke-width=\"2\"\r\n            stroke-linecap=\"round\"\r\n            stroke-linejoin=\"round\"\r\n          />\r\n        </g>\r\n        <defs>\r\n          <clipPath id=\"clip0_778_24981\">\r\n            <rect width=\"20\" height=\"20\" fill=\"white\" />\r\n          </clipPath>\r\n        </defs>\r\n      </svg>\r\n    </i>\r\n    <span>Send proposal</span>\r\n  </>\r\n);\r\n\r\nconst body = (\r\n  <>\r\n    <EntityInput>\r\n      <Label htmlFor=\"enity-id\">Contribute to:</Label>\r\n      {props.accountId ? (\r\n        <SelectedEntity id=\"entity-id\">\r\n          <Widget\r\n            src={`${ownerId}/widget/ProfileLine`}\r\n            props={{\r\n              accountId: props.accountId,\r\n              imageSize: \"4em\",\r\n              isEntity: true,\r\n            }}\r\n          />\r\n        </SelectedEntity>\r\n      ) : (\r\n        <Typeahead\r\n          id=\"entity-id\"\r\n          labelKey=\"name\"\r\n          onChange={(entity) => State.update({ entity })}\r\n          options={state.existingEntities}\r\n          placeholder=\"social.near, contribut3.near\"\r\n          selected={state.entity}\r\n          positionFixed\r\n        />\r\n      )}\r\n    </EntityInput>\r\n    <InputWrapper>\r\n      <Widget\r\n        src={`${ownerId}/widget/ContributionTypeInput`}\r\n        props={{\r\n          contributionType: state.contributionType,\r\n          update: (contributionType) => State.update({ contributionType }),\r\n        }}\r\n      />\r\n    </InputWrapper>\r\n    <InputWrapper>\r\n      <Widget\r\n        src={`${ownerId}/widget/DescriptionInput`}\r\n        props={{\r\n          description: state.description,\r\n          text: \"Details:\",\r\n          update: (description) => State.update({ description }),\r\n        }}\r\n      />\r\n    </InputWrapper>\r\n  </>\r\n);\r\n\r\nconst onConfirm = () => {\r\n  const args = {\r\n    entity_id: state.entity[0].name,\r\n    description: state.description,\r\n    contribution_type: convertType(state.contributionType[0]),\r\n    need: state.need,\r\n  };\r\n\r\n  Near.call(ownerId, \"request_contribution\", args);\r\n};\r\n\r\nconst Page = styled.div`\r\n  padding: 0 0.75em;\r\n  max-width: 100%;\r\n\r\n  h1 {\r\n    font-size: 2em;\r\n    margin-bottom: 0.75em;\r\n    padding-bottom: 0.75em;\r\n  }\r\n`;\r\n\r\nconst Form = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-bottom: 0.75em;\r\n  padding: 1em;\r\n  border-radius: 4px;\r\n  background-color: #f9fafb;\r\n`;\r\n\r\nconst Controls = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n`;\r\n\r\nconst CloseButton = styled.a`\r\n  background-color: white;\r\n  padding: 0.7em;\r\n  border-radius: 4px;\r\n  border: 0;\r\n  color: #344054;\r\n  transition: box-shadow 0.2s ease-in-out;\r\n\r\n  &:hover {\r\n    text-decoration: none;\r\n    color: unset;\r\n    box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\r\n  }\r\n`;\r\n\r\nconst ConfirmButton = styled.button`\r\n  padding: 0.7em;\r\n  border-radius: 4px;\r\n  border: 0;\r\n  box-shadow: 0px 1px 2px rgba(16, 24, 40, 0.05);\r\n  background-color: ${({ valid }) => (valid ? \"#7f56d9\" : \"#344054\")};\r\n  color: white;\r\n  transition: background-color 0.2s ease-in-out;\r\n\r\n  &:hover {\r\n    ${({ valid }) => (valid ? \"background-color: #4f56d9;\" : \"\")}\r\n  }\r\n`;\r\n\r\nreturn (\r\n  <Page>\r\n    <h1>Propose contribution</h1>\r\n    <Form>{body}</Form>\r\n    <Controls>\r\n      <CloseButton\r\n        href={`/#/${ownerId}/widget/Index?tab=home`}\r\n        onClick={() => props.update({ tab: \"home\" })}\r\n      >\r\n        Cancel\r\n      </CloseButton>\r\n      <ConfirmButton\r\n        valid={\r\n          state.contributionType.length === 1 && state.description.length > 0\r\n        }\r\n        onClick={onConfirm}\r\n      >\r\n        {confirmText}\r\n      </ConfirmButton>\r\n    </Controls>\r\n  </Page>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/ContributionRequestForm"}