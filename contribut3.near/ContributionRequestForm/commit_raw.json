{"tx_hash": "5cw4nS6CzMX1YGoJHjM244Q4UfQjUo9jdH5j9foEY9ih", "action_id_social": "BzFvTWCzzmgA8fEZVfELaoCbaR3iGt1X6oDvMk58fi9p-0-widget", "block_id": 86825903, "block_timestamp": "2023-03-08 10:13:47.873", "signer_id": "contribut3.near", "widget_name": "ContributionRequestForm", "source_code": "const ownerId = \"contribut3.near\";\r\nconst id = props.id;\r\nconst need = props.need ?? null;\r\n\r\nconst convertType = (contributionType) => {\r\n  if (\r\n    state.allContributionTypes.some(\r\n      ({ name }) => name === contributionType.name\r\n    )\r\n  ) {\r\n    return contributionType.name;\r\n  }\r\n\r\n  return { Other: contributionType.name };\r\n};\r\n\r\nState.init({\r\n  // The entity to which to request a contribution.\r\n  entity: props.entity ? [{ name: props.entity }] : [],\r\n  // The description of the contribution request.\r\n  description: props.description ?? \"\",\r\n  contributionType: props.contributionType\r\n    ? [{ name: props.contributionType }]\r\n    : [],\r\n  existingEntities: [],\r\n  types: [],\r\n});\r\n\r\nconst onSubmit = () => {\r\n  const args = {\r\n    entity_id: state.entity[0].name,\r\n    description: state.description,\r\n    contribution_type: convertType(state.contributionType[0]),\r\n    need,\r\n  };\r\n\r\n  Near.call(ownerId, \"request_contribution\", args);\r\n};\r\n\r\nNear.asyncView(ownerId, \"get_entities\", {}, \"final\", false).then((entities) =>\r\n  State.update({ existingEntities: entities.map((name) => ({ name })) })\r\n);\r\n\r\nNear.asyncView(ownerId, \"get_contribution_types\", {}, \"final\", false).then(\r\n  (types) => State.update({ types: types.map((name) => ({ name })) })\r\n);\r\n\r\nconst entityEditor = props.entity ? (\r\n  <div>\r\n    <label htmlFor=\"account-id\" className=\"text-muted fw-semibold\">\r\n      Contribute to:\r\n    </label>\r\n    <div\r\n      className=\"rounded-3 bg-light\"\r\n      style={{ height: \"5em\" }}\r\n      id=\"account-id\"\r\n    >\r\n      <Widget\r\n        src={`${ownerId}/widget/ProfileLine`}\r\n        props={{ accountId: props.entity, imageSize: \"4em\", isEntity: true }}\r\n      />\r\n    </div>\r\n  </div>\r\n) : (\r\n  <div className=\"col-lg-12  mb-2\">\r\n    <label htmlFor=\"enity-id\">Contribute to:</label>\r\n    <Typeahead\r\n      id=\"entity-id\"\r\n      labelKey=\"name\"\r\n      onChange={(entity) => State.update({ entity })}\r\n      options={state.existingEntities}\r\n      placeholder=\"social.near, contribut3.near\"\r\n      selected={state.entity}\r\n      positionFixed\r\n    />\r\n  </div>\r\n);\r\n\r\nconst descriptionDiv = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/DescriptionInput`}\r\n      props={{\r\n        description: state.description,\r\n        text: \"Details:\",\r\n        update: (description) => State.update({ description }),\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst contributionTypeInput = (\r\n  <div className=\"col-lg-12 mb-2\">\r\n    <Widget\r\n      src={`${ownerId}/widget/ContributionTypeInput`}\r\n      props={{\r\n        contributionType: state.contributionType,\r\n        update: (contributionType) => State.update({ contributionType }),\r\n        allContributionTypes: state.types,\r\n      }}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst body = (\r\n  <div className=\"row\">\r\n    {entityEditor}\r\n    {contributionTypeInput}\r\n    {descriptionDiv}\r\n  </div>\r\n);\r\n\r\nreturn (\r\n  <Widget\r\n    src={`${ownerId}/widget/Modal`}\r\n    props={{\r\n      title: \"Propose contribution\",\r\n      confirmText: (\r\n        <>\r\n          <i className=\"bi-send\" />\r\n          <span>Send proposal</span>\r\n        </>\r\n      ),\r\n      onConfirm: onSubmit,\r\n      hidden: props.hidden,\r\n      onClose: props.onClose,\r\n      body,\r\n      id,\r\n    }}\r\n  />\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/ContributionRequestForm"}