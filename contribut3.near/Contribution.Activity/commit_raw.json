{"tx_hash": "473MWQizV4cMx4hKq7NhPw1dXZ7SRWMVvQ1XVPzJV61E", "action_id_social": "93vHzqQ2eUXKXDiNGEdoHxY7eSbAbwXLNsmUa98WkBSe-0-widget", "block_id": 94753220, "block_timestamp": "2023-06-22T08:12:48.756Z", "signer_id": "contribut3.near", "widget_name": "Contribution.Activity", "source_code": "const ownerId = \"contribut3.near\";\nconst projectId = props.projectId;\nconst vendorId = props.vendorId;\nconst title = props.title;\nconst status = props.status;\nconst actions = props.actions;\n\nState.init({\n  name: \"\",\n  nameIsFetched: false,\n  vendorName: \"\",\n  vendorNameIsFetched: false,\n});\n\nif (!state.nameIsFetched) {\n  Near.asyncView(\n    \"social.near\",\n    \"get\",\n    { keys: [`${projectId}/profile/name`] },\n    \"final\",\n    false\n  ).then((data) =>\n    State.update({\n      name: data[projectId].profile.name,\n      nameIsFetched: true,\n    })\n  );\n}\n\nif (!state.vendorNameIsFetched) {\n  Near.asyncView(\n    \"social.near\",\n    \"get\",\n    { keys: [`${vendorId}/profile/name`] },\n    \"final\",\n    false\n  ).then((data) =>\n    State.update({\n      vendorName: data[vendorId].profile.name,\n      vendorNameIsFetched: true,\n    })\n  );\n}\n\nif (!state.nameIsFetched || !state.vendorNameIsFetched) {\n  return <>Loading...</>;\n}\n\nconst activity = [\n  {\n    id: \"created\",\n    text: (\n      <>\n        <b>{state.name}</b> created a contract <b>\"{title}\"</b> with{\" \"}\n        <b>{state.vendorName}</b>\n      </>\n    ),\n  },\n  {\n    id: \"awaiting\",\n    text: (\n      <>\n        Awaiting approval by <b>{state.vendorName}</b>\n      </>\n    ),\n  },\n];\n\nif (\n  typeof status === \"string\" ||\n  (!(\"Rejected\" in status) && !(\"Created\" in status))\n) {\n  activity.push({\n    id: \"accepted\",\n    text: (\n      <>\n        <b>{state.vendorName}</b> accepted contract\n      </>\n    ),\n  });\n  activity.push({\n    id: \"started\",\n    text: <>Contract has started</>,\n  });\n}\n\nif (typeof status === \"object\" && \"Rejected\" in status) {\n  activity.push({\n    id: \"rejected\",\n    text: (\n      <>\n        <b>{state.vendorName}</b> rejected contract\n      </>\n    ),\n  });\n}\n\nif (status === \"Ongoing\" || \"Delivered\" in status || \"Completed\" in status) {\n  activity.push({\n    id: \"ongoing\",\n    text: <>Work in progress</>,\n  });\n}\n\nactions.forEach(({ description, start_date, end_date }) =>\n  activity.push({\n    id: start_date,\n    text: <>{description}</>,\n    timestamp: `${new Date(\n      Number(start_date.substring(0, start_date.length - 6))\n    ).toLocaleDateString()}${\n      end_date\n        ? \" - \" +\n          new Date(\n            Number(end_date.substring(0, end_date.length - 6))\n          ).toLocaleDateString()\n        : \"\"\n    }`,\n  })\n);\n\nif (\n  typeof status !== \"string\" &&\n  (\"Delivered\" in status || \"Completed\" in status)\n) {\n  activity.push({\n    id: \"delivered\",\n    text: (\n      <>\n        Contract marked as delivered by <b>{state.vendorName}</b>\n      </>\n    ),\n  });\n}\n\nif (typeof status !== \"string\" && \"Completed\" in status) {\n  activity.push({\n    id: \"completed\",\n    text: <>Contract completed</>,\n  });\n}\n\nconst List = styled.ul`\n  list-style-position: inside;\n  list-style-type: image;\n  list-style-image: url(https://ipfs.near.social/ipfs/bafkreicxzxikc435dyiwilxuitevu5uiwoea4ls6o7ckdev3esjs6r3p5q);\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  padding: 0;\n  gap: 2em;\n`;\n\nreturn (\n  <List>\n    {activity.reverse().map(({ id, text, timestamp }) => (\n      <li key={id}>\n        <span>{text}</span>\n        <br />\n        {timestamp ? <small>At {timestamp}</small> : <></>}\n      </li>\n    ))}\n  </List>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/Contribution.Activity", "__row_index": 1}