{"tx_hash": "4o353tfJu8wzoKBgrk5EAo4bWPBEY1PZHBLE53dbEeQH", "action_id_social": "8Ejs4Do7xCn5PiSAUzMDVHKWBSMSmkiZ2RYEG5J98L8f-0-widget", "block_id": 86757966, "block_timestamp": "2023-03-07 12:05:25.321", "signer_id": "contribut3.near", "widget_name": "NeedList", "source_code": "const ownerId = \"contribut3.near\";\r\nconst search = props.search;\r\nconst accountId = props.accountId;\r\nconst isAdmin = props.isAdmin;\r\nconst limit = 10;\r\n\r\nState.init({\r\n  needs: [],\r\n  shown: [],\r\n  from: 0,\r\n  hasMore: true,\r\n});\r\n\r\nif (state.needs.length === 0) {\r\n  Near.asyncView(\r\n    ownerId,\r\n    accountId\r\n      ? isAdmin\r\n        ? \"get_admin_contribution_needs\"\r\n        : \"get_entity_contribution_needs\"\r\n      : \"get_contribution_needs\",\r\n    { ...(accountId ? { account_id: accountId } : {}) },\r\n    \"final\",\r\n    false\r\n  ).then((needs) => {\r\n    if (accountId && isAdmin) {\r\n      State.update({\r\n        needs: needs.map((cid) => [accountId, cid]),\r\n        shown: needs.map((cid) => [accountId, cid]).slice(0, limit),\r\n        from: limit,\r\n        hasMore: needs.length > limit,\r\n      });\r\n    } else {\r\n      State.update({\r\n        needs: needs.sort(([a], [b]) => a.localeCompare(b)),\r\n        shown: needs.slice(0, limit),\r\n        from: limit,\r\n        hasMore: needs.length > limit,\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nconst loadMore = () => {\r\n  State.update({\r\n    shown: state.needs.slice(0, state.from + limit),\r\n    from: state.from + limit,\r\n    hasMore: state.from + limit < state.needs.length,\r\n  });\r\n};\r\n\r\nconst WidgetContainer = styled.div`\r\n  margin: 0.5em 0;\r\n`;\r\n\r\nreturn (\r\n  <InfiniteScroll loadMore={loadMore} hasMore={state.hasMore}>\r\n    {state.shown\r\n      .filter(([accountId]) => accountId.includes(search))\r\n      .map(([accountId, cid]) => (\r\n        <WidgetContainer key={cid}>\r\n          <Widget\r\n            src={`${ownerId}/widget/Need`}\r\n            props={{\r\n              accountId,\r\n              cid,\r\n              update: props.update,\r\n            }}\r\n          />\r\n        </WidgetContainer>\r\n      ))}\r\n  </InfiniteScroll>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/NeedList"}