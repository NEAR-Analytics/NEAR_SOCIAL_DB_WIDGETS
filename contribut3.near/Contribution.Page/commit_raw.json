{"tx_hash": "B5urThfhSSes2ADm1tg2Dag8Ldkx71rJnRoN81oA4xfL", "action_id_social": "EwA2hrrvE2BRAD7h5vHDBYZcoMYV8Q7uoRBFyxdq8YmN-0-widget", "block_id": 90315261, "block_timestamp": "2023-04-24 10:14:35.349", "signer_id": "contribut3.near", "widget_name": "Contribution.Page", "source_code": "const ownerId = \"contribut3.near\";\nconst projectId = props.projectId;\nconst cid = props.cid;\nconst vendorId = props.vendorId;\n\nconst availableContent = [\"activity\", \"details\", \"feedback\"];\n\nconst getContent = (content) => {\n  if (!content || !availableContent.includes(content)) {\n    return \"activity\";\n  }\n\n  return content;\n};\n\nState.init({\n  contribution: null,\n  contributionIsFetched: false,\n  proposal: null,\n  proposalIsFetched: false,\n  isProjectAdmin: false,\n  isProjectAdminIsFetched: false,\n  isVendorAdmin: false,\n  isVendorAdminIsFetched: false,\n});\n\nif (!state.proposalIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_proposal\",\n    { project_id: projectId, cid, vendor_id: vendorId },\n    \"final\",\n    false\n  ).then((proposal) => State.update({ proposal, proposalIsFetched: true }));\n}\n\nif (!state.contributionIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"get_contribution\",\n    { project_id: projectId, cid, vendor_id: vendorId },\n    \"final\",\n    false\n  ).then((contribution) =>\n    State.update({ contribution, contributionIsFetched: true })\n  );\n}\n\nif (!state.isProjectAdminIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"check_is_project_admin\",\n    { project_id: projectId, account_id: context.accountId },\n    \"final\",\n    false\n  ).then((isProjectAdmin) =>\n    State.update({ isProjectAdmin, isProjectAdminIsFetched: true })\n  );\n}\n\nif (!state.isVendorAdminIsFetched) {\n  Near.asyncView(\n    ownerId,\n    \"check_is_vendor_admin\",\n    { vendor_id: vendorId, account_id: context.accountId },\n    \"final\",\n    false\n  ).then((isVendorAdmin) =>\n    State.update({ isVendorAdmin, isVendorAdminIsFetched: true })\n  );\n}\n\nif (\n  !state.contributionIsFetched ||\n  !state.proposalIsFetched ||\n  !state.isProjectAdminIsFetched ||\n  !state.isVendorAdminIsFetched\n) {\n  return <>Loading...</>;\n}\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  gap: 1em;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  justify-content: space-between;\n  gap: 1em;\n  width: 100%;\n`;\n\nconst HeaderDetails = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  gap: 1em;\n  width: 80%;\n`;\n\nconst ContentContainer = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  justify-content: flex-start;\n  gap: 1em;\n  width: 100%;\n`;\n\nconst MainContent = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  gap: 1em;\n  width: 80%;\n  padding-top: 0.25em;\n`;\n\nconst Sidebar = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  justify-content: flex-start;\n  gap: 1em;\n  width: 20%;\n`;\n\nconst circledPlus = (\n  <svg\n    width=\"18\"\n    height=\"18\"\n    viewBox=\"0 0 18 18\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_1624_38049)\">\n      <path\n        d=\"M9 6V12M6 9H12M16.5 9C16.5 13.1421 13.1421 16.5 9 16.5C4.85786 16.5 1.5 13.1421 1.5 9C1.5 4.85786 4.85786 1.5 9 1.5C13.1421 1.5 16.5 4.85786 16.5 9Z\"\n        stroke=\"currentColor\"\n        stroke-width=\"1.66667\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_1624_38049\">\n        <rect width=\"18\" height=\"18\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n);\n\nconst personPlus = (\n  <svg\n    width=\"18\"\n    height=\"16\"\n    viewBox=\"0 0 18 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M12 3.5L14.25 1.25M14.25 1.25L16.5 3.5M14.25 1.25V5.75M12 14.75V13.85C12 12.5899 12 11.9598 11.7548 11.4785C11.539 11.0552 11.1948 10.711 10.7715 10.4952C10.2902 10.25 9.66012 10.25 8.4 10.25H5.1C3.83988 10.25 3.20982 10.25 2.72852 10.4952C2.30516 10.711 1.96095 11.0552 1.74524 11.4785C1.5 11.9598 1.5 12.5899 1.5 13.85V14.75M9.375 4.625C9.375 6.07475 8.19975 7.25 6.75 7.25C5.30025 7.25 4.125 6.07475 4.125 4.625C4.125 3.17525 5.30025 2 6.75 2C8.19975 2 9.375 3.17525 9.375 4.625Z\"\n      stroke=\"#006ADC\"\n      stroke-width=\"1.66667\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n);\n\nconst plus = (\n  <svg\n    width=\"18\"\n    height=\"18\"\n    viewBox=\"0 0 18 18\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M9 3.75V14.25M3.75 9H14.25\"\n      stroke=\"#006ADC\"\n      stroke-width=\"1.66667\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n);\n\nconst CTARow = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: flex-start;\n  gap: 0.75em;\n`;\n\nconst Heading = styled.div`\n  padding-bottom: 0.5em;\n  font-style: normal;\n  font-weight: 700;\n  font-size: 1.125em;\n  line-height: 1.5em;\n  color: #000;\n  width: 100%;\n`;\n\nconst content = {\n  activity: (\n    <Widget\n      src={`${ownerId}/widget/Contribution.Activity`}\n      props={{\n        projectId,\n        title: state.proposal.title,\n        actions: state.contribution.actions,\n        status: state.contribution.status,\n        vendorId,\n        isAdmin: state.isAdmin,\n      }}\n    />\n  ),\n  details: (\n    <Widget\n      src={`${ownerId}/widget/Contribution.About`}\n      props={{\n        projectId,\n        cid,\n        vendorId,\n        isAdmin: state.isAdmin,\n      }}\n    />\n  ),\n  feedback: (\n    <Widget\n      src={`${ownerId}/widget/Contribution.Feedback`}\n      props={{\n        projectId,\n        cid,\n        vendorId,\n        status: state.contribution.status,\n        title: state.proposal.title,\n        projectFeedback: state.contribution.project_feedback,\n        vendorFeedback: state.contribution.vendor_feedback,\n      }}\n    />\n  ),\n}[getContent(props.content)];\n\nconst Title = styled.h1`\n  font-style: normal;\n  font-weight: 700;\n  font-size: 1.5em;\n  line-height: 1.5em;\n  color: #101828;\n`;\n\nconst vendorCreatedView =\n  state.isVendorAdmin && typeof state.contribution.status !== \"string\" && \"Created\" in state.contribution.status ? (\n    <>\n      <Widget\n        src={`${ownerId}/widget/Buttons.Green`}\n        props={{\n          text: (\n            <>\n              <svg\n                width=\"14\"\n                height=\"11\"\n                viewBox=\"0 0 14 11\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <path\n                  d=\"M13 1.5L4.75 9.75L1 6\"\n                  stroke=\"#11181C\"\n                  stroke-width=\"1.66667\"\n                  stroke-linecap=\"round\"\n                  stroke-linejoin=\"round\"\n                />\n              </svg>\n              Accept contract\n            </>\n          ),\n          onClick: () =>\n            Near.call(ownerId, \"accept_contribution\", {\n              project_id: projectId,\n              cid,\n              vendor_id: vendorId,\n            }),\n        }}\n      />\n      <Widget\n        src={`${ownerId}/widget/Buttons.Red`}\n        props={{\n          text: (\n            <>\n              <svg\n                width=\"12\"\n                height=\"12\"\n                viewBox=\"0 0 12 12\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n              >\n                <path\n                  d=\"M10.5 1.5L1.5 10.5M1.5 1.5L10.5 10.5\"\n                  stroke=\"#F44738\"\n                  stroke-width=\"1.66667\"\n                  stroke-linecap=\"round\"\n                  stroke-linejoin=\"round\"\n                />\n              </svg>\n              Decline contract\n            </>\n          ),\n          onClick: () =>\n            Near.call(ownerId, \"reject_contribution\", {\n              project_id: projectId,\n              cid,\n              vendor_id: vendorId,\n            }),\n        }}\n      />\n    </>\n  ) : (\n    <></>\n  );\nconst vendorAcceptedView =\n  state.isVendorAdmin && typeof state.contribution.status !== \"string\" && \"Accepted\" in state.contribution.status ? (\n    <Widget\n      src={`${ownerId}/widget/Buttons.Grey`}\n      props={{\n        text: (\n          <>\n            <svg\n              width=\"15\"\n              height=\"16\"\n              viewBox=\"0 0 15 16\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                d=\"M1 14.75L1 2M1 8.75H6.55C6.97004 8.75 7.18006 8.75 7.34049 8.66825C7.48161 8.59635 7.59635 8.48161 7.66825 8.34049C7.75 8.18006 7.75 7.97004 7.75 7.55V2.45C7.75 2.02996 7.75 1.81994 7.66825 1.65951C7.59635 1.51839 7.48161 1.40365 7.34049 1.33175C7.18006 1.25 6.97004 1.25 6.55 1.25H2.2C1.77996 1.25 1.56994 1.25 1.40951 1.33175C1.26839 1.40365 1.15365 1.51839 1.08175 1.65951C1 1.81994 1 2.02996 1 2.45V8.75ZM7.75 2.75H12.55C12.97 2.75 13.1801 2.75 13.3405 2.83175C13.4816 2.90365 13.5963 3.01839 13.6683 3.15951C13.75 3.31994 13.75 3.52996 13.75 3.95V9.05C13.75 9.47004 13.75 9.68006 13.6683 9.84049C13.5963 9.98161 13.4816 10.0963 13.3405 10.1683C13.1801 10.25 12.97 10.25 12.55 10.25H8.95C8.52996 10.25 8.31994 10.25 8.15951 10.1683C8.01839 10.0963 7.90365 9.98161 7.83175 9.84049C7.75 9.68006 7.75 9.47004 7.75 9.05V2.75Z\"\n                stroke=\"#006ADC\"\n                stroke-width=\"1.66667\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n              />\n            </svg>\n            Deliver work\n          </>\n        ),\n        onClick: () =>\n          Near.call(ownerId, \"deliver_contribution\", {\n            project_id: projectId,\n            cid,\n            vendor_id: vendorId,\n          }),\n      }}\n    />\n  ) : (\n    <></>\n  );\n\nconst projectDeliveredView =\n  state.isProjectAdmin && typeof state.contribution.status !== \"string\" && \"Delivered\" in state.contribution.status ? (\n    <Widget\n      src={`${ownerId}/widget/Buttons.Grey`}\n      props={{\n        text: (\n          <>\n            <svg\n              width=\"15\"\n              height=\"16\"\n              viewBox=\"0 0 15 16\"\n              fill=\"none\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n            >\n              <path\n                d=\"M1 14.75L1 2M1 8.75H6.55C6.97004 8.75 7.18006 8.75 7.34049 8.66825C7.48161 8.59635 7.59635 8.48161 7.66825 8.34049C7.75 8.18006 7.75 7.97004 7.75 7.55V2.45C7.75 2.02996 7.75 1.81994 7.66825 1.65951C7.59635 1.51839 7.48161 1.40365 7.34049 1.33175C7.18006 1.25 6.97004 1.25 6.55 1.25H2.2C1.77996 1.25 1.56994 1.25 1.40951 1.33175C1.26839 1.40365 1.15365 1.51839 1.08175 1.65951C1 1.81994 1 2.02996 1 2.45V8.75ZM7.75 2.75H12.55C12.97 2.75 13.1801 2.75 13.3405 2.83175C13.4816 2.90365 13.5963 3.01839 13.6683 3.15951C13.75 3.31994 13.75 3.52996 13.75 3.95V9.05C13.75 9.47004 13.75 9.68006 13.6683 9.84049C13.5963 9.98161 13.4816 10.0963 13.3405 10.1683C13.1801 10.25 12.97 10.25 12.55 10.25H8.95C8.52996 10.25 8.31994 10.25 8.15951 10.1683C8.01839 10.0963 7.90365 9.98161 7.83175 9.84049C7.75 9.68006 7.75 9.47004 7.75 9.05V2.75Z\"\n                stroke=\"#006ADC\"\n                stroke-width=\"1.66667\"\n                stroke-linecap=\"round\"\n                stroke-linejoin=\"round\"\n              />\n            </svg>\n            End contract\n          </>\n        ),\n        onClick: () =>\n          Near.call(ownerId, \"complete_contribution\", {\n            project_id: projectId,\n            cid,\n            vendor_id: vendorId,\n          }),\n      }}\n    />\n  ) : (\n    <></>\n  );\n\nconst addActionView = (typeof state.contribution.status !== \"string\" && \"Accepted\" in state.contribution.status) || state.contribution.status === \"Ongoing\" ? (\n  <Widget\n    src={`${ownerId}/widget/Contribution.ActionSideWindow`}\n    props={{\n      projectId,\n      vendorId,\n      cid,\n    }}\n  />\n) : <></>;\n\nreturn (\n  <Container>\n    <Header>\n      <HeaderDetails>\n        <Title>{state.proposal.title}</Title>\n        <CTARow>\n          {vendorCreatedView}\n          {addActionView}\n          {vendorAcceptedView}\n          {projectDeliveredView}\n        </CTARow>\n      </HeaderDetails>\n    </Header>\n    <ContentContainer>\n      <MainContent>\n        <Widget\n          src={`${ownerId}/widget/TabSelector`}\n          props={{\n            tab: \"contribution\",\n            content: getContent(props.content),\n            search: props.search,\n            update: props.update,\n            projectId,\n            vendorId,\n            cid,\n            buttons: [\n              {\n                id: \"activity\",\n                text: \"Activity\",\n              },\n              {\n                id: \"details\",\n                text: \"Details\",\n              },\n              {\n                id: \"feedback\",\n                text: \"Feedback\",\n              },\n            ],\n          }}\n        />\n        {content}\n      </MainContent>\n      <Sidebar>\n        <Widget\n          src={`${ownerId}/widget/Contribution.Sidebar`}\n          props={{ projectId, vendorId, cid }}\n        />\n      </Sidebar>\n    </ContentContainer>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/Contribution.Page"}