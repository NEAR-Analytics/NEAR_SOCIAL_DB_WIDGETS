{"tx_hash": "6apR51SGm9Xt565NUbHmpSVJwPUdKU2Um2EViY3WjasH", "action_id_social": "4RffqcaAjbPxtcZpwFN5uXrRbSGuENWNXakydt4AueQx-0-widget", "block_id": 83760535, "block_timestamp": "2023-01-25 12:17:35.044", "signer_id": "contribut3.near", "widget_name": "Contribution", "source_code": "const ownerId = \"contribut3.near\";\r\nconst entityId = props.entityId;\r\nconst contributorId = props.contributorId;\r\nconst accountId = context.accountId;\r\n\r\ninitState({\r\n  endDate: new Date().toLocaleDateString(),\r\n});\r\n\r\nif (!entityId || !contributorId) {\r\n  return \"Cannot show contribution without entity ID or contributor ID!\";\r\n}\r\n\r\nconst contribution = Near.view(\r\n  ownerId,\r\n  \"get_contribution\",\r\n  { entity_id: entityId, contributor_id: contributorId },\r\n  \"final\"\r\n);\r\n\r\nconst currentAccountContribution = Near.view(\r\n  ownerId,\r\n  \"get_contribution\",\r\n  { entity_id: entityId, contributor_id: accountId },\r\n  \"final\"\r\n);\r\n\r\nif (!contribution) {\r\n  return \"Loading...\";\r\n}\r\n\r\nconst isAuthorized =\r\n  !!currentAccountContribution &&\r\n  currentAccountContribution.permissions.includes(\"Admin\");\r\n\r\nconst endDateInput = (\r\n  <div className=\"col-lg-6 mb-2\">\r\n    End date of contribution:\r\n    <input\r\n      type=\"date\"\r\n      value={state.endDate}\r\n      onChange={(e) => State.update({ endDate: e.target.value })}\r\n    />\r\n  </div>\r\n);\r\n\r\nconst finishButton =\r\n  isAuthorized && !contribution.current.end_date ? (\r\n    <div className=\"card-footer\">\r\n      {endDateInput}\r\n      <a\r\n        className=\"btn btn-outline-primary mb-2\"\r\n        onClick={() => {\r\n          const args = {\r\n            entity_id: entityId,\r\n            contributor_id: contributorId,\r\n            end_date: `${new Date(state.endDate).getTime()}`,\r\n          };\r\n          Near.call(ownerId, \"finish_contribution\", args);\r\n        }}\r\n      >\r\n        Finish\r\n      </a>\r\n    </div>\r\n  ) : null;\r\n\r\nconst shareButton = props.isPreview ? null : (\r\n  <a\r\n    className=\"card-link\"\r\n    href={`https://near.social/#/${ownerId}/widget/Contribution?entityId=${entityId}&contributorId=${contributorId}`}\r\n    role=\"button\"\r\n    target=\"_blank\"\r\n    title=\"Open in new tab\"\r\n  >\r\n    <div className=\"bi bi-share\" />\r\n  </a>\r\n);\r\n\r\nconst header = (\r\n  <div className=\"card-header\">\r\n    <small className=\"text-muted\">\r\n      <div className=\"row justify-content-between\">\r\n        <div className=\"col-4\">\r\n          <Widget\r\n            src={`mob.near/widget/ProfileLine`}\r\n            props={{ accountId: contributorId }}\r\n          />\r\n        </div>\r\n        <div className=\"col-5\">\r\n          <div className=\"d-flex justify-content-end\">{shareButton}</div>\r\n        </div>\r\n      </div>\r\n    </small>\r\n  </div>\r\n);\r\n\r\nconst detail = ({ description, start_date, end_date }) => (\r\n  <div className=\"card\">\r\n    <div className=\"card-header\">Details</div>\r\n    <div className=\"card-body\">\r\n      Description:\r\n      <br />\r\n      <p>{description || \"Founded entity\"}</p>\r\n      Start date:\r\n      <br />\r\n      <p>{new Date(Number(start_date)).toLocaleDateString()}</p>\r\n      {end_date ? (\r\n        <>\r\n          End date: <br /> <p>{end_date}</p>\r\n        </>\r\n      ) : null}\r\n    </div>\r\n    {finishButton}\r\n  </div>\r\n);\r\n\r\nconst pastWork =\r\n  !contribution.history || contribution.history.length === 0 ? null : (\r\n    <>\r\n      Past work:\r\n      {contribution.history.map(detail)}\r\n    </>\r\n  );\r\n\r\nconst body = (\r\n  <div className=\"card-body\">\r\n    <div>\r\n      Contribution to:\r\n      <Widget\r\n        src={`mob.near/widget/ProfileLine`}\r\n        props={{ accountId: entityId }}\r\n      />\r\n    </div>\r\n    Current work:\r\n    {detail(contribution.current)}\r\n    {pastWork}\r\n  </div>\r\n);\r\n\r\nreturn (\r\n  <div className=\"card\">\r\n    {header}\r\n    {body}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/contribut3.near/widget/Contribution"}