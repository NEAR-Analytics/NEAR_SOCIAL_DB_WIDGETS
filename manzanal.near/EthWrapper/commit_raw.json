{"tx_hash": "Hk36BZaKAdzkC4fb3x7MJRY9wNTas5rWE9r58FvKc9fT", "action_id_social": "92vgbJ6yrceCPEqfjkgHiutBCfiLB6PddNPjDLd34wNq-0-widget", "block_id": 91621611, "block_timestamp": "2023-05-11T17:20:18.543Z", "signer_id": "manzanal.near", "widget_name": "EthWrapper", "source_code": "const ownerId = \"manzanal.near\";\nconst tokenName = \"ETH\";\nconst wrapTokenName = \"WETH\";\nconst wethAddress =\n  props.wethAddress || \"0xB4FBF271143F4FBf7B91A5ded31805e42b2208d6\";\nconst tokenDecimals = 18;\nconst wethAbiUrl =\n  props.wethAbiUrl ||\n  \"https://api.etherscan.io/api?module=contract&action=getabi&address=0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2&format=raw\";\nconst wethAbi = fetch(wethAbiUrl);\n\nif (!wethAbi.ok) {\n  return \"Loading\";\n}\nconst wethAbiBody = wethAbi.body;\nconst signer = Ethers.provider() ? Ethers.provider().getSigner() : null;\nconst wethContract = new ethers.Contract(wethAddress, wethAbiBody, signer);\n\nState.init({\n  signerAddress: null,\n});\n\nconst getSignerAddress = () => {\n  signer.getAddress().then((signerAddress) => {\n    State.update({ signerAddress });\n  });\n};\ngetSignerAddress();\n\nconst imgWrapTokenSvg = (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n    <g fill=\"none\" fill-rule=\"evenodd\">\n      <circle cx=\"16\" cy=\"16\" r=\"16\" fill=\"#627EEA\" />\n      <g fill=\"#FFF\" fill-rule=\"nonzero\">\n        <path fill-opacity=\".602\" d=\"M16.498 4v8.87l7.497 3.35z\" />\n        <path d=\"M16.498 4L9 16.22l7.498-3.35z\" />\n        <path fill-opacity=\".602\" d=\"M16.498 21.968v6.027L24 17.616z\" />\n        <path d=\"M16.498 27.995v-6.028L9 17.616z\" />\n        <path fill-opacity=\".2\" d=\"M16.498 20.573l7.497-4.353-7.497-3.348z\" />\n        <path fill-opacity=\".602\" d=\"M9 16.22l7.498 4.353v-7.701z\" />\n      </g>\n    </g>\n  </svg>\n);\nconst imgTokenSvg = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    version=\"1.2\"\n    viewBox=\"0 0 21 21\"\n    width=\"35\"\n    height=\"35\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      d=\"m10.7 21c-5.8 0-10.5-4.7-10.5-10.5 0-5.8 4.7-10.5 10.5-10.5 5.7 0 10.4 4.7 10.4 10.5 0 5.8-4.7 10.5-10.4 10.5zm3.9-9.6l-4.1 2.4-4-2.4 4 5.8zm0-0.8l-4-6.8-4 6.8 4 2.3z\"\n    />\n  </svg>\n);\n\nconst parseToUnitsFn = (amount) => {\n  const tokenDecimals = 18;\n  return ethers.utils.parseUnits(amount, tokenDecimals);\n};\n\nconst formatUnitsFn = (amount) => {\n  const tokenDecimals = 18;\n  return ethers.utils.formatUnits(amount, tokenDecimals);\n};\nconst isValidAmountFn = (amount) => {\n  if (!amount) return false;\n  if (isNaN(Number(amount))) return false;\n  if (amount === \"\") return false;\n  if (amount < 0) return false;\n  return true;\n};\nconst isSignedIn = () => !!state.signerAddress;\n\nconst getEthBalance = (signerAddress, updateStateCb) => {\n  Ethers.provider()\n    .getBalance(signerAddress)\n    .then((balance) => updateStateCb(formatUnitsFn(balance)));\n};\n\nconst getWEthBalance = (signerAddress, updateStateCb) => {\n  wethContract\n    .balanceOf(signerAddress)\n    .then((balance) => updateStateCb(formatUnitsFn(balance)));\n};\n\nconst wrapFn = (amountIn) => {\n  const amount = parseToUnitsFn(amountIn);\n\n  wethContract.deposit({ value: amount });\n};\nconst unwrapFn = (amountIn) => {\n  const amount = parseToUnitsFn(amountIn);\n\n  wethContract.withdraw(amount);\n};\nif (!state.signerAddress) return \"Loading...\";\nreturn (\n  <Widget\n    src={`${ownerId}/widget/AbstractWrapper`}\n    props={{\n      tokenName,\n      wrapTokenName,\n      imgTokenSvg,\n      imgWrapTokenSvg,\n      getTokenBalanceFn: getEthBalance,\n      getWrapTokenBalanceFn: getWEthBalance,\n      parseToUnitsFn,\n      formatUnitsFn,\n      isValidAmountFn,\n      wrapFn,\n      unwrapFn,\n      isSignedIn,\n      signerAddress: state.signerAddress,\n    }}\n  />\n);\n", "metadata": null, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/manzanal.near/widget/EthWrapper", "__row_index": 0}