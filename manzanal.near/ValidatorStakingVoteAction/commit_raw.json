{"tx_hash": "7r6gjpn7AZHSRHL7u6WA5AN7zv7RYWMgyj9WGKt5F52B", "action_id_social": "GtiHj6zfZSsgyyUsp7gWGrjsjPT6jNtwcFjG3jaw1dGv-0-widget", "block_id": 84845003, "block_timestamp": "2023-02-09 14:01:07.756", "signer_id": "manzanal.near", "widget_name": "ValidatorStakingVoteAction", "source_code": "if (!context.accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nconst poolId = props.validator_account_id || \"idtcn4.poolv1.near\";\nconst CONTRACT_ID = \"meta-vote.near\";\nconst GET_VP_METHOD = \"get_available_voting_power\";\nconst VOTE_METHOD = \"vote\";\nconst VOTE_CONTRACT_ADDRESS_ARG = \"metastaking.app\";\n\nconst YoctoToNear = (amountYocto) =>\n  new Big(amountYocto).div(new Big(10).pow(24)).toFixed(2);\n\nconst getVotingPowerBalance = () => {\n  const balanceYocto = Near.view(CONTRACT_ID, GET_VP_METHOD, {\n    voter_id: context.accountId,\n  });\n  const _balance = YoctoToNear(balanceYocto);\n  return _balance;\n};\n\ninitState({\n  amount: 0,\n  poolId,\n  valid: false,\n  balance: getVotingPowerBalance(),\n});\n\nconst onVoteClick = () => {\n  const gas = 200 * 1000000000000;\n  const deposit = \"\";\n  const args = {\n    contract_address: VOTE_CONTRACT_ADDRESS_ARG,\n    voting_power: parseInt(state.amount) + \"000000000000000000000000\",\n    votable_object_id: state.poolId,\n  };\n\n  Near.call(CONTRACT_ID, VOTE_METHOD, args, gas, deposit);\n};\nconst onUseMaxClick = () => {\n  const balance = getVotingPowerBalance();\n  State.update({ amount: balance, balance, valid: balance > 0 });\n};\n\nconst handleChange = (e) => {\n  State.update({\n    amount: e.target.value,\n    valid:\n      e.target.value > 0 &&\n      state.balance > 0 &&\n      e.target.value <= state.balance,\n  });\n};\n\nconst handleBlur = (e) => {\n  State.update({ amount: parseInt(state.amount) });\n};\n\nreturn (\n  <div>\n    <div class=\"d-flex flex-row justify-content-between clearfix\">\n      <div class=\"col-sm-6\">\n        <div class=\"bs-calltoaction bs-calltoaction-default\">\n          <div class=\"col-md-9 cta-contents text-primary\">\n            <h5>{state.poolId}</h5>\n          </div>\n        </div>\n        <a\n          disabled={context.loading}\n          className={`btn ${\n            context.loading ? \"btn-outline-dark\" : \"btn-secondary\"\n          }`}\n          href={`/#/manzanal.near/widget/ValidatorsStakingVote`}\n          role=\"button\"\n        >\n          Back&nbsp;to&nbsp;validators\n        </a>\n      </div>\n    </div>\n    <div class=\"d-flex flex-row mt-3 justify-content-center\">\n      <div class=\"col-sm-6\">\n        <div class=\"d-flex justify-content-start\">\n          <div class=\"card\">\n            <div class=\"card-body\">\n              <h5 class=\"card-title\">Vote</h5>\n              <p>How much Voting Power do you want to asign to this node?</p>\n              <div class=\"input-group input-group-md my-3\">\n                <div class=\"input-group-prepend\">\n                  <span class=\"input-group-text\">VP</span>\n                </div>\n                <input\n                  type=\"number\"\n                  value={state.amount}\n                  onChange={handleChange}\n                  onBlur={handleBlur}\n                  class=\"form-control\"\n                  placeholder=\"Amount Voting Power\"\n                  aria-label=\"amount-voting-power\"\n                  aria-describedby=\"btnGroupAddon\"\n                />\n                <div class=\"input-group-append \">\n                  <button\n                    class=\"btn btn-outline-secondary\"\n                    id=\"btnGroupAddon\"\n                    className={`btn ${\n                      context.loading ? \"btn-outline-dark\" : \"btn-secondary\"\n                    }`}\n                    onClick={onUseMaxClick}\n                  >\n                    Use MAX\n                  </button>\n                </div>\n              </div>\n              <button\n                disabled={context.loading || !state.valid}\n                className={`btn ${\n                  context.loading ? \"btn-outline-dark\" : \"btn-primary\"\n                }`}\n                onClick={onVoteClick}\n              >\n                Vote this validator\n              </button>\n            </div>\n\n            <Widget\n              src=\"manzanal.near/widget/UserVotingDashComponent\"\n              props={{ noborder: true }}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/manzanal.near/widget/ValidatorStakingVoteAction"}