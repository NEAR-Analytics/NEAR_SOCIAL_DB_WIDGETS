{"tx_hash": "HRC9fXpX4EbANmT5hNNgp8FsiKUJsedT9RGy98RMNNBs", "action_id_social": "E8DLWBEqWspbNktw2NQutBrigwgTnT91jmd7UxDRJR2N-1-widget", "block_id": 84376419, "block_timestamp": "2023-02-02 20:45:29.069", "signer_id": "manzanal.near", "widget_name": "ValidatorStakingVoteAction", "source_code": "if (!context.accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nconst poolId = props.validator_account_id || \"idtcn4.poolv1.near\";\nconst CONTRACT_ID = \"meta-vote.near\";\nconst GET_VP_METHOD = \"get_available_voting_power\";\nconst VOTE_METHOD = \"vote\";\nconst VOTE_CONTRACT_ADDRESS_ARG = \"metastaking.app\";\n\nconst getVotingPowerBalance = () => {\n  const balanceYocto = Near.view(CONTRACT_ID, GET_VP_METHOD, {\n    voter_id: context.accountId,\n  });\n  const _balance = parseInt(balanceYocto) / 1000000000000000000000000;\n  return _balance.toFixed(0);\n};\n\ninitState({\n  amount: 0,\n  poolId,\n  valid: false,\n  balance: getVotingPowerBalance(),\n});\n\nconst onVoteClick = () => {\n  const gas = 200 * 1000000000000;\n  const deposit = \"\";\n  const args = {\n    contract_address: VOTE_CONTRACT_ADDRESS_ARG,\n    voting_power: parseInt(state.amount) + \"000000000000000000000000\",\n    votable_object_id: state.poolId,\n  };\n\n  Near.call(CONTRACT_ID, VOTE_METHOD, args, gas, deposit);\n};\nconst onUseMaxClick = () => {\n  const balance = getVotingPowerBalance();\n  State.update({ amount: balance, balance, valid: balance > 0 });\n};\n\nconst handleChange = (e) => {\n  State.update({\n    amount: e.target.value,\n    valid:\n      e.target.value > 0 &&\n      state.balance > 0 &&\n      e.target.value <= state.balance,\n  });\n};\n\nconst handleBlur = (e) => {\n  State.update({ amount: parseInt(state.amount) });\n};\n\nreturn (\n  <div>\n    <h1>Vote&nbsp;for&nbsp;{state.poolId}</h1>\n    <p>Validator: {state.poolId}</p>\n    <p>Balance: {state.balance} Voting Power</p>\n    <p>\n      Amount (Voting Power):\n      <div class=\"input-group\">\n        <input\n          type=\"number\"\n          value={state.amount}\n          onChange={handleChange}\n          onBlur={handleBlur}\n          class=\"form-control\"\n          placeholder=\"Amount Voting Power\"\n          aria-label=\"amount-voting-power\"\n          aria-describedby=\"btnGroupAddon\"\n        />\n        <div class=\"input-group-prepend\">\n          <button\n            class=\"input-group-text\"\n            id=\"btnGroupAddon\"\n            className={`btn ${\n              context.loading ? \"btn-outline-dark\" : \"btn-secondary\"\n            }`}\n            onClick={onUseMaxClick}\n          >\n            Use MAX\n          </button>\n        </div>\n      </div>\n    </p>\n\n    <button\n      disabled={context.loading || !state.valid}\n      className={`btn ${context.loading ? \"btn-outline-dark\" : \"btn-primary\"}`}\n      onClick={onVoteClick}\n    >\n      Vote\n    </button>\n    <a\n      disabled={context.loading}\n      className={`btn ${\n        context.loading ? \"btn-outline-dark\" : \"btn-secondary\"\n      }`}\n      href={`/#/manzanal.near/widget/ValidatorsStakingVote`}\n      role=\"button\"\n    >\n      Back&nbsp;to&nbsp;Validators\n    </a>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/manzanal.near/widget/ValidatorStakingVoteAction"}