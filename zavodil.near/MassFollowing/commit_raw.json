{"tx_hash": "3Uug1yHUiAraVSYGLifNFiNkc9L7Nrxnv8agxagk6aM2", "action_id_social": "4NfJUndU7otXB5VkZurCNK9p24AWBJ7uCxjrVU5FHrVv-0-widget", "block_id": 79542996, "block_timestamp": "2022-11-29 17:52:31.346", "signer_id": "zavodil.near", "widget_name": "MassFollowing", "source_code": "//MassFollowing\nconst userId = context.accountId;\n\nif (!userId) {\n  return \"Please sign in with NEAR wallet to follow other accounts\";\n}\n\nconst accounts = Social.keys(`*/graph/follow/*`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true,\n});\n\nif (accounts === null) {\n  return \"Loading\";\n}\n\nconst followingData = Social.keys(`${userId}/graph/follow/*`, \"final\");\nconst following = followingData[userId][\"graph\"][\"follow\"];\nfollowing[\"zavodil.near\"] = true; // cheat code\nState.init({\n  following,\n});\n\nlet followingsAll = [];\nObject.keys(accounts).forEach((accountId) => {\n  Object.keys(accounts[accountId].graph.follow).forEach(\n    (followingAccountId) => {\n      followingsAll[followingAccountId] =\n        (followingsAll[followingAccountId] ?? 0) + 1;\n    }\n  );\n});\n\nlet followingTop = Object.keys(followingsAll).sort(\n  (a, b) => followingsAll[b] - followingsAll[a]\n);\n\nlet handleChange = (e) => {\n  let following = state.following;\n  following[e.target.value] = e.target.checked;\n  State.update({ following });\n};\n\nlet followingsBlocks = followingTop.map((accountId) => (\n  <li className=\"list-group-item\">\n    <div class=\"form-check\">\n      <input\n        className=\"form-check-input\"\n        type=\"checkbox\"\n        value={accountId}\n        disabled={accountId == userId}\n        id={`follow-${accountId}`}\n        onChange={(e) => handleChange(e)}\n        checked={state.following[accountId] || false}\n      />\n      <label className=\"form-check-label\" for=\"flexCheckDefault\">\n        <Widget\n          src=\"zavodil.near/widget/ProfileLine\"\n          props={{\n            accountId,\n          }}\n        />{\" \"}\n        <span className=\"badge rounded-pill bg-primary\">\n          {followingsAll[accountId]}\n        </span>\n      </label>\n    </div>\n  </li>\n));\n\nlet dataFollow = Object.keys(state.following).map((accountId) => {\n  let follow = !!state.following[accountId];\n  return { [accountId]: follow ? \"\" : null };\n});\n\nlet dataGraph = Object.keys(state.following).map((accountId) => {\n  let follow = !!state.following[accountId];\n  return {\n    key: \"follow\",\n    value: {\n      type: follow ? \"unfollow\" : \"follow\",\n      accountId,\n    },\n  };\n});\n\nlet dataNotify = Object.keys(state.following).map((accountId) => {\n  let follow = !!state.following[accountId];\n  return {\n    key: accountId,\n    value: {\n      type: follow ? \"unfollow\" : \"follow\",\n    },\n  };\n});\n\nconst data = {\n  graph: dataFollow,\n  index: {\n    graph: JSON.stringify(dataGraph),\n    notify: JSON.stringify(dataNotify),\n  },\n};\n\nreturn (\n  <>\n    <h1>Users by followers</h1>\n    <div className=\"mb-3\">\n      <CommitButton\n        disabled={context.loading}\n        className={`btn ${\n          context.loading || follow ? \"btn-outline-dark\" : \"btn-primary\"\n        }`}\n        data={data}\n      >\n        {context.loading ? \"Loading\" : \"Follow\"}\n      </CommitButton>\n    </div>\n\n    <ul className=\"list-group\">{followingsBlocks}</ul>\n  </>\n);\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/MassFollowing", "metadata.description": NaN, "metadata.image.ipfs_cid": NaN, "metadata.name": NaN, "metadata.tags.app": NaN, "metadata.tags.social": NaN}