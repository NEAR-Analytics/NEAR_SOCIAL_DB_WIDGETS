{"tx_hash": "8wcgqk2fzSp3mDcJSAnsjoJgqHxQ3DqNpCxWqDZQqNDf", "action_id_social": "EV7PnECbLDczce3BM7SJ39Aw9PBXcfPyK7ZFQBXbtboQ-0-widget", "block_id": 89795695, "block_timestamp": "2023-04-17 14:17:02.928", "signer_id": "zavodil.near", "widget_name": "uni-v3-getEstimate", "source_code": "const { tokenIn, tokenOut, amountIn, tokenOutDecimals, loadRes } = props;\n\nconst quoterContractId =\n  props.quoterContractId ?? \"0xb27308f9F90D607463bb33eA1BeBb41C27CE5AB6\";\nconst fee = props.fee ?? 500; // 0.05%\nconst sqrtPriceLimitX96 = props.sqrtPriceLimitX96 ?? 0;\n\nconst quoterContractJson = fetch(\n  \"https://gist.githubusercontent.com/zavodil/7d6038c55d69f4813afab660f5fa64c7/raw/101c7ded26cb586536a433f8ede3c038720e6b0d/Quoter.json\"\n);\nif (!quoterContractJson.ok) {\n  return \"Loading\";\n}\n\nconst abi = JSON.parse(quoterContractJson.body).abi;\n\nconst iface = new ethers.utils.Interface(abi);\n\nconst inputs = [tokenIn, tokenOut, fee, amountIn, sqrtPriceLimitX96];\n\nconst encodedData = iface.encodeFunctionData(\"quoteExactInputSingle\", inputs);\n\nEthers.provider()\n  .call({\n    to: quoterContractId,\n    data: encodedData,\n  })\n  .then((data) => {\n    const decodedData = iface.decodeFunctionResult(\n      \"quoteExactInputSingle\",\n      data\n    );\n\n    const estimate = Big(decodedData.toString())\n      .div(Big(10).pow(tokenOutDecimals))\n      .toFixed(18);\n\n    State.update({\n      res: {\n        estimate,\n        tokenIn,\n        tokenOut,\n        pool: \"\",\n      },\n    });\n  });\n\nif (state.res !== undefined) {\n  if (props.debug) {\n    console.log(\"res\", state.res);\n    return <div>{JSON.stringify(state.res)}</div>;\n  }\n\n  if (typeof loadRes === \"function\") {\n    loadRes(state.res);\n  }\n}\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/uni-v3-getEstimate"}