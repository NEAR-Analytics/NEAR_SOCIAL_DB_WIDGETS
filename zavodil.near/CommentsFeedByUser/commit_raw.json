{"tx_hash": "CAH9dZdvRKDbprHvESCNjZe4czZJgzPSv6y5zB8Uz648", "action_id_social": "5T4tRWVddstyixGusRYSCYQaRFSdqmwnCV12KWpq4hCk-0-widget", "block_id": 85359977, "block_timestamp": "2023-02-16 15:19:59.835", "signer_id": "zavodil.near", "widget_name": "CommentsFeedByUser", "source_code": "const accountId = props.accountId ?? \"mob.near\";\nconst limitForPosts = props.limitForPosts ?? 5000;\n\ninitState({ comments: [] });\n\nconst renderItem = (a, post) =>\n  a.value.type === \"md\" && (\n    <div key={JSON.stringify(a)}>\n      <Widget\n        src=\"mob.near/widget/MainPage.Comment\"\n        props={{\n          accountId: a.accountId,\n          blockHeight: a.blockHeight,\n          highlight: false,\n          raw: false,\n        }}\n      />\n      <div>\n        <a\n          href={`https://near.social/#/mob.near/widget/MainPage.Post.Page?accountId=${post.accountId}&blockHeight=${post.blockHeight}`}\n        >\n          Original post\n        </a>\n      </div>\n    </div>\n  );\n\nconst index = {\n  action: \"post\",\n  key: \"main\",\n  options: {\n    subscribe: true,\n    limit: limitForPosts,\n    order: \"desc\",\n  },\n};\n\nif (!index) return \"\";\n\nif (!state.recentPosts) {\n  State.update({\n    recentPosts: Social.index(index.action, index.key, index.options),\n  });\n  return \"\";\n}\n\nif (!state.comments.length) {\n  const comments = [];\n  state.recentPosts.map((post) => {\n    const item = {\n      type: \"social\",\n      path: `${post.accountId}/post/main`,\n      blockHeight: post.blockHeight,\n    };\n\n    const index = {\n      action: \"comment\",\n      key: item,\n      options: {\n        limit: 10,\n        order: \"desc\",\n      },\n    };\n\n    const initialItems = Social.index(index.action, index.key, index.options);\n    if (initialItems === null) {\n      return \"\";\n    }\n\n    let userComments = initialItems.filter(\n      (comment) => comment.accountId === accountId\n    );\n\n    userComments\n      .filter((comment) => !!comment)\n      .map((comment) => comments.push(renderItem(comment, post)));\n  });\n\n  State.update({ comments });\n}\n\nif (!state.comments.length) return \"No comments\";\n\nreturn <>{state.comments}</>;\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/CommentsFeedByUser"}