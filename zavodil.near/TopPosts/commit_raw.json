{"tx_hash": "6Co9QwdwtyTF4uqCRei4ZFit3BNDXiBrTrC7yPrGjK7T", "action_id_social": "4Vmpnh7J1A5QKwbiBAdciLQuqFsTypSbqSB21kkt7Wzs-0-widget", "block_id": 88431638, "block_timestamp": "2023-03-30 10:23:24.372", "signer_id": "zavodil.near", "widget_name": "TopPosts", "source_code": "const limitForPosts = props.limitForPosts ?? 5000;\ninitState({ postsByReposts: [] });\n\nconst index = {\n  action: \"repost\",\n  key: \"main\",\n  options: {\n    subscribe: false,\n    limit: limitForPosts,\n    order: \"desc\",\n  },\n};\n\nif (!state.reposts) {\n  State.update({\n    reposts: Social.index(index.action, index.key, index.options),\n  });\n  return \"\";\n}\n\nlet postsByReposts = [];\nstate.reposts.map((repost) => {\n  const key = JSON.stringify(repost.value.item);\n  postsByReposts[key] = (postsByReposts[key] ?? 0) + 1;\n});\n\nconst sortedPosts = Object.keys(postsByReposts).sort(\n  (a, b) => postsByReposts[b] - postsByReposts[a]\n);\n\nconst topPosts = sortedPosts.map((postStringified) => {\n  const post = JSON.parse(postStringified);\n  return (\n    <div style={{ paddingBottom: \"10px\" }}>\n      <Widget\n        src=\"zavodil.near/widget/MainPage.Post\"\n        props={{\n          accountId: post.path.replace(\"/post/main\", \"\"),\n          blockHeight: post.blockHeight,\n          repostsNum: postsByReposts[postStringified],\n        }}\n      />\n    </div>\n  );\n});\n\nState.update({ topPosts });\n\nreturn (\n  <>\n    <h1>Top posts by reposts</h1>\n    {state.topPosts}\n  </>\n);\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/TopPosts", "metadata.image.ipfs_cid": "bafkreig2ge6zosbbnknwd6kxg4t6reumurqtbahhvp7tzo6b76m3lzxkly", "metadata.name": "Top Posts", "metadata.tags.app": ""}