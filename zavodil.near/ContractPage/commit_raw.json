{"tx_hash": "5SKRsp8kcahJDF9tKbQgfL85qpfCBoVtJpfANajxE6wS", "action_id_social": "BLQmb8jE111DQStty5pTRxfMpGV9LuDAkXeKrMKrek13-1-widget", "block_id": 78784149, "block_timestamp": "2022-11-19 10:19:00.481", "signer_id": "zavodil.near", "widget_name": "ContractPage", "source_code": "// ContractPage\nconst ownerId = \"zavodil.near\";\nconst appName = \"nametag\";\nconst profileWidgetOwner = \"mob.near\";\nconst accountId = props.contractId ?? context.accountId;\nconst shortMode = props.shortMode ?? false;\n\nconst basicProfile = props.profile ?? Social.getr(`${accountId}/profile`);\n\nconst tagsPattern = props.tagsPattern ?? `*/${appName}/${accountId}/tags/*`;\nconst tagsObject = Social.keys(tagsPattern, \"final\");\n\nconst tagClass = \"bg-success\";\nconst addPublicTagHtml = (\n  <div class={`me-1 badge ${tagClass}`}>\n    <a\n      href={`#/${ownerId}/widget/LabelEditor?contractId=${accountId}`}\n      class=\"text-white\"\n    >\n      + Add Name Tag\n    </a>\n  </div>\n);\n\nif (tagsObject === null) {\n  return \"Loading\";\n}\n\nconst tagsCount = {};\n\nconst processTagsObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (typeof kv[1] === \"object\") {\n      processTagsObject(kv[1]);\n    } else {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) + 1;\n    }\n  });\n};\n\nconst getTags = () => {\n  processTagsObject(tagsObject);\n  const tags = Object.entries(tagsCount);\n  tags.sort((a, b) => b[1] - a[1]);\n  return tags.map((t) => {\n    return {\n      name: t[0],\n      title: t[1] + (t[1] > 1 ? \" votes\" : \" vote\"),\n    };\n  });\n};\n\nlet hideBasicProfile = basicProfile === null || basicProfile === undefined;\n\nconst profile = {\n  name: basicProfile.name,\n  description: basicProfile.description,\n  image: basicProfile.image,\n  backgroundImage: basicProfile.backgroundImage,\n  linktree: basicProfile.linktree,\n  tags: basicProfile.tags,\n  publicTags: getTags(),\n};\n\nconst showEditButton =\n  !props.profile && accountId && accountId === context.accountId;\n\nconst tags = profile.tags ?? {};\nconst publicTags = profile.publicTags ?? {};\n\nconst name = props.profile.name ?? profile.name;\nconst image = props.profile.image ?? profile.image;\nconst url =\n  (image.ipfs_cid\n    ? `https://ipfs.near.social/ipfs/${image.ipfs_cid}`\n    : image.url) || \"https://thewiki.io/static/media/sasha_anon.6ba19561.png\";\n\nconst linktree = props.profile.linktree ?? profile.linktree;\n\nif (hideBasicProfile || shortMode) {\n  return (\n    <div className=\"py-1 px-1\">\n      <div className=\"mx-auto\">\n        <div className=\"bg-white shadow rounded overflow-hidden\">\n          <div className=\"bg-light px-4 pb-4 \">\n            <div\n              className=\"d-md-flex justify-content-between\"\n              style={{ paddingTop: \"1rem\" }}\n            >\n              <div className=\"small\">\n                <i className=\"bi bi-person-fill text-secondary me-1\"></i>\n                {accountId}\n              </div>\n            </div>\n            {tags.length > 0 && (\n              <div>\n                {tags.map((tag) => (\n                  <span className=\"me-1 badge bg-secondary\">#{tag}</span>\n                ))}\n              </div>\n            )}\n            {publicTags.length > 0 && (\n              <div>\n                {publicTags.map((tag) => (\n                  <span className={`me-1 badge ${tagClass}`} title={tag.title}>\n                    #{tag.name}\n                  </span>\n                ))}\n                {addPublicTagHtml}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nreturn (\n  <div className=\"profile\">\n    <div\n      className=\"profile-image float-start me-2\"\n      style={{ width: \"3em\", height: \"3em\" }}\n    >\n      <img\n        className=\"rounded w-100 h-100\"\n        style={{ objectFit: \"cover\" }}\n        src={url}\n        alt=\"profile image\"\n      />\n    </div>\n    <div className=\"profile-info d-inline-block\">\n      <div className=\"profile-links\">\n        <span className=\"profile-name\">{name || \"No-name profile\"}</span>\n        <div className=\"d-inline-block profile-account text-secondary\">\n          @{accountId}\n        </div>\n        {linktree.website && (\n          <div className=\"ms-1 d-inline-block\">\n            <a href={`https://${linktree.website}`}>\n              <i className=\"bi bi-globe2 text-secondary\"></i>\n            </a>\n          </div>\n        )}\n        {linktree.github && (\n          <div className=\"ms-1 d-inline-block\">\n            <a href={`https://github.com/${linktree.github}`}>\n              <i className=\"bi bi-github text-secondary\"></i>\n            </a>\n          </div>\n        )}\n        {linktree.twitter && (\n          <div className=\"ms-1 d-inline-block\">\n            <a href={`https://twitter.com/${linktree.twitter}`}>\n              <i className=\"bi bi-twitter text-secondary\"></i>\n            </a>\n          </div>\n        )}\n        {linktree.telegram && (\n          <div className=\"ms-1 d-inline-block\">\n            <a href={`https://t.me/${linktree.telegram}`}>\n              <i className=\"bi bi-telegram text-secondary\"></i>\n            </a>\n          </div>\n        )}\n      </div>\n\n      {publicTags.length > 0 && (\n        <span>\n          {publicTags.map((tag) => (\n            <span className={`me-1 badge ${tagClass}`} title={tag.title}>\n              #{tag.name}\n            </span>\n          ))}\n          {addPublicTagHtml}\n        </span>\n      )}\n    </div>\n    {showEditButton && (\n      <a\n        href={`#/${profileWidgetOwner}/widget/ProfileEditor`}\n        className=\"profile-edit btn btn-sm btn-outline-secondary border-0 align-top\"\n      >\n        Edit\n      </a>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/ContractPage"}