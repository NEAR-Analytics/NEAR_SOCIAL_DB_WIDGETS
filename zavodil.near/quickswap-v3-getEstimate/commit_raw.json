{"tx_hash": "B3ndhr1P1ob947WMRVxJgbzka9snvayXFdFiEtPWnsoU", "action_id_social": "HSwGZeFa5CBRToVwcXGjK1XbzsrqFGEbyaZoUkzokVdK-0-widget", "block_id": 92456402, "block_timestamp": "2023-05-22T14:52:41.943Z", "signer_id": "zavodil.near", "widget_name": "quickswap-v3-getEstimate", "source_code": "const { tokenIn, tokenOut, amountIn, tokenOutDecimals, loadRes } = props;\n\nconst quoterContractId =\n  props.quoterContractId ?? \"0x55BeE1bD3Eb9986f6d2d963278de09eE92a3eF1D\";\nconst sqrtPriceLimitX96 = props.sqrtPriceLimitX96 ?? 0;\n\nconst quoterABI =\n  props.quoterABI ??\n  \"https://gist.githubusercontent.com/zavodil/6a6e93e079deb3f8992e3d28d1ff0d78/raw/c6693b2ea41605ec215c912bfa82d67bad90258b/zkevm-quoter-abi.json\";\n\nconst quoterContractJson = fetch(quoterABI);\nif (!quoterContractJson.ok) {\n  return \"Loading\";\n}\n\nconst abi = JSON.parse(quoterContractJson.body);\n\nconst iface = new ethers.utils.Interface(abi);\n\nconst inputs = [tokenIn, tokenOut, amountIn, sqrtPriceLimitX96];\n\nconst encodedData = iface.encodeFunctionData(\"quoteExactInputSingle\", inputs);\n\nEthers.provider()\n  .call({\n    to: quoterContractId,\n    data: encodedData,\n  })\n  .then((data) => {\n    const decodedData = iface.decodeFunctionResult(\n      \"quoteExactInputSingle\",\n      data\n    );\n\n    // decodedData = [amountOut, fee]\n    decodedData = decodedData[0];\n\n    const estimate = Big(decodedData.toString())\n      .div(Big(10).pow(tokenOutDecimals))\n      .toFixed(18);\n\n    State.update({\n      res: {\n        estimate,\n        tokenIn,\n        tokenOut,\n        pool: \"\",\n      },\n    });\n  });\n\nif (state.res !== undefined) {\n  if (props.debug) {\n    console.log(\"res\", state.res);\n    return <div>{JSON.stringify(state.res)}</div>;\n  }\n\n  if (typeof loadRes === \"function\") {\n    loadRes(state.res);\n  }\n}\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/quickswap-v3-getEstimate", "__row_index": 0}