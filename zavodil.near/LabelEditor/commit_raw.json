{"tx_hash": "EiZ18Lf3fmWeyvYn5pSdavjbYGeiznC62uPgk9SqYLP2", "action_id_social": "FTe4A7pbL2GHPQdWkJmWuWzmx7uGxZYojvpZMuiiHegP-0-widget", "block_id": 78784470, "block_timestamp": "2022-11-19 10:25:04.169", "signer_id": "zavodil.near", "widget_name": "LabelEditor", "source_code": "// LabelEditor\nconst ownerId = \"zavodil.near\";\nconst appName = \"nametag\";\nconst accountId = context.accountId;\nconst contractId = props.contractId ?? ownerId;\nconst debug = props.debug ?? false;\n\nif (!accountId) {\n  return \"Please sign in with NEAR wallet to edit your profile\";\n}\n\nlet profile = Social.getr(`*/${appName}/${contractId}`, \"final\");\nif (profile === null) {\n  return \"Loading\";\n}\n\n// current user tags only\nconst tagsPattern =\n  props.tagsPattern ?? `${accountId}/${appName}/${contractId}/tags/*`;\nconst tagsObject = Social.keys(tagsPattern, \"final\");\nif (tagsObject === null) {\n  return \"Loading\";\n}\n\nconst tagsCount = {};\nconst userTags = {};\n\nconst processTagsObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (typeof kv[1] === \"object\") {\n      processTagsObject(kv[1]);\n    } else {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) + 1;\n    }\n  });\n};\n\nconst getTags = () => {\n  processTagsObject(tagsObject);\n  const tags = Object.entries(tagsCount);\n  tags.sort((a, b) => b[1] - a[1]);\n  return tags.map((t) => ({\n    name: t[0],\n    count: null,\n  }));\n};\n\nprofile.userTags = getTags();\n\nState.init({ profile });\n\nreturn (\n  <div className=\"row\">\n    <div className=\"col-lg-6\">\n      <div>\n        <h4>Name tag editor</h4>\n      </div>\n      <div className=\"mb-2\">\n        <Widget\n          src={`${ownerId}/widget/LabelEditorForm`}\n          props={{\n            contractId,\n            debug,\n            initialMetadata: profile,\n            onChange: (profile) => {\n              console.log(profile);\n              State.update({ profile, contractId: profile.contractId });\n            },\n            options: {\n              tags: {\n                label: \"Tags\",\n                tagsPattern: `*/${appName}/${state.profile.contractId}/tags/*`,\n                placeholder: \"Label\",\n              },\n            },\n          }}\n        />\n      </div>\n      <div className=\"mb-2\">\n        <CommitButton\n          data={{\n            [appName]: {\n              [state.profile.contractId]: { tags: state.profile.tags },\n            },\n          }}\n        >\n          Save labels\n        </CommitButton>\n        <a\n          className=\"btn btn-outline-primary ms-2\"\n          href={`#/${ownerId}/widget/ContractPage?contractId=${state.profile.contractId}`}\n        >\n          View profile\n        </a>\n      </div>\n    </div>\n    <div className=\"col-lg-6\">\n      <div>\n        <h4>Preview</h4>\n        <br />\n      </div>\n      <div>\n        <Widget\n          src={`${ownerId}/widget/ContractPage`}\n          props={{ contractId: state.contractId }}\n        />\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/zavodil.near/widget/LabelEditor"}