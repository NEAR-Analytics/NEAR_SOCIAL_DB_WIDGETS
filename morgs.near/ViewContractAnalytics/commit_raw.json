{"tx_hash": "9HK9xgA6RVXfm3bPoR7f1YpdLv1AMikuC7MHDvrVEsni", "action_id_social": "5bPdqe6k9axZEHAjNQLG4ASwJqm2AsBkM2P1m1KWrrZu-0-widget", "block_id": 80746043, "block_timestamp": "2022-12-16 02:01:26.726", "signer_id": "morgs.near", "widget_name": "ViewContractAnalytics", "source_code": "const initialState = {\n  contractId: \"\",\n  query: {\n    id: null,\n    estimate: null,\n    results: null,\n  },\n};\n\nState.init(initialState);\n\nconst getQueryCostEstimate = () => {\n  const { body } = fetch(\n    `https://dev.kitwallet.app/consumer/${state.contractId}/query`,\n    {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: \"\",\n    }\n  );\n  State.update({ query: { estimate: body.estimatedCost, id: body.queryId } });\n};\n\nconst getQueryResults = () => {\n  const { body } = fetch(\n    `https://dev.kitwallet.app/consumer/${state.contractId}/results/${state.query.id}`,\n    {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: \"\",\n    }\n  );\n  State.update({\n    query: {\n      results: body.results,\n      id: state.query.id,\n      estimate: state.query.estimate,\n    },\n  });\n};\n\nconsole.log(state);\n\nif (state.query.results) {\n  return (\n    <div>\n      <h1>View Contract Analytics</h1>\n      {JSON.stringify(state.query.results, null, 2)}\n      <br />\n      <br />\n      <button onClick={() => State.update(initialState)}>Reset</button>\n    </div>\n  );\n}\n\nif (state.query.estimate) {\n  return (\n    <div>\n      <h1>View Contract Analytics</h1>\n      Analytics for {state.contractId} will cost\n      {state.query.estimate} NEAR. Do you want to continue?\n      <br />\n      <br />\n      <button onClick={getQueryResults}>View analytics</button>\n      <button onClick={() => State.update(initialState)}>Reset</button>\n    </div>\n  );\n}\n\nreturn (\n  <div>\n    <h1>View Contract Analytics</h1>\n    Contract ID\n    <input\n      type=\"text\"\n      value={state.contractId}\n      onChange={(e) => State.update({ contractId: e.target.value })}\n    />\n    <br />\n    <button onClick={getQueryCostEstimate}>Calculate analytics cost</button>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/morgs.near/widget/ViewContractAnalytics"}