{"tx_hash": "EkQm21MmZ8RQ8asgN8YXwLCFSaKU46yQKUEnjd5NuWmP", "action_id_social": "8XPcjukkA9VHbvZqtbz6iBnAfYUMXZcDjNWrCDAHACaS-0-widget", "block_id": 82216949, "block_timestamp": "2023-01-05 00:31:02.068", "signer_id": "devgovgigs.near", "widget_name": "PostEditor", "source_code": "const ownerId = \"devgovgigs.near\";\nconst postType = props.postType ?? \"Sponsorship\";\nconst parentId = props.parentId ?? null;\n\nconst labelStrings = props.labels ?? [];\nconst labels = labelStrings.map((s) => {\n  return { name: s };\n});\n\ninitState({\n  author_id: context.accountId,\n  // Should be a list of objects with field \"name\".\n  labels,\n  // Should be a list of labels as strings.\n  // Both of the label structures should be modified together.\n  labelStrings,\n  postType,\n  name: \"\",\n  description: \"\",\n  amount: \"0\",\n  token: \"Near\",\n  supervisor: \"\",\n});\n\nlet fields = {\n  Comment: [\"description\"],\n  Idea: [\"name\", \"description\"],\n  Submission: [\"name\", \"description\"],\n  Attestation: [\"name\", \"description\"],\n  Sponsorship: [\n    \"name\",\n    \"description\",\n    \"amount\",\n    \"sponsorship_token\",\n    \"supervisor\",\n  ],\n}[postType];\n\nconst onClick = () => {\n  let labels = state.labelStrings;\n  var body = {\n    Comment: { description: state.description, comment_version: \"V2\" },\n    Idea: {\n      name: state.name,\n      description: state.description,\n      idea_version: \"V1\",\n    },\n    Submission: {\n      name: state.name,\n      description: state.description,\n      submission_version: \"V1\",\n    },\n    Attestation: {\n      name: state.name,\n      description: state.description,\n      attestation_version: \"V1\",\n    },\n    Sponsorship: {\n      name: state.name,\n      description: state.description,\n      amount: state.amount,\n      sponsorship_token: state.token,\n      supervisor: state.supervisor,\n      sponsorship_version: \"V1\",\n    },\n  }[postType];\n  body[\"post_type\"] = postType;\n\n  Near.call(ownerId, \"add_post\", {\n    parent_id: parentId,\n    labels,\n    body,\n  });\n};\n\nconst normalizeLabel = (label) =>\n  label\n    .replaceAll(/[- \\.]/g, \"_\")\n    .replaceAll(/[^\\w]+/g, \"\")\n    .replaceAll(/_+/g, \"-\")\n    .replace(/^-+/, \"\")\n    .replace(/-+$/, \"\")\n    .toLowerCase()\n    .trim(\"-\");\n\nconst setLabels = (labels) => {\n  labels = labels.map((o) => {\n    o.name = normalizeLabel(o.name);\n    return o;\n  });\n  let labelStrings = labels.map((o) => {\n    return o.name;\n  });\n  State.update({ labels, labelStrings });\n};\nconst existingLabelStrings = Near.view(ownerId, \"get_all_labels\") ?? [];\nconst existingLabels = existingLabelStrings.map((s) => {\n  return { name: s };\n});\n\nconst labelEditor = (\n  <div className=\"col-lg-12  mb-2\">\n    Labels:\n    <Typeahead\n      multiple\n      labelKey=\"name\"\n      onChange={setLabels}\n      options={existingLabels}\n      placeholder=\"near.social, widget, NEP, standard, protocol, tool\"\n      selected={state.labels}\n      positionFixed\n      allowNew\n    />\n  </div>\n);\n\nconst nameDiv = fields.includes(\"name\") ? (\n  <div className=\"col-lg-6  mb-2\">\n    Title:\n    <input\n      type=\"text\"\n      value={state.name}\n      onChange={(event) => State.update({ name: event.target.value })}\n    />\n  </div>\n) : null;\n\nconst descriptionDiv = fields.includes(\"description\") ? (\n  <div className=\"col-lg-12  mb-2\">\n    Description:\n    <br />\n    <textarea\n      value={state.description}\n      type=\"text\"\n      rows={6}\n      className=\"form-control\"\n      onChange={(event) => State.update({ description: event.target.value })}\n    />\n  </div>\n) : null;\n\nconst amountDiv = fields.includes(\"amount\") ? (\n  <div className=\"col-lg-6  mb-2\">\n    Amount:\n    <input\n      type=\"text\"\n      value={state.amount}\n      onChange={(event) => State.update({ amount: event.target.value })}\n    />\n  </div>\n) : null;\n\nconst tokenDiv = fields.includes(\"sponsorship_token\") ? (\n  <div className=\"col-lg-6  mb-2\">\n    Tokens:\n    <input\n      type=\"text\"\n      value={state.token}\n      onChange={(event) => State.update({ token: event.target.value })}\n    />\n  </div>\n) : null;\n\nconst supervisorDiv = fields.includes(\"supervisor\") ? (\n  <div className=\"col-lg-6 mb-2\">\n    Supervisor:\n    <input\n      type=\"text\"\n      value={state.supervisor}\n      onChange={(event) => State.update({ supervisor: event.target.value })}\n    />\n  </div>\n) : null;\n\nconst disclaimer = (\n  <p>\n    <i>\n      * Note, all projects that were granted sponsorships are required to pass\n      KYC to receive the funding.\n    </i>\n  </p>\n);\n\nconst renamedPostType = postType == \"Submission\" ? \"Solution\" : postType;\nreturn (\n  <div className=\"card\">\n    <div className=\"card-header\">{renamedPostType} Editor</div>\n\n    <div class=\"card-body\">\n      <div className=\"row\">\n        {labelEditor}\n        {nameDiv}\n        {amountDiv}\n        {tokenDiv}\n        {supervisorDiv}\n        {descriptionDiv}\n      </div>\n\n      <a className=\"btn btn-outline-primary mb-2\" onClick={onClick}>\n        Submit\n      </a>\n      {disclaimer}\n    </div>\n    <div class=\"card-footer\">\n      Preview:\n      <Widget\n        src={`${ownerId}/widget/Post`}\n        props={{\n          isPreview: true,\n          id: 0, // irrelevant\n          post: {\n            author_id: state.author_id,\n            likes: [],\n            snapshot: {\n              editor_id: state.editor_id,\n              labels: state.labelStrings,\n              post_type: postType,\n              name: state.name,\n              description: state.description,\n              amount: state.amount,\n              sponsorship_token: state.token,\n              supervisor: state.supervisor,\n            },\n          },\n        }}\n      />\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devgovgigs.near/widget/PostEditor"}