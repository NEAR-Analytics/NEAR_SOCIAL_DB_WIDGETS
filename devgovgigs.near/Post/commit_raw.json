{"tx_hash": "6JAqQWfdyuKYHw2BUZzXgZAcwRBWxkNGCQe1sKFkesWe", "action_id_social": "F1wPFdJ5qrz8qcrV1p36KFDwbfeLubsgWFoj5ks31EQw-0-widget", "block_id": 82216455, "block_timestamp": "2023-01-05 00:21:51.187", "signer_id": "devgovgigs.near", "widget_name": "Post", "source_code": "const ownerId = \"devgovgigs.near\";\nconst postId = props.post.id ?? (props.id ? parseInt(props.id) : 0);\nconst post = props.post ?? Near.view(ownerId, \"get_post\", { post_id: postId });\nconst snapshot = post.snapshot;\n// If this post is displayed under another post. Used to limit the size.\nconst isUnderPost = props.isUnderPost ? true : false;\n\nconst childPostIdsUnordered =\n  Near.view(ownerId, \"get_children_ids\", {\n    post_id: postId,\n  }) ?? [];\n\nconst childPostIds = props.isPreview ? [] : childPostIdsUnordered.reverse();\n\nfunction readableDate(timestamp) {\n  var a = new Date(timestamp);\n  return a.toDateString() + \" \" + a.toLocaleTimeString();\n}\n\nconst timestamp = readableDate(\n  snapshot.timestamp ? snapshot.timestamp / 1000000 : Date.now()\n);\n\n// TODO: Implement editing posts.\n// const editControl =\n//   post.author_id == context.accountId && !props.isPreview ? (\n//     <a class=\"card-link px-2\" role=\"button\" title=\"Edit post\">\n//       <div class=\"bi bi-pencil-square\"></div>\n//     </a>\n//   ) : null;\n\nconst editControl = null;\n\nconst shareButton = props.isPreview ? null : (\n  <a\n    class=\"card-link\"\n    href={`https://near.social/#/devgovgigs.near/widget/Post?id=${postId}`}\n    role=\"button\"\n    target=\"_blank\"\n    title=\"Open in new tab\"\n  >\n    <div class=\"bi bi-share\"></div>\n  </a>\n);\n\nconst header = (\n  <div className=\"card-header\">\n    <small class=\"text-muted\">\n      <div class=\"row justify-content-between\">\n        <div class=\"col-4\">\n          <Widget\n            src={`mob.near/widget/ProfileLine`}\n            props={{ accountId: post.author_id }}\n          />\n        </div>\n        <div class=\"col-5\">\n          <div class=\"d-flex justify-content-end\">\n            {editControl}\n            {timestamp}\n            <div class=\"bi bi-clock-history px-2\"></div>\n            {shareButton}\n          </div>\n        </div>\n      </div>\n    </small>\n  </div>\n);\n\nconst emptyIcons = {\n  Idea: \"bi-lightbulb\",\n  Comment: \"bi-chat\",\n  Submission: \"bi-rocket\",\n  Attestation: \"bi-check-circle\",\n  Sponsorship: \"bi-cash-coin\",\n  Like: \"bi-heart\",\n  Reply: \"bi-reply\",\n};\n\nconst fillIcons = {\n  Idea: \"bi-lightbulb-fill\",\n  Comment: \"bi-chat-fill\",\n  Submission: \"bi-rocket-fill\",\n  Attestation: \"bi-check-circle-fill\",\n  Sponsorship: \"bi-cash-coin\",\n  Like: \"bi-heart-fill\",\n  Reply: \"bi-reply-fill\",\n};\n\nconst borders = {\n  Idea: \"border-secondary\",\n  Comment: \"border-secondary\",\n  Submission: \"border-secondary\",\n  Attestation: \"border-secondary\",\n  Sponsorship: \"border-secondary\",\n};\n\nconst containsLike = props.isPreview\n  ? false\n  : post.likes.find((l) => l.author_id == context.accountId);\nconst likeBtnClass = containsLike ? fillIcons.Like : emptyIcons.Like;\nconst onLike = () => {\n  Near.call(ownerId, \"add_like\", {\n    post_id: postId,\n  });\n};\n\nconst buttonsFooter = props.isPreview ? null : (\n  <div class=\"row\">\n    <div class=\"col-8\">\n      <div class=\"btn-group\" role=\"group\" aria-label=\"Basic outlined example\">\n        <button\n          type=\"button\"\n          class=\"btn btn-outline-primary\"\n          style={{ border: \"0px\" }}\n          onClick={onLike}\n        >\n          <i class={`bi ${likeBtnClass}`}> </i>\n          Like ({post.likes.length ?? 0})\n        </button>\n        <div class=\"btn-group\" role=\"group\">\n          <button\n            type=\"button\"\n            class=\"btn btn-outline-primary\"\n            style={{ border: \"0px\" }}\n            data-bs-toggle=\"dropdown\"\n            aria-expanded=\"false\"\n          >\n            <i class={`bi ${emptyIcons.Reply}`}> </i> Reply\n          </button>\n          <ul class=\"dropdown-menu\">\n            <li>\n              <a\n                class=\"dropdown-item\"\n                href=\"#\"\n                data-bs-toggle=\"collapse\"\n                href={`#collapseIdeaEditor${postId}`}\n                role=\"button\"\n                aria-expanded=\"false\"\n                aria-controls={`collapseIdeaEditor${postId}`}\n              >\n                <i class={`bi ${emptyIcons.Idea}`}> </i> Idea\n              </a>\n            </li>\n            <li>\n              <a\n                class=\"dropdown-item\"\n                href=\"#\"\n                data-bs-toggle=\"collapse\"\n                href={`#collapseSubmissionEditor${postId}`}\n                role=\"button\"\n                aria-expanded=\"false\"\n                aria-controls={`collapseSubmissionEditor${postId}`}\n              >\n                <i class={`bi ${emptyIcons.Submission}`}> </i> Solution\n              </a>\n            </li>\n            <li>\n              <a\n                class=\"dropdown-item\"\n                href=\"#\"\n                data-bs-toggle=\"collapse\"\n                href={`#collapseAttestationEditor${postId}`}\n                role=\"button\"\n                aria-expanded=\"false\"\n                aria-controls={`collapseAttestationEditor${postId}`}\n              >\n                <i class={`bi ${emptyIcons.Attestation}`}> </i> Attestation\n              </a>\n            </li>\n            <li>\n              <a\n                class=\"dropdown-item\"\n                href=\"#\"\n                data-bs-toggle=\"collapse\"\n                href={`#collapseSponsorshipEditor${postId}`}\n                role=\"button\"\n                aria-expanded=\"false\"\n                aria-controls={`collapseSponsorshipEditor${postId}`}\n              >\n                <i class={`bi ${emptyIcons.Sponsorship}`}> </i> Sponsorship\n              </a>\n            </li>\n            <li>\n              <hr class=\"dropdown-divider\" />\n            </li>\n            <li>\n              <a\n                class=\"dropdown-item\"\n                href=\"#\"\n                data-bs-toggle=\"collapse\"\n                href={`#collapseCommentEditor${postId}`}\n                role=\"button\"\n                aria-expanded=\"false\"\n                aria-controls={`collapseCommentEditor${postId}`}\n              >\n                <i class={`bi ${emptyIcons.Comment}`}> </i> Comment\n              </a>\n            </li>\n          </ul>\n        </div>\n        <button\n          type=\"button\"\n          class=\"btn btn-outline-primary\"\n          style={{ border: \"0px\" }}\n          data-bs-toggle=\"collapse\"\n          href={`#collapseChildPosts${postId}`}\n          aria-expanded=\"false\"\n          aria-controls={`collapseChildPosts${postId}`}\n        >\n          <i class=\"bi bi-arrows-expand\"> </i>{\" \"}\n          {`Expand Replies (${childPostIds.length})`}\n        </button>\n      </div>\n    </div>\n  </div>\n);\n\nconst editorsFooter = props.isPreview ? null : (\n  <div class=\"row\" id={`accordion${postId}`}>\n    <div\n      class=\"collapse\"\n      id={`collapseCommentEditor${postId}`}\n      data-bs-parent={`#accordion${postId}`}\n    >\n      <Widget\n        src={`${ownerId}/widget/PostEditor`}\n        props={{\n          postType: \"Comment\",\n          parentId: postId,\n        }}\n      />\n    </div>\n    <div\n      class=\"collapse\"\n      id={`collapseIdeaEditor${postId}`}\n      data-bs-parent={`#accordion${postId}`}\n    >\n      <Widget\n        src={`${ownerId}/widget/PostEditor`}\n        props={{\n          postType: \"Idea\",\n          parentId: postId,\n        }}\n      />\n    </div>\n    <div\n      class=\"collapse\"\n      id={`collapseSubmissionEditor${postId}`}\n      data-bs-parent={`#accordion${postId}`}\n    >\n      <Widget\n        src={`${ownerId}/widget/PostEditor`}\n        props={{\n          postType: \"Submission\",\n          parentId: postId,\n        }}\n      />\n    </div>\n    <div\n      class=\"collapse\"\n      id={`collapseAttestationEditor${postId}`}\n      data-bs-parent={`#accordion${postId}`}\n    >\n      <Widget\n        src={`${ownerId}/widget/PostEditor`}\n        props={{\n          postType: \"Attestation\",\n          parentId: postId,\n        }}\n      />\n    </div>\n    <div\n      class=\"collapse\"\n      id={`collapseSponsorshipEditor${postId}`}\n      data-bs-parent={`#accordion${postId}`}\n    >\n      <Widget\n        src={`${ownerId}/widget/PostEditor`}\n        props={{\n          postType: \"Sponsorship\",\n          parentId: postId,\n        }}\n      />\n    </div>\n  </div>\n);\n\nconst renamedPostType =\n  snapshot.post_type == \"Submission\" ? \"Solution\" : snapshot.post_type;\n\nconst postLables = post.snapshot.labels ? (\n  <div class=\"card-title\">\n    {post.snapshot.labels.map((label) => {\n      return <span class=\"badge text-bg-primary\">{label}</span>;\n    })}\n  </div>\n) : null;\n\nconst postTitle =\n  snapshot.post_type == \"Comment\" ? null : (\n    <h5 class=\"card-title\">\n      <div className=\"row justify-content-between\">\n        <div class=\"col-9\">\n          <i class={`bi ${emptyIcons[snapshot.post_type]}`}> </i>\n          {renamedPostType}: {snapshot.name}\n        </div>\n      </div>\n    </h5>\n  );\n\nconst postExtra =\n  snapshot.post_type == \"Sponsorship\" ? (\n    <div>\n      <h6 class=\"card-subtitle mb-2 text-muted\">\n        Maximum amount: {snapshot.amount} {snapshot.sponsorship_token}\n      </h6>\n      <h6 class=\"card-subtitle mb-2 text-muted\">\n        Supervisor:{\" \"}\n        <Widget\n          src={`mob.near/widget/ProfileLine`}\n          props={{ accountId: snapshot.supervisor }}\n        />\n      </h6>\n    </div>\n  ) : null;\n\nconst postsList =\n  props.isPreview || childPostIds.length == 0 ? null : (\n    <div class=\"row\">\n      <div class=\"collapse\" id={`collapseChildPosts${postId}`}>\n        {childPostIds\n          ? childPostIds.map((childId) => {\n              return (\n                <Widget\n                  src={`${ownerId}/widget/Post`}\n                  props={{ id: childId, isUnderPost: true }}\n                />\n              );\n            })\n          : \"\"}\n      </div>\n    </div>\n  );\n\nconst Card = styled.div`\n  &:hover {\n    box-shadow: rgba(3, 102, 214, 0.3) 0px 0px 0px 3px;\n  }\n\n`;\n\nconst limitedMarkdown = styled.div`\n      max-height: 20em;\n`;\n\n// Should make sure the posts under the currently top viewed post are limited in size.\nconst descriptionArea = isUnderPost ? (\n  <limitedMarkdown className=\"overflow-auto\">\n    <Markdown class=\"card-text\" text={snapshot.description}></Markdown>\n  </limitedMarkdown>\n) : (\n  <Markdown class=\"card-text\" text={snapshot.description}></Markdown>\n);\n\nreturn (\n  <Card className={`card my-2 ${borders[snapshot.post_type]}`}>\n    {header}\n    <div className=\"card-body\">\n      {postLables}\n      {postTitle}\n      {postExtra}\n      {descriptionArea}\n      {buttonsFooter}\n      {editorsFooter}\n      {postsList}\n    </div>\n  </Card>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/devgovgigs.near/widget/Post"}