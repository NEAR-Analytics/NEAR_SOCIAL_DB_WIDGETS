{"tx_hash": "8uMf9hXshLFmVczG8nm4DaJSMJoRk2vK2zPYfdfEx6gb", "action_id_social": "2fHULGKKNJdD36YgjzBLaWJkRPif5nCiXcFs9VUxpJge-0-widget", "block_id": 85711085, "block_timestamp": "2023-02-21 10:19:45.039", "signer_id": "frichard2.near", "widget_name": "LiveRefFinanceSwaps", "source_code": "// CSS\nconst bgStyle = {\n  background:\n    \"radial-gradient(64.28% 58.47% at 27.26% 59.61%,rgba(67,118,254,.55) 0,rgba(67,118,254,0) 100%)\",\n  filter: \"blur(95px)\",\n  pointerEvents: \"none\",\n  position: \"absolute\",\n  transform: \"matrix(-1,0,0,-1,0,0)\",\n  zIndex: 0,\n  width: \"100%\",\n  height: \"100%\",\n};\n\nconst wStyle = {\n  maxHeight: \"800px\",\n  overflow: \"scroll\",\n  background: \"black\",\n  color: \"white\",\n  padding: \"0 25px 25px 25px\",\n};\n\nconst tableStyle = {\n  display: \"table\",\n  width: \"100%\",\n  borderCollapse: \"separate\",\n  borderSpacing: \"0px\",\n  fontSize: \"14px\",\n};\n\nconst tdStyle = {\n  textOverflow: \"ellipsis\",\n  overflow: \"hidden\",\n  whiteSpace: \"nowrap\",\n  padding: \"16px\",\n  maxWidth: \"130px\",\n  borderBottom: \"1px solid rgb(81, 81, 81)\",\n};\n\nconst iconStyle = {\n  height: \"15px\",\n  width: \"15px\",\n};\n\nconst theadStyle = {\n  position: \"sticky\",\n  top: 0,\n  background: \"rgb(13, 15, 36)\",\n  padding: \"16px\",\n  textAlign: \"left\",\n  lineHeight: \"14px\",\n};\n\nconst linkStyle = {\n  margin: \"0px\",\n  textDecoration: \"underline rgba(1, 199, 251, 0.4)\",\n  color: \"rgb(1, 199, 251)\",\n  fontWeight: 600,\n};\n\n// CONSTANTS\nconst refUrl = \"https://api.stats.ref.finance/api/ft\";\nconst apiUrl = \"https://api.pikespeak.ai/event-historic/v2.ref-finance.near\";\nconst publicApiKey = \"bf63f79f-93b9-4613-ad98-396c3f9a5c64\";\n\n//UTILS\n\nconst getDate24h = () => {\n  const d =\n    Math.trunc(new Date(Date.now() - 86400 * 1000).getTime() / 10000) * 10000;\n  return new Date(d).toISOString();\n};\n\nconst numberWithCommas = (x) => {\n  return JSON.stringify(x).replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n};\n\nconst forgeUrl = (apiUrl, params) =>\n  apiUrl +\n  Object.keys(params).reduce(\n    (paramString, p) => paramString + `${p}=${params[p]}&`,\n    \"?\"\n  );\nconst defaultFt = { icon: \"\", symbol: \"\" };\nconst findFt = (ftAddress, ftList) => {\n  if (!ftList) return defaultFt;\n  const ft = ftList.body.find((f) => ftAddress === f.token_account_id);\n  return ft ? ft : defaultFt;\n};\n\n// DATA FETCH\nconst params = {\n  timestampStart: getDate24h(),\n  filters: \"SWAP\",\n};\nconst fetchSwaps = (params) =>\n  fetch(forgeUrl(apiUrl, params), {\n    mode: \"cors\",\n    headers: {\n      \"x-api-key\": publicApiKey,\n    },\n  });\nlet swaps = fetchSwaps(params);\nconst ftList = fetch(refUrl);\n\nsetInterval(() => {\n  let params = {\n    timestampStart: getDate24h(),\n    filters: \"SWAP\",\n  };\n  swaps = fetchSwaps(params);\n}, 5000);\n\nlet allRows = [];\nfor (let i = 0; i < swaps.body.length; i++) {\n  const swap = swaps.body[i].transaction_view;\n  const swapFtIn = findFt(swap.token_in, ftList);\n  const swapFtOut = findFt(swap.token_out, ftList);\n  const txDate = new Date(Number(swaps.body[i].timestamp)).toISOString();\n  allRows.push(\n    <tr>\n      <td style={tdStyle}>\n        <a\n          style={linkStyle}\n          href={`https://pikespeak.ai/transaction-viewer/${swap.transaction_id}`}\n          target=\"_blank\"\n        >\n          {swap.transaction_id}\n        </a>\n        <div>{txDate}</div>\n      </td>\n      <td style={tdStyle}>\n        <a\n          style={linkStyle}\n          href={`http://pikespeak.ai/wallet-explorer/${swap.sender}`}\n          target=\"_blank\"\n        >\n          {swap.sender}\n        </a>\n      </td>\n      <td style={tdStyle}>\n        {numberWithCommas(parseInt(swap.amount_in))}\n        {swapFtIn.icon ? <img style={iconStyle} src={swapFtIn.icon} /> : \"\"}\n        {swapFtIn.symbol}\n      </td>\n      <td style={tdStyle}>\n        {numberWithCommas(parseInt(swap.amount_out))}\n        {swapFtOut.icon ? <img style={iconStyle} src={swapFtOut.icon} /> : \"\"}\n        {swapFtOut.symbol}\n      </td>\n    </tr>\n  );\n}\n\nreturn (\n  <div>\n    <div style={bgStyle}></div>\n    <div style={wStyle}>\n      <h2 style={{ paddingTop: \"25px\", paddingBottom: \"25px\" }}>\n        Live Ref-Finance swap\n      </h2>\n      <p>\n        Powered By:{\" \"}\n        <a style={linkStyle} href=\"https://pikespeak.ai\" target=\"_blank\">\n          pikespeak.ai\n        </a>\n      </p>\n      <table style={tableStyle}>\n        <thead>\n          <tr>\n            <th style={theadStyle}>txHash</th>\n            <th style={theadStyle}>Account</th>\n            <th style={theadStyle}>In</th>\n            <th style={theadStyle}>Out</th>\n          </tr>\n        </thead>\n        <tbody>{allRows}</tbody>\n      </table>\n    </div>\n  </div>\n);\n", "metadata": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/frichard2.near/widget/LiveRefFinanceSwaps", "branch.draft": NaN, "branch": NaN, "metadata.image.ipfs_cid": NaN, "metadata.tags.app": NaN}