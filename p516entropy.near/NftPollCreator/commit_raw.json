{"tx_hash": "2i2Y2wQCmU2mAi1eJFEo8f2rEScdi6gVwV8pCJj1G2Aj", "action_id_social": "b8frq2iVsBWjjokE23dGHDNuMqHBxatpQzRdDtBYz3Y-0-widget", "block_id": 85253980, "block_timestamp": "2023-02-15 03:11:35.287", "signer_id": "p516entropy.near", "widget_name": "NftPollCreator", "source_code": "const CONTRACT = \"nft-vote.near\";\r\nconst nftContract = props.nftContract;\r\nif (!nftContract) {\r\n  return \"No nftContract\";\r\n}\r\n\r\nState.init({\r\n  createdOptions: [],\r\n  newPollNoCommitted: \"\",\r\n  title: \"\",\r\n  description: \"\",\r\n});\r\n\r\nconst isCreateBtnDisabled = () => {\r\n  return state.createdOptions.length <= 1 || !state.title || !state.description;\r\n};\r\n\r\nconst createPoll = () => {\r\n  const pollData = {\r\n    nft_contract_id: nftContract,\r\n    name: state.title,\r\n    description: state.description,\r\n    answers: state.createdOptions.map((option) => option.input),\r\n    min_votes_to_win: 0,\r\n    min_participations: 0,\r\n    meta: {},\r\n  };\r\n  console.log(\"NEAR.call: \" + JSON.stringify(pollData));\r\n  Near.call(CONTRACT, \"create_vote\", pollData);\r\n};\r\n\r\nconst createdOptions = state.createdOptions.map((option, i) => {\r\n  console.log(option);\r\n  return (\r\n    <div class=\"input-group mb-3\" key={i + \"_new\"}>\r\n      <input\r\n        type=\"text\"\r\n        class=\"form-control\"\r\n        placeholder=\"A new poll option\"\r\n        aria-label=\"A new poll option\"\r\n        aria-describedby=\"basic-addon2\"\r\n        value={option.input}\r\n        onChange={(e) => {\r\n          const modifiedCreatedOptions = [...state.createdOptions];\r\n          modifiedCreatedOptions[i] = { input: e.target.value };\r\n          State.update({\r\n            createdOptions: modifiedCreatedOptions,\r\n          });\r\n        }}\r\n      />\r\n      <div>\r\n        <button\r\n          class=\"btn btn-outline-secondary\"\r\n          type=\"button\"\r\n          style={{\r\n            \"border-top-left-radius\": 0,\r\n            \"border-bottom-left-radius\": 0,\r\n          }}\r\n          onClick={() => {\r\n            const modifiedOptions = [...state.createdOptions];\r\n            modifiedOptions.splice(i, 1);\r\n            State.update({\r\n              createdOptions: modifiedOptions,\r\n            });\r\n          }}\r\n        >\r\n          Remove\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nreturn (\r\n  <div class=\"mx-2 my-3\">\r\n    <div class=\"card\">\r\n      <div class=\"card-body\">\r\n        <div>\r\n          <p>\r\n            <strong>\"{nftContract}\" NFT Poll Creator</strong>\r\n          </p>\r\n          <div class=\"form-group mb-3\">\r\n            <label for=\"titleFormControlInput\">Title</label>\r\n            <input\r\n              type=\"text\"\r\n              class=\"form-control\"\r\n              id=\"titleFormControlInput\"\r\n              value={state.title}\r\n              onChange={(e) => {\r\n                State.update({ title: e.target.value });\r\n              }}\r\n            />\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"descriptionFormControlTextarea\">Description</label>\r\n            <textarea\r\n              class=\"form-control\"\r\n              id=\"descriptionFormControlTextarea\"\r\n              rows=\"3\"\r\n              value={state.description}\r\n              onChange={(e) => {\r\n                State.update({ description: e.target.value });\r\n              }}\r\n            ></textarea>\r\n          </div>\r\n        </div>\r\n        <hr />\r\n        <div>{createdOptions}</div>\r\n        <div class=\"input-group mb-3\">\r\n          <input\r\n            type=\"text\"\r\n            class=\"form-control\"\r\n            placeholder=\"A new poll option\"\r\n            aria-label=\"A new poll option\"\r\n            aria-describedby=\"basic-addon2\"\r\n            onChange={(e) => {\r\n              State.update({ newPollNoCommitted: e.target.value });\r\n            }}\r\n            value={state.newPollNoCommitted}\r\n          />\r\n          <div>\r\n            <button\r\n              class=\"btn btn-outline-secondary\"\r\n              type=\"button\"\r\n              style={{\r\n                \"border-top-left-radius\": 0,\r\n                \"border-bottom-left-radius\": 0,\r\n              }}\r\n              disabled={!state.newPollNoCommitted}\r\n              onClick={() => {\r\n                State.update({\r\n                  createdOptions: [\r\n                    ...state.createdOptions,\r\n                    { input: state.newPollNoCommitted },\r\n                  ],\r\n                  newPollNoCommitted: \"\",\r\n                });\r\n              }}\r\n            >\r\n              Add\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"card-footer text-end\">\r\n        <button\r\n          onClick={createPoll}\r\n          type=\"button\"\r\n          class=\"btn btn-primary\"\r\n          disabled={isCreateBtnDisabled()}\r\n        >\r\n          Create\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/p516entropy.near/widget/NftPollCreator"}