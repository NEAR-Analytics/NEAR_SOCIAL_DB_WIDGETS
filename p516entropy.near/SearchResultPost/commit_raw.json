{"tx_hash": "7idePAAQFCDPWpS2zoFoyyAELG23rwtHkJDoNab4qJFQ", "action_id_social": "6LFgA8KDrCd2kc7WRLix3ytEgtbMHGA7x8HkrKyce1H8-0-widget", "block_id": 86432221, "block_timestamp": "2023-03-03 02:35:15.850", "signer_id": "p516entropy.near", "widget_name": "SearchResultPost", "source_code": "/* INCLUDE: \"common.jsx\" */\r\nconst nearDevGovGigsContractAccountId =\r\n  props.nearDevGovGigsContractAccountId ||\r\n  (context.widgetSrc ?? \"devgovgigs.near\").split(\"/\", 1)[0];\r\nconst nearDevGovGigsWidgetsAccountId =\r\n  props.nearDevGovGigsWidgetsAccountId ||\r\n  (context.widgetSrc ?? \"devgovgigs.near\").split(\"/\", 1)[0];\r\n\r\nfunction widget(widgetName, widgetProps, key) {\r\n  widgetProps = {\r\n    ...widgetProps,\r\n    nearDevGovGigsContractAccountId: props.nearDevGovGigsContractAccountId,\r\n    nearDevGovGigsWidgetsAccountId: props.nearDevGovGigsWidgetsAccountId,\r\n    referral: props.referral,\r\n  };\r\n  return (\r\n    <Widget\r\n      src={`${nearDevGovGigsWidgetsAccountId}/widget/gigs-board.${widgetName}`}\r\n      props={widgetProps}\r\n      key={key}\r\n    />\r\n  );\r\n}\r\n\r\nfunction href(widgetName, linkProps) {\r\n  linkProps = { ...linkProps };\r\n  if (props.nearDevGovGigsContractAccountId) {\r\n    linkProps.nearDevGovGigsContractAccountId =\r\n      props.nearDevGovGigsContractAccountId;\r\n  }\r\n  if (props.nearDevGovGigsWidgetsAccountId) {\r\n    linkProps.nearDevGovGigsWidgetsAccountId =\r\n      props.nearDevGovGigsWidgetsAccountId;\r\n  }\r\n  if (props.referral) {\r\n    linkProps.referral = props.referral;\r\n  }\r\n  const linkPropsQuery = Object.entries(linkProps)\r\n    .map(([key, value]) => `${key}=${value}`)\r\n    .join(\"&\");\r\n  return `#/${nearDevGovGigsWidgetsAccountId}/widget/gigs-board.pages.${widgetName}${\r\n    linkPropsQuery ? \"?\" : \"\"\r\n  }${linkPropsQuery}`;\r\n}\r\n/* END_INCLUDE: \"common.jsx\" */\r\n\r\nconst postId = props.post.id ?? (props.id ? parseInt(props.id) : 0);\r\nconst post =\r\n  props.post ??\r\n  Near.view(nearDevGovGigsContractAccountId, \"get_post\", { post_id: postId });\r\nif (!post) {\r\n  return <div>Loading ...</div>;\r\n}\r\n\r\nconst snapshot = post.snapshot;\r\n\r\nconst childPostIds =\r\n  Near.view(nearDevGovGigsContractAccountId, \"get_children_ids\", {\r\n    post_id: postId,\r\n  }) ?? [];\r\n\r\nfunction readableDate(timestamp) {\r\n  var a = new Date(timestamp);\r\n  return a.toDateString() + \" \" + a.toLocaleTimeString();\r\n}\r\n\r\nconst timestamp = readableDate(\r\n  snapshot.timestamp ? snapshot.timestamp / 1000000 : Date.now()\r\n);\r\n\r\nconst header = (\r\n  <div className=\"card-header\" key=\"header\">\r\n    <small class=\"text-muted\">\r\n      <div class=\"row justify-content-between\">\r\n        <div class=\"col-4\">\r\n          <Widget\r\n            src={`neardevgov.near/widget/ProfileLine`}\r\n            props={{ accountId: post.author_id }}\r\n          />\r\n        </div>\r\n        <div class=\"col-5\">\r\n          <div class=\"d-flex justify-content-end\">\r\n            {timestamp}\r\n            <div class=\"bi bi-clock-history px-2\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </small>\r\n  </div>\r\n);\r\n\r\nconst emptyIcons = {\r\n  Idea: \"bi-lightbulb\",\r\n  Comment: \"bi-chat\",\r\n  Submission: \"bi-rocket\",\r\n  Attestation: \"bi-check-circle\",\r\n  Sponsorship: \"bi-cash-coin\",\r\n  Github: \"bi-github\",\r\n  Like: \"bi-heart\",\r\n  Reply: \"bi-reply\",\r\n};\r\n\r\nconst fillIcons = {\r\n  Idea: \"bi-lightbulb-fill\",\r\n  Comment: \"bi-chat-fill\",\r\n  Submission: \"bi-rocket-fill\",\r\n  Attestation: \"bi-check-circle-fill\",\r\n  Sponsorship: \"bi-cash-coin\",\r\n  Github: \"bi-github\",\r\n  Like: \"bi-heart-fill\",\r\n  Reply: \"bi-reply-fill\",\r\n};\r\n\r\n// Trigger saving this widget.\r\n\r\nconst borders = {\r\n  Idea: \"border-secondary\",\r\n  Comment: \"border-secondary\",\r\n  Submission: \"border-secondary\",\r\n  Attestation: \"border-secondary\",\r\n  Sponsorship: \"border-secondary\",\r\n  Github: \"border-secondary\",\r\n};\r\n\r\nconst containsLike = post.likes.find((l) => l.author_id == context.accountId);\r\nconst likeBtnClass = containsLike ? fillIcons.Like : emptyIcons.Like;\r\nconst onLike = () => {\r\n  Near.call(\r\n    nearDevGovGigsContractAccountId,\r\n    \"add_like\",\r\n    {\r\n      post_id: postId,\r\n    },\r\n    100_000_000_000_000n,\r\n    2_000_000_000_000_000_000_000n\r\n  );\r\n};\r\n\r\nconst buttonsFooter = props.isPreview ? null : (\r\n  <div class=\"row mt-2\" key=\"buttons-footer\">\r\n    <div class=\"col-8\">\r\n      <div class=\"btn-group\" role=\"group\" aria-label=\"Basic outlined example\">\r\n        <button\r\n          type=\"button\"\r\n          class=\"btn btn-outline-primary\"\r\n          style={{ border: \"0px\" }}\r\n          onClick={onLike}\r\n        >\r\n          <i class={`bi ${likeBtnClass}`}> </i>\r\n          Like ({post.likes.length ?? 0})\r\n        </button>\r\n        <div class=\"btn-group\" role=\"group\">\r\n          <a\r\n            class=\"card-link\"\r\n            href={href(\"Post\", { id: postId })}\r\n            role=\"button\"\r\n            class=\"btn btn-outline-primary\"\r\n            style={{ border: \"0px\" }}\r\n            target=\"_blank\"\r\n            title=\"Open in new tab\"\r\n          >\r\n            <div class=\"bi bi-share\"> Open</div>\r\n          </a>\r\n        </div>\r\n        <a\r\n          class=\"card-link\"\r\n          href={href(\"Post\", { id: postId })}\r\n          role=\"button\"\r\n          class=\"btn btn-outline-primary\"\r\n          style={{ border: \"0px\" }}\r\n          target=\"_blank\"\r\n          title=\"Open in new tab\"\r\n        >\r\n          <div class=\"bi bi-arrows-expand\">{` Check Replies (${childPostIds.length})`}</div>\r\n        </a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst renamedPostType =\r\n  snapshot.post_type == \"Submission\" ? \"Solution\" : snapshot.post_type;\r\n\r\nconst postLabels = post.snapshot.labels ? (\r\n  <div class=\"card-title\" key=\"post-labels\">\r\n    {post.snapshot.labels.map((label) => {\r\n      return (\r\n        <a href={href(\"Feed\", { label }, label)}>\r\n          <span class=\"badge text-bg-primary me-1\">{label}</span>\r\n        </a>\r\n      );\r\n    })}\r\n  </div>\r\n) : (\r\n  <div key=\"post-labels\"></div>\r\n);\r\n\r\nconst postTitle =\r\n  snapshot.post_type == \"Comment\" ? (\r\n    <div key=\"post-title\"></div>\r\n  ) : (\r\n    <h5 class=\"card-title\" key=\"post-title\">\r\n      <div className=\"row justify-content-between\">\r\n        <div class=\"col-9\">\r\n          <i class={`bi ${emptyIcons[snapshot.post_type]}`}> </i>\r\n          {renamedPostType}: {snapshot.name}\r\n        </div>\r\n      </div>\r\n    </h5>\r\n  );\r\n\r\nconst postExtra =\r\n  snapshot.post_type == \"Sponsorship\" ? (\r\n    <div key=\"post-extra\">\r\n      <h6 class=\"card-subtitle mb-2 text-muted\">\r\n        Maximum amount: {snapshot.amount} {snapshot.sponsorship_token}\r\n      </h6>\r\n      <h6 class=\"card-subtitle mb-2 text-muted\">\r\n        Supervisor:{\" \"}\r\n        <Widget\r\n          src={`neardevgov.near/widget/ProfileLine`}\r\n          props={{ accountId: snapshot.supervisor }}\r\n        />\r\n      </h6>\r\n    </div>\r\n  ) : (\r\n    <div></div>\r\n  );\r\n\r\nconst limitedMarkdown = styled.div`\r\n  max-height: 10em;\r\n  \r\n  border-bottom: 1px solid rgba(0,0,0,0.03);\r\n    border-radius: 10px;\r\n    \r\n  ::-webkit-scrollbar {\r\n    width: 10px;\r\n  }\r\n\r\n  ::-webkit-scrollbar-track {\r\n      background: rgba(0,0,0,0.03); \r\n      border-radius: 10px;\r\n      \r\n  }\r\n\r\n  ::-webkit-scrollbar-thumb {\r\n      background: rgba(0,0,0,0.175); \r\n      border-radius: 10px;\r\n  }\r\n\r\n  ::-webkit-scrollbar-thumb:hover {\r\n      background: #888; \r\n  }\r\n`;\r\n\r\nconst onMention = (accountId) => (\r\n  <span key={accountId} className=\"d-inline-flex\" style={{ fontWeight: 500 }}>\r\n    <Widget\r\n      src=\"neardevgov.near/widget/ProfileLine\"\r\n      props={{\r\n        accountId: accountId.toLowerCase(),\r\n        hideAccountId: true,\r\n        tooltip: true,\r\n      }}\r\n    />\r\n  </span>\r\n);\r\n\r\nconst descriptionArea = (\r\n  <limitedMarkdown className=\"overflow-auto\" key=\"description-area\">\r\n    <Markdown\r\n      class=\"card-text\"\r\n      text={snapshot.description}\r\n      onMention={onMention}\r\n    />\r\n  </limitedMarkdown>\r\n);\r\n\r\nreturn (\r\n  <div className={`card my-2 ${borders[snapshot.post_type]}`}>\r\n    {header}\r\n    <div className=\"card-body\">\r\n      {postLabels}\r\n      {postTitle}\r\n      {postExtra}\r\n      {descriptionArea}\r\n      {buttonsFooter}\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/p516entropy.near/widget/SearchResultPost"}