{"tx_hash": "8Sw36tfAsyRGoxcaTvP7UVL7Tk4AG8dUqBEU18XMvorY", "action_id_social": "4AvvvnGEtW1NsUthbDamgdojHBuhnrx6AsHycnAEvVix-0-widget", "block_id": 95112645, "block_timestamp": "2023-06-27T00:38:43.317Z", "signer_id": "jay100.near", "widget_name": "post-to-dao", "source_code": "if (!context.accountId) {\r\n  return \"\";\r\n}\r\n\r\n// Initialize state\r\nState.init({\r\n  onChange: ({ content }) => {\r\n    State.update({ content });\r\n  },\r\n});\r\n\r\n// composeData function remains the same\r\nconst composeData = () => {\r\n  const daoId = \"test-og-sbt.sputnik-dao.near\";\r\n\r\n  const content = {\r\n    text: state.content,\r\n  };\r\n\r\n  const post_args = JSON.stringify({\r\n    data: {\r\n      [daoId]: {\r\n        post: {\r\n          main: JSON.stringify(content),\r\n        },\r\n        index: {\r\n          post: JSON.stringify({\r\n            key: \"main\",\r\n            value: {\r\n              type: \"md\",\r\n            },\r\n          }),\r\n        },\r\n      },\r\n    },\r\n  });\r\n\r\n  return post_args;\r\n};\r\n\r\n// function to compose and encode data\r\nconst composeEncodedArgs = () => {\r\n  const data = composeData();\r\n  const buffer = Buffer.from(JSON.stringify(data));\r\n  const encodedArgs = buffer.toString(\"base64\");\r\n  return encodedArgs;\r\n};\r\n\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src=\"mob.near/widget/Common.Compose\"\r\n      props={{\r\n        placeholder: \"What's happening?\",\r\n        onChange: state.onChange,\r\n        onHelper: ({ extractMentionNotifications, extractHashtags }) => {\r\n          State.update({ extractMentionNotifications, extractHashtags });\r\n        },\r\n        composeButton: (onCompose) => (\r\n          <CommitButton\r\n            disabled={!state.content}\r\n            force\r\n            className=\"btn btn-dark rounded-3\"\r\n            data={composeData}\r\n            onCommit={() => {\r\n              const encodedArgs = composeEncodedArgs();\r\n\r\n              const proposal = {\r\n                proposal: {\r\n                  description:\r\n                    \"post on near.social from DAO$$$$https://near.social/#/mob.near/widget/ProfilePage?accountId=test-og-sbt.sputnik-dao.near$$$$ProposeCustomFunctionCall\",\r\n                  kind: {\r\n                    FunctionCall: {\r\n                      receiver_id: \"social.near\",\r\n                      actions: [\r\n                        {\r\n                          method_name: \"set\",\r\n                          args: encodedArgs,\r\n                          deposit: \"0\",\r\n                          gas: \"2000000\",\r\n                        },\r\n                      ],\r\n                    },\r\n                  },\r\n                },\r\n              };\r\n\r\n              Near.call(\r\n                \"test-og-sbt.sputnik-dao.near\",\r\n                \"add_proposal\",\r\n                proposal,\r\n                \"220Tg\"\r\n              );\r\n\r\n              onCompose();\r\n            }}\r\n          >\r\n            Post\r\n          </CommitButton>\r\n        ),\r\n      }}\r\n    />\r\n    {state.content && (\r\n      <div className=\"mt-3\">\r\n        <Widget\r\n          src=\"mob.near/widget/MainPage.Post\"\r\n          props={{\r\n            accountId: context.accountId,\r\n            content: state.content,\r\n            blockHeight: \"now\",\r\n          }}\r\n        />\r\n      </div>\r\n    )}\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/jay100.near/widget/post-to-dao", "__row_index": 3}