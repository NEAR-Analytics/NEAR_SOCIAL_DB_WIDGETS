{"tx_hash": "5wpsTnUn39MnaxMNz4cf3XH6Dc6TpWCWHjhRiAaGFC2h", "action_id_social": "2VgYwJen67XpFCDri9Wyee4CF95RHrApo4PVYkJquZZG-0-widget", "block_id": 83250833, "block_timestamp": "2023-01-18 18:36:36.810", "signer_id": "vanyog.near", "widget_name": "ProfileTabs", "source_code": "const accountId = props.accountId ?? context.accountId;\nif (!accountId) {\n  return \"No account ID\";\n}\n\nconst profile = props.profile ?? Social.getr(`${accountId}/profile`);\n\nif (profile === null) {\n  return \"Loading\";\n}\n\nState.init({ loadarticles: true });\n\nconst articlesNum = Near.view(\"thewiki.near\", \"get_num_articles\");\nconst articles = Near.view(\"thewiki.near\", \"get_article_ids_paged\", {\n  from_index: 0,\n  limit: 250,\n});\nconsole.log(\"articlesNum\", articlesNum);\n\nconsole.log(\"articles\", articles);\n\nconst description = profile.description;\n\nconst pills = [\n  { id: \"main\", title: \"Main\" },\n  { id: \"articles\", title: \"Articles\" },\n  { id: \"authors\", title: \"Authors\" },\n  { id: \"create\", title: \"Create Article\" },\n];\n\nconst handleArticle = (e, articleId) => {\n  State.update({ ...state, articleId: articleId, authorId: undefined });\n};\n\nconst handleAuthor = (e, authorId) => {\n  State.update({ ...state, articleId: undefined, authorId });\n};\n\nconst article =\n  state?.articleId &&\n  Near.view(\"thewiki.near\", \"get_article\", {\n    article_id: state?.articleId,\n  });\nSocial.get(\"///wiki/article\");\n\nconsole.log(\"article\", article);\n\nconst authorArticles =\n  state?.authorId &&\n  Near.view(\"thewiki.near\", \"get_account\", {\n    account_id: state?.authorId,\n  });\n\nconsole.log(\"authorArticles\", authorArticles);\n\nconst mainPage = Near.view(\"thewiki.near\", \"get_article\", {\n  article_id: \"\",\n});\n\nconsole.log(\"mainPage\", mainPage);\n\nconst getDate = (timestamp) => {\n  const newTimestamp = timestamp.slice(0, timestamp.length - 6);\n  const date = new Date(Number(newTimestamp));\n  return date.toDateString();\n};\n\nconst saveArticle = (args) => {\n  Near.call(\"thewiki.near\", \"post_article\", args, \"30000000000000\");\n};\n\nreturn (\n  <>\n    <ul className=\"nav nav-pills nav-fill mb-4\" id=\"pills-tab\" role=\"tablist\">\n      {pills.map(({ id, title }, i) => (\n        <li className=\"nav-item\" role=\"presentation\" key={i}>\n          <button\n            className={`nav-link ${i === 0 ? \"active\" : \"\"}`}\n            id={`pills-${id}-tab`}\n            data-bs-toggle=\"pill\"\n            data-bs-target={`#pills-${id}`}\n            type=\"button\"\n            role=\"tab\"\n            aria-controls={`pills-${id}`}\n            aria-selected={i === 0}\n            onClick={() => {\n              const key = `load${id}`;\n              !state[key] && State.update({ [key]: true });\n              State.update({ articleId: undefined, authorId: undefined });\n            }}\n          >\n            {title}\n          </button>\n        </li>\n      ))}\n    </ul>\n\n    <div className=\"tab-content\" id=\"pills-tabContent\">\n      <div\n        className=\"tab-pane fade show active\"\n        id=\"pills-main\"\n        role=\"tabpanel\"\n        aria-labelledby=\"pills-main-tab\"\n      >\n        {mainPage && <Markdown text={mainPage.body} />}\n      </div>\n\n      <div\n        className=\"tab-pane fade\"\n        id=\"pills-articles\"\n        role=\"tabpanel\"\n        aria-labelledby=\"pills-articles-tab\"\n      >\n        {state.loadarticles && (\n          <div>\n            {!state?.articleId && <h1>Articles</h1>}\n\n            {state?.articleId ? (\n              <div>\n                <button\n                  onClick={() => {\n                    State.update({ articleId: undefined });\n                  }}\n                >\n                  {\" \"}\n                  Back to articles{\" \"}\n                </button>\n                <button\n                  onClick={() => {\n                    State.update({ editArticle: true });\n                  }}\n                >\n                  Edit Article{\" \"}\n                </button>\n\n                {state.editArticle && (\n                  <>\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-success\"\n                      onClick={() => {\n                        if (!state.note || article.body === state.note) return;\n\n                        const args = {\n                          article_id: state?.articleId,\n                          body: state.note,\n                          navigation_id: null,\n                        };\n\n                        saveArticle(args);\n                      }}\n                    >\n                      Save Article{\" \"}\n                    </button>\n\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-danger\"\n                      onClick={() => {\n                        State.update({\n                          editArticle: false,\n                          note: article.body,\n                        });\n                      }}\n                    >\n                      Cancel{\" \"}\n                    </button>\n                    <textarea\n                      id=\"textarea1\"\n                      type=\"text\"\n                      rows={10}\n                      className=\"form-control mt-2\"\n                      value={state.note || article.body}\n                      onChange={(e) => {\n                        State.update({ ...state, note: e.target.value });\n                      }}\n                    />\n                  </>\n                )}\n\n                <Markdown text={article.body} />\n\n                {article && (\n                  <div className=\"mt-5 alert alert-secondary\">\n                    <div>\n                      Last edit by{\" \"}\n                      <a\n                        href=\"\"\n                        style={{ textDecoration: \"underline\" }}\n                        onClick={(e) => handleAuthor(e, article.author)}\n                      >\n                        {article.author}\n                      </a>\n                      <br />\n                      Edited on {getDate(article.timestamp)}\n                      <br />\n                      Edit versions: {article.edit_version + 1}\n                    </div>\n                    {buttons}\n                  </div>\n                )}\n              </div>\n            ) : state?.authorId ? (\n              <div>\n                <h4>Author: {state.authorId}</h4>\n                <ul>\n                  {authorArticles &&\n                    authorArticles.articles &&\n                    authorArticles.articles.map((article, index) => (\n                      <li>\n                        <a\n                          href=\"#\"\n                          onClick={(e) =>\n                            handleArticle(\n                              e,\n                              articles[articles.length - index - 1]\n                            )\n                          }\n                        >\n                          #{index + 1} {article}\n                        </a>\n                      </li>\n                    ))}\n                </ul>\n              </div>\n            ) : (\n              <ul>\n                {articles &&\n                  articles.map((article, index, articles) => (\n                    <li key={article}>\n                      #{\" \"}\n                      <a\n                        href=\"#\"\n                        onClick={(e) =>\n                          handleArticle(\n                            e,\n                            articles[articles.length - index - 1]\n                          )\n                        }\n                      >\n                        {articles.length - index}{\" \"}\n                        {index === articles.length - 1\n                          ? \"main page\"\n                          : articles[articles.length - index - 1]}\n                      </a>\n                    </li>\n                  ))}\n              </ul>\n            )}\n          </div>\n        )}\n      </div>\n\n      <div\n        className=\"tab-pane fade\"\n        id=\"pills-authors\"\n        role=\"tabpanel\"\n        aria-labelledby=\"pills-authors-tab\"\n      >\n        {state.loadauthors && (\n          <div>\n            <Widget src=\"eugenewolf507.near/widget/TestWiki_Authors\" />\n          </div>\n        )}\n      </div>\n\n      <div\n        className=\"tab-pane fade\"\n        id=\"pills-create\"\n        role=\"tabpanel\"\n        aria-labelledby=\"pills-create-tab\"\n      >\n        {state.loadcreate && (\n          <div>\n            <h1 className=\"mb-3\"> Create Article</h1>\n            <Widget src=\"vanyog.near/widget/CreateWikiArticle\" />\n          </div>\n        )}\n      </div>\n    </div>\n  </>\n);\n", "metadata": NaN, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/vanyog.near/widget/ProfileTabs", "metadata.name": NaN, "metadata.tags.profile": NaN, "metadata.tags.tabs": NaN, "branch.draft": NaN}