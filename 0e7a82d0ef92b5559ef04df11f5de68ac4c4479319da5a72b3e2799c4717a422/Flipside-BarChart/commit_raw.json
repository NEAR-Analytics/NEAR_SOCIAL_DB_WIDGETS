{"tx_hash": "FYxmQgdPjuJDJ4mD53yJphx4s6gpehHamMtzyMnBHeyi", "action_id_social": "EF1VfLVkJXGmGQkkyR9jFx3aaBKa6K7zEL9DUJBmnAoQ-0-widget", "block_id": 86603080, "block_timestamp": "2023-03-05 09:34:02.639", "signer_id": "0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422", "widget_name": "Flipside-BarChart", "source_code": "// Query API\r\nState.init({\r\n  queryResults: \"\",\r\n});\r\n\r\nfunction queryComplete(success, results) {\r\n  State.update({\r\n    queryResults: results,\r\n  });\r\n  //console.log(\"results: \" + JSON.stringify(state.queryResults));\r\n}\r\n\r\nconst myProps = {\r\n  query: `select substr(date_trunc('month', block_timestamp),0,10) as day_date, count(1) as num_blocks from near.core.fact_blocks where block_timestamp > '2022-01-01' group by 1 order by 1`,\r\n  debug: \"false\",\r\n  onComplete: queryComplete,\r\n};\r\n\r\n// Sample Charts\r\n// <img src=\"https://quickchart.io/chart?width=300&height=200&chart={type:'bar',data:{labels:['January','February', 'March','April', 'May'], datasets:[{label:'Dogs',data:[50,60,70,180,190]},{label:'Cats',data:[100,200,300,400,500]}]}}\" />\r\n\r\nconst chartType = `\"bar\"`;\r\nlet chartBottomAxisLabels = \"[\";\r\nlet chartValues = \"[\"; // {label:'DAY_DATE', data:[50,60,70,180,190]} ]\";\r\nlet chartValuesOrig = \"[ {label:'DAY_DATE', data:[50,60,70,180,190]} ]\";\r\n// parsing of data from flipside\r\nif (state.queryResults !== \"\") {\r\n  // parsing of labels\r\n  state.queryResults.rows.map((d, i) => {\r\n    if (i !== 0) {\r\n      chartBottomAxisLabels += \",\";\r\n      chartValues += \",\";\r\n    } else {\r\n      chartValues += \"{label: 'DAY_DATE', data:[\";\r\n    }\r\n    chartBottomAxisLabels += \"'\";\r\n    chartBottomAxisLabels += d[0];\r\n    chartBottomAxisLabels += \"'\";\r\n\r\n    chartValues += \"'\";\r\n    chartValues += d[1];\r\n    chartValues += \"'\";\r\n\r\n    // parsing of columns\r\n    // chartValues += `{label:'${d}', data:[50,60]}`;\r\n  });\r\n\r\n  chartValues += \"]}]\";\r\n  console.log(\"chartValues\", chartValues);\r\n  //chartValues = chartValuesOrig;\r\n  chartBottomAxisLabels += \"]\";\r\n  //console.log(\"chartBottomAxisLabels\", chartBottomAxisLabels);\r\n  console.log(\"chartValuesOrig\", chartValues);\r\n}\r\n\r\n/*\r\nconst imgSrc =\r\n  \"https://quickchart.io/chart?width=300&height=200&chart={type:'bar',data:{labels:['January','February', 'March','April', 'May'], datasets:[{label:'Dogs',data:[50,60,70,180,190]}]}}\";\r\n*/\r\n\r\nconst imgTemplate = `https://quickchart.io/chart?width=300&height=200&chart={type:${chartType},data:{labels:${chartBottomAxisLabels}, datasets:${chartValues}}}`;\r\n\r\n//console.log(imgTemplate);\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src=\"0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422/widget/Flipside-API-Getter\"\r\n      props={myProps}\r\n    ></Widget>\r\n    <div className=\"text-bg-light rounded-4 p-3 mb-4\">\r\n      {state.queryResults !== \"\" ? (\r\n        <p>\r\n          <div class=\"d-flex clearfix flex-wrap flex-column flex-sm-row\">\r\n            <div class=\"p-2\">\r\n              <div>\r\n                <h2>Metric: Near Blocks Per Month</h2>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <img src={imgTemplate} />\r\n          </div>\r\n        </p>\r\n      ) : (\r\n        <div>Loading ...</div>\r\n      )}\r\n    </div>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422/widget/Flipside-BarChart"}