{"tx_hash": "CiVNo146yvVSa9UCG7EKZTgKd2VtrgAbShnUjthb4kfH", "action_id_social": "BX7HrbdhKmAQK2EDoLb9Qwoj2i8kxszZBZkfQfeTMXj5-0-widget", "block_id": 86588750, "block_timestamp": "2023-03-05 04:59:52.179", "signer_id": "0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422", "widget_name": "Flipside-BarChart", "source_code": "// Query API\r\nState.init({\r\n  queryResults: \"\",\r\n});\r\n\r\nfunction queryComplete(success, results) {\r\n  State.update({\r\n    queryResults: results,\r\n  });\r\n  //console.log(\"results: \" + JSON.stringify(state.queryResults.records));\r\n}\r\n\r\nconst myProps = {\r\n  query: `select substr(date_trunc('month', block_timestamp),0,10) as day_date, count(1) as num_blocks from near.core.fact_blocks where block_timestamp > '2022-01-01' group by 1 order by 1`,\r\n  debug: \"false\",\r\n  onComplete: queryComplete,\r\n};\r\n\r\n// Chart Query\r\nlet Style = styled.div`\r\n.barTextH{\r\n  transition: fill 0.2s;\r\n\r\n}\r\n.barTextH:hover{\r\n  fill: #ad610a;\r\n\r\n}\r\n.bar {\r\n  transition: fill 0.2s;\r\n}\r\n\r\n.bar:hover {\r\n  fill: #ffa726;\r\n}\r\n\r\n.bar-chart {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\nsvg {\r\n  width: 80%;\r\n}\r\n\r\nrect {\r\n  shape-rendering: crispEdges;\r\n  fill: #61dafb;\r\n  stroke: #333;\r\n  stroke-width: 1;\r\n}\r\n`;\r\n\r\nconst width = 800;\r\nconst height = 500;\r\nlet maxValue = 0;\r\nif (state.queryResults !== \"\") {\r\n  state.queryResults.rows.map((d) => {\r\n    if (d[1] > maxValue) {\r\n      maxValue = d[1];\r\n    }\r\n  });\r\n}\r\n/*\r\nif (state.queryResults !== \"\") {\r\n  maxValue = Math.max(state.queryResults.rows.map((d) => d[0])) * 1.1;\r\n}\r\n*/\r\n\r\nreturn (\r\n  <>\r\n    <Widget\r\n      src=\"0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422/widget/Flipside-API-Getter\"\r\n      props={myProps}\r\n    ></Widget>\r\n    <Style>\r\n      <div className=\"text-bg-light rounded-4 p-3 mb-4\">\r\n        {state.queryResults !== \"\" ? (\r\n          <p>\r\n            <div class=\"d-flex clearfix flex-wrap flex-column flex-sm-row\">\r\n              <div class=\"p-2\">\r\n                <div>\r\n                  <h2>Metric: Near Blocks Per Month</h2>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"bar-chart\">\r\n              <svg\r\n                width={width}\r\n                height={height}\r\n                viewBox={`0 0 ${width} ${height + 200} `}\r\n                preserveAspectRatio=\"xMidYMid meet\"\r\n              >\r\n                {state.queryResults.rows.map((d, i) => {\r\n                  const yPos = height - (d[1] / maxValue) * height;\r\n                  const yHeight = (d[1] / maxValue) * height;\r\n                  return (\r\n                    <g key={i} className=\"barTextH\">\r\n                      <rect\r\n                        className=\"bar\"\r\n                        x={i * (width / state.queryResults.records.length)}\r\n                        y={yPos}\r\n                        width={width / state.queryResults.records.length - 2}\r\n                        height={yHeight}\r\n                        fill=\"#61dafb\"\r\n                      />\r\n                      <text\r\n                        className=\"text-primary-emphasis\"\r\n                        x={\r\n                          i * (width / state.queryResults.records.length) +\r\n                          width / state.queryResults.records.length / 2.5\r\n                        }\r\n                        y={height + 40}\r\n                        transform={`rotate(-75 ${\r\n                          i * (width / state.queryResults.records.length) +\r\n                          width / state.queryResults.records.length / 2\r\n                        } ${height + 40})`}\r\n                        textAnchor=\"middle\"\r\n                      >\r\n                        {d[0]}\r\n                      </text>\r\n                      <text\r\n                        className=\"text-primary-emphasis\"\r\n                        x={\r\n                          i * (width / state.queryResults.records.length) +\r\n                          width / state.queryResults.records.length / 2\r\n                        }\r\n                        y={height - 50}\r\n                        transform={`rotate(-90 ${\r\n                          i * (width / state.queryResults.records.length) +\r\n                          width / state.queryResults.records.length / 2\r\n                        } ${height - 50})`}\r\n                        textAnchor=\"middle\"\r\n                      >\r\n                        {d[1]}\r\n                      </text>\r\n                    </g>\r\n                  );\r\n                })}\r\n              </svg>\r\n            </div>\r\n            <div>\r\n              <hr />\r\n            </div>\r\n          </p>\r\n        ) : (\r\n          <div>Loading ...</div>\r\n        )}\r\n      </div>\r\n    </Style>\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422/widget/Flipside-BarChart"}