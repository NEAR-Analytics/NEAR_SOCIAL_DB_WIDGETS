{"tx_hash": "UJREWjcZdK2pJWVbY8WgrBpgEHR4YpzzuxzPmEW3kLx", "action_id_social": "CCe4qPgWgB6D9KzK6GuF5CaoxBVbJ7CQmmpG3BbWWBDW-0-widget", "block_id": 86604523, "block_timestamp": "2023-03-05 10:01:45.218", "signer_id": "0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422", "widget_name": "Flipside-BarChart", "source_code": "State.init({\r\n  imgSrc: \"\",\r\n});\r\n\r\n// Query API\r\nconst options = {\r\n  method: \"POST\",\r\n  body: `{ \"query\": \"select substr(date_trunc('month', block_timestamp),0,10) as day_date, count(1) as num_blocks from near.core.fact_blocks where block_timestamp > '2022-01-01' group by 1 order by 1\" }`,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n};\r\n\r\nasyncFetch(\"https://flipside-api.antonyip.com/getCachedQuery\", options).then(\r\n  (res) => {\r\n    if (!res.ok) {\r\n      return;\r\n    }\r\n\r\n    if (res.body.error) {\r\n      return;\r\n    }\r\n\r\n    let queryResults = res.body;\r\n\r\n    console.log(\"queryResults\", queryResults);\r\n    const chartType = `\"bar\"`;\r\n    let chartBottomAxisLabels = \"[\";\r\n    let chartValues = \"[\";\r\n    // parsing of data from flipside\r\n    if (queryResults !== \"\") {\r\n      // parsing of labels\r\n      queryResults.rows.map((d, i) => {\r\n        if (i !== 0) {\r\n          chartBottomAxisLabels += \",\";\r\n          chartValues += \",\";\r\n        } else {\r\n          chartValues += \"{label: 'Number of Blocks', data:[\";\r\n        }\r\n        chartBottomAxisLabels += \"'\";\r\n        chartBottomAxisLabels += d[0];\r\n        chartBottomAxisLabels += \"'\";\r\n\r\n        chartValues += \"'\";\r\n        chartValues += d[1];\r\n        chartValues += \"'\";\r\n      });\r\n\r\n      chartValues += \"]}]\";\r\n      chartBottomAxisLabels += \"]\";\r\n      const imgTemplate = `https://quickchart.io/chart?width=300&height=200&chart={type:${chartType},data:{labels:${chartBottomAxisLabels}, datasets:${chartValues}}}`;\r\n      State.update({\r\n        imgSrc: imgTemplate,\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\nreturn (\r\n  <>\r\n    <h2>Near Monthly Number of Blocks</h2>\r\n    {state.imgSrc === \"\" ? <div>Loading ...</div> : <img src={state.imgSrc} />}\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422/widget/Flipside-BarChart"}