{"tx_hash": "31NBHQdnX7Zz6s2xTxD55sbkEJqfcx1WKbRaapnoK3Er", "action_id_social": "ASHw8xX17Zc7f41MB2uiwmR5tqmcY2RRB7ymGReCgZgH-0-widget", "block_id": 87352091, "block_timestamp": "2023-03-15 13:07:10.228", "signer_id": "0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422", "widget_name": "NEAR-Segment-DEXSWAP", "source_code": "let dexSwapChartProps = {\r\n  queryTemplate: `with\r\n  social_inits as (\r\n    select\r\n      *\r\n    from\r\n      near.core.fact_actions_events_addkey\r\n    where\r\n      receiver_id = 'social.near'\r\n  ),\r\n  add_signer as (\r\n    select\r\n      k.tx_hash,\r\n      k.block_id,\r\n      k.block_timestamp,\r\n      t.tx_signer,\r\n      k.allowance,\r\n      t.tx_signer = t.tx_receiver\r\n    from\r\n      social_inits k\r\n      left join near.core.fact_transactions t using (tx_hash)\r\n  ),\r\n  de_dupe_resigners as (\r\n    select\r\n      block_timestamp,\r\n      tx_signer\r\n    from\r\n      add_signer\r\n    qualify\r\n      ROW_NUMBER() over (\r\n        PARTITION BY\r\n          tx_signer\r\n        ORDER BY\r\n          block_timestamp ASC\r\n      ) = 1\r\n  ),\r\n  interested_addresses as (\r\n    select\r\n      tx_signer\r\n    from\r\n      de_dupe_resigners\r\n    WHERE\r\n      block_timestamp BETWEEN '$$(dateStart)' and '$$(dateEnd)'\r\n  ),\r\n  data_table as (\r\n    select\r\n      substr(date_trunc('month', t.block_timestamp), 0, 10) as day_date,\r\n      ia.tx_signer,\r\n      count(1) as num_actions\r\n    from\r\n      interested_addresses ia\r\n      left join near.core.ez_dex_swaps t on ia.tx_signer = t.trader\r\n    group by\r\n      1,\r\n      2\r\n  ),\r\n  final as (\r\n    select\r\n      day_date,\r\n      sum(num_actions) as net_actions\r\n    from\r\n      data_table\r\n    WHERE\r\n      len(day_date) > 0\r\n    group by\r\n      1\r\n  )\r\nselect\r\n  *\r\nfrom\r\n  final\r\norder by\r\n  1`,\r\n  title: \"DEX Swap Activity\",\r\n  chartWidth: 640,\r\n  chartHeight: 200,\r\n};\r\n\r\ndexSwapChartProps.query = dexSwapChartProps.queryTemplate\r\n  .replace(\"$$(dateStart)\", props.dateStart)\r\n  .replace(\"$$(dateEnd)\", props.dateEnd)\r\n  .replaceAll(\"\\n\", \" \");\r\n\r\nreturn (\r\n  <div>\r\n    <Widget\r\n      src=\"0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422/widget/Flipside-BarChart-V2\"\r\n      props={dexSwapChartProps}\r\n    />\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/0e7a82d0ef92b5559ef04df11f5de68ac4c4479319da5a72b3e2799c4717a422/widget/NEAR-Segment-DEXSWAP"}