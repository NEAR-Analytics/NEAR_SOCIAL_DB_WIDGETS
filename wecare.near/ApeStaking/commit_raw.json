{"tx_hash": "GhGeqQbRwV8xLqDWVrfyqwWMUK8qfTyXhe31oxSs39kA", "action_id_social": "7fqzDTeaGhyPghC4gkcE6bovdid3LXg1BU7se6opQjgZ-0-widget", "block_id": 86849712, "block_timestamp": "2023-03-08 18:24:00.978", "signer_id": "wecare.near", "widget_name": "ApeStaking", "source_code": "const stakingContractAddress = \"0x5954aB967Bc958940b7EB73ee84797Dc8a2AFbb9\";\nconst apeContractAddress = \"0x4d224452801ACEd8B2F0aebE155379bb5D594381\";\nconst stakingContractAbi = fetch(\n  \"https://api.etherscan.io/api?module=contract&action=getabi&address=0x5954aB967Bc958940b7EB73ee84797Dc8a2AFbb9&format=raw\"\n);\nconst apeContractAbi = fetch(\n  \"https://api.etherscan.io/api?module=contract&action=getabi&address=0x4d224452801aced8b2f0aebe155379bb5d594381&format=raw\"\n);\nconst tokenDecimals = 18;\n\nif (!stakingContractAbi.ok || !apeContractAbi.ok) return \"Loading...\";\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n    console.log(\"set sender\", accounts[0]);\n  }\n}\n\nconst apeStakingContract = new ethers.Contract(\n  stakingContractAddress,\n  stakingContractAbi.body,\n  Ethers.provider()\n);\n\nconsole.log(\"staking contract initated\");\n\nconst apeContract = new ethers.Contract(\n  apeContractAddress,\n  apeContractAbi.body,\n  Ethers.provider()\n);\n\nconsole.log(\"ape contract initated\");\n\nconst getStakedBalance = (receiver) => {\n  console.log(\"getStakedBalance\");\n  return apeStakingContract.getApeCoinStake(receiver);\n};\n\nconst getApeBalance = (receiver) => {\n  console.log(\"getApeBalance\");\n  return apeContract.balanceOf(receiver);\n};\n\nif (state.stakedBalance === undefined && state.sender) {\n  console.log(\"getting staked balance\");\n  getStakedBalance(state.sender).then((stakedBalance) => {\n    const balance = Big(stakedBalance[2].toString())\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(2)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n    State.update({ stakedBalance: balance });\n  });\n}\n\nif (state.apeBalance === undefined && state.sender) {\n  console.log(\"getting ape balance\");\n  getApeBalance(state.sender).then((apeBalance) => {\n    const balance = Big(apeBalance.toString())\n      .div(Big(10).pow(tokenDecimals))\n      .toFixed(2)\n      .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n    State.update({ apeBalance: balance });\n  });\n}\n\nconst submitApe = (amount, receiver) => {\n  console.log(amount);\n  return;\n};\n\nreturn (\n  <div>\n    <h3>Staking</h3>\n    <div>Staked APE: {state.stakedBalance} $APE</div>\n    <div>Wallet Balance: {state.apeBalance} $APE</div>\n    <div>\n      <input\n        value={state.stkApe}\n        onChange={(e) => State.update({ stkApe: e.target.value })}\n        placeholder=\"Amount\"\n      />\n    </div>\n    <button onClick={() => submitApe(state.stkApe, state.sender)}>\n      STAKE & DEPOSIT\n    </button>\n  </div>\n);\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/wecare.near/widget/ApeStaking", "metadata.tags.ethdenver2023": NaN, "metadata": NaN}