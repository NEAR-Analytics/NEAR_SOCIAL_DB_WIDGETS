{"tx_hash": "7SDmZRWzdkHbFeGPcxW1TCs4TsFyEvAA9cwDPietnsuX", "action_id_social": "FoV7StLQPoyvMr2jrZi3RgRxngVVp9CV4kjrv4j5puDf-0-widget", "block_id": 88363415, "block_timestamp": "2023-03-29 11:48:31.791", "signer_id": "jirapatwor.near", "widget_name": "bastion-deposit", "source_code": "const { selectedTokenId, amount, hasError, status } = state;\r\n\r\n// check if account connected\r\nconst sender = Ethers.send(\"eth_requestAccounts\", [])[0];\r\nif (!sender)\r\n  return (\r\n    <div>\r\n      <h2>Please login first</h2>\r\n      <br />\r\n      <Web3Connect connectLabel=\"Connect with Web3\" />\r\n    </div>\r\n  );\r\n\r\n// fetch data from lens\r\nconst LenABI = fetch(\r\n  \"https://raw.githubusercontent.com/pysrbastion/bastion-abi/main/Lens.json\"\r\n).body;\r\n\r\nconst lenContract = \"0x080B5ce373fE2103A7086b31DabA412E88bD7356\";\r\n\r\nconst len = new ethers.Contract(lenContract, LenABI, Ethers.provider());\r\n\r\nconst dataArray = [\r\n  \"0xfa786baC375D8806185555149235AcDb182C033b\",\r\n  \"0x4E8fE8fd314cFC09BDb0942c5adCC37431abDCD0\",\r\n  \"0x8C14ea853321028a7bb5E4FB0d0147F183d3B677\",\r\n  \"0xe5308dc623101508952948b141fD9eaBd3337D99\",\r\n  \"0x845E15A441CFC1871B7AC610b0E922019BaD9826\",\r\n];\r\n\r\nlen.callStatic\r\n  .cTokenBalancesAll(dataArray, sender, 0)\r\n  .then((cTokenBalancesAll) => {\r\n    State.update({ cTokenBalancesAll });\r\n  });\r\n\r\nlen.callStatic.cTokenMetadataAll(dataArray, 0).then((cTokenMetadataAll) => {\r\n  State.update({ cTokenMetadataAll });\r\n});\r\n\r\n// provide constants\r\nconst TokensDetail = {\r\n  [\"0xC42C30aC6Cc15faC9bD938618BcaA1a1FaE8501d\"]: {\r\n    name: \"Near\",\r\n    symbol: \"NEAR\",\r\n    address: \"0xC42C30aC6Cc15faC9bD938618BcaA1a1FaE8501d\",\r\n    cAddress: \"0x8C14ea853321028a7bb5E4FB0d0147F183d3B677\",\r\n    icon: \"near.svg\",\r\n    decimals: 24,\r\n  },\r\n  [\"0xB12BFcA5A55806AaF64E99521918A4bf0fC40802\"]: {\r\n    name: \"USD Coin\",\r\n    symbol: \"USDC\",\r\n    address: \"0xB12BFcA5A55806AaF64E99521918A4bf0fC40802\",\r\n    cAddress: \"0xe5308dc623101508952948b141fD9eaBd3337D99\",\r\n    icon: \"usdc.svg\",\r\n    decimals: 6,\r\n  },\r\n  [\"0x4988a896b1227218e4A686fdE5EabdcAbd91571f\"]: {\r\n    name: \"Tether USD\",\r\n    symbol: \"USDT.e\",\r\n    address: \"0x4988a896b1227218e4A686fdE5EabdcAbd91571f\",\r\n    cAddress: \"0x845E15A441CFC1871B7AC610b0E922019BaD9826\",\r\n    icon: \"usdt.svg\",\r\n    decimals: 6,\r\n  },\r\n  [\"0xf4eb217ba2454613b15dbdea6e5f22276410e89e\"]: {\r\n    name: \"Wrapped Bitcoin\",\r\n    symbol: \"WBTC\",\r\n    address: \"0xf4eb217ba2454613b15dbdea6e5f22276410e89e\",\r\n    cAddress: \"0xfa786baC375D8806185555149235AcDb182C033b\",\r\n    icon: \"btc.png\",\r\n    decimals: 8,\r\n  },\r\n  [\"ETH\"]: {\r\n    name: \"Ether\",\r\n    symbol: \"ETH\",\r\n    address: ethers.constants.AddressZero,\r\n    cAddress: \"0x4E8fE8fd314cFC09BDb0942c5adCC37431abDCD0\",\r\n    icon: \"eth.svg\",\r\n    decimals: 18,\r\n  },\r\n};\r\n\r\nconst Comptroller = \"0x6De54724e128274520606f038591A00C5E94a1F6\";\r\nconst EIP20InterfaceABI = fetch(\r\n  \"https://raw.githubusercontent.com/JirapatWov/bos/main/EIP20.json\"\r\n).body;\r\nconst CEthABI = fetch(\r\n  \"https://raw.githubusercontent.com/JirapatWov/bos/main/CEther.json\"\r\n).body;\r\nconst CErc20ABI = fetch(\r\n  \"https://raw.githubusercontent.com/JirapatWov/bos/main/CErc20.json\"\r\n).body;\r\n\r\nconst expandToken = (value, decimals) => {\r\n  return new Big(value).mul(new Big(10).pow(decimals));\r\n};\r\n\r\nconst handleSelect = (e) => {\r\n  State.update({\r\n    selectedTokenId: e.target.value,\r\n    amount: \"\",\r\n    hasError: false,\r\n  });\r\n};\r\n\r\nconst handleAmount = (e) => {\r\n  State.update({\r\n    amount: Number(e.target.value),\r\n    selectedTokenId,\r\n    hasError: false,\r\n  });\r\n};\r\n\r\nconst handleApprove = () => {\r\n  if (!selectedTokenId || !amount || hasError) return;\r\n\r\n  const erc20 = new ethers.Contract(\r\n    selectedTokenId,\r\n    EIP20InterfaceABI,\r\n    Ethers.provider().getSigner()\r\n  );\r\n\r\n  const expandedAmount = expandToken(\r\n    amount,\r\n    TokensDetail[selectedTokenId].decimals\r\n  ).toFixed();\r\n\r\n  const toBigNumber = ethers.BigNumber.from(expandedAmount);\r\n\r\n  erc20\r\n    .approve(TokensDetail[selectedTokenId].cAddress, toBigNumber)\r\n    .then((transactionHash) => {\r\n      console.log(\"transactionHash is \" + transactionHash);\r\n    });\r\n};\r\n\r\nconst handleDeposit = () => {\r\n  if (!selectedTokenId || !amount || hasError) return;\r\n\r\n  let contractABI;\r\n  if (selectedTokenId == \"ETH\") {\r\n    contractABI = CEthABI;\r\n  } else {\r\n    contractABI = CErc20ABI;\r\n  }\r\n\r\n  const connection = new ethers.Contract(\r\n    TokensDetail[selectedTokenId].cAddress,\r\n    contractABI,\r\n    Ethers.provider().getSigner()\r\n  );\r\n\r\n  const expandedAmount = expandToken(\r\n    amount,\r\n    TokensDetail[selectedTokenId].decimals\r\n  ).toFixed();\r\n\r\n  const toBigNumber = ethers.BigNumber.from(expandedAmount);\r\n\r\n  connection.mint(toBigNumber).then((transactionHash) => {\r\n    console.log(\"transactionHash is \" + transactionHash);\r\n  });\r\n};\r\n\r\nreturn (\r\n  <div style={{ maxWidth: \"400px\" }}>\r\n    <div class=\"card-body d-grid gap-3\">\r\n      <div>\r\n        <div class=\"mb-2 text-muted\">Token</div>\r\n        <select\r\n          onChange={handleSelect}\r\n          class=\"p-2 mb-1\"\r\n          style={{ width: \"100%\" }}\r\n        >\r\n          <option value=\"\">Choose your token</option>\r\n          <option value=\"0xC42C30aC6Cc15faC9bD938618BcaA1a1FaE8501d\">\r\n            NEAR\r\n          </option>\r\n          <option value=\"0xB12BFcA5A55806AaF64E99521918A4bf0fC40802\">\r\n            USDC\r\n          </option>\r\n          <option value=\"0x4988a896b1227218e4A686fdE5EabdcAbd91571f\">\r\n            USDT.e\r\n          </option>\r\n          <option value=\"0xf4eb217ba2454613b15dbdea6e5f22276410e89e\">\r\n            WBTC\r\n          </option>\r\n          <option value=\"ETH\">ETH</option>\r\n        </select>\r\n        {state.selectedTokenId !== undefined && state.selectedTokenId !== \"\" && (\r\n          <div>\r\n            <span class=\"badge bg-light text-dark\">Wallet Balance: {}</span>\r\n            <span class=\"badge bg-light text-dark\">Supply Balance: </span>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div>\r\n        <div class=\"mb-2 text-muted\">Amount</div>\r\n        <input type=\"number\" value={amount} onChange={handleAmount} />\r\n      </div>\r\n      {hasError && (\r\n        <p class=\"alert alert-danger\" role=\"alert\">\r\n          Amount greater than balance\r\n        </p>\r\n      )}\r\n      <button\r\n        onClick={handleApprove}\r\n        style={{ background: \"#4ED58A\", borderColor: \"#4ED58A\" }}\r\n      >\r\n        Approve\r\n      </button>\r\n      <button\r\n        onClick={handleDeposit}\r\n        style={{ background: \"#4ED58A\", borderColor: \"#4ED58A\" }}\r\n      >\r\n        Deposit\r\n      </button>\r\n    </div>\r\n\r\n    <p>Account: {sender}</p>\r\n  </div>\r\n);\r\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/jirapatwor.near/widget/bastion-deposit", "metadata.name": NaN, "metadata.tags.defi": NaN, "metadata.tags.ethdenver2023": NaN}