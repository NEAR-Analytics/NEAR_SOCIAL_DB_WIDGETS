{"tx_hash": "x41Z4hy6tbHopHhk4f3DZGFSmPRzCBpXxWBxC3LAqJZ", "action_id_social": "835mnh4pMvv4zJphDFqWGYGpiHyqAfhgBC8u5x2MFJBi-0-widget", "block_id": 83004906, "block_timestamp": "2023-01-15 12:19:16.744", "signer_id": "vow_owner_123.near", "widget_name": "Instance_time_review", "source_code": "State.init({\r\n  _account: \"all\",\r\n});\r\nconst card = {\r\n  background: \"#FFA629\",\r\n  border: \"1px solid black\",\r\n  borderRadius: \"5px\",\r\n  textAlign: \"center\",\r\n  color: \"white\",\r\n  padding: \"10px\",\r\n};\r\nconst comboBox = {\r\n  background: \"black\",\r\n  color: \"white\",\r\n  borderRadius: \"1rem\",\r\n  padding: \"1rem\",\r\n};\r\nconst container_on = {\r\n  display: \"flex\",\r\n  width: \"100%\",\r\n  justifyContent: \"center\",\r\n  padding: \"1rem\",\r\n  margin: \"0.5rem\",\r\n  background: \"#9747FF\",\r\n  color: \"white\",\r\n  fontWeight: 400,\r\n  fontSize: \"16px\",\r\n  borderRadius: \"1rem\",\r\n  flexDirection: \"column\",\r\n};\r\nconst container_off = {\r\n  display: \"flex\",\r\n  width: \"100%\",\r\n  justifyContent: \"center\",\r\n  padding: \"1rem\",\r\n  margin: \"0.5rem\",\r\n  background: \"rgb(170 173 201)\",\r\n  color: \"white\",\r\n  fontWeight: 400,\r\n  fontSize: \"16px\",\r\n  borderRadius: \"1rem\",\r\n  flexDirection: \"column\",\r\n};\r\nconst days = [\r\n  \"Monday\",\r\n  \"Tuesday\",\r\n  \"Wednesday\",\r\n  \"Thursday\",\r\n  \"Friday\",\r\n  \"Saturday\",\r\n  \"Sunday\",\r\n];\r\nconst data = Social.index(\"Instance_time\", \"data\");\r\nif (!data) {\r\n  return \"Loading datas\";\r\n}\r\nvar sortedData = data.sort((d1, d2) => d2.blockHeight - d1.blockHeight);\r\nvar finalData = [];\r\nvar accountIds = [\"all\"];\r\n\r\nconst sortAndRemoveRepeated = (flag, data) => {\r\n  var temp = data;\r\n  if (flag) temp.push(0, 168);\r\n  var sortedTimeData = temp.sort((d2, d1) => d2 - d1);\r\n\r\n  var final = [];\r\n  for (var k = 0; k < sortedTimeData.length; k++) {\r\n    var repeated = false;\r\n    for (var l = 0; l < sortedTimeData.length; l++) {\r\n      if (k != l && sortedTimeData[k] == sortedTimeData[l]) {\r\n        repeated = true;\r\n      }\r\n    }\r\n    if (!repeated) final.push(sortedTimeData[k]);\r\n  }\r\n  return final;\r\n};\r\n\r\nfor (let i = 0; i < sortedData.length; i++) {\r\n  if (accountIds.indexOf(sortedData[i].accountId) < 0) {\r\n    accountIds.push(sortedData[i].accountId);\r\n    var date = new Date();\r\n    var utc_offset = -date.getTimezoneOffset() / 60;\r\n    var times = sortedData[i].value._data;\r\n    var temp = [];\r\n    var flag = false;\r\n    for (var j = 0; j < times.length; j++) {\r\n      const time = times[j] + utc_offset;\r\n      if (time > 168) {\r\n        temp.push(time - 168);\r\n        flag = true;\r\n      } else if (time < 0) {\r\n        temp.push(time + 168);\r\n        flag = true;\r\n      } else temp.push(time);\r\n    }\r\n    const final = sortAndRemoveRepeated(flag, temp);\r\n    for (var m = 0; m < final.length - 1; m += 2) {\r\n      const _from = final[m];\r\n      const _to = final[m + 1];\r\n      for (var o = 1; o < 7; o++) {\r\n        if (o * 24 > _from && o * 24 < _to) {\r\n          final.push(o * 24, o * 24);\r\n        }\r\n      }\r\n    }\r\n    var sortedTimeDataNew = final.sort((d2, d1) => d2 - d1);\r\n    var weeklyData = [];\r\n    for (var t = 0; t < 7; t++) {\r\n      var dailyData = [];\r\n      var exist = false;\r\n      for (var p = 0; p < sortedTimeDataNew.length - 1; p += 2) {\r\n        var _from = sortedTimeDataNew[p];\r\n        var _to = sortedTimeDataNew[p + 1];\r\n        if (_to > t * 24 && _to <= (t + 1) * 24) {\r\n          dailyData.push({\r\n            _from: _from - t * 24,\r\n            _to: _to - t * 24,\r\n          });\r\n          exist = true;\r\n        }\r\n      }\r\n      if (!exist) weeklyData.push({ on_off: \"off\", data: [] });\r\n      else weeklyData.push({ on_off: \"on\", data: dailyData });\r\n    }\r\n    finalData.push({\r\n      accountId: sortedData[i].accountId,\r\n      value: {\r\n        _data: weeklyData,\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nreturn (\r\n  <div>\r\n    <div className=\"p-2 d-flex flex-row align-items-center\">\r\n      <h4 className=\"p-2\">Account: </h4>\r\n      <select\r\n        style={comboBox}\r\n        name=\"accounts\"\r\n        id=\"accounts\"\r\n        value={state._account}\r\n        onChange={(e) => {\r\n          State.update({ _account: e.target.value });\r\n        }}\r\n      >\r\n        {accountIds.map((account) => (\r\n          <option value={account}>{account}</option>\r\n        ))}\r\n      </select>\r\n    </div>\r\n    {finalData\r\n      ? finalData.map((d) => (\r\n          <div style={card}>\r\n            <Widget\r\n              src=\"mob.near/widget/ProfileImage\"\r\n              props={{\r\n                accountId: d.accountId,\r\n                className: \"d-inline-block\",\r\n                style: { width: \"1.5em\", height: \"1.5em\", fontSize: \"x-large\" },\r\n              }}\r\n            />\r\n            <a href={`#/mob.near/widget/ProfilePage?accountId=${d.accountId}`}>\r\n              {d.accountId}\r\n            </a>\r\n            <div>\r\n              <div className=\"d-flex flex-row\">\r\n                {d.value._data.map((week, index) => {\r\n                  return (\r\n                    <div\r\n                      style={week.on_off == \"on\" ? container_on : container_off}\r\n                    >\r\n                      <div>{`${days[index]}`}</div>\r\n                      <div>\r\n                        {week.data.map((y) => (\r\n                          <li>{`${y._from}:00 - ${y._to}:00`}</li>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))\r\n      : \"Loading...\"}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/vow_owner_123.near/widget/Instance_time_review"}