{"tx_hash": "CzfZvfgLpPCDooxP1Z4DJYhmQU1mmVczo7QDmfGaMJ1j", "action_id_social": "7JJozb4QJaJoyd6mxHSkuu8R9JgBcaXJR4tcRCqtEcsc-0-widget", "block_id": 83081358, "block_timestamp": "2023-01-16 12:45:19.812", "signer_id": "vow_owner_123.near", "widget_name": "Instance_time_setting", "source_code": "State.init({\r\n  _is_on: [\"on\", \"on\", \"on\", \"on\", \"on\", \"off\", \"off\"],\r\n  _from: [\r\n    \"10:00 AM\",\r\n    \"10:00 AM\",\r\n    \"10:00 AM\",\r\n    \"10:00 AM\",\r\n    \"10:00 AM\",\r\n    \"10:00 AM\",\r\n    \"10:00 AM\",\r\n  ],\r\n  _to: [\r\n    \"06:00 PM\",\r\n    \"06:00 PM\",\r\n    \"06:00 PM\",\r\n    \"06:00 PM\",\r\n    \"06:00 PM\",\r\n    \"06:00 PM\",\r\n    \"06:00 PM\",\r\n  ],\r\n  _time_zone: \"(UTC+00:00) UTC\",\r\n  _validate_result: true,\r\n  _validate_error: [true, true, true, true, true, true, true],\r\n});\r\nconst title = {\r\n  display: \"flex\",\r\n  justifyContent: \"center\",\r\n  width: \"70%\",\r\n  padding: \"1.5rem\",\r\n  marginBottom: \"1rem\",\r\n  color: \"black\",\r\n  borderRadius: \"2rem\",\r\n  fontWeight: 600,\r\n  fontSize: \"xx-large\",\r\n  boxShadow: \"2px 2px 2px 2px grey\",\r\n};\r\nconst container = {\r\n  display: \"flex\",\r\n  width: \"100%\",\r\n  justifyContent: \"center\",\r\n  padding: \"3rem\",\r\n  color: \"black\",\r\n  fontWeight: 400,\r\n  borderRadius: \"1rem\",\r\n  flexDirection: \"column\",\r\n};\r\nconst tbl_container = {\r\n  display: \"flex\",\r\n  marginTop: \"1rem\",\r\n  justifyContent: \"center\",\r\n  padding: \"2rem\",\r\n  color: \"black\",\r\n  fontWeight: 400,\r\n  borderRadius: \"1rem\",\r\n  flexDirection: \"column\",\r\n};\r\nconst button = {\r\n  borderRadius: \"5px\",\r\n  margin: \"5px 0\",\r\n  padding: \"8px\",\r\n  marginTop: \"10px\",\r\n  textAlign: \"center\",\r\n  fontSize: \"x-large\",\r\n  border: \"2px solid black\",\r\n  fontWeight: \"bold\",\r\n};\r\nconst comboBox = {\r\n  borderRadius: \"1rem\",\r\n  padding: \"1rem\",\r\n};\r\nconst comboBoxTimezone = {\r\n  background: \"black\",\r\n  color: \"white\",\r\n  borderRadius: \"1rem\",\r\n  padding: \"1rem\",\r\n  boxShadow: \"2px 2px white\",\r\n};\r\nconst table = {\r\n  display: \"flex\",\r\n  flex: \"1\",\r\n  alignItems: \"center\",\r\n  justifyContent: \"center\",\r\n  fontWeight: 600,\r\n};\r\nconst flex_row = {\r\n  display: \"flex\",\r\n  flex: \"1\",\r\n  flexDirection: \"row\",\r\n  fontSize: \"large\",\r\n};\r\nconst flex_column = {\r\n  display: \"flex\",\r\n  flexDirection: \"column\",\r\n};\r\nconst tbl_row = {\r\n  display: \"flex\",\r\n  background: \"white\",\r\n  margin: \"1px\",\r\n  padding: \"6px\",\r\n};\r\nconst time_zones = [\r\n  \"(UTC-11:00) Samoa\",\r\n  \"(UTC-10:00) Hawaii\",\r\n  \"(UTC-09:00) Alaska\",\r\n  \"(UTC-08:00) Pacific Time\",\r\n  \"(UTC-07:00) Arizona\",\r\n  \"(UTC-06:00) Central America\",\r\n  \"(UTC-06:00) Saskatchewan\",\r\n  \"(UTC-05:00) Eastern Time\",\r\n  \"(UTC-04:00) Atlantic Time\",\r\n  \"(UTC-04:30) Caracas\",\r\n  \"(UTC-04:00) Santiago\",\r\n  \"(UTC-03:30) Newfoundland\",\r\n  \"(UTC-03:00) Brasilia\",\r\n  \"(UTC-02:00) Mid-Atlantic\",\r\n  \"(UTC-01:00) Azores\",\r\n  \"(UTC+00:00) UTC\",\r\n  \"(UTC+01:00) Amsterdam\",\r\n  \"(UTC+02:00) Athens\",\r\n  \"(UTC+03:00) Baghdad\",\r\n  \"(UTC+04:00) Abu Dhabi\",\r\n  \"(UTC+04:30) Kabul\",\r\n  \"(UTC+05:00) Islamabad\",\r\n  \"(UTC+05:30) Chennai\",\r\n  \"(UTC+05:45) Kathmandu\",\r\n  \"(UTC+06:00) Almaty\",\r\n  \"(UTC+06:30) Rangoon\",\r\n  \"(UTC+07:00) Bangkok\",\r\n  \"(UTC+08:00) Beijing\",\r\n  \"(UTC+09:00) Irkutsk\",\r\n  \"(UTC+09:00) Seoul\",\r\n  \"(UTC+09:00) Tokyo\",\r\n  \"(UTC+09:30) Adelaide\",\r\n  \"(UTC+10:00) Guam\",\r\n  \"(UTC+11:00) Vladivostok\",\r\n  \"(UTC+12:00) Auckland\",\r\n  \"(UTC+13:00) Nuku'alofa\",\r\n];\r\nconst hours = [];\r\nconst days = [\r\n  \"Monday\",\r\n  \"Tuesday\",\r\n  \"Wednesday\",\r\n  \"Thursday\",\r\n  \"Friday\",\r\n  \"Saturday\",\r\n  \"Sunday\",\r\n];\r\nconst tbl_headers = [\"Day\", \"On\", \"From\", \"To\"];\r\nconst initialize = () => {\r\n  hours = [];\r\n  for (var i = 0; i < 2; i++)\r\n    for (var j = 0; j <= 12; j++)\r\n      for (var k = 0; k < 4; k++) {\r\n        i % 2 == 0\r\n          ? hours.push(`${j < 10 ? `0${j}` : j}:${k == 0 ? \"00\" : k * 15} AM`)\r\n          : hours.push(`${j < 10 ? `0${j}` : j}:${k == 0 ? \"00\" : k * 15} PM`);\r\n      }\r\n};\r\ninitialize();\r\n\r\nconst validate = () => {\r\n  var result = true;\r\n  for (var i = 0; i < 7; i++) {\r\n    if (!state._validate_error[i]) result = false;\r\n  }\r\n  State.update({ _validate_result: result });\r\n};\r\nconst getTime = (time) => {\r\n  const ap = time.split(\" \")[1];\r\n  const hour = parseInt(time.split(\":\")[0]);\r\n  const mins = parseInt(time.split(\":\")[1]) / 60;\r\n  const time_by_hours = ap == \"AM\" ? hour + mins : hour + 12 + mins;\r\n  return time_by_hours;\r\n};\r\nconst onTimeChanged = (value, index, is_from_to, in_de) => {\r\n  let temp = is_from_to ? state._from : state._to;\r\n  const i = hours.indexOf(value);\r\n  console.log(i, in_de);\r\n  if (i + in_de >= 0 && i + in_de < hours.length) {\r\n    temp[index] = hours[i + in_de];\r\n    is_from_to ? State.update({ _from: temp }) : State.update({ _to: temp });\r\n    let error_temp = state._validate_error;\r\n    if (getTime(state._from[index]) >= getTime(state._to[index])) {\r\n      error_temp[index] = false;\r\n    } else {\r\n      error_temp[index] = true;\r\n    }\r\n    validate();\r\n    State.update({\r\n      _validate_error: error_temp,\r\n    });\r\n  }\r\n};\r\nconst sortAndRemoveRepeated = (flag, data) => {\r\n  var temp = data;\r\n  if (flag) temp.push(0, 168);\r\n  var sortedTimeData = temp.sort((d2, d1) => d2 - d1);\r\n\r\n  var final = [];\r\n  for (var k = 0; k < sortedTimeData.length; k++) {\r\n    var repeated = false;\r\n    for (var l = 0; l < sortedTimeData.length; l++) {\r\n      if (k != l && sortedTimeData[k] == sortedTimeData[l]) {\r\n        repeated = true;\r\n      }\r\n    }\r\n    if (!repeated) final.push(sortedTimeData[k]);\r\n  }\r\n  return final;\r\n};\r\nconst getData = () => {\r\n  var zone = state._time_zone.split(\" \")[0].split(\"UTC\")[1].split(\":\");\r\n  var hours = parseInt(zone[0]);\r\n  var offset = hours + (parseInt(zone[1]) / 60) * ((hours > 0) * 2 - 1);\r\n  var temp = [];\r\n  var flag = false;\r\n  for (var i = 0; i < 7; i++) {\r\n    if (state._is_on[i] == \"on\") {\r\n      for (var j = 0; j < 2; j++) {\r\n        const time =\r\n          j == 0\r\n            ? getTime(state._from[i]) + 24 * i - offset\r\n            : getTime(state._to[i]) + 24 * i - offset;\r\n        if (time > 168) {\r\n          temp.push(time - 168);\r\n          flag = true;\r\n        } else if (time < 0) {\r\n          temp.push(time + 168);\r\n          flag = true;\r\n        } else temp.push(time);\r\n      }\r\n    }\r\n  }\r\n  const final = sortAndRemoveRepeated(flag, temp);\r\n  console.log(\"final\", final);\r\n  return {\r\n    index: {\r\n      Instance_time: JSON.stringify(\r\n        {\r\n          key: \"data\",\r\n          value: {\r\n            _data: final,\r\n          },\r\n        },\r\n        undefined,\r\n        0\r\n      ),\r\n    },\r\n  };\r\n};\r\nconst timeSelector = (f, index) => {\r\n  return (\r\n    <div style={table}>\r\n      <div className=\"d-flex\">\r\n        <select\r\n          style={comboBox}\r\n          value={f ? state._from[index] : state._to[index]}\r\n          disabled={state._is_on[index] == \"off\"}\r\n          onChange={(e) => {\r\n            onTimeChanged(e.target.value, index, f, 0);\r\n          }}\r\n        >\r\n          {hours.map((hour) => (\r\n            <option value={hour}>{hour}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n      <div style={flex_column}>\r\n        <div\r\n          onClick={() => {\r\n            const value = f ? state._from[index] : state._to[index];\r\n            onTimeChanged(value, index, f, 1);\r\n          }}\r\n        >\r\n          <i class=\"bi-caret-up\"></i>\r\n        </div>\r\n        <div\r\n          onClick={() => {\r\n            const value = f ? state._from[index] : state._to[index];\r\n            onTimeChanged(value, index, f, -1);\r\n          }}\r\n        >\r\n          <i class=\"bi-caret-down\"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nreturn (\r\n  <div>\r\n    <div style={flex_column} className=\"align-items-center\">\r\n      <div style={title}>Weekly Schedule</div>\r\n      <div style={container}>\r\n        <div style={flex_row} className=\"p-3\">\r\n          <div style={flex_row}>\r\n            <div style={table}>current_user:</div>\r\n            <div style={table}>\r\n              <div style={comboBoxTimezone}>{context.accountId}</div>\r\n            </div>\r\n          </div>\r\n          <div style={flex_row}>\r\n            <div style={table}>Select Time zone:</div>\r\n            <div style={table}>\r\n              <select\r\n                style={comboBoxTimezone}\r\n                name=\"zones\"\r\n                id=\"zones\"\r\n                value={state._time_zone}\r\n                onChange={(e) => {\r\n                  State.update({ _time_zone: e.target.value });\r\n                }}\r\n              >\r\n                {time_zones.map((zone) => (\r\n                  <option value={zone}>{zone}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div style={tbl_container}>\r\n          <div style={flex_column} className=\"mt-3\">\r\n            <div style={tbl_row}>\r\n              <div style={flex_row}>\r\n                {tbl_headers.map((header) => (\r\n                  <div style={table}>{header}</div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            {days.map((day, index) => (\r\n              <div style={tbl_row}>\r\n                <div style={flex_row}>\r\n                  <div style={table}>{day}</div>\r\n                  <div style={table}>\r\n                    <select\r\n                      style={comboBox}\r\n                      value={state._is_on[index]}\r\n                      onChange={(e) => {\r\n                        let temp = state._is_on;\r\n                        temp[index] = e.target.value;\r\n                        State.update({ _is_on: temp });\r\n                        if (e.target.value == \"off\") {\r\n                          state._from[index] = \"0\";\r\n                          state._to[index] = \"0\";\r\n                          let error_temp = state._validate_error;\r\n                          State.update({\r\n                            _error_msg: `${(error_temp[index] = true)}`,\r\n                          });\r\n                          validate();\r\n                        }\r\n                      }}\r\n                    >\r\n                      <option value=\"on\">on</option>\r\n                      <option value=\"off\">off</option>\r\n                    </select>\r\n                  </div>\r\n                  {timeSelector(true, index)}\r\n                  {timeSelector(false, index)}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div style={flex_row}>\r\n        {days.map((day, index) => {\r\n          return !state._validate_error[index] && `${day} `;\r\n        })}\r\n        {!state._validate_result && \"time set wrong\"}\r\n      </div>\r\n      <div style={flex_row}>\r\n        <CommitButton\r\n          className=\"m-2\"\r\n          style={button}\r\n          disabled={!state._validate_result}\r\n          data={getData()}\r\n        >\r\n          Send It!\r\n        </CommitButton>\r\n        <div style={button} className=\"m-2\">\r\n          <a\r\n            href={\r\n              \"https://near.social/#/vow_owner_123.near/widget/Instance_time\"\r\n            }\r\n          >\r\n            Back\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/vow_owner_123.near/widget/Instance_time_setting"}