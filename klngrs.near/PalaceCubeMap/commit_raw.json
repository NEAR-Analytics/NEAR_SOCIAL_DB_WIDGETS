{"tx_hash": "CQ7KtkSkyRMvDi4cpLKee6BtACAiFt8iHbMK6VmTPYie", "action_id_social": "GtftMkdydYR8NiP9s96HQE24KSXvD6AWhD3ux5H1LchY-0-widget", "block_id": 95167185, "block_timestamp": "2023-06-27T17:48:17.064Z", "signer_id": "klngrs.near", "widget_name": "PalaceCubeMap", "source_code": "const src = `\n<div id=\"container\" style=\"height:100%;\"></div>\n\n        <style>\n        body {\n            height:100%;\n        }\n        </style>\n\t\n\t\t<script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.6/iframeResizer.contentWindow.js\"></script>\n\n        <!-- Import maps polyfill -->\n\t\t<!-- Remove this when import maps will be widely supported -->\n        <script async src=\"https://ga.jspm.io/npm:es-module-shims@1.7.3/dist/es-module-shims.js\"></script>\n\n\t\t<script type=\"importmap\">\n\t\t\t{\n\t\t\t\t\"imports\": {\n\t\t\t\t\t\"three\": \"https://unpkg.com/three@0.153.0/build/three.module.js\",\n\t\t\t\t\t\"orbit-controls\": \"https://unpkg.com/three@0.153.0/examples/jsm/controls/OrbitControls.js\"\n\t\t\t\t}\n\t\t\t}\n\t\t</script>\n\t\n\n\t\t<script type=\"module\">\n\n\t\t\timport * as THREE from 'three';\n\t\t\timport { OrbitControls } from 'orbit-controls';\n\n\t\t\t// import OrbitControls from 'three-orbitcontrols';\n\n\t\t\t// import _THREE from 'three-orbitcontrols';\n\n\t\t\t// const OrbitControls = _THREE.OrbitControls;\n\n\t\t\tlet camera, controls;\n\t\t\tlet renderer;\n\t\t\tlet scene;\n\n\t\t\tinit();\n\t\t\tanimate();\n\n\t\t\tfunction init() {\n\n\t\t\t\tconst container = document.getElementById( 'container' );\n\n\t\t\t\trenderer = new THREE.WebGLRenderer();\n\t\t\t\trenderer.setPixelRatio( window.devicePixelRatio );\n\t\t\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\t\t\t\tcontainer.appendChild( renderer.domElement );\n\n\t\t\t\tscene = new THREE.Scene();\n\n\t\t\t\tcamera = new THREE.PerspectiveCamera( 90, window.innerWidth / window.innerHeight, 0.1, 100 );\n\t\t\t\tcamera.position.z = 0.01;\n\n\t\t\t\tcontrols = new OrbitControls( camera, renderer.domElement );\n\t\t\t\tcontrols.enableZoom = false;\n\t\t\t\tcontrols.enablePan = false;\n\t\t\t\tcontrols.enableDamping = true;\n\t\t\t\tcontrols.rotateSpeed = - 0.25;\n\n\t\t\t\tconst textures = getTexturesFromAtlasFile( 'https://raw.githubusercontent.com/klngrs/three.js/dev/examples/textures/cube/sun_temple_stripe.jpg', 6 );\n\n\t\t\t\tconst materials = [];\n\n\t\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\t\tmaterials.push( new THREE.MeshBasicMaterial( { map: textures[ i ] } ) );\n\n\t\t\t\t}\n\n\t\t\t\tconst skyBox = new THREE.Mesh( new THREE.BoxGeometry( 1, 1, 1 ), materials );\n\t\t\t\tskyBox.geometry.scale( 1, 1, - 1 );\n\t\t\t\tscene.add( skyBox );\n\n\t\t\t\twindow.addEventListener( 'resize', onWindowResize );\n\n\t\t\t}\n\n\t\t\tfunction getTexturesFromAtlasFile( atlasImgUrl, tilesNum ) {\n\n\t\t\t\tconst textures = [];\n\n\t\t\t\tfor ( let i = 0; i < tilesNum; i ++ ) {\n\n\t\t\t\t\ttextures[ i ] = new THREE.Texture();\n\n\t\t\t\t}\n\n\t\t\t\tnew THREE.ImageLoader()\n\t\t\t\t\t.load( atlasImgUrl, ( image ) => {\n\n\t\t\t\t\t\tlet canvas, context;\n\t\t\t\t\t\tconst tileWidth = image.height;\n\n\t\t\t\t\t\tfor ( let i = 0; i < textures.length; i ++ ) {\n\n\t\t\t\t\t\t\tcanvas = document.createElement( 'canvas' );\n\t\t\t\t\t\t\tcontext = canvas.getContext( '2d' );\n\t\t\t\t\t\t\tcanvas.height = tileWidth;\n\t\t\t\t\t\t\tcanvas.width = tileWidth;\n\t\t\t\t\t\t\tcontext.drawImage( image, tileWidth * i, 0, tileWidth, tileWidth, 0, 0, tileWidth, tileWidth );\n\t\t\t\t\t\t\ttextures[ i ].colorSpace = THREE.SRGBColorSpace;\n\t\t\t\t\t\t\ttextures[ i ].image = canvas;\n\t\t\t\t\t\t\ttextures[ i ].needsUpdate = true;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\treturn textures;\n\n\t\t\t}\n\n\t\t\tfunction onWindowResize() {\n\n\t\t\t\tconsole.log(window.innerWidth, window.innerHeight)\n\n\t\t\t\t// camera.aspect = window.innerWidth / window.innerHeight;\n\t\t\t\t// camera.updateProjectionMatrix();\n\n\t\t\t\t// renderer.setSize( window.innerWidth, window.innerHeight );\n\n\t\t\t}\n\n\t\t\tfunction animate() {\n\n\t\t\t\trequestAnimationFrame( animate );\n\n\t\t\t\tcontrols.update(); // required when damping is enabled\n\n\t\t\t\trenderer.render( scene, camera );\n\n\t\t\t}\n\n\t\t</script>\n\n\n`;\n\nreturn (\n  <div className=\"w-100 h-100\">\n    <iframe\n      iframeResizer={{\n        onResized: ({ width, height }) => {\n          console.log(\"iframe resized\", width, height);\n        },\n      }}\n      onLoad={() => console.log(\"iframe loaded\")}\n      className=\"position-absolute w-100 h-100\"\n      srcDoc={src}\n    />\n  </div>\n);\n", "metadata": null, "branch": {"draft": null}, "widget_modules_used": null, "widget_url": "https://near.social/#/klngrs.near/widget/PalaceCubeMap", "__row_index": 0}