{"tx_hash": "AhzPLDM678cdGAXKH89xRvbXWwLpkxftUo8zxRwvFN58", "action_id_social": "FFB88auaP9Qu5RvkorFsmyNtCMRti8dr5MNTxW57KR7Q-0-widget", "block_id": 90559556, "block_timestamp": "2023-04-27 15:58:13.839", "signer_id": "dataplatform.near", "widget_name": "widgets.NearQueryApi", "source_code": "let index = state.index ?? Storage.get(\"index\");\n\nconst SmallTitle = styled.h3`\n  color: #687076;\n  font-weight: 600;\n  font-size: 24px;\n  line-height: 15px;\n  margin-top: 10px;\n  text-transform: uppercase;\n\n  @media (max-width: 770px) {\n    margin-bottom: 16px;\n  }\n`;\n\nconst SmallText = styled.h3`\n  color: #687076;\n  font-weight: 400;\n  font-size: 18px;\n  line-height: 15px;\n  margin-top: 10px;\n\n  @media (max-width: 770px) {\n    margin-bottom: 16px;\n  }\n`;\n\nconst TextLink = styled.a`\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  color: #0091FF;\n  font-weight: 600;\n  font-size: 12px;\n  line-height: 15px;\n`;\nState.init({ signedUp: false });\n\nif (index !== null) {\n  index = index || [];\n\n  const lastBlockHeight = index[0].blockHeight || 0;\n\n  const newIndex = Social.index(\"queryAPIWaitlist\", \"query-api-waitlist\", {\n    order: \"asc\",\n    from: lastBlockHeight + 1,\n    limit: 10,\n    subscribe: true,\n  });\n\n  if (newIndex !== null && newIndex.length > 0) {\n    index = [...newIndex.reverse(), ...index];\n    Storage.set(\"index\", index);\n  }\n\n  if ((state.index.length || 0) < (index.length || 0)) {\n    State.update({\n      index,\n    });\n  }\n}\n\nconst waitlist = index;\nconsole.log(waitlist, \"waitlist\");\nconst dedupedList = waitlist.filter(\n  (obj, index, arr) =>\n    index === arr.findIndex((o) => o.accountId === obj.accountId)\n);\nconsole.log(dedupedList, \"deduped waitlist\");\nconst unique = {};\n\nif (waitlist) {\n  waitlist.forEach(({ accountId, value }) => {\n    if (accountId === context.accountId) {\n      State.update({\n        signedUp: true,\n      });\n    }\n    const key = accountId;\n    if (key in unique) {\n      return;\n    }\n    unique[key] = true;\n  });\n}\n\nfunction renderRecentWaitlist(accountIds) {\n  return (\n    <div className=\"d-flex flex-wrap gap-3\">\n      {accountIds &&\n        accountIds.map((accountId, i) => {\n          return (\n            <div className=\"position-relative\" key={i}>\n              <a\n                href={`#/mob.near/widget/ProfilePage?accountId=${accountId}`}\n                className=\"text-decoration-none\"\n              >\n                <Widget\n                  src=\"mob.near/widget/ProfileImage\"\n                  props={{\n                    accountId,\n                    className: \"d-inline-block overflow-hidden\",\n                  }}\n                />\n              </a>\n            </div>\n          );\n        })}\n    </div>\n  );\n}\n\nreturn (\n  <div>\n    <div className=\"mb-4\">\n      <SmallTitle>Near Query API</SmallTitle>\n\n      <SmallText>\n        Seamlessly create, manage, and discover indexers. Coming soon Near you.\n      </SmallText>\n    </div>\n    {state.signedUp === false ? (\n      <div className=\"mb-4\">\n        <CommitButton\n          className=\"btn btn-lg btn-success\"\n          onCommit={() => {\n            State.update({\n              signedUp: true,\n            });\n          }}\n          onCancel={() => {\n            State.update({\n              signedUp: false,\n            });\n          }}\n          data={() => ({\n            index: {\n              queryAPIWaitlist: JSON.stringify({\n                key: \"query-api-waitlist\",\n                value: Date.now(),\n              }),\n            },\n          })}\n        >\n          Get me on the waitlist \ud83d\ude4b\u200d\u2642\ufe0f\n        </CommitButton>\n      </div>\n    ) : (\n      <div className=\"mb-4\">\n        <h4>You are already on the waitlist. Hang tight :)</h4>\n        <TextLink\n          style={{ \"font-size\": \"16px\" }}\n          href=\"https://tnobfjyc9vs.typeform.com/to/UCRjFqJe\"\n          target=\"_blank\"\n        >\n          Let us know your indexing needs here!{\" \"}\n          <i className=\"bi bi-box-arrow-up-right\"></i>\n        </TextLink>\n      </div>\n    )}\n\n    <div className=\"mb-4\">\n      <h4>Recently signed up... </h4>\n      <div>\n        {dedupedList &&\n          renderRecentWaitlist(\n            dedupedList.slice(0, 10).map((a) => a.accountId)\n          )}\n      </div>\n    </div>\n  </div>\n);\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dataplatform.near/widget/widgets.NearQueryApi", "metadata.description": "Seamlessly create, manage, and discover indexers", "metadata.image.ipfs_cid": "bafkreihx3wowmjrv3taztqxwgubt6mijaqwzvo6573wi6lv4omxfh3ogdm", "metadata.name": "Near Query API waitlist", "metadata.tags.data-platform": "", "metadata.tags.indexers": ""}