{"tx_hash": "2bonQvVEhZ3zivxEzeinpFu9jFQz39WeCPMohvAByfaq", "action_id_social": "AaAFYNk6nQn85pScMyzfSTVLgHpCExmXuYTFW7WF4XR5-0-widget", "block_id": 90417258, "block_timestamp": "2023-04-25 18:48:38.682", "signer_id": "ae40cb52839f896de8ec2313e5d7ef5f3b05b9ebc474329fa3456eec32126055", "widget_name": "NestedDiscussions.Preview", "source_code": "const accountId = props.accountId;\nconst blockHeight = parseInt(props.blockHeight);\nconst parentComponent = props.parentComponent;\nconst parentParams = { ...props.parentParams };\nconst highlightComment = props.highlightComment;\nconst moderatorAccount = props.moderatorAccount || \"bosmod.near\";\n\nconst { content } = JSON.parse(\n  Social.get(`${accountId}/discuss/main`, blockHeight)\n);\n\nState.init({ hasBeenFlagged: false });\n\nconst notificationParams = {\n  ...parentParams,\n  highlightComment: content.commentId,\n};\n\n// URL to share\nvar postUrl = `https://near.org/#/${parentComponent}?`;\npostUrl += Object.entries(notificationParams)\n  .map(([k, v]) => `${k}=${v}`)\n  .join(\"&\");\n\n// all children comments will be identified by this object\nconst indexKey = {\n  accountId,\n  blockHeight,\n};\n\nconst Post = styled.div`\n  position: relative;\n  ${\n    content.commentId == highlightComment\n      ? \"border-left: 4px solid aqua; padding-left: 1rem;\"\n      : \"\"\n  }\n\n  &::before {\n    content: \"\";\n    display: block;\n    position: absolute;\n    left: 19px;\n    top: 52px;\n    bottom: 12px;\n    width: 2px;\n    background: #eceef0;\n  }\n`;\n\nconst Header = styled.div`\n  margin-bottom: 0;\n  display: inline-flex;\n`;\n\nconst Body = styled.div`\n  padding-left: 52px;\n  padding-bottom: 1px;\n`;\n\nconst Content = styled.div`\n  img {\n    display: block;\n    max-width: 100%;\n    max-height: 80vh;\n    margin: 0 0 12px;\n  }\n`;\n\nconst Text = styled.p`\n  display: block;\n  margin: 0;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 400;\n  color: #687076;\n  white-space: nowrap;\n`;\n\nconst Actions = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin: -6px -6px 6px;\n`;\n\nconst Comments = styled.div`\n  > div > div:first-child {\n    padding-top: 12px;\n  }\n`;\n\nif (state.hasBeenFlagged) {\n  return (\n    <div className=\"alert alert-secondary\">\n      <i className=\"bi bi-flag\" /> This content has been flagged for moderation\n    </div>\n  );\n}\n\nwindow.location.href = \"#highlight\";\n\nreturn (\n  <Post id={content.commentId == highlightComment ? \"highlight\" : \"\"}>\n    <Header>\n      <Widget\n        src=\"calebjacob.near/widget/AccountProfile\"\n        props={{\n          accountId,\n          hideAccountId: true,\n          inlineContent: (\n            <>\n              <Text as=\"span\">\uff65</Text>\n              <Text>\n                <Widget src=\"mob.near/widget/TimeAgo\" props={{ blockHeight }} />{\" \"}\n                ago\n              </Text>\n            </>\n          ),\n        }}\n      />\n    </Header>\n    <Body>\n      <Content>\n        {content.text && (\n          <Widget\n            src=\"calebjacob.near/widget/SocialMarkdown\"\n            props={{ text: content.text }}\n          />\n        )}\n\n        {content.image && (\n          <Widget\n            src=\"mob.near/widget/Image\"\n            props={{\n              image: content.image,\n            }}\n          />\n        )}\n      </Content>\n\n      {blockHeight !== \"now\" && (\n        <Actions>\n          <Widget\n            src=\"ae40cb52839f896de8ec2313e5d7ef5f3b05b9ebc474329fa3456eec32126055/widget/NestedDiscussions.Preview.LikeButton\"\n            props={{\n              item: content.commentId,\n              notificationComponent: parentComponent,\n              notificationParams,\n              notifyAccountId: accountId,\n            }}\n          />\n          <Widget\n            src=\"ae40cb52839f896de8ec2313e5d7ef5f3b05b9ebc474329fa3456eec32126055/widget/NestedDiscussions.Preview.CommentButton\"\n            props={{\n              item: indexKey,\n              onClick: () => State.update({ showReply: !state.showReply }),\n            }}\n          />\n          <Widget\n            src=\"calebjacob.near/widget/CopyUrlButton\"\n            props={{\n              url: postUrl,\n            }}\n          />\n          <Widget\n            src=\"near/widget/FlagButton\"\n            props={{\n              item: {\n                type: \"social\",\n                path: `${accountId}/discuss`,\n                blockHeight,\n              },\n              onFlag: () => {\n                State.update({ hasBeenFlagged: true });\n              },\n            }}\n          />\n        </Actions>\n      )}\n\n      {state.showReply && (\n        <div className=\"mb-2\">\n          <Widget\n            src=\"ae40cb52839f896de8ec2313e5d7ef5f3b05b9ebc474329fa3456eec32126055/widget/NestedDiscussions.Compose\"\n            props={{\n              indexKey,\n              notifyAccountId: accountId,\n              notificationWidget: parentComponent,\n              notificationParams,\n              onComment: () => State.update({ showReply: false }),\n            }}\n          />\n        </div>\n      )}\n\n      <Comments>\n        <Widget\n          src=\"ae40cb52839f896de8ec2313e5d7ef5f3b05b9ebc474329fa3456eec32126055/widget/NestedDiscussions.Feed\"\n          props={{\n            indexKey,\n            moderatorAccount,\n            parentComponent,\n            parentParams,\n            highlightComment,\n          }}\n        />\n      </Comments>\n    </Body>\n  </Post>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ae40cb52839f896de8ec2313e5d7ef5f3b05b9ebc474329fa3456eec32126055/widget/NestedDiscussions.Preview"}