{"tx_hash": "8stMC3ZCJxC8XuaMvBnp4oKbocn5UPYaFPFZtNg7XLko", "action_id_social": "29iB4MhyKu4QzZxu8qEgqJrYqUHrpy4DjewKwVe1VxgW-0-widget", "block_id": 84639018, "block_timestamp": "2023-02-06 16:45:41.626", "signer_id": "events_v2.near", "widget_name": "events___form", "source_code": "const onSave = props.onSave;\nif (onSave === undefined || onSave === null) {\n  return 'props.onSave is required';\n}\n\nconst model = props.model;\nconst buttonText = props.buttonText || 'Save';\n\nconst MIN_LENGTH_NAME = 4;\nconst MIN_LENGTH_DESCRIPTION = 10;\nconst MAX_LENGTH_NAME = 100;\nconst MAX_LENGTH_DESCRIPTION = 2000;\n\nconst MILLISECONDS_IN_DAY = 86400000;\nconst DAYS_IN_WEEK = 7;\n\nconst TODAY =\n  Math.floor((Date.now() + 0) / MILLISECONDS_IN_DAY) * MILLISECONDS_IN_DAY;\nconst TOMORROW = TODAY + MILLISECONDS_IN_DAY;\nconst ONE_WEEK = DAYS_IN_WEEK * MILLISECONDS_IN_DAY;\n\nconst formatDate = props.__engine.helpers.formatDate;\n\nconst EventStatus = [\n  { value: 'draft', label: 'Draft' },\n  { value: 'published', label: 'Published' },\n  { value: 'cancelled', label: 'Cancelled' },\n];\n\nconst EventTypes = [\n  { value: 'virtual', label: 'Online' },\n  { value: 'irl', label: 'In Person' },\n  { value: 'mixed', label: 'Both' },\n];\n\nconst DEFAULT_STATE = {\n  name: '',\n  type: EventTypes[0].value,\n  category: '',\n  status: EventStatus[0].value,\n  start_date: new Date(TODAY + ONE_WEEK),\n  end_date: new Date(TOMORROW + ONE_WEEK),\n  location: '',\n  images: [\n    {\n      url: null,\n      type: 'tile',\n    },\n    {\n      url: null,\n      type: 'banner',\n    },\n  ],\n  links: [\n    {\n      text: 'Register here',\n      url: '',\n      type: 'register',\n    },\n    {\n      text: 'Get tickets',\n      url: '',\n      type: 'tickets',\n    },\n    {\n      text: 'Watch live',\n      url: '',\n      type: 'join_stream',\n    },\n  ],\n  description: '',\n\n  errors: {},\n};\n\nif (!state) {\n  if (model) {\n    const start_date = model.start_date\n      ? formatDate(model.start_date, '{{ YYYY }}-{{ MM }}-{{ DD }}')\n      : null;\n\n    const end_date = model.end_date\n      ? formatDate(model.end_date, '{{ YYYY }}-{{ MM }}-{{ DD }}')\n      : null;\n\n    State.init({\n      ...model,\n      images: model.images || DEFAULT_STATE.images,\n      links: model.links || DEFAULT_STATE.links,\n      start_date,\n      end_date,\n    });\n  } else {\n    State.init(DEFAULT_STATE);\n  }\n  return 'Loading...';\n}\n\nconst Label = styled.label`\n  width: 100%;\n  color: #666;\n  padding: 0.5rem 0;\n  margin: 0.5rem 0 0 0;\n  box-sizing: border-box;\n`;\n\nconst ValidationError = props.__engine.Components.ValidationError;\nconst FullActionButton = props.__engine.Components.FullActionButton;\n\nfunction addError(key, message) {\n  const oldErrors = { ...state.errors };\n  const oldKeyErrors = oldErrors[key] || [];\n\n  const newKeyErrors = oldKeyErrors.includes(message)\n    ? oldKeyErrors\n    : [...oldKeyErrors, message];\n  const newErrors = { ...oldErrors, [key]: newKeyErrors };\n\n  State.update({\n    errors: newErrors,\n  });\n}\n\nfunction clearErrors() {\n  State.update({ errors: {} });\n}\n\nfunction getErrors(key) {\n  const errors = state.errors[key];\n  const hasErrors = errors && errors.length > 0;\n  if (hasErrors && errors.length === 1) {\n    return errors[0];\n  }\n\n  if (!hasErrors) {\n    return null;\n  }\n\n  return (\n    <ul>\n      {errors.map((message, index) => (\n        <li key={index}>{message}</li>\n      ))}\n    </ul>\n  );\n}\n\nfunction assertCondition(valid, condition, key, message) {\n  if (!condition) {\n    addError(key, message);\n    return false;\n  }\n  return valid;\n}\n\nfunction sanitize(data) {\n  const { name, description } = data;\n  return {\n    name,\n    description,\n  };\n}\n\nfunction validate(data) {\n  let valid = true;\n\n  const { name, description } = data;\n\n  clearErrors();\n\n  valid = assertCondition(\n    valid,\n    name.length >= MIN_LENGTH_NAME && name.length < MAX_LENGTH_NAME,\n    'name',\n    `Name must be between ${MIN_LENGTH_NAME} and ${MAX_LENGTH_NAME} characters long. Currently: ${name.length} characters.`\n  );\n\n  valid = assertCondition(\n    valid,\n    description.length >= MIN_LENGTH_DESCRIPTION &&\n      description.length < MAX_LENGTH_DESCRIPTION,\n    'description',\n    `Description must be between ${MIN_LENGTH_DESCRIPTION} and ${MAX_LENGTH_DESCRIPTION} characters long. Currently: ${description.length} characters.`\n  );\n\n  return valid;\n}\n\nfunction sanitizeValidateAndCall(data) {\n  const sanitized = sanitize(data);\n  const valid = validate(sanitized);\n  if (valid && onSave) {\n    onSave(sanitized);\n  }\n}\n\nfunction sanitizeAndValidate(data) {\n  const sanitized = sanitize(data);\n  return validate(sanitized);\n}\n\nconst updateState = (event, key) => {\n  State.update({ [key]: event.target.value });\n  sanitizeAndValidate({ ...state, [key]: event.target.value });\n};\n\nreturn (\n  <div\n    style={{\n      width: '100%',\n      padding: '1rem',\n    }}\n  >\n    <div className=\"mt-3\">\n      <Label>Name</Label>\n      <input\n        type=\"text\"\n        placeholder=\"Event Name\"\n        value={state.name || ''}\n        onChange={(event) => {\n          updateState(event, 'name');\n        }}\n      />\n    </div>\n    <ValidationError>{getErrors('name')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <Label>Description</Label>\n      <textarea\n        className=\"w-100\"\n        placeholder=\"Event Description\"\n        value={state.description}\n        onChange={(event) => {\n          updateState(event, 'description');\n        }}\n        rows={3}\n      />\n    </div>\n    <ValidationError>{getErrors('description')}</ValidationError>\n\n    <br />\n    <FullActionButton\n      className=\"mt-3\"\n      onClick={() => {\n        sanitizeValidateAndCall(state);\n      }}\n    >\n      {buttonText}\n    </FullActionButton>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/events_v2.near/widget/events___form"}