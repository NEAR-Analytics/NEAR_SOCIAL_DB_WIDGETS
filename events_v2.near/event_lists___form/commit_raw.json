{"tx_hash": "MUvWdxKTcrEcnAWDRyQVUaLPaXAEG5EkCAaqgAdGLkV", "action_id_social": "2mbLV5nHP4A6e1RaXrakX4oDvHdWHCH65FDYN8wSHWbA-0-widget", "block_id": 84639850, "block_timestamp": "2023-02-06 17:02:45.924", "signer_id": "events_v2.near", "widget_name": "event_lists___form", "source_code": "const onSave = props.onSave;\nif (onSave === undefined || onSave === null) {\n  return 'props.onSave is required';\n}\n\nconst model = props.model;\nconst buttonText = props.buttonText || 'Save';\n\nconst MIN_LENGTH_NAME = 4;\nconst MIN_LENGTH_DESCRIPTION = 10;\nconst MAX_LENGTH_NAME = 100;\nconst MAX_LENGTH_DESCRIPTION = 2000;\n\nconst DEFAULT_STATE = {\n  name: '',\n  description: '',\n\n  errors: {},\n};\n\nif (!state) {\n  if (model) {\n    State.init({\n      ...model,\n    });\n  } else {\n    State.init(DEFAULT_STATE);\n  }\n  return 'Loading...';\n}\n\nconst ValidationError = props.__engine.Components.ValidationError;\nconst FullActionButton = props.__engine.Components.FullActionButton;\nconst FormLabel = props.__engine.Components.FormLabel;\n\nfunction addError(key, message) {\n  const oldErrors = { ...state.errors };\n  const oldKeyErrors = oldErrors[key] || [];\n\n  const newKeyErrors = oldKeyErrors.includes(message)\n    ? oldKeyErrors\n    : [...oldKeyErrors, message];\n  const newErrors = { ...oldErrors, [key]: newKeyErrors };\n\n  State.update({\n    errors: newErrors,\n  });\n}\n\nfunction clearErrors() {\n  State.update({ errors: {} });\n}\n\nfunction getErrors(key) {\n  const errors = state.errors[key];\n  const hasErrors = errors && errors.length > 0;\n  if (hasErrors && errors.length === 1) {\n    return errors[0];\n  }\n\n  if (!hasErrors) {\n    return null;\n  }\n\n  return (\n    <ul>\n      {errors.map((message, index) => (\n        <li key={index}>{message}</li>\n      ))}\n    </ul>\n  );\n}\n\nfunction assertCondition(valid, condition, key, message) {\n  if (!condition) {\n    addError(key, message);\n    return false;\n  }\n  return valid;\n}\n\nfunction sanitize(data) {\n  const { name, description } = data;\n  return {\n    name,\n    description,\n  };\n}\n\nfunction validate(data) {\n  let valid = true;\n\n  const { name, description } = data;\n\n  clearErrors();\n\n  valid = assertCondition(\n    valid,\n    name.length >= MIN_LENGTH_NAME && name.length < MAX_LENGTH_NAME,\n    'name',\n    `Name must be between ${MIN_LENGTH_NAME} and ${MAX_LENGTH_NAME} characters long. Currently: ${name.length} characters.`\n  );\n\n  valid = assertCondition(\n    valid,\n    description.length >= MIN_LENGTH_DESCRIPTION &&\n      description.length < MAX_LENGTH_DESCRIPTION,\n    'description',\n    `Description must be between ${MIN_LENGTH_DESCRIPTION} and ${MAX_LENGTH_DESCRIPTION} characters long. Currently: ${description.length} characters.`\n  );\n\n  return valid;\n}\n\nfunction sanitizeValidateAndCall(data) {\n  const sanitized = sanitize(data);\n  const valid = validate(sanitized);\n  if (valid && onSave) {\n    onSave(sanitized);\n  }\n}\n\nfunction sanitizeAndValidate(data) {\n  const sanitized = sanitize(data);\n  return validate(sanitized);\n}\n\nconst updateState = (event, key) => {\n  State.update({ [key]: event.target.value });\n  sanitizeAndValidate({ ...state, [key]: event.target.value });\n};\n\nreturn (\n  <div\n    style={{\n      width: '100%',\n      padding: '1rem',\n    }}\n  >\n    <div className=\"mt-3\">\n      <FormLabel>Name</FormLabel>\n      <input\n        type=\"text\"\n        placeholder=\"Event Name\"\n        value={state.name || ''}\n        onChange={(event) => {\n          updateState(event, 'name');\n        }}\n      />\n    </div>\n    <ValidationError>{getErrors('name')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Description</FormLabel>\n      <textarea\n        className=\"w-100\"\n        placeholder=\"Event Description\"\n        value={state.description}\n        onChange={(event) => {\n          updateState(event, 'description');\n        }}\n        rows={3}\n      />\n    </div>\n    <ValidationError>{getErrors('description')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Type</FormLabel>\n      <Select\n        value={state.type}\n        onChange={(event) => {\n          updateState(event, 'type');\n        }}\n      >\n        {EventTypes.map((type) => (\n          <option key={type.value} value={type.value}>\n            {type.label}\n          </option>\n        ))}\n      </Select>\n    </div>\n    <ValidationError>{getErrors('type')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Category</FormLabel>\n      <input\n        type=\"text\"\n        placeholder=\"Event Category\"\n        value={state.category}\n        onChange={(event) => {\n          updateState(event, 'category');\n        }}\n      />\n    </div>\n    <ValidationError>{getErrors('category')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Status</FormLabel>\n      <Select\n        value={state.status}\n        onChange={(event) => {\n          updateState(event, 'status');\n        }}\n      >\n        {EventStatus.map((status) => (\n          <option key={status.value} value={status.value}>\n            {status.label}\n          </option>\n        ))}\n      </Select>\n    </div>\n    <ValidationError>{getErrors('status')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Start Date</FormLabel>\n      <input\n        type=\"date\"\n        value={state.start_date}\n        onChange={(event) => {\n          updateState(event, 'start_date');\n        }}\n      />\n    </div>\n    <ValidationError>{getErrors('start_date')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>End Date</FormLabel>\n      <input\n        type=\"date\"\n        value={state.end_date}\n        onChange={(event) => {\n          updateState(event, 'end_date');\n        }}\n      />\n    </div>\n    <ValidationError>{getErrors('end_date')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Location</FormLabel>\n      <textarea\n        className=\"w-100\"\n        placeholder=\"Event Location\"\n        value={state.location}\n        onChange={(event) => {\n          updateState(event, 'location');\n        }}\n        rows={3}\n      />\n    </div>\n    <ValidationError>{getErrors('location')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Images</FormLabel>\n\n      {state.images.map((image, index) => (\n        <div key={index} className=\"mb-4 d-flex\">\n          {props.__engine.renderComponent('_form.image_component', {\n            image: image,\n            onChange: (changed) => {\n              state.images[index] = changed;\n              sanitizeAndValidate({ ...state, images: state.images });\n            },\n            onRemove: () => {\n              const images = [...state.images];\n              images.splice(index, 1);\n              State.update({ images });\n              sanitizeAndValidate({ ...state, images });\n            },\n          })}\n        </div>\n      ))}\n\n      <button\n        className=\"btn btn-secondary\"\n        onClick={() => {\n          const images = [...state.images];\n          images.push({ type: 'tile', image: '' });\n          State.update({ images });\n          sanitizeAndValidate({ ...state, images });\n        }}\n      >\n        Add Image\n      </button>\n    </div>\n    <ValidationError>{getErrors('images')}</ValidationError>\n\n    <div className=\"mt-3\">\n      <FormLabel>Links</FormLabel>\n      {state.links.map((link, index) => (\n        <div key={index} className=\"mb-4\">\n          <input\n            type=\"text\"\n            placeholder=\"Link URL\"\n            className=\"mb-2\"\n            style={{\n              width: '100%',\n              padding: '0.5rem',\n              border: '1px solid #ccc',\n              borderRadius: '4px',\n              boxSizing: 'border-box',\n            }}\n            value={link.url}\n            onChange={(event) => {\n              const links = [...state.links];\n              links[index].url = event.target.value;\n              State.update({ links });\n              sanitizeAndValidate({ ...state, links });\n            }}\n          />\n\n          <div>\n            <input\n              type=\"text\"\n              placeholder=\"Link Text\"\n              style={{\n                width: '200px',\n                display: 'inline-block',\n                boxSizing: 'border-box',\n              }}\n              value={link.text}\n              onChange={(event) => {\n                const links = [...state.links];\n                links[index].text = event.target.value;\n                State.update({ links });\n                sanitizeAndValidate({ ...state, links });\n              }}\n            />\n\n            <Select\n              className=\"ms-2\"\n              style={{ width: '100px' }}\n              value={link.type}\n              onChange={(event) => {\n                const links = [...state.links];\n                links[index].type = event.target.value;\n                State.update({ links });\n                sanitizeAndValidate({ ...state, links });\n              }}\n            >\n              {LinkTypes.map((type) => (\n                <option key={type.value} value={type.value}>\n                  {type.label}\n                </option>\n              ))}\n            </Select>\n\n            <button\n              className=\"ms-2 btn btn-danger\"\n              onClick={() => {\n                const links = [...state.links];\n                links.splice(index, 1);\n                State.update({ links });\n                sanitizeAndValidate({ ...state, links });\n              }}\n            >\n              Remove\n            </button>\n          </div>\n        </div>\n      ))}\n      <button\n        className=\"btn btn-secondary\"\n        onClick={() => {\n          const links = [...state.links];\n          links.push('');\n          State.update({ links });\n          sanitizeAndValidate({ ...state, links });\n        }}\n      >\n        Add Link\n      </button>\n    </div>\n    <ValidationError>{getErrors('links')}</ValidationError>\n\n    <br />\n    <FullActionButton\n      className=\"mt-3\"\n      onClick={() => {\n        sanitizeValidateAndCall(state);\n      }}\n    >\n      {buttonText}\n    </FullActionButton>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/events_v2.near/widget/event_lists___form"}