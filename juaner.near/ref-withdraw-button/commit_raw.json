{"tx_hash": "8wqLpm7HmcBwjvpaC1LUUz6Uo1Gar3bo5mikAmtzUMUa", "action_id_social": "4hy7DcAdiDD5cEfVaezmEC1KSiZmCDhdwLH7AnYTW8iw-0-widget", "block_id": 89849725, "block_timestamp": "2023-04-18 07:26:39.627", "signer_id": "juaner.near", "widget_name": "ref-withdraw-button", "source_code": "const Container = styled.div`\n  .greenButton{\n    display:flex;\n    align-items:center;\n    justify-content:center;\n    background: #00FFD1;\n    border-radius: 12px;\n    height:46px;\n    font-weight: 700;\n    font-size: 18px;\n    color:#000;\n    cursor:pointer;\n    width:100%;\n  }\n  .mt_25{\n    margin-top:25px;\n  }\n  .disabled{\n    opacity:0.3;\n    cursor: not-allowed;\n  }\n`;\nlet BURROW_CONTRACT = \"contract.main.burrow.near\";\nlet ORACLE_CONTRACT = \"priceoracle.near\";\nlet accountId = context.accountId;\nlet MAX_RATIO = 10_000;\nlet B = Big();\nB.DP = 60; // set precision to 60 decimals\nconst NO_STORAGE_DEPOSIT_CONTRACTS = [\"aurora\", \"meta-pool.near\"];\nconst toAPY = (v) => Math.round(v * 100) / 100;\nconst clone = (o) => JSON.parse(JSON.stringify(o));\nconst shrinkToken = (value, decimals) => {\n  return new Big(value).div(new Big(10).pow(decimals));\n};\nconst expandToken = (value, decimals) => {\n  return new Big(value).mul(new Big(10).pow(decimals));\n};\nconst formatToken = (v) => Math.floor(v * 10_000) / 10_000;\nconst {\n  selectedTokenId,\n  amount,\n  hasError,\n  account,\n  onLoad,\n  assets,\n  availableBalance,\n  storageToken,\n  isMax,\n} = props;\nfunction decimalMax(a, b) {\n  a = new B(a);\n  b = new B(b);\n  return a.gt(b) ? a : b;\n}\n\nfunction decimalMin(a, b) {\n  a = new B(a);\n  b = new B(b);\n  return a.lt(b) ? a : b;\n}\nconst handleWithdraw = () => {\n  if (!selectedTokenId || !amount || hasError || !account) return;\n  const asset = assets.find((a) => a.token_id === selectedTokenId);\n  const { token_id, metadata, config } = asset;\n  const decimals = metadata.decimals + config.extra_decimals;\n  const expandedAmount = expandToken(\n    isMax ? availableBalance : amount,\n    decimals\n  );\n  const accountSuppliedAsset = account.supplied.find(\n    (a) => a.token_id === selectedTokenId\n  );\n  const suppliedBalance = accountSuppliedAsset?.balance || 0;\n  const decreaseCollateralAmount = decimalMax(\n    expandedAmount.sub(suppliedBalance).toFixed(),\n    0\n  );\n  const withdrawAction = {\n    Withdraw: {\n      token_id,\n      max_amount: !isMax ? expandedAmount.toFixed() : undefined,\n    },\n  };\n  const transactions = [];\n  if (decreaseCollateralAmount.gt(0)) {\n    transactions.push({\n      contractName: ORACLE_CONTRACT,\n      methodName: \"oracle_call\",\n      gas: expandToken(100, 12),\n      deposit: new Big(\"1\").toFixed(),\n      args: {\n        receiver_id: BURROW_CONTRACT,\n        msg: JSON.stringify({\n          Execute: {\n            actions: [\n              {\n                DecreaseCollateral: {\n                  token_id,\n                  amount: decreaseCollateralAmount.toFixed(0),\n                },\n              },\n              withdrawAction,\n            ],\n          },\n        }),\n      },\n    });\n  } else {\n    transactions.push({\n      contractName: ORACLE_CONTRACT,\n      methodName: \"oracle_call\",\n      gas: expandToken(100, 12),\n      deposit: new Big(\"1\").toFixed(),\n      args: {\n        receiver_id: BURROW_CONTRACT,\n        msg: JSON.stringify({\n          Execute: { actions: [withdrawAction] },\n        }),\n      },\n    });\n  }\n  const isNEAR = token_id == \"wrap.near\";\n  if (isNEAR && expandedAmount.gt(10)) {\n    transactions.push({\n      contractName: token_id,\n      methodName: \"near_withdraw\",\n      args: { amount: expandedAmount.sub(10).toFixed(0) },\n    });\n  }\n  if (\n    !(storageToken && storageToken.total != \"0\") &&\n    !NO_STORAGE_DEPOSIT_CONTRACTS.includes(token_id)\n  ) {\n    transactions.unshift({\n      contractName: token_id,\n      methodName: \"storage_deposit\",\n      deposit: expandToken(0.25, 24).toFixed(),\n    });\n  }\n\n  Near.call(transactions);\n};\nreturn (\n  <Container>\n    <div\n      class={`greenButton mt_25 ${Number(amount) ? \"\" : \"disabled\"}`}\n      onClick={handleWithdraw}\n    >\n      Withdraw\n    </div>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/juaner.near/widget/ref-withdraw-button"}