{"tx_hash": "AAuD2puubD4KgfAMd9DR5BKerrG4EWwxMuwcz22Uvr56", "action_id_social": "CG6Za6JQ3fHETJDxE64YrSK6a37T2RUtaC2kutYx4y7Y-1-widget", "block_id": 89410522, "block_timestamp": "2023-04-12 12:14:29.229", "signer_id": "juaner.near", "widget_name": "ref-adjust-button", "source_code": "let BURROW_CONTRACT = \"contract.main.burrow.near\";\nlet ORACLE_CONTRACT = \"priceoracle.near\";\nlet accountId = context.accountId;\nlet MAX_RATIO = 10_000;\nlet B = Big();\nB.DP = 60; // set precision to 60 decimals\nconst NO_STORAGE_DEPOSIT_CONTRACTS = [\"aurora\", \"meta-pool.near\"];\nconst toAPY = (v) => Math.round(v * 100) / 100;\nconst clone = (o) => JSON.parse(JSON.stringify(o));\nconst shrinkToken = (value, decimals) => {\n  return new Big(value).div(new Big(10).pow(decimals));\n};\nconst expandToken = (value, decimals) => {\n  return new Big(value).mul(new Big(10).pow(decimals));\n};\nconst formatToken = (v) => Math.floor(v * 10_000) / 10_000;\nconst {\n  selectedTokenId,\n  amount,\n  hasError,\n  hasHFError,\n  account,\n  onLoad,\n  assets,\n  availableBalance,\n  storageToken,\n} = props;\nfunction decimalMax(a, b) {\n  a = new B(a);\n  b = new B(b);\n  return a.gt(b) ? a : b;\n}\n\nfunction decimalMin(a, b) {\n  a = new B(a);\n  b = new B(b);\n  return a.lt(b) ? a : b;\n}\nconst handleAdjust = () => {\n  if (!selectedTokenId || !amount || hasError || !account) return;\n  const asset = assets.find((a) => a.token_id === selectedTokenId);\n  const { token_id, metadata, config } = asset;\n  if (Number(amount) > Number(availableBalance)) {\n    onLoad({ hasError: true });\n    return;\n  }\n  const decimals = metadata.decimals + config.extra_decimals;\n  const expandedAmount = expandToken(amount, decimals);\n  const accountSuppliedAsset = account.supplied.find(\n    (a) => a.token_id === token_id\n  );\n  const accountCollateralAsset = account.collateral.find(\n    (a) => a.token_id === token_id\n  );\n  const suppliedBalance = accountSuppliedAsset?.balance || 0;\n  const collateralBalance = accountCollateralAsset?.balance || 0;\n  const transactions = [];\n  if (expandedAmount.gt(collateralBalance)) {\n    transactions.push({\n      contractName: BURROW_CONTRACT,\n      methodName: \"execute\",\n      gas: expandToken(100, 12),\n      deposit: new Big(\"1\").toFixed(),\n      args: {\n        actions: [\n          {\n            IncreaseCollateral: {\n              token_id,\n              max_amount: expandedAmount.sub(collateralBalance).toFixed(0),\n            },\n          },\n        ],\n      },\n    });\n  } else if (expandedAmount.lt(collateralBalance)) {\n    transactions.push({\n      contractName: ORACLE_CONTRACT,\n      methodName: \"oracle_call\",\n      gas: expandToken(100, 12),\n      deposit: new Big(\"1\").toFixed(),\n      args: {\n        receiver_id: BURROW_CONTRACT,\n        msg: JSON.stringify({\n          Execute: {\n            actions: [\n              {\n                DecreaseCollateral: {\n                  token_id,\n                  max_amount: collateralBalance.sub(expandedAmount).toFixed(0),\n                },\n              },\n            ],\n          },\n        }),\n      },\n    });\n  }\n  Near.call(transactions);\n};\nreturn (\n  <div\n    class={`greenButton mt_25 ${\n      Number(amount) && !hasHFError && !hasError ? \"\" : \"disabled\"\n    }`}\n    onClick={handleAdjust}\n  >\n    Adjust\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/juaner.near/widget/ref-adjust-button"}