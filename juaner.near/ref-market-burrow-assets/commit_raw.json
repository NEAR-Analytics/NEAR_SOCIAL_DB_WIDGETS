{"tx_hash": "3z8avocaJv2W4VZLPiACtgVudswMsDvV6d9DyqRENseD", "action_id_social": "6ksTP1trC3cuPTzqhSLdetaZgjUsh7WLSY5S5ozchBzH-0-widget", "block_id": 88949693, "block_timestamp": "2023-04-06 11:38:15.420", "signer_id": "juaner.near", "widget_name": "ref-market-burrow-assets", "source_code": "const Container = styled.div`\n   background: #1A2E33;\n    .table{\n        margin:0;\n    }\n    .noBorder{\n      border:none;\n    }\n    .table thead tr{\n        height:50px;\n        border:hidden;\n    }\n    .table tbody tr{\n        height:50px;\n    }\n    .table.click tbody tr{\n      cursor:pointer;\n    }\n     .table.click tbody tr:hover{\n        background: rgba(0, 0, 0, 0.1);\n     }\n    .table th{\n        color: #7E8A93;\n        font-size:14px;\n        vertical-align: middle;\n    }\n    .table td{\n        color: #fff;\n        font-size:14px;\n        vertical-align: middle;\n        border: none;\n    }\n    .tokenIcon{\n      width: 26px;\n      height: 26px;\n      border-radius:100px;\n      margin-right:8px;\n    }\n    .rewardIcon{\n      width: 16px;\n      height: 16px;\n      border-radius:100px;\n    }\n    .text_red_color{\n      color:#FF6BA9;\n    }\n    .ml_4_ne{\n        margin-left:-4px;\n    }\n    .flex_center{\n      display:flex;\n      align-items:center;\n    }\n    .mt_25{\n      margin-top:25px;\n    }\n    .mt-10{\n      margin-top:10px;\n    }\n    .font-18{\n      font-size:18px;\n    }\n`;\nconst Backdrop = styled.div`\n  height: 100vh;\n  width: 100vw;\n  background-color: rgba(0, 0, 0, 0.6);\n  position: fixed;\n  left: 0;\n  top: 0;\n  z-index: 1001;\n`;\n\nconst Modal = styled.div`\n  background-color:#1A2E33;\n  border-radius:12px;\n  position:fixed;\n  z-index:1002;\n  width:30rem;\n  max-width: 95vw;\n  max-height: 80vh;\n  padding:10px 0 20px 0;\n  animation:anishow 0.3s forwards ease-out;\n  left:50%;\n  top:50%;\n  transform:translate(-50%,-50%);\n  @keyframes anishow {\n    from {\n      opacity: 0;\n      transform:translate(-50%,-70%);\n    }\n    to {\n      opacity: 1;\n      transform:translate(-50%,-50%);\n    }\n  }\n    .modal-header{\n      display:flex;\n      align-items:center;\n      justify-content:center;\n      color:#fff;\n      font-weight: 700;\n      font-size: 18px;\n      padding:12px;\n      margin-bottom:16px;\n      border-bottom:2px solid rgba(48, 67, 82, 0.5);\n    } \n    .modal-header .btn-close{\n      position:absolute;\n      right:28px;\n      margin:0;\n    }\n    .modal-body {\n        padding:0 10px;\n    }\n    .modal-body .tab{\n      display:flex;\n      align-items:center;\n      justify-content:space-between;\n      margin-bottom:30px;\n    }\n    .modal-body .tab span{\n      display:flex;\n      align-items:center;\n      justify-content:center;\n      width:50%;\n      height:40px;\n      border-radius: 6px;\n      font-weight: 700;\n      font-size: 18px;\n      cursor:pointer;\n      color:#fff;\n    }\n    .modal-body .tab span.active{\n      background: #304352;\n    }\n   .btn-close-custom{\n      position:absolute;\n      right:28px;\n      width:12px;\n      height:12px;\n      cursor:pointer;\n    }\n`;\n/** base tool start  */\nconst wnearbase64 =\n  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAABmJLR0QA/wD/AP+gvaeTAAADvElEQVRYhbWYTUtjVxjH/9fRaFBaK3Q0ahCE3HTR0kWLL0g72nEh6NaAL+BivkIXHUpblWr9Ai78CIKgQqC1xYJNVnWwdiFCF9OS4CRRM2o7TRyw+XWRJk2uebuJ/uFC7jnP89xfzrnPOee5hmwIqJc0LOmxpA8keSW1SnpD0p+SLiT9JumZpF1Je4Zh3Nh5RiUQHcAKEMWeov/5td8FRBPwFZCwCWFVAvgCaKwWxAsc1ghh1RHwrl2QR8DlHYNk9BcwWinIMJC8J5CMEsDH5UDeAa7uGSSjC8DMfb6RA9Ik6WdJ79ma09r0q6R+wzBeS1JdTsdnhUACgYA8Ho8cDofGx8d1fn5u62mrq6tyuVwyTVPBYNDa/b6kT/NaSK8jBdPX4/EgKXsNDQ1xfX1d0Tz4/f48X9M0C5n9DTzMhVkpFjA3WOaam5srCxKPx+ns7LzlW0TLGZB6IGIHRhIrK0X5AZiZmSnoV0RRoF7AaKmguYFmZ2ezv+vq6tja2iros7m5iSSamppYWlqqBAZgRMA3lcJEo1Gmpqay9y0tLRwe5i/SZ2dntLe309bWxt7eHuFwuFKYrwX8UClMLBYjkUjQ19eXbevp6SEa/X//9Pl89Pb2cnx8DGAH5jsBf9iBATg5OaGrqyvbPjg4SDKZJBQKMTo6yunpadbfBsxzkd4rbMEAHBwc0NzcnO3z+XykUqlb/jZgrgTcVAMDsLGxgWEY2f7l5eVaYG6qHpmM5ufns/2GYbC+vl4tzJWA32uBSaVSTE9PZ22cTif7+/vVwDwX8H01MJFIhJGRESKRyK0Mc7vdRCIRuzDf1il9eLalo6MjDQwMqLu7Wx0dHXI6ndre3pbb7ZYkhcNhTUxMKJFI2An7TMBjOyOzu7tLa2srLpeLeDyeZ2vNsMnJSUKhUKUjM2xrb1pYWMDhcCAJv99f0N6aYdY9qoheAA8k2d+1nzx5Uuofsri4WHSDLaKl7GQB7RQ5z1iDud1uLi9Ln9WtGVYG5hXwdt7bA3xZyNI0zbx1ZGdnpyRIRslkkv7+/jwQr9dbyPTprVcZaKRAnRQIBDBNE5fLxdraWkUgGcViMcbGxmhoaMDr9RIMBq0mB4CjYG6RLtzuq16y6iXgKZnspAu4WsvZckoAH5UEyQEaAM7vCeSCcgVcASAT+OWOQQ4oNzUlgBqBz0mXE7XoFfCUYi+rTaiHwDLpldKOXgBLWNeRIjLKm+RBPZD0SNInkj5U+svVW5LelHQl6aXSX672Jf0o6SfDMP6pNP6/QZPF1Du0/sIAAAAASUVORK5CYII=\";\nconst closeButtonBase64 =\n  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAERSURBVHgBtdjLDYMwEEXRUSqhY+gg0xElUAIlvOAAwkEEPJ93JVaM47OJsCyyBaBbnhFrvZAreyzPvDxT2fv8stte1L2FVPnt014H6g+GhrrA/KJuMOmoG8zeWIZmPBdGNWC+lcEBbblRrZhi2Rdo4wIzyoDR88J0lBvDQIUxmag0TAYqHRNB0TAeFNgYB4qPSUapZBZEqTByolSYGVEqxl5iD6RZe2j/a9dxTp5ODAcVxOSikjA5KANGQTzkmTHVGg4KgQ9lOgoJX+00FBKPEGEUCOcZNwrEw5UZhfUWgoJxoHppHFQJ1oiay+DIxhhQ09N1jEpyN6gJD3dEKqQuUAemGtpR5XpmEHI4bl3GGvMBHUHk6KgoFgEAAAAASUVORK5CYII=\";\nlet MAX_RATIO = 10_000;\nlet BURROW_CONTRACT = \"contract.main.burrow.near\";\nlet accountId = context.accountId;\nlet B = Big();\nB.DP = 60; // set precision to 60 decimals\n\nconst toAPY = (v) => Math.round(v * 100) / 100;\nconst clone = (o) => JSON.parse(JSON.stringify(o));\nconst shrinkToken = (value, decimals) => {\n  return B(value).div(B(10).pow(decimals));\n};\n\nconst expandToken = (value, decimals) => {\n  return B(value).mul(B(10).pow(decimals));\n};\n\nconst formatToken = (v) => Math.floor(v * 10_000) / 10_000;\n\nconst power = (x, y) => {\n  if (y === 0) {\n    return 1;\n  } else if (y % 2 === 0) {\n    return power(x, parseInt(y / 2)) * power(x, parseInt(y / 2));\n  } else {\n    return x * power(x, parseInt(y / 2)) * power(x, parseInt(y / 2));\n  }\n};\nconst nFormat = (num, digits) => {\n  const lookup = [\n    { value: 1, symbol: \"\" },\n    { value: 1e3, symbol: \"K\" },\n    { value: 1e6, symbol: \"M\" },\n  ];\n  const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\n  var item = lookup\n    .slice()\n    .reverse()\n    .find((item) => num >= item.value);\n  return item\n    ? (num / item.value).toFixed(digits).replace(rx, \"$1\") + item.symbol\n    : \"0\";\n};\nconst {\n  rewards,\n  account,\n  balances,\n  selectedTokenId,\n  amount,\n  hasError,\n  assets,\n  tabName,\n  showModal,\n} = state;\nconst hasData = assets.length > 0 && rewards.length > 0 && account;\n/** base tool end */\nif (!accountId) {\n  return <Widget src=\"juaner.near/widget/ref_account-signin\" />;\n}\nconst config = Near.view(BURROW_CONTRACT, \"get_config\");\nconst onLoad = (data) => {\n  State.update(data);\n};\nconst rewardsMap = rewards\n  ? rewards.reduce((acc, cur) => {\n      return {\n        ...acc,\n        [cur.token_id]: cur,\n      };\n    }, {})\n  : {};\nconst assetsMap = assets\n  ? assets.reduce((acc, cur) => {\n      return {\n        ...acc,\n        [cur.token_id]: cur,\n      };\n    }, {})\n  : {};\n// get market can burrow assets\nconst can_burrow_assets = assets && assets.filter((a) => a.config.can_borrow);\nconst market_burrow_assets =\n  can_burrow_assets &&\n  can_burrow_assets.map((asset) => {\n    const { token_id, metadata } = asset;\n    const r = rewards.find((a) => a.token_id === asset.token_id);\n    const borrowApy = r.apyBaseBorrow;\n    const liquidity = nFormat(asset.availableLiquidity, 2);\n    const hasRewards = rewardsMap[token_id] && assetsMap[token_id];\n    const rewardMap = hasRewards && rewardsMap[token_id];\n    const rewardTokens = rewardMap && rewardMap.rewardTokensBorrow;\n    const rewardTokensImg =\n      rewardTokens &&\n      rewardTokens.map((token_id, index) => {\n        const metadata = assetsMap[token_id].metadata;\n        return (\n          <img\n            class={`rewardIcon ${index > 0 ? \"ml_4_ne\" : \"\"}`}\n            src={metadata.icon}\n          ></img>\n        );\n      });\n    return (\n      <tr\n        onClick={() => {\n          handleSelect(token_id);\n        }}\n      >\n        <td>\n          <img src={metadata.icon || wnearbase64} class=\"tokenIcon\"></img>\n          {metadata.symbol}\n        </td>\n        <td>{toAPY(borrowApy)}%</td>\n        <td class=\"text-white\">\n          {rewardTokensImg.length == 0 ? \"-\" : rewardTokensImg}\n        </td>\n        <td class=\"text-end\">{liquidity}</td>\n      </tr>\n    );\n  });\nconst handleSelect = (token_id) => {\n  State.update({\n    selectedTokenId: token_id,\n    showModal: true,\n  });\n};\nfunction closeModal() {\n  State.update({\n    showModal: false,\n  });\n}\nfunction changeTab(tabName) {\n  State.update({\n    tabName,\n  });\n}\nconst selectedToken = (selectedTokenId && assetsMap[selectedTokenId]) || {};\nconst selectedTokenMeta = selectedToken.metadata || {};\nreturn (\n  <Container>\n    {/* load data */}\n    {!hasData && (\n      <Widget src=\"juaner.near/widget/ref_burrow-data\" props={{ onLoad }} />\n    )}\n    {/* market */}\n    <div class=\"fw-bold text-white mt-3 font-18\">\n      <span class=\"text_red_color\">Borrow</span> Market\n    </div>\n    <table class=\"table click noBorder\">\n      <thead>\n        <tr>\n          <th scope=\"col\" width=\"25%\">\n            Assets\n          </th>\n          <th scope=\"col\" class=\"text-start\" width=\"25%\">\n            APY\n          </th>\n          <th scope=\"col\" class=\"text-start\" width=\"25%\">\n            Rewards\n          </th>\n          <th scope=\"col\" class=\"text-end\">\n            Total Liquidity\n          </th>\n        </tr>\n      </thead>\n      <tbody>{market_burrow_assets}</tbody>\n    </table>\n    {/* Modal*/}\n    <>\n      <Modal style={{ display: showModal ? \"block\" : \"none\" }}>\n        <div class=\"modal-header\">\n          <div class=\"flex_center\">\n            <img\n              class=\"tokenIcon\"\n              src={selectedTokenMeta.icon || wnearbase64}\n            />\n            {selectedTokenMeta.symbol}\n          </div>\n          <img\n            class=\"btn-close-custom\"\n            src={closeButtonBase64}\n            onClick={closeModal}\n          />\n        </div>\n        <div class=\"modal-body\">\n          <div class=\"modal-body\">\n            <div class=\"tab\">\n              <span\n                onClick={() => {\n                  changeTab(\"borrow\");\n                }}\n                class={`${tabName != \"repay\" ? \"active\" : \"\"}`}\n              >\n                Borrow\n              </span>\n              <span\n                onClick={() => {\n                  changeTab(\"repay\");\n                }}\n                class={`${tabName == \"repay\" ? \"active\" : \"\"}`}\n              >\n                Repay\n              </span>\n            </div>\n            {tabName == \"repay\" ? (\n              <Widget\n                src=\"juaner.near/widget/ref-market-burrow-repay\"\n                props={{ selectedTokenId, selectedTokenMeta, showModal }}\n              />\n            ) : (\n              <Widget\n                src=\"juaner.near/widget/ref-market-burrow-burrow\"\n                props={{ selectedTokenId, showModal }}\n              />\n            )}\n          </div>\n        </div>\n      </Modal>\n      <Backdrop\n        style={{ display: showModal ? \"block\" : \"none\" }}\n        onClick={closeModal}\n      ></Backdrop>\n    </>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/juaner.near/widget/ref-market-burrow-assets"}