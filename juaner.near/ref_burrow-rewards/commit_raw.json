{"tx_hash": "7XfTogQYpH8pyhHTt76sGVyjrP1cwYxmCcr4TANLC2uE", "action_id_social": "FMrDmG6K68gZ4qLy783pHQpHJGT6pdQgA2sYkJzDdWpo-0-widget", "block_id": 88504093, "block_timestamp": "2023-03-31 12:06:25.571", "signer_id": "juaner.near", "widget_name": "ref_burrow-rewards", "source_code": "let accountId = context.accountId;\n\nif (!accountId) {\n  return <div />;\n}\n\nconst shrinkToken = (value, decimals, fixed) => {\n  return new Big(value).div(new Big(10).pow(decimals)).toFixed(fixed);\n};\n\nconst { assets, rewards, account } = state;\n\nconst hasData = assets.length > 0 && rewards.length > 0 && account;\n\nconst onLoad = (data) => {\n  State.update(data);\n};\n\nconst unclaimedRewardsMap = account\n  ? account.farms?.reduce((prev, curr) => {\n      for (const reward of curr.rewards) {\n        const t = prev[reward.reward_token_id];\n        if (t) {\n          prev[reward.reward_token_id] = Big(t)\n            .plus(Big(reward.unclaimed_amount))\n            .toFixed();\n        } else {\n          prev[reward.reward_token_id] = Big(reward.unclaimed_amount).toFixed();\n        }\n      }\n      return prev;\n    }, {})\n  : {};\n\nconst unclaimedRewards = Object.keys(unclaimedRewardsMap).map((id) => {\n  const asset = assets.find((a) => a.token_id === id);\n  const decimals = asset.metadata.decimals + asset.config.extra_decimals;\n  return {\n    id,\n    unclaimed: shrinkToken(unclaimedRewardsMap[id], decimals, 4),\n    symbol: asset.metadata.symbol,\n  };\n});\n\nconst handleClaimAll = () => {\n  Near.call({\n    contractName: \"contract.main.burrow.near\",\n    methodName: \"account_farm_claim_all\",\n  });\n};\n\nreturn (\n  <div>\n    {!hasData && (\n      <Widget src=\"juaner.near/widget/ref_burrow-data\" props={{ onLoad }} />\n    )}\n    <h6>Unclaimed rewards</h6>\n    <ul class=\"list p-0\">\n      {unclaimedRewards.map((reward) => (\n        <li class=\"list-inline-item align-middle\">\n          <span class=\"badge rounded-pill bg-light text-dark\">\n            {reward.unclaimed}\n          </span>\n          <span class=\"align-middle\">{reward.symbol}</span>\n        </li>\n      ))}\n    </ul>\n    <button type=\"button\" class=\"btn btn-light\" onClick={handleClaimAll}>\n      Claim all rewards\n    </button>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/juaner.near/widget/ref_burrow-rewards"}