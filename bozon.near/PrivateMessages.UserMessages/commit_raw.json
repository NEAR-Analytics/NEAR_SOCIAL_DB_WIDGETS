{"tx_hash": "2SbyQ6WxZKk5bNSbtpJqpmatEcq5avtQ3jMVCM6jf6k7", "action_id_social": "6v5mq7CwPpQXbZCsbPMuzpg6oPXb7XPfYwf4FP9Hk9fE-0-widget", "block_id": 82055862, "block_timestamp": "2023-01-02 21:12:52.310", "signer_id": "bozon.near", "widget_name": "PrivateMessages.UserMessages", "source_code": "if (\r\n  !props.accountId ||\r\n  !props.secretKey ||\r\n  !props.receiverPublicKeyBase64 ||\r\n  !props.onClose\r\n) {\r\n  return \"Send accountId, secretKey and onClose() in props\";\r\n}\r\n\r\nState.init({ message: \"\" });\r\n\r\nconst messages = Social.index(\"private_messages\", \"message\", {\r\n  subscribe: true,\r\n  limit: 50,\r\n  order: \"desc\",\r\n});\r\n\r\nconsole.log(messages);\r\n\r\nreturn (\r\n  <div>\r\n    <div class=\"d-flex flex-row align-items-center mb-3\">\r\n      <div class=\"col\">\r\n        <button class=\"btn btn-primary\" onClick={props.onClose}>\r\n          {\"<\"}\r\n        </button>\r\n      </div>\r\n      <h1 class=\"col\">Private Messages</h1>\r\n      <div class=\"col\"></div>\r\n    </div>\r\n\r\n    <div class=\"input-group mb-3\">\r\n      <input\r\n        class=\"form-control\"\r\n        placeholder=\"Input message\"\r\n        onChange={(e) => {\r\n          State.update({\r\n            message: e.target.value,\r\n          });\r\n        }}\r\n      ></input>\r\n      <CommitButton\r\n        data={() => {\r\n          const encryptedMessage = nacl.box(\r\n            new Uint8Array(state.message),\r\n            nacl.randomBytes(24),\r\n            [\r\n              Buffer.from(receiverPublicKeyBase64, \"base64\"),\r\n              nacl.box.keyPair.fromSecretKey(secretKey).publicKey,\r\n            ]\r\n          );\r\n\r\n          return {\r\n            // private_messages: {\r\n            //   message: encryptedMessage,\r\n            // },\r\n            index: {\r\n              private_messages: JSON.stringify({\r\n                key: \"message\",\r\n                value: {\r\n                  message: encryptedMessage,\r\n                },\r\n              }),\r\n            },\r\n          };\r\n        }}\r\n      >\r\n        Send\r\n      </CommitButton>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessages.UserMessages"}