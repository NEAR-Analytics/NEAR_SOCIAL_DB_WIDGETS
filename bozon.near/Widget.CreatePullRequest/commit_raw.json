{"tx_hash": "5QZDUF4QygXyWiwFQsTzKgBCcKEXnXy1F7S6QYNGD9PT", "action_id_social": "CR8bh5AUVGkLpKR6NDqwtJ5qESZ5vgWGzYVbgQLyukiB-0-widget", "block_id": 86493890, "block_timestamp": "2023-03-03 22:32:21.295", "signer_id": "bozon.near", "widget_name": "Widget.CreatePullRequest", "source_code": "/*\r\n\r\nwidgetPath: string,\r\nonClose(): function,\r\n\r\n*/\r\n\r\nconst widgetCode = Social.get(props.widgetPath);\r\n\r\nif (widgetCode === null) return \"loading...\";\r\n\r\nState.init({\r\n  title: \"\",\r\n  code: widgetCode,\r\n  memo: \"\",\r\n  tab: \"code\",\r\n  props: Storage.get(\"props\") || {},\r\n});\r\n\r\nconst [widgetAccountId, _, widgetName] = props.widgetPath.split(\"/\");\r\n\r\nfunction getDatastringFromBlockHeight(blockHeight) {\r\n  const block = Near.block(blockHeight);\r\n  const date = new Date(block.header.timestamp_nanosec / 1e6);\r\n  return date.toDateString() + \" \" + date.toLocaleTimeString();\r\n}\r\n\r\nconst Tabs = styled.div`\r\n  display: flex;\r\n  padding: 0 12px;\r\n  height: 48px;\r\n  border-bottom: 1px solid #ECEEF0;\r\n`;\r\n\r\nconst TabsButton = styled.button`\r\n  font-weight: 400;\r\n  font-size: 14px;\r\n  padding: 0 12px;\r\n  position: relative;\r\n  color: ${(p) => (p.selected ? \"#11181C\" : \"#687076\")};\r\n  background: none;\r\n  border: none;\r\n\r\n  &:hover {\r\n    color: #11181C;\r\n  }\r\n\r\n  &::after {\r\n    content: '';\r\n    display: ${(p) => (p.selected ? \"block\" : \"none\")};\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 12px;\r\n    right: 12px;\r\n    height: 3px;\r\n    background: #0091FF;\r\n  }\r\n`;\r\n\r\nreturn (\r\n  <div>\r\n    <div class=\"d-flex flex-row align-items-center mb-3\">\r\n      <div class=\"col\"></div>\r\n      <h4 class=\"col\">Create Pull Request</h4>\r\n      <div class=\"col d-flex justify-content-end\">\r\n        <button className=\"btn-close\" onClick={() => props.onClose()} />\r\n      </div>\r\n    </div>\r\n    <div className=\"col-lg-12  mb-2\">\r\n      Title\r\n      <input\r\n        type=\"text\"\r\n        onBlur={(e) => {\r\n          State.update({\r\n            title: e.target.value,\r\n          });\r\n        }}\r\n      />\r\n      Code:\r\n      <textarea\r\n        type=\"text\"\r\n        rows={6}\r\n        class=\"form-control\"\r\n        placeholder=\"code\"\r\n        defaultValue={widgetCode}\r\n        onBlur={(e) => {\r\n          State.update({\r\n            code: e.target.value,\r\n          });\r\n        }}\r\n      />\r\n      Memo:\r\n      <textarea\r\n        type=\"text\"\r\n        rows={2}\r\n        class=\"form-control\"\r\n        placeholder=\"memo\"\r\n        onBlur={(e) => {\r\n          State.update({\r\n            memo: e.target.value,\r\n          });\r\n        }}\r\n      />\r\n    </div>\r\n    <CommitButton\r\n      data={{\r\n        index: {\r\n          pull_request: JSON.stringify([\r\n            {\r\n              key: props.widgetAccountId,\r\n              value: {\r\n                title: state.title,\r\n              },\r\n            },\r\n          ]),\r\n        },\r\n        pull_request: {\r\n          title: state.title,\r\n          code: state.code,\r\n          memo: state.memo,\r\n        },\r\n      }}\r\n    >\r\n      {widgetCode ? \"Submit\" : \"Widget not found\"}\r\n    </CommitButton>\r\n    <hr />\r\n    <div>\r\n      <div className=\"border rounded-4 p-3 pb-1\">\r\n        <div className=\"d-flex flex-row justify-content-between\">\r\n          <div className=\"flex-grow-1 text-truncate\">\r\n            <a\r\n              className=\"text-dark text-decoration-none text-truncate\"\r\n              href={`#/mob.near/widget/ProfilePage?accountId=${accountId}`}\r\n            >\r\n              <Widget\r\n                src=\"mob.near/widget/Profile.ShortInlineBlock\"\r\n                props={{ accountId: context.accountId, tooltip: true }}\r\n              />\r\n            </a>\r\n          </div>\r\n          <div className=\"text-muted\">{getDatastringFromBlockHeight()}</div>\r\n        </div>\r\n\r\n        {state.title && <h3 className=\"m-3\">{state.title}</h3>}\r\n\r\n        {state.memo && <Markdown className=\"m-3\" text={state.memo} />}\r\n\r\n        <Tabs>\r\n          <TabsButton\r\n            onClick={() => State.update({ tab: \"code\" })}\r\n            selected={state.tab === \"code\"}\r\n          >\r\n            Code\r\n          </TabsButton>\r\n          <TabsButton\r\n            onClick={() => State.update({ tab: \"render\" })}\r\n            selected={state.tab === \"render\"}\r\n          >\r\n            Render\r\n          </TabsButton>\r\n        </Tabs>\r\n\r\n        <div\r\n          style={{\r\n            display: state.tab == \"code\" ? \"block\" : \"none\",\r\n          }}\r\n        >\r\n          <Widget\r\n            src={`bozon.near/widget/CodeDiff`}\r\n            props={{\r\n              currentCode: state.code,\r\n              prevCode: widgetCode,\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            display: state.tab == \"render\" ? \"block\" : \"none\",\r\n          }}\r\n          className=\"p-3\"\r\n        >\r\n          props:\r\n          <textarea\r\n            type=\"text\"\r\n            rows={2}\r\n            class=\"form-control\"\r\n            defaultValue={JSON.stringify(state.props)}\r\n            onBlur={(e) => {\r\n              try {\r\n                const provProps = JSON.parse(e.target.value);\r\n\r\n                Storage.set(\"props\", provProps);\r\n\r\n                State.update({\r\n                  props: provProps,\r\n                });\r\n              } catch {}\r\n            }}\r\n          />\r\n          <Widget code={state.code} props={state.props} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/Widget.CreatePullRequest"}