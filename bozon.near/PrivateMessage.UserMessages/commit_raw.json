{"tx_hash": "3bFnyDPW6rtk3XaxAVEPrhg9KmQVN6zvzYBhqrtuBNxQ", "action_id_social": "A25u1ggk62cCaRtAfrQJqsjNaEgJZVVJga6XLTnUavs-0-widget", "block_id": 82061188, "block_timestamp": "2023-01-02 22:52:48.613", "signer_id": "bozon.near", "widget_name": "PrivateMessage.UserMessages", "source_code": "const accountId = context.accountId;\r\n\r\nif (!accountId) {\r\n  return \"Please sign in with NEAR wallet\";\r\n}\r\n\r\nif (\r\n  !props.receiverAccountId ||\r\n  !props.secretKeyBase64 ||\r\n  !props.receiverPublicKeyBase64 ||\r\n  !props.onClose\r\n) {\r\n  return \"Send receiverAccountId, secretKeyBase64, receiverPublicKeyBase64 and onClose() in props\";\r\n}\r\n\r\nState.init({ message: \"\" });\r\n\r\nconst messages = Social.index(\"private_message\", accountId, {\r\n  subscribe: true,\r\n  order: \"desc\",\r\n});\r\n\r\nconsole.log(messages);\r\n\r\nreturn (\r\n  <div>\r\n    <div class=\"d-flex flex-row align-items-center mb-3\">\r\n      <div class=\"col\">\r\n        <button class=\"btn btn-primary\" onClick={props.onClose}>\r\n          {\"<\"}\r\n        </button>\r\n      </div>\r\n      <h1 class=\"col\">Private Messages</h1>\r\n      <div class=\"col\"></div>\r\n    </div>\r\n\r\n    <div class=\"input-group mb-3\">\r\n      <input\r\n        class=\"form-control\"\r\n        placeholder=\"Input message\"\r\n        onChange={(e) => {\r\n          State.update({\r\n            message: e.target.value,\r\n          });\r\n        }}\r\n      ></input>\r\n      <CommitButton\r\n        data={() => {\r\n          const encryptedMessage = nacl.box(\r\n            new Uint8Array(Buffer.from(state.message)),\r\n            nacl.randomBytes(24),\r\n            new Uint8Array(\r\n              Buffer.from(props.receiverPublicKeyBase64, \"base64\")\r\n            ),\r\n            nacl.box.keyPair.fromSecretKey(\r\n              Buffer.from(props.secretKeyBase64, \"base64\")\r\n            ).secretKey\r\n          );\r\n\r\n          return {\r\n            private_message: {\r\n              last_message: {\r\n                message_text_base64:\r\n                  Buffer.from(encryptedMessage).toString(\"base64\"),\r\n                receiver_public_key_base64: receiverPublicKeyBase64,\r\n                receiver_account_id: receiverAccountId,\r\n              },\r\n            },\r\n            index: {\r\n              private_message: JSON.stringify({\r\n                key: receiverAccountId,\r\n                value: \"\",\r\n              }),\r\n            },\r\n          };\r\n        }}\r\n      >\r\n        Send\r\n      </CommitButton>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessage.UserMessages"}