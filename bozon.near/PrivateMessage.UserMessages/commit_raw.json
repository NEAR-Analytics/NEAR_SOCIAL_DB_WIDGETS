{"tx_hash": "CgkXyCj4C6U3Cxucv3SZSPXagc8CVH6GpeyCCBpzdpSt", "action_id_social": "4xWSVw8NsXpbpRSGjMjRjxDwAHpmxr5PVVXuviH1fsTi-0-widget", "block_id": 82109381, "block_timestamp": "2023-01-03 14:02:37.519", "signer_id": "bozon.near", "widget_name": "PrivateMessage.UserMessages", "source_code": "//props:\n//receiverAccountId\n//secretKeyBase64\n//receiverPublicKeyBase64\n\nconst accountId = context.accountId;\n\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nif (\n  !props.receiverAccountId ||\n  !props.secretKeyBase64 ||\n  !props.receiverPublicKeyBase64\n) {\n  return \"Send receiverAccountId, secretKeyBase64, receiverPublicKeyBase64  in props\";\n}\n\nState.init({ message: \"\" });\n\nconst messages = Social.index(\"private_message\", accountId, {\n  subscribe: true,\n  order: \"desc\",\n});\n\nconsole.log(messages);\n\nreturn (\n  <div>\n    <div class=\"input-group mb-3\">\n      <input\n        class=\"form-control\"\n        placeholder=\"Input message\"\n        onChange={(e) => {\n          State.update({\n            message: e.target.value,\n          });\n        }}\n      ></input>\n      <CommitButton\n        data={() => {\n          const encryptedMessage = nacl.box(\n            new Uint8Array(Buffer.from(state.message)),\n            nacl.randomBytes(24),\n            new Uint8Array(\n              Buffer.from(props.receiverPublicKeyBase64, \"base64\")\n            ),\n            nacl.box.keyPair.fromSecretKey(\n              Buffer.from(props.secretKeyBase64, \"base64\")\n            ).secretKey\n          );\n\n          return {\n            private_message: {\n              last_message: {\n                message_text_base64:\n                  Buffer.from(encryptedMessage).toString(\"base64\"),\n                receiver_public_key_base64: receiverPublicKeyBase64,\n                receiver_account_id: receiverAccountId,\n              },\n            },\n            index: {\n              private_message: JSON.stringify({\n                key: receiverAccountId,\n                value: \"\",\n              }),\n            },\n          };\n        }}\n      >\n        Send\n      </CommitButton>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessage.UserMessages"}