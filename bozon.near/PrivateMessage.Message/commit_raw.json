{"tx_hash": "9YSLY2rf3NabtuvZzhV1wx94DbbFQDz8NPuk8mV4R4Q1", "action_id_social": "4gvYudAewr4WKLQZ6r6CAt9cwTSdecys1juSSkTEj94e-0-widget", "block_id": 82126629, "block_timestamp": "2023-01-03 19:35:28.059", "signer_id": "bozon.near", "widget_name": "PrivateMessage.Message", "source_code": "//props\r\n//secretKeyBase64 : string base64\r\n//blockHeight? : number || unknown date\r\n//senderAccountId? : string || current account id\r\n\r\nif (!props.secretKeyBase64) return \"send secretKeyBase64 in props\";\r\n\r\nconst messageObject = Social.get(\r\n  `${\r\n    props.senderAccountId || context.accountId\r\n  }/private_message/last_message/**`,\r\n  blockHeight\r\n);\r\n\r\nconst messageWithNonceUint8Array = new Uint8Array(\r\n  new Buffer(messageObject.message_text_base64, \"base64\")\r\n);\r\nconst nonce = messageWithNonceUint8Array.slice(0, nacl.box.nonceLength);\r\nconst encryptedMessage = messageWithNonceUint8Array.slice(\r\n  nacl.box.nonceLength,\r\n  messageWithNonce.length\r\n);\r\n\r\nconst messageTextUint8Array = nacl.box.open(\r\n  encryptedMessage,\r\n  nonce,\r\n  new Uint8Array(\r\n    new Buffer(messageObject.receiver_public_key_base64, \"base64\")\r\n  ),\r\n  new Uint8Array(new Buffer(props.secretKeyBase64, \"base64\"))\r\n);\r\n\r\nconst messageText = messageTextUint8Array\r\n  ? Buffer.from(messageTextUint8Array).toString()\r\n  : null;\r\n\r\nreturn (\r\n  <div className=\"card my-2 border-primary\">\r\n    <div className=\"card-header\">\r\n      <small class=\"text-muted\">\r\n        <div class=\"row justify-content-between\">\r\n          <div class=\"col-4\">\r\n            <Widget\r\n              src={`mob.near/widget/ProfileLine`}\r\n              props={{ accountId: senderAccountId }}\r\n            />\r\n          </div>\r\n          <div class=\"col-4\">\r\n            <div class=\"d-flex justify-content-end\">\r\n              <Widget\r\n                src={`mob.near/widget/TimeAgo`}\r\n                props={{ blockHeight: blockHeight }}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </small>\r\n    </div>\r\n    <div className=\"card-body\">\r\n      {messageText || \"\u26a0\ufe0f error reading message with your private key\"}\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessage.Message"}