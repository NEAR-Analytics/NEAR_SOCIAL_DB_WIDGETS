{"tx_hash": "E3eJWNbn216hL6MjTWB2nNumVhSjKiRgDFnCrR6hnL5y", "action_id_social": "BhnQqveFh9Uxr1Ebm138zabKrizWJ5ZCftvqbh3XpPRw-0-widget", "block_id": 81968458, "block_timestamp": "2023-01-01 17:43:12.800", "signer_id": "bozon.near", "widget_name": "PrivateMessages.Register", "source_code": "const accountId = context.accountId;\r\n\r\nif (!accountId) {\r\n  return \"Please sign in with NEAR wallet\";\r\n}\r\n\r\nconst registeredPublicKey = Social.get(\r\n  `${accountId}/private_messages/public_key`\r\n);\r\n\r\nif (registeredPublicKey === null) return \"Loading\";\r\n\r\nfunction randomKeyPairBase64() {\r\n  const keyPair = nacl.box.keyPair();\r\n  return {\r\n    secretKey: Buffer.from(keyPair.secretKey).toString(\"base64\"),\r\n    publicKey: Buffer.from(keyPair.publicKey).toString(\"base64\"),\r\n  };\r\n}\r\n\r\nconst keyPair = randomKeyPairBase64();\r\n\r\nState.init({\r\n  registeredPublicKey,\r\n  secretKey: keyPair.secretKey,\r\n  publicKey: keyPair.publicKey,\r\n});\r\n\r\nreturn (\r\n  <div class=\"mb-3\">\r\n    <h1 class=\"mb-3 text-center\">Register</h1>\r\n\r\n    {registeredPublicKey && (\r\n      <div class=\"mb-3\">\r\n        You already registered. If your key is compromised, you can re-register.\r\n        You can read old messages using old secret key{\" \"}\r\n      </div>\r\n    )}\r\n\r\n    <div class=\"mb-3\">\r\n      <label for=\"inputSercetKey\" class=\"form-label\">\r\n        Secret key:\r\n      </label>\r\n      <div class=\"mb-3 input-group\">\r\n        <input\r\n          type=\"text\"\r\n          value={state.secretKey}\r\n          class=\"form-control\"\r\n          readonly=\"\"\r\n        />\r\n        <button\r\n          class=\"btn btn-outline-primary\"\r\n          onClick={() => {\r\n            const keyPair = randomKeyPairBase64();\r\n\r\n            //re-render\r\n            State.update({\r\n              secretKey: keyPair.secretKey,\r\n              publicKey: keyPair.publicKey,\r\n            });\r\n          }}\r\n        >\r\n          Random\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"mb-3 form-check\">\r\n      <input\r\n        onClick={() => {\r\n          State.update({\r\n            checkboxSaveSecretKey: !state.checkboxSaveSecretKey,\r\n          });\r\n        }}\r\n        defaultChecked={state.checkboxSaveSecretKey}\r\n        class=\"form-check-input\"\r\n        type=\"checkbox\"\r\n        id=\"flexCheckDefault\"\r\n      />\r\n\r\n      <label class=\"form-check-label\" for=\"flexCheckDefault\">\r\n        <b>I SAVE SECRET KEY</b>\r\n      </label>\r\n    </div>\r\n\r\n    <CommitButton\r\n      disabled={!state.checkboxSaveSecretKey}\r\n      onClick={() => {\r\n        Storage.privateSet(\"secretKey\", state.secretKey);\r\n      }}\r\n      onCommit={() => {\r\n        window.open(\"/#/bozon.near/widget/PrivateMessages\");\r\n      }}\r\n      data={{ private_messages: { public_key: state.publicKey } }}\r\n    >\r\n      Register\r\n    </CommitButton>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessages.Register"}