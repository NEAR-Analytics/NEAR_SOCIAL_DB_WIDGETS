{"tx_hash": "J7P4q2QQgFagHLxnXMNdPe36R4tT5pbeS9LCEgxsDbZa", "action_id_social": "5THX1bF1pFCbtDEZm2Vr2K2AdxpwTUaRdxLJTDDhV8EH-0-widget", "block_id": 82061167, "block_timestamp": "2023-01-02 22:52:25.022", "signer_id": "bozon.near", "widget_name": "PrivateMessage.UserList", "source_code": "const accountId = context.accountId;\r\n\r\nif (!accountId) {\r\n  return \"Please sign in with NEAR wallet\";\r\n}\r\n\r\nif (!props.secretKey || !props.onSelectedUser) {\r\n  console.log(props.secretKey || props.onSelectedUser);\r\n  return \"Send secretKey and onSelectedUser() in props\";\r\n}\r\n\r\nconst follows = Social.get(`${accountId}/graph/follow/**`);\r\n\r\nconst allFollowers = follows\r\n  ? Object.keys(follows).map((f) => {\r\n      return f;\r\n    })\r\n  : [];\r\n\r\nState.init({\r\n  userList: allFollowers,\r\n});\r\n\r\nreturn (\r\n  <div>\r\n    <h1 class=\"mb-3 text-center\">Private Messages</h1>\r\n\r\n    <input\r\n      class=\"mb-3 form-control\"\r\n      placeholder=\"\ud83d\udd0d Input username\"\r\n      onChange={(e) => {\r\n        const newFollowersArray = allFollowers.filter(\r\n          (accountId) => accountId.indexOf(e.target.value) !== -1\r\n        );\r\n        const a = Social.get(`${e.target.value}/**`);\r\n\r\n        if (a) newFollowersArray.unshift(e.target.value);\r\n\r\n        State.update({\r\n          userList: newFollowersArray,\r\n        });\r\n      }}\r\n    ></input>\r\n\r\n    {allFollowers.length === 0 && <p>You don't have any followers yet</p>}\r\n    {state.userList.map((follower, i) => {\r\n      const followerRegisteredPublicKey = Social.get(\r\n        `${follower}/private_message/public_key`\r\n      );\r\n\r\n      return (\r\n        <div\r\n          class=\"mb-3 d-flex flex-row align-items-center justify-content-between\"\r\n          key={i}\r\n        >\r\n          <Widget\r\n            src=\"mob.near/widget/Profile.ShortInlineBlock\"\r\n            props={{\r\n              accountId: follower,\r\n            }}\r\n          />\r\n\r\n          {!followerRegisteredPublicKey ? (\r\n            <span\r\n              style={{ lineHeight: \"1.5rem\" }}\r\n              className=\"badge text-bg-secondary\"\r\n            >\r\n              User not registered\r\n            </span>\r\n          ) : (\r\n            <button\r\n              onClick={() => {\r\n                props.onSelectedUser(follower, followerRegisteredPublicKey);\r\n              }}\r\n            >\r\n              Send message\r\n            </button>\r\n          )}\r\n        </div>\r\n      );\r\n    })}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessage.UserList"}