{"tx_hash": "FRG6Getk8bhfXTiYDkPqeujJabMWSvdehKx6vGRnJemp", "action_id_social": "9wrDZLDiM73ntst2sqXudt2y5Vfg8NHfESU2dRB5G7Ef-0-widget", "block_id": 82122117, "block_timestamp": "2023-01-03 18:10:12.595", "signer_id": "bozon.near", "widget_name": "PrivateMessage.UserList", "source_code": "const accountId = context.accountId;\n\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nif (!props.secretKeyBase64 || !props.onSelectedUser) {\n  console.log(props.secretKeyBase64 || props.onSelectedUser);\n  return \"Send secretKeyBase64 and onSelectedUser() in props\";\n}\n\nconst follows = Social.get(`${accountId}/graph/follow/**`);\n\nif (follows === null) return <div>Loading...</div>;\n\nconst allFollowers = follows\n  ? Object.keys(follows).map((f) => {\n      return f;\n    })\n  : [];\n\nState.init({\n  userList: allFollowers,\n});\n\nreturn (\n  <div>\n    <input\n      class=\"mb-3 form-control\"\n      placeholder=\"\ud83d\udd0d Input username\"\n      onChange={(e) => {\n        const newFollowersArray = allFollowers.filter(\n          (accountId) => accountId.indexOf(e.target.value) !== -1\n        );\n        const a = Social.get(`${e.target.value}/**`);\n\n        if (a === null) if (a) newFollowersArray.unshift(e.target.value);\n\n        State.update({\n          userList: newFollowersArray,\n        });\n      }}\n    ></input>\n\n    {allFollowers.length === 0 && <p>You don't have any followers yet</p>}\n    {state.userList.map((follower, i) => {\n      const followerRegisteredPublicKey = Social.get(\n        `${follower}/private_message/public_key`\n      );\n\n      return (\n        <div\n          class=\"mb-3 d-flex flex-row align-items-center justify-content-between\"\n          key={i}\n        >\n          <Widget\n            src=\"mob.near/widget/Profile.ShortInlineBlock\"\n            props={{\n              accountId: follower,\n            }}\n          />\n\n          {!followerRegisteredPublicKey ? (\n            <span\n              style={{ lineHeight: \"1.5rem\" }}\n              className=\"badge text-bg-secondary\"\n            >\n              User not registered\n            </span>\n          ) : (\n            <button\n              onClick={() => {\n                props.onSelectedUser(follower, followerRegisteredPublicKey);\n              }}\n            >\n              Send message\n            </button>\n          )}\n        </div>\n      );\n    })}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessage.UserList"}