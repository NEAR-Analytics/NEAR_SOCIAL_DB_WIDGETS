{"tx_hash": "AAxSWaPydfdtz614QJJbMnB5BKfngGJnrZz8uQftm59y", "action_id_social": "KoedYqGqruwbKkrAMuikaKtC4NYaWqBVyqSdhbMWoCC-0-widget", "block_id": 82255162, "block_timestamp": "2023-01-05 12:41:04.729", "signer_id": "bozon.near", "widget_name": "PrivateMailBox.UserList", "source_code": "const accountId = context.accountId;\r\n\r\nif (!accountId) return \"Please sign in with NEAR wallet\";\r\n\r\nif (!props.secretKeyBase64 || !props.onSelectedUser) {\r\n  console.log(props.secretKeyBase64 || props.onSelectedUser);\r\n  return \"Send secretKeyBase64 and onSelectedUser() in props\";\r\n}\r\n\r\nlet allProfiles =\r\n  Social.get([\"*/profile/name\", \"*/private_message/public_key/*\"]) || {};\r\n// allProfiles = Object.keys(allProfilesRequest).map((accountId) => {\r\n//   return [accountId, allProfilesRequest[accountId]?.profile?.name];\r\n// });\r\n\r\nconst follows = Social.get(`${accountId}/graph/follow/**`);\r\n\r\nif (follows === null) return \"Loading...\";\r\n\r\nconst allFollowers = follows\r\n  ? Object.keys(follows).map((f) => {\r\n      return f;\r\n    })\r\n  : [];\r\n\r\nState.init({\r\n  userList: allFollowers,\r\n});\r\n\r\nreturn (\r\n  <div>\r\n    <input\r\n      class=\"mb-3 form-control\"\r\n      placeholder=\"\ud83d\udd0d Input username\"\r\n      onChange={(e) => {\r\n        const newFollowersArray = allFollowers.filter(\r\n          (accountId) => accountId.indexOf(e.target.value) !== -1\r\n        );\r\n\r\n        if (allProfiles[e.target.value])\r\n          newFollowersArray.unshift(e.target.value);\r\n\r\n        State.update({\r\n          userList: newFollowersArray,\r\n        });\r\n      }}\r\n    ></input>\r\n\r\n    {allFollowers.length === 0 && <p>You don't have any followers yet</p>}\r\n    {state.userList.map((follower, i) => {\r\n      const followerRegisteredPublicKey = Social.get(\r\n        `${follower}/private_message/public_key`\r\n      );\r\n\r\n      return (\r\n        <div\r\n          class=\"mb-3 d-flex flex-row align-items-center justify-content-between\"\r\n          key={i}\r\n        >\r\n          <Widget\r\n            src=\"mob.near/widget/Profile.ShortInlineBlock\"\r\n            props={{\r\n              accountId: follower,\r\n            }}\r\n          />\r\n\r\n          {!followerRegisteredPublicKey ? (\r\n            <span\r\n              style={{ lineHeight: \"1.5rem\" }}\r\n              className=\"badge text-bg-secondary\"\r\n            >\r\n              User not registered\r\n            </span>\r\n          ) : (\r\n            <button\r\n              onClick={() => {\r\n                props.onSelectedUser(follower, followerRegisteredPublicKey);\r\n              }}\r\n            >\r\n              Send message\r\n            </button>\r\n          )}\r\n        </div>\r\n      );\r\n    })}\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMailBox.UserList"}