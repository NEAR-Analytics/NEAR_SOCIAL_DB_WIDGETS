{"tx_hash": "C36E4HAvXcSb8kjukcrpRaYmapAoMffw5zn6FFvAiKxR", "action_id_social": "7XwQA7FmmSDYRzFMEBS6h4uNrMkypnhWEx3A9rTp6CNi-0-widget", "block_id": 82432517, "block_timestamp": "2023-01-07 21:08:25.637", "signer_id": "bozon.near", "widget_name": "WidgetHistory", "source_code": "const initWidgetPath = \"devgovgigs.near/widget/Ideas\";\r\n\r\nState.init({\r\n  widgetPath: initWidgetPath,\r\n  widgetsCodeChanges: [],\r\n});\r\n\r\nconst historyBlocksRequest = Social.keys(`${state.widgetPath}`, \"final\", {\r\n  return_type: \"History\",\r\n});\r\n\r\nif (historyBlocksRequest === null) return \"loading...\";\r\n\r\nconst [widgetAccountId, _, widgetName] = state.widgetPath.split(\"/\");\r\n\r\nlet blocksChanges =\r\n  historyBlocksRequest[widgetAccountId]?.[\"widget\"]?.[widgetName];\r\n\r\nif (blocksChanges) blocksChanges = blocksChanges?.sort((a, b) => b - a);\r\n\r\nconst loadMoreCode = () => {\r\n  const newCode = blocksChanges\r\n    .slice(state.widgetsCodeChanges.length, state.widgetsCodeChanges.length + 1)\r\n    .map(blockHeightToWidget);\r\n\r\n  newCode.forEach((code) => state.widgetsCodeChanges.push(code));\r\n  State.update({});\r\n};\r\n\r\nconst blockHeightToWidget = (blockHeight) => {\r\n  const index = blocksChanges.findIndex((el) => el == blockHeight);\r\n  console.log({\r\n    currentBlockHeight: blockHeight,\r\n    prevBlockHeight: blocksChanges[index + 1],\r\n  });\r\n  return (\r\n    <div style={{ minHeight: \"200px\" }} key={blockHeight}>\r\n      <hr />\r\n      <div>changes in block #{blockHeight}</div>\r\n      <Widget src={`mob.near/widget/TimeAgo`} props={{ blockHeight }} />\r\n      <Widget\r\n        src={`bozon.near/widget/WidgetHistory.CodeHistory`}\r\n        props={{\r\n          pathToWidget: state.widgetPath,\r\n          currentBlockHeight: blockHeight,\r\n          prevBlockHeight: blocksChanges[index + 1],\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nreturn (\r\n  <div>\r\n    <h1 class=\"text-center\">Widget History</h1>\r\n\r\n    <div class=\"input-group mb-3\">\r\n      <input\r\n        class=\"form-control\"\r\n        placeholder={initWidgetPath}\r\n        defaultValue={initWidgetPath}\r\n        onBlur={(e) => {\r\n          State.update({ widgetPath: e.target.value, widgetsCodeChanges: [] });\r\n        }}\r\n      />\r\n    </div>\r\n\r\n    {!blocksChanges ? (\r\n      <div>incorrent widget path</div>\r\n    ) : (\r\n      <div>\r\n        <div>\r\n          <InfiniteScroll\r\n            pageStart={0}\r\n            loadMore={loadMoreCode}\r\n            hasMore={blocksChanges.length > state.widgetsCodeChanges.length}\r\n            loader={<div className=\"loader\">Loading...</div>}\r\n          >\r\n            {state.widgetsCodeChanges}\r\n          </InfiniteScroll>\r\n        </div>\r\n      </div>\r\n    )}\r\n  </div>\r\n);\r\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/WidgetHistory", "metadata.image.ipfs_cid": NaN, "metadata": NaN, "metadata.description": NaN, "metadata.name": NaN, "metadata.tags.code": NaN, "metadata.tags.dev": NaN, "metadata.tags.history": NaN, "metadata.tags.widget": NaN, "metadata.tags.app": NaN}