{"tx_hash": "58L5g6Bmzv3U1Q5qJQvxL8BbDKXcUZ3BNUFM5KYJZSie", "action_id_social": "RK5xiG98pEBnSy2rDSN8zUnwzE7sVwE4o1vZJVyUB1j-0-widget", "block_id": 82061213, "block_timestamp": "2023-01-02 22:53:16.620", "signer_id": "bozon.near", "widget_name": "PrivateMessage.Register", "source_code": "const accountId = context.accountId;\r\n\r\nif (!accountId) {\r\n  return \"Please sign in with NEAR wallet\";\r\n}\r\n\r\nconst registeredPublicKey = Social.get(\r\n  `${accountId}/private_message/public_key`\r\n);\r\n\r\nif (registeredPublicKey === null) return \"Loading\";\r\n\r\nfunction randomKeyPairBase64() {\r\n  const keyPair = nacl.box.keyPair();\r\n  return {\r\n    secretKey: Buffer.from(keyPair.secretKey).toString(\"base64\"),\r\n    publicKey: Buffer.from(keyPair.publicKey).toString(\"base64\"),\r\n  };\r\n}\r\n\r\nconst keyPair = randomKeyPairBase64();\r\n\r\nState.init({\r\n  registeredPublicKey,\r\n  secretKey: keyPair.secretKey,\r\n  publicKey: keyPair.publicKey,\r\n  registered: false,\r\n});\r\n\r\nreturn (\r\n  <div>\r\n    {state.registered && (\r\n      <div class=\"modal\" style={{ display: \"block\" }}>\r\n        <div className=\"modal-dialog\">\r\n          <div className=\"modal-content\">\r\n            <div className=\"modal-header\">\r\n              <h5 className=\"modal-title\">Registration successfully</h5>\r\n            </div>\r\n            <div className=\"modal-body\">\r\n              <p>You can send and receive messages now</p>\r\n            </div>\r\n            <div className=\"modal-footer\">\r\n              <a\r\n                className=\"btn btn-success\"\r\n                href={`#/bozon.near/widget/PrivateMessages`}\r\n              >\r\n                Go to login\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )}\r\n\r\n    <h1 class=\"mb-3 text-center\">Register</h1>\r\n    {registeredPublicKey && (\r\n      <div class=\"mb-3\">\r\n        You already registered. If your key is compromised, you can re-register.\r\n        You can read old messages using old secret key{\" \"}\r\n      </div>\r\n    )}\r\n    <div class=\"mb-3\">\r\n      <label for=\"inputSercetKey\" class=\"form-label\">\r\n        Secret key:\r\n      </label>\r\n      <div class=\"mb-3 input-group\">\r\n        <input\r\n          type=\"text\"\r\n          value={state.secretKey}\r\n          class=\"form-control\"\r\n          readonly=\"\"\r\n        />\r\n        <button\r\n          class=\"btn btn-outline-primary\"\r\n          onClick={() => {\r\n            const keyPair = randomKeyPairBase64();\r\n\r\n            //re-render\r\n            State.update({\r\n              secretKey: keyPair.secretKey,\r\n              publicKey: keyPair.publicKey,\r\n            });\r\n          }}\r\n        >\r\n          Random\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <div class=\"mb-3 form-check\">\r\n      <input\r\n        onClick={() => {\r\n          State.update({\r\n            checkboxSaveSecretKey: !state.checkboxSaveSecretKey,\r\n          });\r\n        }}\r\n        defaultChecked={state.checkboxSaveSecretKey}\r\n        class=\"form-check-input\"\r\n        type=\"checkbox\"\r\n        id=\"flexCheckDefault\"\r\n      />\r\n\r\n      <label class=\"form-check-label\" for=\"flexCheckDefault\">\r\n        <b>I SAVE SECRET KEY</b>\r\n      </label>\r\n    </div>\r\n    <CommitButton\r\n      disabled={!state.checkboxSaveSecretKey}\r\n      onCommit={() => {\r\n        State.update({\r\n          registered: true,\r\n        });\r\n      }}\r\n      data={{ private_message: { public_key: state.publicKey } }}\r\n    >\r\n      Register\r\n    </CommitButton>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bozon.near/widget/PrivateMessage.Register"}