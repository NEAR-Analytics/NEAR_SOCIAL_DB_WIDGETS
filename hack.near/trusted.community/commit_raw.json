{"tx_hash": "FBTnwKAPtZeeqRxxt8hR6XrSTx4YQmmrCUfFCmZZ1SgD", "action_id_social": "G3724cfkk42DB4v9E7tzCZXG5h7n5Y43YGFeKU11h6AA-0-widget", "block_id": 95007418, "block_timestamp": "2023-06-25T15:42:54.770Z", "signer_id": "hack.near", "widget_name": "trusted.community", "source_code": "const userId = context.accountId;\nconst ownerId = \"every.near\";\n\nif (!userId) {\n  return \"Please sign in with NEAR wallet to trust other accounts\";\n}\n\nconst accounts = Social.keys(`*/graph/trust/*`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true,\n});\n\nif (accounts === null) {\n  return \"Loading...\";\n}\n\nconst trustingData = Social.keys(`${userId}/graph/trust/*`, \"final\");\nif (trustingData === null) {\n  return \"Loading...\";\n}\n\nconst trusting = trustingData[userId][\"graph\"][\"trust\"] ?? {};\n\nlet trustDev = prop.trustDev ?? false;\n\nif (trustDev) {\n  trusting[ownerId] = true;\n}\n\nState.init({\n  trusting,\n  trustDev,\n});\n\nlet trustGraph = [];\nObject.keys(accounts).forEach((accountId) => {\n  Object.keys(accounts[accountId].graph.trust).forEach((trustingAccountId) => {\n    trustGraph[trustingAccountId] = (trustGraph[trustingAccountId] ?? 0) + 1;\n  });\n});\n\nlet trustRank = Object.keys(trustGraph).sort(\n  (a, b) => trustGraph[b] - trustGraph[a]\n);\n\nlet handleChange = (accountId) => {\n  let trusting = state.trusting;\n  trusting[accountId] = !trusting[accountId];\n  State.update({ trusting });\n};\n\nlet trustDevChange = () => {\n  handleChange(ownerId);\n  State.update({ trustDev: !state.trustDev });\n};\n\nlet trustBlocks = trustRank.map((accountId) => (\n  <li\n    className={`list-group-item ${\n      state.trusting[accountId] ? \"list-group-item-success\" : \"\"\n    }`}\n  >\n    <div className=\"form-check\">\n      <input\n        className=\"form-check-input\"\n        type=\"checkbox\"\n        value={accountId}\n        disabled={accountId == userId}\n        id={`trust-${accountId}`}\n        name={`trust-${accountId}`}\n        onChange={() => handleChange(accountId)}\n        checked={state.trusting[accountId] ?? false}\n      />\n      <label className=\"form-check-label\" for={`trust-${accountId}`}>\n        <Widget\n          src=\"near/widget/Profile\"\n          props={{\n            accountId,\n          }}\n        />{\" \"}\n        <span\n          className=\"badge rounded-pill bg-primary\"\n          title={`${trustGraph[accountId]}`}\n        >\n          {trustGraph[accountId]}\n        </span>\n        <a\n          className=\"btn btn-sm btn-outline-secondary border-0\"\n          href={`#/mob.near/widget/ProfilePage?accountId=${accountId}`}\n          target=\"_blank\"\n        >\n          <i className=\"bi bi-window-plus me-1\" title=\"Open in new tab\"></i>\n        </a>\n      </label>\n    </div>\n  </li>\n));\n\nlet dataTrust = {};\nObject.keys(state.trusting).map((accountId) => {\n  if (accountId !== userId) {\n    let trust = !!state.trusting[accountId];\n    dataTrust[accountId] = trust ? \"\" : null;\n  }\n});\n\nlet dataGraph = [];\nlet dataNotify = [];\n\nObject.keys(state.trusting).map((accountId) => {\n  if (trusting[accountId] != state.trusting[accountId]) {\n    let trust = !!state.trusting[accountId];\n    dataGraph.push({\n      key: \"trust\",\n      value: {\n        type: trust ? \"trust\" : \"block\",\n        accountId,\n      },\n    });\n\n    dataNotify.push({\n      key: accountId,\n      value: {\n        type: trust ? \"trust\" : \"block\",\n      },\n    });\n  }\n});\n\nconst data = {\n  graph: {\n    trust: dataTrust,\n  },\n  index: {\n    graph: JSON.stringify(dataGraph),\n    notify: JSON.stringify(dataNotify),\n  },\n};\n\nreturn (\n  <>\n    <h3>Open Web of Trust</h3>\n    <p>Connect with people you know!</p>\n\n    <div className=\"mb-3\">\n      <CommitButton\n        disabled={context.loading}\n        className={`btn ${\n          context.loading ? \"btn-outline-dark\" : \"btn-outline-success\"\n        }`}\n        data={data}\n      >\n        {context.loading ? \"Loading...\" : \"Save Connections\"}\n      </CommitButton>\n    </div>\n    <br />\n    <h5>Community</h5>\n    <ul className=\"list-group\">{trustBlocks}</ul>\n    <div className=\"form-check pt-3\">\n      <input\n        className=\"form-check-input\"\n        type=\"checkbox\"\n        id={`trust-dev`}\n        onChange={() => trustDevChange()}\n        checked={state.trustDev}\n        name=\"trust-dev\"\n      />\n      <label className=\"form-check-label\" for=\"trust-dev\">\n        Join us: {ownerId}\n      </label>\n    </div>\n\n    <div className=\"mt-3 mb-3\">\n      <CommitButton\n        disabled={context.loading}\n        className={`btn ${\n          context.loading ? \"btn-outline-dark\" : \"btn-outline-success\"\n        }`}\n        data={data}\n      >\n        {context.loading ? \"Loading...\" : \"Save Connections\"}\n      </CommitButton>\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/trusted.community", "__row_index": 0}