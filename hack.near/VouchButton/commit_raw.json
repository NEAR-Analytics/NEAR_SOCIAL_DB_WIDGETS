{"tx_hash": "DGQy3zBhUWt5rUv414Vt1u2fnpEyUBsP9bbZ8GokVSjs", "action_id_social": "4NwTjQ55Py2VAV6T8QBYWUPF7GqPmM1ti4aLVWfx2x3p-0-widget", "block_id": 91886459, "block_timestamp": "2023-05-15T04:11:40.326Z", "signer_id": "hack.near", "widget_name": "VouchButton", "source_code": "const widget = props.widget;\nconst item = props.item;\n\nif (!item) {\n  return \"\";\n}\n\nconst vouches = Social.index(\"vouch\", widget);\n\nconst dataLoading = vouches === null;\n\nconst vouchesByUsers = Object.fromEntries(\n  (vouches || [])\n    .filter((vouch) => vouch.value.type === \"vouch\")\n    .map((vouch) => [vouch.accountId, vouch])\n);\n\nif (state.hasVouch === true) {\n  vouchesByUsers[context.accountId] = {\n    accountId: context.accountId,\n  };\n}\n\nconst VouchButton = styled.button`\n  border: 0 !important;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  width: 2.5em;\n  height: 2.5em;\n  fill: currentColor;\n  svg {\n    margin-top: -0.2em;\n  }\n  &:hover {\n    color: rgb(0, 184, 124);\n    background: rgb(0, 184, 124, 0.1);\n  }\n  .vouched {\n    color: rgb(0, 184, 124);\n  }\n`;\n\nconst accountsWithVouches = Object.keys(vouchesByUsers);\nconst hasVouch = context.accountId && !!vouchesByUsers[context.accountId];\n\nconst vouchClick = () => {\n  if (state.loading) {\n    return;\n  }\n  State.update({\n    loading: true,\n  });\n  const vouches = [\n    {\n      key: \"main\",\n      value: {\n        type: \"vouch\",\n        item,\n      },\n    },\n  ];\n  if (!hasVouch) {\n    vouches.push({\n      key: item,\n      value: {\n        type: \"vouch\",\n      },\n    });\n  }\n  const data = {\n    index: {\n      vouch: JSON.stringify(vouches),\n    },\n  };\n\n  if (!hasVouch && props.notifyAccountId) {\n    data.index.notify = JSON.stringify({\n      key: props.notifyAccountId,\n      value: {\n        type: \"vouch\",\n        item,\n      },\n    });\n  }\n  Social.set(data, {\n    onCommit: () => State.update({ loading: false, hasVouch: true }),\n    onCancel: () => State.update({ loading: false }),\n  });\n};\n\nconst title = \"Vouch\";\n\n// const vouchSvg = (\n//   <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24px\" viewBox=\"0 0 576 512\">\n//     <path d=\"M272 416c17.7 0 32-14.3 32-32s-14.3-32-32-32H160c-17.7 0-32-14.3-32-32V192h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8l32 0 0 128c0 53 43 96 96 96H272zM304 96c-17.7 0-32 14.3-32 32s14.3 32 32 32l112 0c17.7 0 32 14.3 32 32l0 128H416c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8l-32 0V192c0-53-43-96-96-96L304 96z\" />\n//   </svg>\n// );\n\nconst vouchSvg = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"32\"\n    height=\"32\"\n    fill=\"currentColor\"\n    viewBox=\"0 0 24 24\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      d=\"M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z\"\n      transform=\"rotate(180, 12, 12), translate(0, 4)\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      d=\"M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z\"\n      transform=\"translate(0, 4)\"\n    />\n  </svg>\n);\n\nreturn (\n  <div className=\"d-inline-flex align-items-center\">\n    <VouchButton\n      disabled={state.loading || dataLoading || !context.accountId}\n      className=\"btn me-1\"\n      title={title}\n      onClick={vouchClick}\n    >\n      {state.loading || dataLoading ? (\n        <span\n          className=\"spinner-grow spinner-grow-sm p-2\"\n          role=\"status\"\n          aria-hidden=\"true\"\n        />\n      ) : (\n        <span className={`bi fs-3 ${hasVouch ? \"vouched\" : \"\"}`}>\n          {vouchSvg}\n          Vouch\n        </span>\n      )}\n    </VouchButton>\n    <Widget\n      src=\"mob.near/widget/LikeButton.Faces\"\n      props={{ likesByUsers: vouchesByUsers }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/VouchButton", "__row_index": 1}