{"tx_hash": "8qpSVNBbXGUX4JKqSNbEkVcwv2UvhW9fkwnyGqNsR6tN", "action_id_social": "e3iXUq3CvF7yGB5V6ygvjxJJS1SiTWYUMgTchgfjk6Q-1-widget", "block_id": 90360213, "block_timestamp": "2023-04-25 00:43:18.031", "signer_id": "hack.near", "widget_name": "DAO.Post", "source_code": "const accountId = props.accountId;\nconst contract_name = props.daoId ?? \"liberty.sputnik-dao.near\";\n\nconst blockHeight =\n  props.blockHeight === \"now\" ? \"now\" : parseInt(props.blockHeight);\nconst content =\n  props.content ??\n  JSON.parse(Social.get(`${accountId}/post/main`, blockHeight) ?? \"null\");\nconst subscribe = !!props.subscribe;\nconst raw = !!props.raw;\n\nconst notifyAccountId = accountId;\n\nconst link = `#/mob.near/widget/MainPage.Post.Page?accountId=${accountId}&blockHeight=${blockHeight}`;\n\nconst convertAmount = (amount, decimals) => {\n  const [whole, fractional] = amount.toString().split(\".\");\n  const wholePart = new BN(whole).mul(new BN(\"10\").pow(new BN(decimals)));\n  if (fractional === undefined) {\n    return wholePart.toString();\n  }\n  const fractionalPart = new BN(fractional).mul(\n    new BN(\"10\").pow(new BN(decimals - fractional.length))\n  );\n  return wholePart.add(fractionalPart).toString();\n};\n\nState.init({\n  recipient: accountId,\n  amount: 0.5,\n  deposit: 0.1,\n});\n\nconst onChangeAmount = (amount) => {\n  State.update({\n    amount,\n  });\n};\n\nconst onChangeRecipient = (recipient) => {\n  State.update({\n    recipient,\n  });\n};\n\nconst onChangeDescription = (description) => {\n  State.update({\n    description,\n  });\n};\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: contract_name,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: content.text,\n          kind: {\n            Transfer: {\n              token_id: \"\",\n              receiver_id: state.recipient.trim().toLowerCase(),\n              amount: convertAmount(state.amount.toString(), 24) ?? 0,\n            },\n          },\n        },\n      },\n      gas: state.gas ?? 200000000000000,\n      deposit: 100000000000000000000000,\n    },\n  ]);\n};\n\nconst item = {\n  type: \"social\",\n  path: `${contract_name}/post/main`,\n  blockHeight,\n};\n\nconst reposts = [\n  {\n    key: \"main\",\n    value: {\n      type: \"repost\",\n      item,\n    },\n  },\n  {\n    key: item,\n    value: {\n      type: \"repost\",\n    },\n  },\n];\n\nconst social_args = JSON.stringify({\n  data: {\n    [contract_name]: {\n      index: {\n        repost: JSON.stringify(reposts),\n      },\n    },\n  },\n});\n\nconst proposal_args = Buffer.from(social_args, \"utf-8\").toString(\"base64\");\n\nconst handleBoostProposal = () => {\n  Near.call([\n    {\n      contractName: contract_name,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: content.text,\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: proposal_args,\n                  deposit: \"100000000000000000000000\",\n                  gas: \"200000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: \"100000000000000000000000\",\n      gas: \"200000000000000\",\n    },\n  ]);\n};\n\nreturn (\n  <div className=\"border-bottom pt-3 pb-1\">\n    <Widget\n      src=\"mob.near/widget/MainPage.Post.Header\"\n      props={{ accountId, blockHeight, link, postType: \"post\", flagItem: item }}\n    />\n    <div className=\"mt-3 text-break\">\n      <Widget\n        src=\"mob.near/widget/MainPage.Post.Content\"\n        props={{ content, raw }}\n      />\n    </div>\n    {blockHeight !== \"now\" && (\n      <div className=\"mt-1 d-flex justify-content-between\">\n        <div className=\"me-4\">\n          <Widget\n            src=\"mob.near/widget/CommentButton\"\n            props={{\n              onClick: () =>\n                !state.showReply && State.update({ showReply: true }),\n            }}\n          />\n        </div>\n        <div className=\"me-3\">\n          <Widget\n            src=\"mob.near/widget/RepostButton\"\n            props={{\n              notifyAccountId,\n              item,\n            }}\n          />\n        </div>\n        <div className=\"me-3\">\n          <Widget\n            src=\"mob.near/widget/LikeButton\"\n            props={{\n              notifyAccountId,\n              item,\n            }}\n          />\n        </div>\n        <div>\n          <Widget\n            src=\"mob.near/widget/MainPage.Post.ShareButton\"\n            props={{ accountId, blockHeight, postType: \"post\" }}\n          />\n        </div>\n      </div>\n    )}\n    <div className=\"me-3\">\n      <button className=\"btn btn-primary m-2\" onClick={handleProposal}>\n        Submit to DAO\n      </button>\n      <button className=\"btn btn-success m-2\" onClick={handleBoostProposal}>\n        Request a Boost\n      </button>\n    </div>\n    <div className=\"mt-3 ps-5\">\n      {state.showReply && (\n        <div className=\"mb-2\">\n          <Widget\n            src=\"mob.near/widget/MainPage.Comment.Compose\"\n            props={{\n              notifyAccountId,\n              item,\n              onComment: () => State.update({ showReply: false }),\n            }}\n          />\n        </div>\n      )}\n      <Widget\n        src=\"mob.near/widget/MainPage.Comment.Feed\"\n        props={{\n          item,\n          highlightComment: props.highlightComment,\n          limit: props.commentsLimit,\n          subscribe,\n          raw,\n        }}\n      />\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/DAO.Post"}