{"tx_hash": "CU1ACfLJKJkoRz7ZyXyaEcx4YJL4cnFnniKjCaFfQAao", "action_id_social": "8YqnCPFzeFQ5vmKrnutZAWSoTNspKw81B5GsC2rmAi4o-0-widget", "block_id": 91993927, "block_timestamp": "2023-05-16T13:44:27.831Z", "signer_id": "hack.near", "widget_name": "DAO.Main.Editor", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"build.sputnik-dao.near\";\n\nconst typeTag = props.typeTag ?? \"\";\n\nconst defaultMain = props.main ?? \"mob.near/widget/Homepage\";\n\nconst main = Social.get(`${daoId}/settings/dao/main`);\n\nif (main === null) {\n  return \"Loading...\";\n}\n\nState.init({\n  main: main ?? defaultMain,\n  prop: state.prop,\n  value: state.value,\n  typeTag: typeTag,\n});\n\nconst main_args = JSON.stringify({\n  data: {\n    [daoId]: {\n      settings: {\n        dao: {\n          main: state.main,\n        },\n      },\n    },\n  },\n});\n\nconst widget_args = JSON.stringify({\n  data: {\n    [daoId]: {\n      widget: {\n        [`${state.prop}.Main`]: {\n          \"\": `const ${state.prop} = props.${state.prop} ?? \"${state.value}\"; return (<Widget src=\"${state.main}\" props={{${state.prop}: ${state.prop}}} />);`,\n          metadata: {\n            tags: {\n              dao: \"\",\n              [typeTag]: \"\",\n            },\n          },\n        },\n      },\n    },\n  },\n});\n\nconst proposal_args = Buffer.from(main_args, \"utf-8\").toString(\"base64\");\nconst create_args = Buffer.from(widget_args, \"utf-8\").toString(\"base64\");\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"new DAO.Main\",\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: proposal_args,\n                  deposit: \"50000000000000000000000\",\n                  gas: \"200000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: \"100000000000000000000000\",\n      gas: \"200000000000000\",\n    },\n  ]);\n};\n\nconst handleCreate = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"new DAO.Widget\",\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: create_args,\n                  deposit: \"50000000000000000000000\",\n                  gas: \"200000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: \"100000000000000000000000\",\n      gas: \"200000000000000\",\n    },\n  ]);\n};\n\nconst addWidget = ({ widgetPath: main, onHide }) => {\n  return (\n    <button\n      className=\"btn btn-primary\"\n      onClick={() => {\n        State.update({\n          main,\n        });\n        onHide();\n      }}\n    >\n      <i className=\"bi bi-plus-lg\" /> Add\n    </button>\n  );\n};\n\nreturn (\n  <>\n    <h3>Domain Editor</h3>\n    <div className=\"mt-2\">\n      <h5>Widget Source</h5>\n\n      <input\n        type=\"text\"\n        value={state.main}\n        placeholder=\"account.near/widget/Example\"\n      />\n    </div>\n    <div className=\"mt-2\">\n      <h5>Property</h5>\n\n      <input type=\"text\" value={state.domain} placeholder=\"daoId\" />\n    </div>\n    <div className=\"mt-2\">\n      <h5>Value</h5>\n\n      <input\n        type=\"text\"\n        value={state.value}\n        placeholder=\"multi.sputnik-dao.near\"\n      />\n    </div>\n    <div className=\"mt-2\">\n      <h5>Tag</h5>\n\n      <input type=\"text\" value={state.typeTag} placeholder=\"example\" />\n    </div>\n    <div className=\"mt-2\">\n      <CommitButton\n        disabled={state.main === defaultMain}\n        data={{ settings: { dao: { main: state.main } } }}\n      >\n        Save\n      </CommitButton>\n      <button\n        disabled={state.main === defaultMain}\n        className=\"btn btn-outline-primary\"\n        onClick={handleProposal}\n      >\n        Propose\n      </button>\n      <button\n        disabled={state.main === defaultMain}\n        className=\"btn btn-outline-primary\"\n        onClick={handleCreate}\n      >\n        Create\n      </button>\n    </div>\n    <div className=\"mb-2 mt-3\">\n      <Widget\n        src=\"hack.near/widget/dev.Widget.Search\"\n        props={{ extraButtons: addWidget }}\n      />\n    </div>\n    <hr />\n    <h5>Preview</h5>\n    <div className=\"mb-2\">\n      <Widget src={state.main} />\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/DAO.Main.Editor", "__row_index": 1}