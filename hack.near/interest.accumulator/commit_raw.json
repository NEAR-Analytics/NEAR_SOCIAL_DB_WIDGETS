{"tx_hash": "6php7xze7TvVdUvrVQhGrrMe2nYof8Ssshte8HRTyQTV", "action_id_social": "E2Zp9SnQebgouGerPmPpgEjEC24B7Sso9yeeZ9pRzv4S-0-widget", "block_id": 93621109, "block_timestamp": "2023-06-06T23:49:09.653Z", "signer_id": "hack.near", "widget_name": "interest.accumulator", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"meta.sputnik-dao.near\";\n\nlet defaultSlices = Social.get(`${daoId}/pie`);\n\nif (defaultSlices === null) {\n  return \"\";\n}\n\nlet slices = Social.get(`${accountId}/pie`);\n\nif (slices === null) {\n  return \"\";\n}\n\nState.init({\n  labels: defaultSlices.labels ?? state.labels,\n  description: defaultSlices.labels ?? state.description,\n  values,\n});\n\nconst policy = Near.view(daoId, \"get_policy\");\n\nif (policy === null) {\n  return \"\";\n}\n\nconst deposit = policy.proposal_bond;\n\nconst slice_args = JSON.stringify({\n  data: {\n    [daoId]: {\n      pie: {\n        labels: state.labels,\n        description: state.description,\n        supporters: \"futurevisions.near\",\n      },\n    },\n  },\n});\n\nconst mySlice = JSON.stringify({\n  data: {\n    [accountId]: {\n      pie: {\n        labels: state.labels,\n        description: state.description,\n        supporters: [accountId],\n      },\n    },\n  },\n});\n\nconst proposal_args = Buffer.from(slice_args, \"utf-8\").toString(\"base64\");\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"propose new slice for the interest accumulator\",\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: proposal_args,\n                  deposit: \"80000000000000000000000\",\n                  gas: \"300000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: deposit,\n      gas: \"300000000000000\",\n    },\n  ]);\n};\n\nlet Style = styled.div`\n\n  .barTextH{\n    transition: fill 0.2s;\n\n  }\n.barTextH:hover{\n    fill: #ad610a;\n\n  }\n  .bar {\n    transition: fill 0.2s;\n  }\n\n  .bar:hover {\n    fill: #ffa726;\n  }\n\n  .bar-chart {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n    svg {\n      width: 80%;\n    }\n\n    rect {\n      shape-rendering: crispEdges;\n      fill: #61dafb;\n      stroke: #333;\n      stroke-width: 1;\n    }\n\n\n    `;\n\nconst onChangeLabel = (newLabel) => {\n  State.update({\n    newLabel,\n  });\n};\n\nconst onChangeDescription = (description) => {\n  State.update({\n    description,\n  });\n};\n\nconst values = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];\n\nreturn (\n  <div>\n    <h3>Add Your Slice</h3>\n    <h5>Label: What?</h5>\n    <input type=\"text\" onChange={(e) => onChangeLabel(e.target.value)}></input>\n    <br />\n    <h5>Description</h5>\n    <input\n      type=\"text\"\n      onChange={(e) => onChangeDescription(e.target.value)}\n    ></input>\n    <br />\n    <div className=\"mb-2\">\n      <button className=\"btn btn-outline-success m-1\" onClick={handleProposal}>\n        Propose Changes\n      </button>\n      <CommitButton data={{ pie: mySlice }}>Save Changes</CommitButton>\n    </div>\n    <Widget src=\"y3k.near/widget/pieChartSVG\" props={{ labels, values }} />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/interest.accumulator", "__row_index": 3}