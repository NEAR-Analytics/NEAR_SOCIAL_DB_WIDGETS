{"tx_hash": "98BGwGbD941jskfQqqj7UFaXq7sFdnhJotyVwJ9XQYTJ", "action_id_social": "F1VKdNB6rNwgdkZakEkDKFvNdGX3Vm8MRRziNJy1656L-0-widget", "block_id": 92471679, "block_timestamp": "2023-05-22T19:43:39.728Z", "signer_id": "hack.near", "widget_name": "DAO.ChangePolicy", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"meta.sputnik-dao.near\";\n\nconst policy = Near.view(daoId, \"get_policy\");\n\nif (policy === null) {\n  return \"Loading...\";\n}\n\nconst deposit = policy.proposal_bond;\n\nconst groups = policy.roles\n  .filter((role) => role.kind.Group)\n  .map((role) => ({\n    name: role.name,\n    members: role.kind.Group,\n  }));\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"reconfigure policy\",\n          kind: {\n            ChangePolicy: {\n              policy: {\n                roles: [\n                  {\n                    name: \"all\",\n                    kind: \"Everyone\",\n                    permissions: [\"call:AddProposal\"],\n                    vote_policy: {},\n                  },\n                  {\n                    name: \"council\",\n                    kind: {\n                      Group: [\"hack.near\"],\n                    },\n                    permissions: [\n                      \"add_member_to_role:AddProposal\",\n                      \"bounty_done:VoteApprove\",\n                      \"add_bounty:VoteReject\",\n                      \"add_bounty:AddProposal\",\n                      \"config:VoteReject\",\n                      \"add_bounty:VoteApprove\",\n                      \"remove_member_from_role:VoteReject\",\n                      \"policy:VoteRemove\",\n                      \"transfer:VoteRemove\",\n                      \"vote:VoteApprove\",\n                      \"upgrade_self:VoteApprove\",\n                      \"call:VoteRemove\",\n                      \"upgrade_self:AddProposal\",\n                      \"upgrade_remote:AddProposal\",\n                      \"upgrade_remote:VoteReject\",\n                      \"upgrade_remote:VoteApprove\",\n                      \"vote:AddProposal\",\n                      \"add_member_to_role:VoteReject\",\n                      \"bounty_done:VoteReject\",\n                      \"call:AddProposal\",\n                      \"upgrade_self:VoteRemove\",\n                      \"add_bounty:VoteRemove\",\n                      \"remove_member_from_role:VoteRemove\",\n                      \"config:VoteRemove\",\n                      \"call:VoteApprove\",\n                      \"add_member_to_role:VoteRemove\",\n                      \"policy:AddProposal\",\n                      \"add_member_to_role:VoteApprove\",\n                      \"policy:VoteApprove\",\n                      \"transfer:VoteApprove\",\n                      \"config:AddProposal\",\n                      \"*:Finalize\",\n                      \"remove_member_from_role:VoteApprove\",\n                      \"set_vote_token:VoteReject\",\n                      \"bounty_done:AddProposal\",\n                      \"set_vote_token:AddProposal\",\n                      \"policy:VoteReject\",\n                      \"set_vote_token:VoteRemove\",\n                      \"remove_member_from_role:AddProposal\",\n                      \"transfer:VoteReject\",\n                      \"transfer:AddProposal\",\n                      \"call:VoteReject\",\n                      \"upgrade_remote:VoteRemove\",\n                      \"upgrade_self:VoteReject\",\n                      \"vote:VoteReject\",\n                      \"bounty_done:VoteRemove\",\n                      \"vote:VoteRemove\",\n                      \"set_vote_token:VoteApprove\",\n                      \"config:VoteApprove\",\n                    ],\n                    vote_policy: {\n                      add_member_to_role: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      remove_member_from_role: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      call: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      transfer: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      set_vote_token: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      policy: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      config: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      upgrade_self: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      upgrade_remote: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      add_bounty: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      bounty_done: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      vote: {\n                        quorum: \"0\",\n                        threshold: [1, 2],\n                        weight_kind: \"RoleWeight\",\n                      },\n                    },\n                  },\n                  {\n                    name: \"community\",\n                    kind: {\n                      Group: [\"infinity.near\"],\n                    },\n                    permissions: [],\n                    vote_policy: {\n                      add_member_to_role: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      remove_member_from_role: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      call: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      transfer: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      set_vote_token: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      policy: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      config: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      upgrade_self: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      upgrade_remote: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      add_bounty: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      bounty_done: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                      vote: {\n                        quorum: \"0\",\n                        threshold: [69, 100],\n                        weight_kind: \"RoleWeight\",\n                      },\n                    },\n                  },\n                ],\n                default_vote_policy: {\n                  quorum: \"0\",\n                  threshold: [1, 2],\n                  weight_kind: \"RoleWeight\",\n                },\n                proposal_bond: \"100000000000000000000000\",\n                proposal_period: \"604800000000000\",\n                bounty_bond: \"100000000000000000000000\",\n                bounty_forgiveness_period: \"604800000000000\",\n              },\n            },\n          },\n        },\n      },\n      gas: 300000000000000,\n      deposit: deposit,\n    },\n  ]);\n};\n\nreturn (\n  <div>\n    <button\n      disabled={!daoId}\n      className=\"btn btn-outline-success\"\n      onClick={handleProposal}\n    >\n      Propose Changes\n    </button>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/DAO.ChangePolicy", "__row_index": 2}