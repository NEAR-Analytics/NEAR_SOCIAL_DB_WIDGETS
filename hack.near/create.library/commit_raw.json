{"tx_hash": "6RLuj2Y1Ch5DEC8iXXDZC4izfLuMX2AsF7spRv3p4Pde", "action_id_social": "71zGdXyT9yjYH3CwuMJNDDcKmaRKpmiKpC5X5jJEQXzW-0-widget", "block_id": 94487977, "block_timestamp": "2023-06-18T20:32:52.598Z", "signer_id": "hack.near", "widget_name": "create.library", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"build.sputnik-dao.near\";\n\nconst policy = Near.view(daoId, \"get_policy\");\n\nconst deposit = policy.proposal_bond;\n\nlet string = \"sputnik-dao.near\";\nlet domain = \".near\";\n\nState.init({\n  accountId: accountId ?? \"\",\n  daoId: daoId ?? \"\",\n  data: props.data ?? \"\",\n  isDao: false,\n  isAccount: false,\n  isAddress: false,\n});\n\nconst checkDao = (daoId) => {\n  if (daoId.indexOf(string) !== -1) {\n    return State.update({ isDao: true });\n  }\n};\n\nconst checkOrgAccount = (daoId) => {\n  if (daoId.indexOf(domain) !== -1) {\n    return State.update({ isAddress: true });\n  }\n};\n\nconst checkAccount = (accountId) => {\n  if (accountId.indexOf(domain) !== -1) {\n    return State.update({ isAccount: true });\n  }\n};\n\nconst validDao = checkDao(state.daoId);\nconst validAccount = checkAccount(state.accountId);\nconst validOrgAccount = checkOrgAccount(state.daoId);\n\nconst curation_args = state.data;\n\nconst proposal_args = Buffer.from(curation_args, \"utf-8\").toString(\"base64\");\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: state.daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"update library\",\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: proposal_args,\n                  deposit: \"50000000000000000000000\",\n                  gas: \"30000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: deposit,\n      gas: \"300000000000000\",\n    },\n  ]);\n};\n\nconst handleGrant = () => {\n  Near.call([\n    {\n      contractName: \"social.near\",\n      methodName: \"grant_write_permission\",\n      args: {\n        predecessor_id: state.accountId,\n        keys: [state.daoId],\n      },\n      deposit: \"1\",\n    },\n  ]);\n};\n\nconst onChangeDao = (daoId) => {\n  State.update({\n    daoId,\n  });\n};\n\nconst onChangeData = (data) => {\n  State.update({\n    data,\n  });\n};\n\nreturn (\n  <div className=\"d-flex flex-column\">\n    <div className=\"d-flex p-1 m-1 flex-row\">\n      <Widget\n        src=\"mob.near/widget/ProfileImage\"\n        props={{ accountId: state.daoId }}\n      />\n      <h1 className=\"px-2\">Settings</h1>\n    </div>\n    <div className=\"p-1 m-1\">\n      <p>{proposal_args}</p>\n\n      <div>\n        <h2>\n          <b>Organization Account:</b>\n        </h2>\n        {!validOrgAccount ? (\n          <p>\n            \u21b3 must be a valid NEAR account ~ <i>example.near</i>\n          </p>\n        ) : (\n          <div>\n            <p>\u21b3 must have permission to propose function calls</p>\n          </div>\n        )}\n        <input\n          placeholder=\"<example>.sputnik-dao.near\"\n          type=\"text\"\n          value={state.daoId}\n          onChange={(e) => onChangeDao(e.target.value)}\n        ></input>\n      </div>\n    </div>\n    {validOrgAccount && (\n      <div className=\"p-1 m-1\">\n        <h3>Propose Update:</h3>\n        <div className=\"w-100 d-flex gap-2\">\n          <div>\n            {validDao && (\n              <div>\n                <p>\u21b3 propose to update our components library</p>\n              </div>\n            )}\n          </div>\n        </div>\n        <div className=\"w-100 d-flex gap-2\">\n          <input\n            placeholder=\"JSON goes here\"\n            type=\"text\"\n            value={state.data}\n            onChange={(e) => onChangeData(e.target.value)}\n          ></input>\n          <div>\n            <button disabled={!validDao} onClick={handleProposal}>\n              Submit\n            </button>\n          </div>\n        </div>\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/create.library", "__row_index": 3}