{"tx_hash": "9f49yNPe8n94rDa4V1ewBWU2n1tyKVYWeyRtUZqmoFkY", "action_id_social": "8c7sQTs3VBRrKDyjmMWndwYJ47W3xJVi4bUM5c1FDUWe-0-widget", "block_id": 94487861, "block_timestamp": "2023-06-18T20:30:41.643Z", "signer_id": "hack.near", "widget_name": "create.library", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"build.sputnik-dao.near\";\n\nconst policy = Near.view(daoId, \"get_policy\");\n\nconst deposit = policy.proposal_bond;\n\nlet string = \"sputnik-dao.near\";\nlet domain = \".near\";\n\nState.init({\n  accountId: accountId ?? \"\",\n  daoId: daoId ?? \"\",\n  data,\n  isDao: false,\n  isAccount: false,\n  isAddress: false,\n});\n\nconst checkDao = (daoId) => {\n  if (daoId.indexOf(string) !== -1) {\n    return State.update({ isDao: true });\n  }\n};\n\nconst checkOrgAccount = (daoId) => {\n  if (daoId.indexOf(domain) !== -1) {\n    return State.update({ isAddress: true });\n  }\n};\n\nconst checkAccount = (accountId) => {\n  if (accountId.indexOf(domain) !== -1) {\n    return State.update({ isAccount: true });\n  }\n};\n\nconst validDao = checkDao(state.daoId);\nconst validAccount = checkAccount(state.accountId);\nconst validOrgAccount = checkOrgAccount(state.daoId);\n\nconst curation_args = [\n  {\n    category: \"Buttons\",\n    id: \"buttons\",\n    icon: \"bi-egg\",\n    components: [\n      { accountId: \"mob.near\", widgetName: \"CopyButton\" },\n      { accountId: \"mob.near\", widgetName: \"CommentButton\" },\n      { accountId: \"rubycop.near\", widgetName: \"NftVotingButton\" },\n      { accountId: \"mob.near\", widgetName: \"LikeButton\" },\n      { accountId: \"mob.near\", widgetName: \"LikeButton.Faces\" },\n      { accountId: \"mob.near\", widgetName: \"FollowButton\" },\n      { accountId: \"mob.near\", widgetName: \"NotificationButton\" },\n      { accountId: \"mob.near\", widgetName: \"PokeButton\" },\n      { accountId: \"peechz.near\", widgetName: \"TwitterFollowButton\" },\n    ],\n  },\n  {\n    category: \"Search\",\n    icon: \"bi-search\",\n    id: \"search\",\n    components: [\n      { accountId: \"mob.near\", widgetName: \"ComponentSearch\" },\n      { accountId: \"mob.near\", widgetName: \"ComponentSearch.Item\" },\n      { accountId: \"manzanal.near\", widgetName: \"SerchComponent\" },\n    ],\n  },\n  {\n    category: \"Time and Date\",\n    id: \"time\",\n    icon: \"bi-calendar\",\n    components: [{ accountId: \"mob.near\", widgetName: \"TimeAgo\" }],\n  },\n  {\n    category: \"Compose\",\n    id: \"compose\",\n    icon: \"bi-envelope-paper\",\n    components: [{ accountId: \"mob.near\", widgetName: \"Common.Compose\" }],\n  },\n  {\n    category: \"Markdown\",\n    id: \"markdown\",\n    icon: \"bi-markdown\",\n    components: [{ accountId: \"mob.near\", widgetName: \"MarkdownEditorDemo\" }],\n  },\n  {\n    category: \"Metadata\",\n    id: \"metadata\",\n    icon: \"bi-box-seam\",\n    components: [{ accountId: \"mob.near\", widgetName: \"MetadataEditor\" }],\n  },\n  {\n    category: \"Widget Tools\",\n    id: \"tools\",\n    icon: \"bi-tools\",\n    components: [\n      { accountId: \"mob.near\", widgetName: \"Explorer\" },\n      { accountId: \"mob.near\", widgetName: \"WidgetHistory\" },\n      { accountId: \"mob.near\", widgetName: \"WidgetSource\" },\n    ],\n  },\n];\n\nconst proposal_args = Buffer.from(curation_args, \"utf-8\").toString(\"base64\");\n\nconst handleProposal = () => {\n  Near.call([\n    {\n      contractName: state.daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"update library\",\n          kind: {\n            FunctionCall: {\n              receiver_id: \"social.near\",\n              actions: [\n                {\n                  method_name: \"set\",\n                  args: proposal_args,\n                  deposit: \"50000000000000000000000\",\n                  gas: \"30000000000000\",\n                },\n              ],\n            },\n          },\n        },\n      },\n      deposit: deposit,\n      gas: \"300000000000000\",\n    },\n  ]);\n};\n\nconst handleGrant = () => {\n  Near.call([\n    {\n      contractName: \"social.near\",\n      methodName: \"grant_write_permission\",\n      args: {\n        predecessor_id: state.accountId,\n        keys: [state.daoId],\n      },\n      deposit: \"1\",\n    },\n  ]);\n};\n\nconst onChangeDao = (daoId) => {\n  State.update({\n    daoId,\n  });\n};\n\nconst onChangeData = (data) => {\n  State.update({\n    data,\n  });\n};\n\nreturn (\n  <div className=\"d-flex flex-column\">\n    <div className=\"d-flex p-1 m-1 flex-row\">\n      <Widget\n        src=\"mob.near/widget/ProfileImage\"\n        props={{ accountId: state.daoId }}\n      />\n      <h1 className=\"px-2\">Settings</h1>\n    </div>\n    <div className=\"p-1 m-1\">\n      <p>{proposal_args}</p>\n\n      <div>\n        <h2>\n          <b>Organization Account:</b>\n        </h2>\n        {!validOrgAccount ? (\n          <p>\n            \u21b3 must be a valid NEAR account ~ <i>example.near</i>\n          </p>\n        ) : (\n          <div>\n            <p>\u21b3 must have permission to propose function calls</p>\n          </div>\n        )}\n        <input\n          placeholder=\"<example>.sputnik-dao.near\"\n          type=\"text\"\n          value={state.daoId}\n          onChange={(e) => onChangeDao(e.target.value)}\n        ></input>\n      </div>\n    </div>\n    {validOrgAccount && (\n      <div className=\"p-1 m-1\">\n        <h3>Propose Update:</h3>\n        <div className=\"w-100 d-flex gap-2\">\n          <div>\n            {validDao && (\n              <div>\n                <p>\u21b3 propose to update our components library</p>\n              </div>\n            )}\n          </div>\n        </div>\n        <div className=\"w-100 d-flex gap-2\">\n          <input\n            placeholder=\"JSON goes here\"\n            type=\"text\"\n            value={state.data}\n            onChange={(e) => onChangeData(e.target.value)}\n          ></input>\n          <div>\n            <button disabled={!validDao} onClick={handleProposal}>\n              Submit\n            </button>\n          </div>\n        </div>\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/hack.near/widget/create.library", "__row_index": 4}