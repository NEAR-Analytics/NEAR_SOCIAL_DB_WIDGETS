{"tx_hash": "9VZon5dJRQuNxsqyZqoeMD1iDSWowH96FBLf5rz9o5tG", "action_id_social": "3nAQYZ6NYc6PHLDSoAuoBex94Nd6SxWRbVv2tQwT8UTy-0-widget", "block_id": 86566537, "block_timestamp": "2023-03-04 21:52:45.145", "signer_id": "mob.near", "widget_name": "Insta.Compose", "source_code": "State.init({\n  loading: false,\n});\n\nconst ipfsUrl = (cid) => `https://ipfs.near.social/ipfs/${cid}`;\n\nconst filesOnChange = (files) => {\n  if (files?.length > 0) {\n    State.update({\n      loading: true,\n    });\n    const body = files[0];\n    asyncFetch(\"https://ipfs.near.social/add\", {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n      },\n      body,\n    })\n      .then((res) => {\n        const content = {\n          type: \"insta\",\n          image: { ipfs_cid: res.body.cid },\n        };\n        const data = {\n          post: {\n            insta: JSON.stringify(content),\n          },\n          index: {\n            post: JSON.stringify({\n              key: \"insta\",\n              value: {\n                type: \"insta\",\n              },\n            }),\n          },\n        };\n        State.update({\n          uploaded: true,\n        });\n        Social.set(data, {\n          force: true,\n          onCommit: () => {\n            setTimeout(() => {\n              State.update({\n                uploaded: false,\n              });\n            }, 3500);\n          },\n        });\n      })\n      .finally(() => {\n        State.update({\n          loading: false,\n        });\n      });\n  } else {\n    State.update({\n      img: null,\n    });\n  }\n};\n\nconst Wrapper = styled.div`\n  @media (min-width: 576px) {\n    max-width: 288px;\n  }\n  > div {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n`;\n\nconst loader = (\n  <span\n    className=\"spinner-grow spinner-grow-sm me-1\"\n    role=\"status\"\n    aria-hidden=\"true\"\n  />\n);\n\nreturn (\n  <Wrapper className=\"text-bg-light ratio ratio-1x1\">\n    <Files\n      multiple={false}\n      accepts={[\"image/*\"]}\n      minFileSize={1}\n      clickable\n      onChange={filesOnChange}\n      className=\"btn\"\n    >\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"80%\"\n        height=\"80%\"\n        viewBox=\"0 0 16 16\"\n        className=\"position-absolute top-50 start-50 translate-middle\"\n        style={{ opacity: 0.05 }}\n      >\n        <path d=\"M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z\" />\n        <path d=\"M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z\" />\n      </svg>\n      {state.uploaded ? (\n        <div>\n          {loader}\n          Posting\n        </div>\n      ) : state.loading ? (\n        <div>{loader} Uploading</div>\n      ) : (\n        <div>\n          <i className=\"bi bi-cloud-arrow-up\" />\n          Upload a photo\n        </div>\n      )}\n    </Files>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/Insta.Compose"}