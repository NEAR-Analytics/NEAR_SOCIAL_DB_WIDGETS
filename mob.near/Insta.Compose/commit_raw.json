{"tx_hash": "BHzSBVX8cVWJvTnZ73HghzsjS7pPxCB2TMXNcjtEk1Az", "action_id_social": "HyVuznb6oSF9628NUQ1cBNgwXu7BxodbB6pPR4nadTbX-0-widget", "block_id": 86564231, "block_timestamp": "2023-03-04 21:08:06.744", "signer_id": "mob.near", "widget_name": "Insta.Compose", "source_code": "State.init({\n  loading: false,\n});\n\nconst ipfsUrl = (cid) => `https://ipfs.near.social/ipfs/${cid}`;\n\nconst filesOnChange = (files) => {\n  if (files?.length > 0) {\n    State.update({\n      loading: true,\n    });\n    const body = files[0];\n    asyncFetch(\"https://ipfs.near.social/add\", {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n      },\n      body,\n    })\n      .then((res) => {\n        const content = {\n          type: \"insta\",\n          image: { ipfs_cid: res.body.cid },\n        };\n        const data = {\n          post: {\n            insta: JSON.stringify(content),\n          },\n          index: {\n            post: JSON.stringify({\n              key: \"insta\",\n              value: {\n                type: \"insta\",\n              },\n            }),\n          },\n        };\n        State.update({\n          uploaded: true,\n        });\n        Social.set(data, {\n          force: true,\n          onCommit: () => {\n            setTimeout(() => {\n              State.update({\n                uploaded: false,\n              });\n            }, 3500);\n          },\n        });\n      })\n      .finally(() => {\n        State.update({\n          loading: false,\n        });\n      });\n  } else {\n    State.update({\n      img: null,\n    });\n  }\n};\n\nconst Wrapper = styled.div`\n  @media (min-width: 576px) {\n    max-width: 288px;\n  }\n  > div {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n`;\n\nreturn (\n  <Wrapper className=\"text-bg-light ratio ratio-1x1\">\n    <Files\n      multiple={false}\n      accepts={[\"image/*\"]}\n      minFileSize={1}\n      clickable\n      onChange={filesOnChange}\n      className=\"btn\"\n    >\n      {state.uploaded ? (\n        <div>\n          <i className=\"bi bi-cloud-check\" />\n          Uploaded\n        </div>\n      ) : state.loading ? (\n        <>\n          <span\n            className=\"spinner-grow spinner-grow-sm me-1\"\n            role=\"status\"\n            aria-hidden=\"true\"\n          />{\" \"}\n          Uploading\n        </>\n      ) : (\n        <div>\n          <i className=\"bi bi-cloud-arrow-up\" />\n          Upload a photo\n        </div>\n      )}\n    </Files>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/Insta.Compose"}