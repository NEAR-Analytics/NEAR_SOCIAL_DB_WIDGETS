{"tx_hash": "DHcipEUKW93dsJrK3APbHf3bMj5wt5CrDDYxHLtdn2KF", "action_id_social": "PReXgPSHbXxCxDU7kgCbGFDaGZWkYSG6p95JehBngGS-0-widget", "block_id": 78833248, "block_timestamp": "2022-11-20 02:18:25.106", "signer_id": "mob.near", "widget_name": "PublicTags", "source_code": "// ContractPage\nconst ownerId = \"mob.near\";\nconst appName = \"nametag\";\nconst accountId = props.accountId ?? context.accountId;\nconst extraTags = props.extraTags;\n\nconst tagsPattern = `*/${appName}/${accountId}/tags/*`;\nconst tagsObject = Social.keys(tagsPattern, \"final\");\n\nconst tagClass = \"bg-success\";\nconst addPublicTagHtml = (\n  <div class={`me-1 badge bg-primary`}>\n    <a\n      href={`#/mob.near/widget/AllLabels?accountId=${accountId}`}\n      class=\"text-white\"\n    >\n      + Add Name Tag\n    </a>\n  </div>\n);\n\nif (tagsObject === null) {\n  return \"Loading\";\n}\n\nconst tagsCount = {};\n\nconst processTagsObject = (obj) => {\n  Object.entries(obj).forEach((kv) => {\n    if (kv[1] === null) {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) - 1;\n    } else if (typeof kv[1] === \"object\") {\n      processTagsObject(kv[1]);\n    } else {\n      const tag = kv[0];\n      tagsCount[tag] = (tagsCount[tag] || 0) + 1;\n    }\n  });\n};\n\nconst getTags = () => {\n  if (extraTags) {\n    processTagsObject(extraTags);\n    tagsObject[context.accountId] = {};\n  }\n  processTagsObject(tagsObject);\n  const tags = Object.entries(tagsCount);\n  tags.sort((a, b) => b[1] - a[1]);\n  return tags.map((t) => {\n    return {\n      name: t[0],\n      count: t[1],\n      title: t[1] + (t[1] > 1 ? \" votes\" : \" vote\"),\n    };\n  });\n};\n\nconst publicTags = getTags();\nreturn (\n  <>\n    {publicTags &&\n      publicTags.map((tag) => (\n        <span\n          className={`badge ${tagClass} position-relative`}\n          title={tag.title}\n          style={\n            tag.count > 1\n              ? {\n                  marginRight: \"0.9em\",\n                  paddingRight: \"0.85em\",\n                }\n              : { marginRight: \"0.25em\" }\n          }\n        >\n          #{tag.name}\n          {tag.count > 1 && (\n            <span\n              className={`badge translate-middle rounded-pill bg-danger position-absolute top-50 start-100`}\n            >\n              {tag.count}\n            </span>\n          )}\n        </span>\n      ))}\n    {addPublicTagHtml}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/PublicTags"}