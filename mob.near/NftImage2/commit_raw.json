{"tx_hash": "DeTv5PXQGkGk5yUwiEKJQqGdGaT9XMDoubdCTwpzB3xm", "action_id_social": "ENhNBEHLtfRBYCvkYppaEmF3E3HrGL1nNLWTQm1rJt1m-0-widget", "block_id": 79565449, "block_timestamp": "2022-11-30 01:21:03.887", "signer_id": "mob.near", "widget_name": "NftImage2", "source_code": "const nft = props.nft ?? {\n  contractId: props.contractId,\n  tokenId: props.tokenId,\n};\nconst contractId = nft.contractId;\nconst tokenId = nft.tokenId;\nconst className = props.className ?? \"img-fluid\";\nconst style = props.style;\nconst alt = props.alt;\nconst thumbnail = props.thumbnail;\nconst fallbackUrl = props.fallbackUrl;\nconst loadingUrl =\n  props.loadingUrl ??\n  \"https://ipfs.near.social/ipfs/bafkreidoxgv2w7kmzurdnmflegkthgzaclgwpiccgztpkfdkfzb4265zuu\";\n\nState.init({\n  contractId,\n  tokenId,\n});\n\nif (contractId !== state.contractId || tokenId !== tokenId) {\n  State.update({\n    contractId,\n    tokenId,\n    imageUrl: null,\n  });\n}\n\nconst nftMetadata = Near.view(contractId, \"nft_metadata\");\nconst nftToken = Near.view(contractId, \"nft_token\", {\n  token_id: tokenId,\n});\n\nlet imageUrl = loadingUrl;\n\nif (nftMetadata && nftToken) {\n  let tokenMetadata = nftToken.metadata;\n  let tokenMedia = tokenMetadata.media || \"\";\n\n  const ownerId = nftToken.owner_id[\"Account\"]\n    ? nftToken.owner_id[\"Account\"]\n    : nftToken.owner_id;\n\n  imageUrl =\n    tokenMedia.startsWith(\"https://\") ||\n    tokenMedia.startsWith(\"http://\") ||\n    tokenMedia.startsWith(\"data:image\")\n      ? tokenMedia\n      : nftMetadata.base_uri\n      ? `${nftMetadata.base_uri}/${tokenMedia}`\n      : tokenMedia.startsWith(\"Qm\")\n      ? `https://ipfs.near.social/ipfs/${tokenMedia}`\n      : tokenMedia;\n\n  if (\n    !tokenMedia &&\n    tokenMetadata.reference &&\n    nftMetadata.base_uri === \"https://arweave.net\"\n  ) {\n    const res = fetch(`${nftMetadata.base_uri}/${tokenMetadata.reference}`);\n    imageUrl = res.body.media;\n  }\n\n  if (!imageUrl) {\n    imageUrl = fallbackUrl;\n  }\n}\n\nconst replaceIpfs = () => {\n  if (!state.imageUrl && imageUrl) {\n    const match =\n      /^(?:https?:\\/\\/[^\\/]+\\/ipfs\\/)?(Qm[1-9A-HJ-NP-Za-km-z]{44,}|b[A-Za-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,}|F[0-9A-F]{50,})(\\/.*)?$/g.exec(\n        imageUrl\n      );\n    if (match) {\n      const newImageUrl = `https://ipfs.near.social/ipfs/${match[1]}${\n        match[2] || \"\"\n      }`;\n      if (newImageUrl !== imageUrl) {\n        State.update({\n          imageUrl: newImageUrl,\n        });\n        return;\n      }\n    }\n  }\n  if (state.imageUrl !== fallbackUrl) {\n    State.update({\n      imageUrl: fallbackUrl,\n    });\n  }\n};\n\nconst thumb = (imageUrl) =>\n  thumbnail ? `https://i.near.social/${thumbnail}/${imageUrl}` : imageUrl;\n\nconsole.log(contractId, tokenId, imageUrl);\n\nreturn (\n  <img\n    className={className}\n    style={style}\n    src={state.imageUrl ? thumb(state.imageUrl) : thumb(imageUrl)}\n    alt={alt}\n    onError={replaceIpfs}\n  />\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/NftImage2"}