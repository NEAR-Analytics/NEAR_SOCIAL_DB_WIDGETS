{"tx_hash": "4ei7CGFek7VWCQn16UijjCCrS9QrdpZ2WfmEsBZoqBjb", "action_id_social": "GYw1GP6VDfXg8jc9Dy7JEZKqpPQoXvKMPUickxqbLRBz-0-widget", "block_id": 88389966, "block_timestamp": "2023-03-29 20:12:19.754", "signer_id": "mob.near", "widget_name": "RepostButton", "source_code": "const item = props.item;\n\nif (!item) {\n  return \"\";\n}\n\nconst reposts = Social.index(\"repost\", item);\n\nconst dataLoading = reposts === null;\n\nconst repostsByUsers = Object.fromEntries(\n  (reposts || [])\n    .filter((repost) => repost.value.type === \"repost\")\n    .map((repost) => [repost.accountId, repost])\n);\n\nif (state.hasRepost === true) {\n  repostsByUsers[context.accountId] = {\n    accountId: context.accountId,\n  };\n}\n\nconst accountsWithReposts = Object.keys(repostsByUsers);\nconst hasRepost = context.accountId && !!repostsByUsers[context.accountId];\n\nconst RepostButton = styled.button`\n  border: 0;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n  width: 2.5em;\n  height: 2.5em;\n  fill: currentColor;\n  svg {\n    margin-top: -0.2em;\n  }\n  &:hover {\n    color: rgb(0, 184, 124);\n    background: rgb(0, 184, 124, 0.1);\n  }\n  .reposted {\n    color: rgb(0, 184, 124);\n  }\n`;\n\nconst repostClick = () => {\n  if (state.loading) {\n    return;\n  }\n  State.update({\n    loading: true,\n  });\n  const reposts = [\n    {\n      key: \"main\",\n      value: {\n        type: \"repost\",\n        item,\n      },\n    },\n  ];\n  if (!hasRepost) {\n    reposts.push({\n      key: item,\n      value: {\n        type: \"repost\",\n      },\n    });\n  }\n  const data = {\n    index: {\n      repost: JSON.stringify(reposts),\n    },\n  };\n\n  if (!hasRepost && props.notifyAccountId) {\n    data.index.notify = JSON.stringify({\n      key: props.notifyAccountId,\n      value: {\n        type: \"repost\",\n        item,\n      },\n    });\n  }\n  Social.set(data, {\n    onCommit: () => State.update({ loading: false, hasRepost: true }),\n    onCancel: () => State.update({ loading: false }),\n  });\n};\n\nconst title = \"Repost\";\n\nconst repostSvg = (\n  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24px\" viewBox=\"0 0 576 512\">\n    <path d=\"M272 416c17.7 0 32-14.3 32-32s-14.3-32-32-32H160c-17.7 0-32-14.3-32-32V192h32c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8l32 0 0 128c0 53 43 96 96 96H272zM304 96c-17.7 0-32 14.3-32 32s14.3 32 32 32l112 0c17.7 0 32 14.3 32 32l0 128H416c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8l-32 0V192c0-53-43-96-96-96L304 96z\" />\n  </svg>\n);\n\nreturn (\n  <div className=\"d-inline-flex align-items-center\">\n    <RepostButton\n      disabled={state.loading || dataLoading || !context.accountId}\n      className=\"btn me-1\"\n      title={title}\n      onClick={repostClick}\n    >\n      {state.loading || dataLoading ? (\n        <span\n          className=\"spinner-grow spinner-grow-sm p-2\"\n          role=\"status\"\n          aria-hidden=\"true\"\n        />\n      ) : (\n        <span className={`bi fs-4 ${hasRepost ? \"reposted\" : \"\"}`}>\n          {repostSvg}\n        </span>\n      )}\n    </RepostButton>\n    <Widget\n      src=\"mob.near/widget/LikeButton.Faces\"\n      props={{ likesByUsers: repostsByUsers }}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mob.near/widget/RepostButton"}