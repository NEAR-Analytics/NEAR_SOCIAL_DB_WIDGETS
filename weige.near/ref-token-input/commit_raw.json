{"tx_hash": "AjYK8v2cgcodfJncU2e14Bbs6wvnhEwDv7X7j8FhhC85", "action_id_social": "ExgabfN2fiSPeb2RDtg3tp7aoTsfixutZ4EHtc5WdFT7-0-widget", "block_id": 88720814, "block_timestamp": "2023-04-03 11:49:48.592", "signer_id": "weige.near", "widget_name": "ref-token-input", "source_code": "const accountId = context.accountId;\n\nconst REF_FI_CONTRACT = \"v2.ref-finance.near\";\n\nconst ArrowDown = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"14\"\n    height=\"8\"\n    viewBox=\"0 0 14 8\"\n    fill=\"none\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M0.231804 0.359841C0.585368 -0.0644363 1.21593 -0.12176 1.64021 0.231804L7.00003 4.69832L12.3598 0.231804C12.7841 -0.12176 13.4147 -0.0644363 13.7682 0.359841C14.1218 0.784118 14.0645 1.41468 13.6402 1.76825L7.00003 7.30173L0.359841 1.76825C-0.0644363 1.41468 -0.12176 0.784118 0.231804 0.359841Z\"\n      fill=\"white\"\n    />\n  </svg>\n);\n\nconst TokenAmount = styled.div`\n    background: #1A2E33;\n    border-radius: 12px;\n    width:430px;\n    padding: 18px 16px;\n    color: white;\n    display: flex;\n    align-items:center\n`;\n\nconst Input = styled.input`\n    appearance: none;\n    outline: none;\n    width: 100%;\n    background: none;\n    border: none;\n    font-size:20px;\n    ::placeholder{\n        color:#7e8a93\n    }\n    color:white;\n    ::-webkit-outer-spin-button, \n    ::-webkit-inner-spin-button {   \n    -webkit-appearance: none; \n    }\n    -moz-appearance: textfield; \n`;\n\nconst TokenWrapper = styled.div`\n    display: flex;\n    align-items:center;\n    color:white;\n    cursor:pointer;\n`;\n\nconst Icon = styled.img`\n\n  height:26px;\n  width:26px;\n  border-radius:100%;\n`;\n\nconst Symbol = styled.span`\n  margin-right:8px;\n  margin-left:8px;\n  font-size:18px;\n`;\n\nconst account = fetch(\"https://rpc.mainnet.near.org\", {\n  method: \"POST\",\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n  body: JSON.stringify({\n    jsonrpc: \"2.0\",\n    id: \"dontcare\",\n    method: \"query\",\n    params: {\n      request_type: \"view_account\",\n      finality: \"final\",\n      account_id: accountId,\n    },\n  }),\n});\n\nconst shrinkToken = (value, decimals) => {\n  return new Big(value || 0).div(new Big(10).pow(decimals)).toFixed();\n};\n\nconst formatToken = (v) => Math.floor(v * 10_000) / 10_000;\n\nconst formatTokenBig = (v, decimals) =>\n  Math.floor(v * Math.pow(10, Math.min(decimals, 8))) /\n  Math.pow(10, Math.min(decimals, 8));\n\nconst getBalance = (token_id) => {\n  let amount;\n\n  if (!accountId) {\n    return \"-\";\n  }\n\n  if (token_id === \"NEAR\") amount = account.body.result.amount;\n  else {\n    amount = Near.view(token_id, \"ft_balance_of\", {\n      account_id: accountId,\n    });\n  }\n\n  return !!amount\n    ? formatToken(shrinkToken(amount, props.token.decimals))\n    : \"-\";\n};\n\nconst { amount, setAmount, handleSelect, disableInput } = props;\n\nState.init({\n  show: false,\n  handleClose: () => {\n    State.update({\n      show: false,\n    });\n  },\n  handleOpen: () => {\n    State.update({\n      show: true,\n    });\n  },\n});\n\nconst inputOnChange = (e) => {\n  const value = e.target.value;\n\n  setAmount(value);\n};\n\nconst BalanceWrapper = styled.div`\n   color: #304352;\n   font-size:12px;\n   margin-left:8px;\n   padding-top:4px\n`;\n\nconst Wrapper = styled.div`\n   position:relative;\n   margin-top: 8px\n`;\n\nconst SelectToken = (\n  <Widget\n    src={`weige.near/widget/selectToken`}\n    props={{\n      show: state.show || false,\n      handleClose: state.handleClose,\n      handleSelect: (metadata) => {\n        handleSelect(metadata);\n        state.handleClose();\n      },\n    }}\n  />\n);\n\nreturn (\n  <Wrapper>\n    <TokenAmount>\n      <Input\n        class=\"ref-token-inut\"\n        placeholder=\"0.0\"\n        onChange={inputOnChange}\n        min=\"0\"\n        step=\"any\"\n        value={\n          !!disableInput ? formatTokenBig(amount, props.token.decimals) : amount\n        }\n        disabled={!!disableInput}\n        type=\"number\"\n        inputMode=\"decimal\"\n      />\n\n      <TokenWrapper\n        onClick={() => {\n          state.handleOpen();\n        }}\n      >\n        <Icon src={props.token.icon} />\n        <Symbol>{props.token.symbol}</Symbol>\n        {ArrowDown}\n      </TokenWrapper>\n    </TokenAmount>\n    <BalanceWrapper>\n      Balance: {accountId ? getBalance(props.token.id) : \"-\"}\n    </BalanceWrapper>\n\n    {SelectToken}\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/weige.near/widget/ref-token-input"}