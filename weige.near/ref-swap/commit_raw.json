{"tx_hash": "EKzfiNm5D3ypnBG1yR4V6Q1acGpqRVkbdpQG23i72f4X", "action_id_social": "AcKyS2Tk2Vr8YD2puKsgNobaDfNsPG1EVRMpFA4Pz96W-0-widget", "block_id": 88590810, "block_timestamp": "2023-04-01 16:23:26.935", "signer_id": "weige.near", "widget_name": "ref-swap", "source_code": "const accountId = context.accountId;\n\nconst shrinkToken = (value, decimals) => {\n  return new Big(value || 0).div(new Big(10).pow(decimals || 24));\n};\n\nconst account = fetch(\"https://rpc.mainnet.near.org\", {\n  method: \"POST\",\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n  body: JSON.stringify({\n    jsonrpc: \"2.0\",\n    id: \"dontcare\",\n    method: \"query\",\n    params: {\n      request_type: \"view_account\",\n      finality: \"final\",\n      account_id: accountId,\n    },\n  }),\n});\n\nconst ArrowDown = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"14\"\n    height=\"8\"\n    viewBox=\"0 0 14 8\"\n    fill=\"none\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M0.231804 0.359841C0.585368 -0.0644363 1.21593 -0.12176 1.64021 0.231804L7.00003 4.69832L12.3598 0.231804C12.7841 -0.12176 13.4147 -0.0644363 13.7682 0.359841C14.1218 0.784118 14.0645 1.41468 13.6402 1.76825L7.00003 7.30173L0.359841 1.76825C-0.0644363 1.41468 -0.12176 0.784118 0.231804 0.359841Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nconst getBalance = (token_id, tokenMeta) => {\n  let amount;\n\n  if (token_id === \"NEAR\") amount = account.body.result.amount;\n  else {\n    amount = Near.view(token_id, \"ft_balance_of\", {\n      account_id: accountId,\n    });\n  }\n\n  return !amount ? \"0\" : shrinkToken(amount, tokenMeta.decimals).toFixed();\n};\n\nconst RefreshIcon = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"14\"\n    height=\"14\"\n    viewBox=\"0 0 14 14\"\n    fill=\"none\"\n  >\n    <path\n      d=\"M0 7C0 7.55228 0.447715 8 1 8C1.55228 8 2 7.55228 2 7H0ZM12 7C12 9.76142 9.76142 12 7 12V14C10.866 14 14 10.866 14 7H12ZM2 7C2 4.23858 4.23858 2 7 2V0C3.13401 0 0 3.13401 0 7H2ZM7 2C9.76142 2 12 4.23858 12 7H14C14 3.13401 10.866 0 7 0V2Z\"\n      fill=\"#00FFD1\"\n    />\n  </svg>\n);\n\nconst REF_TOKEN_META = {\n  decimals: 18,\n  icon: \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='16 24 248 248' style='background: %23000'%3E%3Cpath d='M164,164v52h52Zm-45-45,20.4,20.4,20.6-20.6V81H119Zm0,18.39V216h41V137.19l-20.6,20.6ZM166.5,81H164v33.81l26.16-26.17A40.29,40.29,0,0,0,166.5,81ZM72,153.19V216h43V133.4l-11.6-11.61Zm0-18.38,31.4-31.4L115,115V81H72ZM207,121.5h0a40.29,40.29,0,0,0-7.64-23.66L164,133.19V162h2.5A40.5,40.5,0,0,0,207,121.5Z' fill='%23fff'/%3E%3Cpath d='M189 72l27 27V72h-27z' fill='%2300c08b'/%3E%3C/svg%3E%0A\",\n  id: \"token.v2.ref-finance.near\",\n  name: \"Ref Finance Token\",\n  symbol: \"REF\",\n};\n\nconst NEAR_META = {\n  decimals: 24,\n  icon: \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTgiIGN5PSIxOCIgcj0iMTcuNSIgZmlsbD0id2hpdGUiIHN0cm9rZT0iYmxhY2siLz4KPGNpcmNsZSBjeD0iMTgiIGN5PSIxOCIgcj0iMTcuNSIgZmlsbD0id2hpdGUiIHN0cm9rZT0iYmxhY2siLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMC42MDc4IDEyLjUwMjlWMjMuNjE5M0wxNi4yOTIgMTkuMzcyMUwxNi44NjA0IDE5Ljg3MDZMMTIuMDkzOCAyNi41ODQ0QzEwLjMyMjggMjguMjA5MiA3LjE5NzI3IDI3LjEwOTkgNy4xOTcyNyAyNC44NjIyVjExLjEzNzFDNy4xOTcyNyA4LjgxMjI4IDEwLjUwNTggNy43NTMzNCAxMi4yMTMzIDkuNTMxNkwyNS4zODY3IDIzLjI1MDRWMTIuNTkwMkwyMC4yNzEgMTYuMzgxMkwxOS43MDI1IDE1Ljg4MjdMMjMuNzU2NyA5LjYxNTZDMjUuNDQ4OSA3LjgwNDQyIDI4Ljc5NzMgOC44NTM3NiAyOC43OTczIDExLjE5NTNWMjQuNjE2M0MyOC43OTczIDI2Ljk0MTEgMjUuNDg4OCAyOCAyMy43ODEyIDI2LjIyMThMMTAuNjA3OCAxMi41MDI5WiIgZmlsbD0iIzBGMUQyNyIvPgo8L3N2Zz4K\",\n  id: \"NEAR\",\n  name: \"NEAR\",\n  symbol: \"NEAR\",\n};\n\nconst ExchangeIcon = (\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"14\"\n    height=\"14\"\n    viewBox=\"0 0 14 14\"\n    fill=\"none\"\n    style={{\n      cursor: \"pointer\",\n    }}\n    onClick={() => {\n      State.update({\n        tokenIn: state.tokenOut,\n        tokenOut: state.tokenIn,\n      });\n    }}\n  >\n    <path\n      opacity=\"0.5\"\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M8.25977 12.9751C8.25977 13.5274 8.70748 13.9751 9.25977 13.9751C9.81205 13.9751 10.2598 13.5274 10.2598 12.9751L10.2598 3.3924L12.2975 5.40399C12.6905 5.79199 13.3237 5.7879 13.7117 5.39487C14.0997 5.00183 14.0956 4.36868 13.7025 3.98068L9.9623 0.288376C9.6753 0.00505281 9.2462 -0.0781458 8.87411 0.077387C8.50202 0.232919 8.25977 0.596739 8.25977 1.00003L8.25977 12.9751ZM5.27273 1.02496C5.27273 0.472672 4.82501 0.0249573 4.27273 0.0249573C3.72044 0.0249573 3.27273 0.472672 3.27273 1.02496V10.6077L1.70253 9.0576C1.30949 8.6696 0.676343 8.67369 0.288346 9.06672C-0.0996505 9.45976 -0.0955657 10.0929 0.29747 10.4809L3.5702 13.7117C3.8572 13.995 4.2863 14.0782 4.65839 13.9227C5.03048 13.7671 5.27273 13.4033 5.27273 13V1.02496Z\"\n      fill=\"#91A2AE\"\n    />\n  </svg>\n);\n\nconst ExchangeWrapper = styled.div`\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  margin-bottom: 16px;\n  \n`;\n\nconst Exchange = <ExchangeWrapper>{ExchangeIcon}</ExchangeWrapper>;\n\nState.init({\n  tokenIn: NEAR_META,\n  tokenOut: REF_TOKEN_META,\n  amountIn: \"1\",\n  amountOut: \"\",\n  showSetting: false,\n  slippagetolerance: \"0.5\",\n});\n\nconst TokenInInput = (\n  <Widget\n    src={`weige.near/widget/ref-token-input`}\n    props={{\n      amount: state.amountIn,\n      disableInput: false,\n      setAmount: (value) => State.update({ amountIn: value }),\n      token: state.tokenIn,\n      handleSelect: (metadata) =>\n        State.update({\n          tokenIn: metadata,\n        }),\n    }}\n  />\n);\n\nconst TokenOutInput = (\n  <Widget\n    src={`weige.near/widget/ref-token-input`}\n    props={{\n      amount: state.amountOut,\n      disableInput: true,\n      setAmount: (value) => State.update({ amountOut: value }),\n      token: state.tokenOut,\n      handleSelect: (metadata) =>\n        State.update({\n          tokenOut: metadata,\n        }),\n    }}\n  />\n);\n\nconst SlippageSelector = (\n  <Widget\n    src={`weige.near/widget/SlippageTolerance`}\n    props={{\n      showSetting: state.showSetting,\n      slippagetolerance: state.slippagetolerance,\n      setSlippagetolerance: (value) => {\n        State.update({\n          slippagetolerance: value,\n        });\n      },\n    }}\n  />\n);\n\nconst Container = styled.div`\n    width: 430px;\n    color: white;\n    background: rgb(16,16,17)\n`;\n\nconst Refresh = styled.span`\n  margin-left:8px\n`;\n\nconst RefreshText = styled.span`\n  margin-left:4px;\n  font-size: 12px;\n  color: #7E8A93;\n`;\n\nconst RateLine = styled.div`\n  display: flex;\n  align-items:center;\n  justify-content: space-between;\n`;\n\nconst RefreshWrapper = styled.div`\n  display: flex;\n  align-items:center;\n  cursor: pointer\n`;\n\nconst RateWrapper = styled.div`\n  display: flex;\n  align-items:center\n`;\n\nconst SettingWrapper = styled.div`\n  display: flex;\n  align-items:center;\n  padding: 0px 8px\n`;\n\nconst SettingLine = styled.div`\n  border: 1px solid #1A2E33;\n  width: 100%\n\n`;\n\nconst SettingText = styled.span`\n  font-size:12px;\n  padding:0px 8px;\n  display: flex;\n  align-items:center;\n  color: ${(props) => (props.show ? `white` : \"#7e8a93\")};\n  cursor:pointer\n`;\n\nconst ArrowDownWrapper = styled.div`\n  transform: ${(props) =>\n    props.show ? `scale(0.85) rotate(180deg)` : \"scale(0.9)\"};\n  color: ${(props) => (props.show ? `white` : \"#7e8a93\")};\n   position: ${(props) => (props.show ? `relative` : \"\")};\n  top: ${(props) => (props.show ? `2px` : \"\")};\n  cursor:pointer\n`;\n\nconst ButtonWrapper = styled.button`\n  \n  border-radius: 12px;\n  opacity: ${(props) => (props.notEnough ? \"0.5\" : \"1\")};\n  background: ${(props) => (props.notEnough ? \"#FF88B3\" : \"#00FFD1\")};\n  font-weight: 700;\n  font-size: 18px;\n  color:black;\n  width: 100%;\n  display: flex;\n  align-items:center;\n  justify-content: center;\n  outline:none;\n  border:none;\n  padding: 8px 0px;\n  margin-top: 26px\n`;\n\nconst notEnough = new Big(state.amountIn || 0).gt(\n  getBalance(state.tokenIn.id, state.tokenIn)\n);\n\nreturn (\n  <Container>\n    <div\n      style={{\n        fontSize: \"20px\",\n        fontWeight: \"700\",\n      }}\n    >\n      Swap\n    </div>\n\n    {TokenInInput}\n    {Exchange}\n    {TokenOutInput}\n\n    <RateLine>\n      <RefreshWrapper>\n        <Refresh>{RefreshIcon}</Refresh>\n        <RefreshText>Refresh</RefreshText>\n      </RefreshWrapper>\n\n      <RateWrapper></RateWrapper>\n    </RateLine>\n    {SlippageSelector}\n\n    <SettingWrapper>\n      <SettingLine />\n      <SettingText\n        show={state.showSetting}\n        onClick={() => {\n          State.update({\n            showSetting: !state.showSetting,\n          });\n        }}\n      >\n        Setting\n      </SettingText>\n\n      <ArrowDownWrapper\n        onClick={() => {\n          State.update({\n            showSetting: !state.showSetting,\n          });\n        }}\n        show={state.showSetting}\n      >\n        {ArrowDown}\n      </ArrowDownWrapper>\n    </SettingWrapper>\n\n    <ButtonWrapper notEnough={notEnough}>\n      {!accountId\n        ? \"Connect wallet\"\n        : notEnough\n        ? \"Insufficient Balance\"\n        : \"Swap\"}\n    </ButtonWrapper>\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/weige.near/widget/ref-swap"}