{"tx_hash": "AK75LkvcMMAHjMavvswXgXhWF4rRnAzv3Ngwg3s4nP6q", "action_id_social": "FWFbqMUKrvyRuoTAAQ5saVRdPkZ7rMsi6BmtJFPE1VeJ-0-widget", "block_id": 80712066, "block_timestamp": "2022-12-15 14:58:11.552", "signer_id": "jakmeier.near", "widget_name": "CanvasParty", "source_code": "State.init({ form: {} });\n\n/*\nconst onlineState = Social.index(\"canvasParty\", \"session\", {\n  order: \"desc\",\n  limit: 1, // we only want the latest version\n  subscribe: true, // refresh once in 5s\n});\n*/\n\nconst onlineState = Social.get(\n  context.accountId + \"/canvasParty/session/**\",\n  \"optimistic\",\n  {\n    subscribe: true, // refresh once in 5s\n  }\n);\n//console.log(onlineState);\n\nconst main = () => {\n  if (onlineState) {\n    if (onlineState.activePlayer === \"\") {\n      return waiting(onlineState);\n    } else {\n      return noGame();\n    }\n  } else {\n    return noState();\n  }\n};\n\nconst noState = () => {\n  //return <h2>Loading...</h2>;\n  return noGame();\n};\n\nconst noGame = () => {\n  return (\n    <div\n      style={{\n        display: \"grid\",\n        padding: \"10px\",\n      }}\n    >\n      <h2>Join a Canvas Party!</h2>\n      <p>The game currently supports 2-player mode only.</p>\n      <p>\n        Both players need to type in their friends ID for the game to start.\n      </p>\n      <label>\n        Account ID of friend:\n        <input\n          type=\"text\"\n          value={state.form.accountId}\n          onChange={(e) => {\n            const accountId = e.target.value\n              .toLowerCase()\n              .replace(/[^a-z0-9_.-]/g, \"\");\n            state.form = { accountId };\n            State.update();\n          }}\n        />\n      </label>\n      <CommitButton\n        data={{\n          canvasParty: {\n            session: {\n              pixels: [],\n              otherPlayer: state.form.accountId,\n              activePlayer: \"\",\n            },\n          },\n        }}\n      >\n        Play\n      </CommitButton>\n    </div>\n  );\n};\n\nconst waiting = (onlineState) => {\n  if (onlineState.activePlayer === \"\") {\n    return (\n      <div>\n        <h2>You are alone :(</h2>\n        <p>Waiting for {onlineState.otherPlayer} to join.</p>\n        <p>They have to type in {context.accountId} and click play.</p>\n        <CommitButton\n          data={{\n            canvasParty: {\n              session: null,\n            },\n          }}\n        >\n          Cancel Party\n        </CommitButton>\n      </div>\n    );\n  }\n};\n\n// putting this here at the end avoids errors due to missing hoisting\nreturn main();\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/jakmeier.near/widget/CanvasParty", "metadata.image.url": NaN, "metadata.name": NaN, "metadata.tags.app": NaN}