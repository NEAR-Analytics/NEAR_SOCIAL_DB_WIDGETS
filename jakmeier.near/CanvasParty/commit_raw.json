{"tx_hash": "8Aqe9845ixAEWJNHsgftQra7VQD9qUFuH6V97AYPWvhQ", "action_id_social": "Br7dd3Cs3Ephw7yqbaifZ6cDbmuCM8njK5EwZF8ambjd-0-widget", "block_id": 80710702, "block_timestamp": "2022-12-15 14:31:25.722", "signer_id": "jakmeier.near", "widget_name": "CanvasParty", "source_code": "State.init({ form: {} });\n\nconst onlineState = Social.index(\"canvasParty\", \"session\", {\n  order: \"desc\",\n  limit: 1, // we only want the latest version\n  subscribe: true, // refresh once in 5s\n});\n\nconst main = () => {\n  if (onlineState && onlineState.length > 0) {\n    if (onlineState[0].value.otherPlayer) {\n      return playing(onlineState[0].value);\n    } else {\n      return noGame();\n    }\n  } else {\n    return <h2>No state</h2>;\n  }\n};\n\nconst noState = () => {\n  return <h2>Loading...</h2>;\n};\n\nconst noGame = () => {\n  return (\n    <div\n      style={{\n        display: \"grid\",\n        padding: \"10px\",\n      }}\n    >\n      <h2>Join a Canvas Party!</h2>\n      <p>The game currently supports 2-player mode only.</p>\n      <p>\n        Both players need to type in their friends ID for the game to start.\n      </p>\n      <label>\n        Account ID of friend:\n        <input\n          type=\"text\"\n          value={state.form.accountId}\n          onChange={(e) => {\n            const accountId = e.target.value\n              .toLowerCase()\n              .replace(/[^a-z0-9_.-]/g, \"\");\n            state.form = { accountId };\n            State.update();\n          }}\n        />\n      </label>\n      <CommitButton\n        data={{\n          index: {\n            canvasParty: JSON.stringify({\n              key: \"session\",\n              value: {\n                pixels: [],\n                otherPlayer: state.form.accountId,\n                activePlayer: \"\",\n              },\n            }),\n          },\n        }}\n      >\n        Play\n      </CommitButton>\n    </div>\n  );\n};\n\nconst playing = (onlineState) => {\n  if (onlineState.activePlayer === \"\") {\n    return (\n      <div>\n        <h2>You are alone :(</h2>\n        <p>Waiting for {onlineState.otherPlayer} to join.</p>\n        <p>They have to type in {context.accountId} and click play.</p>\n        <CommitButton\n          data={{\n            index: {\n              canvasParty: JSON.stringify({\n                key: \"session\",\n                value: null,\n              }),\n            },\n          }}\n        >\n          Cancel\n        </CommitButton>\n      </div>\n    );\n  }\n};\n\n// putting this here at the end avoids errors due to missing hoisting\nreturn main();\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/jakmeier.near/widget/CanvasParty", "metadata.image.url": NaN, "metadata.name": NaN, "metadata.tags.app": NaN}