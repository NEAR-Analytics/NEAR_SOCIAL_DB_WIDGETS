{"tx_hash": "BrZJyazBLUPZA5nhtLMzBVB6McevjGfwj51E6vHWHNuD", "action_id_social": "JEAoX6PPguGofi864oAnWQEZ92viLUCMqzAo2y3Yv5hf-0-widget", "block_id": 87935538, "block_timestamp": "2023-03-23 10:14:13.241", "signer_id": "minorityprogrammers.near", "widget_name": "genadropMinter", "source_code": "let accountId = context.accountId;\r\n\r\n// if (!accountId) {\r\n//   return \"Please sign in with NEAR wallet\";\r\n// }\r\n\r\nconst profile = socialGetr(`${accountId}/profile`);\r\n\r\nif (profile === null) {\r\n  IpfsImageUpload();\r\n  return \"Uploading NFT\";\r\n}\r\n\r\nconst handleMint = () => {\r\n  if (!(state.title && state.description && state.image.cid)) {\r\n    return;\r\n  }\r\n  const metadata = {\r\n    name: state.title,\r\n    description: state.description,\r\n    properties: [],\r\n    image: `ipfs://${state.image.cid}`,\r\n  };\r\n  console.log(\"come\", metadata);\r\n  asyncFetch(\"https://ipfs.near.social/add\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      Accept: \"application/json\",\r\n    },\r\n    body: metadata,\r\n  }).then((res) => {\r\n    console.log(\"GO ON SOUN\", res);\r\n    const cid = res.body.cid;\r\n    const gas = 200000000000000;\r\n    const deposit = 10000000000000000000000;\r\n    Near.call([\r\n      {\r\n        contractName: \"genadrop-contract.nftgen.near\",\r\n        methodName: \"nft_mint\",\r\n        args: {\r\n          token_id: `${Date.now()}`,\r\n          metadata: {\r\n            title: state.title,\r\n            description: state.description,\r\n            media: `https://ipfs.io/ipfs/${state.image.cid}`,\r\n            reference: `ipfs://${cid}`,\r\n          },\r\n          receiver_id: accountId,\r\n        },\r\n        gas: gas,\r\n        deposit: deposit,\r\n      },\r\n    ]);\r\n  });\r\n};\r\n\r\ninitState({\r\n  title: \"\",\r\n  description: \"\",\r\n  accountId: accountId,\r\n});\r\n\r\nconst onChangeTitle = (title) => {\r\n  State.update({\r\n    title,\r\n  });\r\n};\r\n\r\nconst onChangeDesc = (description) => {\r\n  State.update({\r\n    description,\r\n  });\r\n};\r\n// in the future add mint to an address\r\nreturn (\r\n  <div>\r\n    <h1>\ud83d\udca7Mint NFT on GenaDrop</h1>\r\n    <div className=\"row\">\r\n      <div className=\"col-lg-6\">\r\n        <div>\r\n          Title:\r\n          <input type=\"text\" onChange={(e) => onChangeTitle(e.target.value)} />\r\n        </div>\r\n        <div>\r\n          Description:\r\n          <input type=\"text\" onChange={(e) => onChangeDesc(e.target.value)} />\r\n        </div>\r\n      </div>\r\n      <div className=\"flex-grow-1\">\r\n        <IpfsImageUpload\r\n          image={state.image}\r\n          className=\"btn btn-outline-secondary border-0 rounded-3\"\r\n        />\r\n      </div>\r\n      <div className=\"col-lg-6\">\r\n        <div>\r\n          <h2>\ud83d\udc40 Preview</h2>\r\n        </div>\r\n        <div>\r\n          <img\r\n            src={`https://ipfs.io/ipfs/` + state.image.cid}\r\n            alt=\"uploaded image\"\r\n            width=\"800\"\r\n            height=\"600\"\r\n          />\r\n        </div>\r\n        {state.accountId && (\r\n          <div>\r\n            <button onClick={handleMint}>Mint</button>\r\n          </div>\r\n        )}\r\n        {!state.accountId && (\r\n          <div>\r\n            <button className=\"btn btn-danger mt-3\">Login to Mint</button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": NaN, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/minorityprogrammers.near/widget/genadropMinter", "metadata.description": NaN, "metadata.image.ipfs_cid": NaN, "metadata.linktree.website": NaN, "metadata.name": NaN, "metadata.tags.app": NaN, "metadata.tags.genadrop": NaN, "metadata.tags.ipfs": NaN, "metadata.tags.mint": NaN, "metadata.tags.nft": NaN, "metadata.tags.mintbase": NaN, "metadata.tags.nft-minter": NaN, "metadata.tags.onboard": NaN, "metadata.tags.onboard-dao": NaN, "metadata.tags.onboarddao": NaN, "metadata.tags.dapp": NaN, "branch.draft.": NaN, "branch.draft": NaN}