{"tx_hash": "DmpBaMyeQhnTPYhJUvLcPXdqSvKEd4LVuVbZWomtjmHA", "action_id_social": "3bHjPUd43zJVCsena2rvPFdMy534wBD8bFmNWV2FLYME-0-widget", "block_id": 94251402, "block_timestamp": "2023-06-15T16:37:03.720Z", "signer_id": "nycdao.near", "widget_name": "dao.cta", "source_code": "const accountId = props.accountId ?? context.accountId;\nconst daoId = props.daoId ?? \"liberty.sputnik-dao.near\";\n\nState.init({\n  nftHolder: false,\n  isFollower,\n  isMember,\n});\n\nconst nftData = Near.view(\"mint.sharddog.near\", \"nft_supply_for_owner\", {\n  account_id: accountId,\n});\n\nif (nftData > 0) {\n  State.update({ nftHolder: true });\n}\n\n// get DAO followers\nlet followers = Social.keys(`*/graph/follow/${daoId}`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true,\n});\n\nif (followers === null) {\n  return \"Loading followers...\";\n}\n\nfollowers = Object.entries(followers || {});\nfollowers.sort(\n  (a, b) => b.graph.follow[accountId][1] - a.graph.follow[accountId][1]\n);\n\n//check if user is a member of a group: [1]\nconst isFollower = followers.includes(accountId);\n\n// get DAO policy data\nconst policy = Near.view(daoId, \"get_policy\");\n\nif (policy === null) {\n  return \"\";\n}\n\nconst groups = policy.roles\n  .filter((role) => role.name === \"community\")\n  .map((role) => {\n    const group = role.kind.Group;\n\n    return group;\n  });\n\n//check if user is a member of a group: [1]\nconst isMember = groups.some((group) => group.includes(accountId));\n\n// function call used for membership requests\nconst handleJoin = () => {\n  const deposit = policy.proposal_bond;\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"add_proposal\",\n      args: {\n        proposal: {\n          description: \"potential member\",\n          kind: {\n            AddMemberToRole: {\n              member_id: accountId,\n              role: \"community\",\n            },\n          },\n        },\n      },\n      gas: 300000000000000,\n      deposit: deposit,\n    },\n  ]);\n};\n\nconst Text = styled.p`\n  font-family: \"FK Grotesk\", sans-serif;\n  font-size: ${(p) => p.size ?? \"18px\"};\n  line-height: ${(p) => p.lineHeight ?? \"1.5\"};\n  font-weight: ${(p) => p.weight ?? \"400\"};\n  color: ${(p) => p.color ?? \"#000\"};\n  margin-botton: 8px;\n`;\n\nconst FlexContainer = styled.div`\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  flex-direction: row;\n  justify-content: center;\n  flex-wrap: wrap;\n\n  @media (max-width: 998px) {\n    flex-direction: column;\n    gap: var(--section-gap);\n  }\n`;\n\nconst Flex = styled.div`\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  flex-direction: column;\n  flex-wrap: \"nowrap\";\n\n    @media (max-width: 998px) {\n    flex-direction: column;\n    gap: var(--section-gap);\n    }\n`;\n\nconst Container = styled.div`\n  display: flex;\n  max-width: 1080px;\n  margin: 0 auto;\n  gap: var(--section-gap);\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  padding: var(--section-gap) 24px;\n`;\n\nreturn (\n  <Container>\n    {isFollower ? (\n      <Flex>\n        <Text\n          size=\"18px\"\n          weight=\"600\"\n          style={{ textTransform: \"uppercase\", letterSpacing: \"0.17em\" }}\n        >\n          Your Adventure Has Begun\n        </Text>\n        {nftHolder ? (\n          <FlexContainer>\n            <Widget\n              src=\"near/widget/DIG.Button\"\n              props={{\n                href: \"#/devs.near/widget/dev.social\",\n                label: \"Demo Day Voting\",\n                variant: \"outline-secondary\",\n                size: \"large\",\n              }}\n            />\n          </FlexContainer>\n        ) : (\n          <FlexContainer>\n            <button className=\"btn btn-success\" onClick={handleJoin}>\n              Join Community\n            </button>\n          </FlexContainer>\n        )}\n      </Flex>\n    ) : (\n      <Flex>\n        <Text\n          size=\"18px\"\n          weight=\"600\"\n          style={{ textTransform: \"uppercase\", letterSpacing: \"0.17em\" }}\n        >\n          Begin a New Adventure\n        </Text>\n        <FlexContainer>\n          <Widget\n            src=\"near/widget/DIG.Button\"\n            props={{\n              href: \"#/hack.near/widget/Academy\",\n              label: \"Learn Together\",\n              variant: \"outline-secondary\",\n              size: \"large\",\n            }}\n          />\n        </FlexContainer>\n      </Flex>\n    )}\n  </Container>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/nycdao.near/widget/dao.cta", "__row_index": 6}