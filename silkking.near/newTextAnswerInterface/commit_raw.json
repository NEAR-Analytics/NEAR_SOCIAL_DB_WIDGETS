{"tx_hash": "9UfxmkYnRv7MUftXujGdEF4iBhbBUaAVcukG5nXsQC8s", "action_id_social": "6H4vbjNzgyeebmMs7d2L6JUWJ2syzTfN8Vm7J5yofMyk-0-widget", "block_id": 82351818, "block_timestamp": "2023-01-06 19:42:06.532", "signer_id": "silkking.near", "widget_name": "newTextAnswerInterface", "source_code": "if (!props.blockHeight) {\n  return \"Property blockHeight not set\";\n}\n\nState.init({ vote: \"\", showErrorsInForm: false, questions: {}, answers: {} });\n\nconst questionBlockHeight = props.blockHeight;\nconst questions = Social.index(\"poll_question\", \"question-v3.1.0\");\n\nif (JSON.stringify(questions) != JSON.stringify(state.questions)) {\n  State.update({ questions: questions });\n}\n\nif (!questions) {\n  return \"Loading\";\n}\nconst questionParams = questions.find(\n  (q) => q.blockHeight == questionBlockHeight\n);\n\nconst answers = Social.index(\"poll_question\", \"answer-v3.1.0\");\n\nif (JSON.stringify(answers) != JSON.stringify(state.answers)) {\n  State.update({ answers: answers });\n}\n\nif (!answers) {\n  return \"Loading\";\n}\nconst answersToThisQuestion = answers.filter(\n  (a) => a.value.questionBlockHeight == questionBlockHeight\n);\n\nlet usersWithAnswersToThisQuestion = [];\nconst validAnswersToThisQuestion = answersToThisQuestion.filter((a) => {\n  const didUserAlreadyAnswered = usersWithAnswersToThisQuestion.includes(\n    a.accountId\n  );\n  if (!didUserAlreadyAnswered) {\n    usersWithAnswersToThisQuestion.push(a.accountId);\n  }\n  return !didUserAlreadyAnswered;\n});\n\nfunction getBlockTimestamp(blockHeight) {\n  // It is stored in nanoseconds which is 1e-6 miliseconds\n  return Near.block(blockHeight).header.timestamp / 1e6;\n}\n\nconst profileLink = (accId, c) => (\n  <a\n    className=\"text-decoration-none link-dark\"\n    href={`#/mob.near/widget/ProfilePage?accountId=${accId}`}\n  >\n    {c}\n  </a>\n);\n\nfunction makeAnswerAccIdShorter(accId) {\n  if (accId.length > 18) {\n    return accId.slice(0, 18) + \"...\";\n  }\n  return accId;\n}\n\nreturn (\n  <>\n    {validAnswersToThisQuestion.length == 0\n      ? \"This question does not have any answers yet. Be the first one!\"\n      : validAnswersToThisQuestion.map((answerParams) => {\n          if (!answerParams.accountId) return \"\";\n          let profile = Social.getr(`${answerParams.accountId}/profile`);\n          if (!profile) {\n            return \"Loading\";\n          }\n          return (\n            <>\n              <div\n                className=\"d-flex align-items-start\"\n                style={{\n                  padding: \"1.5rem 0\",\n                  borderBottom: \"1px solid #e9e9e9\",\n                }}\n              >\n                <div>\n                  {profileLink(\n                    answerParams.accountId,\n                    <Widget\n                      src=\"mob.near/widget/ProfileImage\"\n                      props={{ accountId: answerParams.accountId }}\n                    />\n                  )}\n                </div>\n                <div className=\"d-flex\">\n                  <div className=\"flex-grow-1 me-1 text-truncate\">\n                    {profileLink(\n                      answerParams.accountId,\n                      <>\n                        <p\n                          style={{ margin: \"0 2px 0 2px\" }}\n                          className=\"fw-bold\"\n                        >\n                          {profile.name}\n                        </p>\n                        <p\n                          style={{ margin: \"0 2px 0 2px\" }}\n                          className=\"text-secondary\"\n                        >\n                          @{makeAnswerAccIdShorter(answerParams.accountId)}\n                        </p>\n                      </>\n                    )}\n                  </div>\n                  <div>\n                    <small className=\"ps-1 text-nowrap text-muted ms-auto\">\n                      <i className=\"bi bi-clock me-1\"></i>\n                      <Widget\n                        src=\"silkking.near/widget/timeAgo\"\n                        props={{\n                          timeInFuture: getBlockTimestamp(\n                            answerParams.blockHeight\n                          ),\n                          reduced: true,\n                        }}\n                      />\n                    </small>\n                  </div>\n                </div>\n              </div>\n              <p className=\"w-100\">{answerParams.value.answer}</p>\n            </>\n          );\n        })}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/silkking.near/widget/newTextAnswerInterface"}