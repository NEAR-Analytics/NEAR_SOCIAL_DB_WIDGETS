{"tx_hash": "2ZbKvNFCUXD9qFrtWxZ1vZbJe1z5LANGxmx34UhytVmZ", "action_id_social": "Dc6eoxPtVi26KcAbm8sdv1Un9S2aYz8TY3NtiSJtUqPH-0-widget", "block_id": 87515655, "block_timestamp": "2023-03-17 19:18:03.410", "signer_id": "silkking.near", "widget_name": "MainPage.Post", "source_code": "const accountId = props.accountId;\nconst blockHeight =\n  props.blockHeight === \"now\" ? \"now\" : parseInt(props.blockHeight);\nconst content =\n  props.content ??\n  JSON.parse(Social.get(`${accountId}/post/main`, blockHeight) ?? \"null\");\nconst subscribe = !!props.subscribe;\nconst raw = !!props.raw;\n\nState.init({\n  displayedCommentBoxes: props.displayedCommentBoxes,\n  displayCommentBox: false,\n});\n\nconst notifyAccountId = accountId;\nconst item = {\n  type: \"social\",\n  path: `${accountId}/post/main`,\n  blockHeight,\n};\n\nconst link = `#/mob.near/widget/MainPage.Post.Page?accountId=${accountId}&blockHeight=${blockHeight}`;\n\nconst card = {\n  background: \"linear-gradient(to right, #4deeea, #f000ff)\",\n  border: \"1px solid black\",\n  borderRadius: \"5px\",\n  textAlign: \"center\",\n  color: \"white\",\n  padding: \"10px\",\n};\n\nconst cardContent = {\n  display: \"grid\",\n  gridTemplateColumns: \"3fr 1fr 1fr\",\n};\n\nconst startCommentTo = () => {\n  // let cm = state.displayedCommentBoxes;\n  // cm.push(blockHeight);\n  // console.log(\"startCommentTo\");\n  // State.update({ displayedCommentBoxes: cm });\n  State.update({ displayCommentBox: true });\n};\n\nconst RenderCommentInput = (blockHeight) => {\n  // console.log(\"RenderCommentInput\");\n  console.log(1, blockHeight);\n  let cm = state.displayedCommentBoxes;\n  // console.log(cm, blockHeight);\n  return state.displayCommentBox ? (\n    <div\n      style={{\n        margin: \"10px 0px\",\n      }}\n    >\n      <textarea\n        style={{\n          backgroundColor: \"rgb(230, 230, 230)\",\n          border: \"1px solid #ced4da\",\n          borderRadius: \"0.375rem\",\n          width: \"50%\",\n          verticalAlign: \"middle\",\n        }}\n        rows=\"2\"\n        value={state.commentTextMap[blockHeight]}\n        onChange={(e) => {\n          const cm = state.commentTextMap;\n          // console.log(cm[blockHeight]);\n          cm[blockHeight] = e.target.value;\n          State.update({ commentTextMap: cm });\n          //   state.commentTextMap[blockHeight] = e.target.value;\n        }}\n      />\n      <CommitButton\n        style={button}\n        data={{\n          index: {\n            kudo: JSON.stringify(\n              {\n                key: \"commentAnswers\",\n                value: {\n                  commentAnswer: state.commentTextMap[blockHeight],\n                  blockHeight: blockHeight,\n                },\n              },\n              undefined,\n              0\n            ),\n          },\n        }}\n        onCommit={() => {\n          let ctm = state.commentTextMap;\n          ctm[blockHeight] = \"\";\n          State.update({\n            commentTextMap: ctm,\n            reloadData: true,\n          });\n        }}\n      >\n        Comment 1\n      </CommitButton>\n    </div>\n  ) : (\n    \"\"\n  );\n};\n\n/* START KudoBox */\nconst RenderKudoBox = (d) => {\n  const text = `@${d.accountId} I BuiDL... ${d.value.answer} `;\n  const content = { text };\n  return (\n    <>\n      <div style={card}>\n        <Widget\n          src=\"mob.near/widget/MainPage.Post.Header\"\n          props={{\n            accountId,\n            blockHeight,\n            link,\n            postType: \"post\",\n            flagItem: item,\n          }}\n        />\n        <div className=\"mt-3 text-break\" style={cardContent}>\n          <Widget\n            src=\"mob.near/widget/MainPage.Post.Content\"\n            props={{ content, raw }}\n          />\n          {\n            // <a href={`#/mob.near/widget/ProfilePage?accountId=${d.accountId}`}>\n            //   {d.accountId}\n            // </a>\n            // I BuiDL... <b>{d.value.answer}&nbsp;&nbsp;&nbsp;</b>\n            // <b>\n            //   <a href={`${urlPrefix}${d.value.url}`} target=\"_blank\">\n            //     {d.value.url}\n            //   </a>\n            //   &nbsp;&nbsp;&nbsp;\n            // </b>\n          }\n          <a href={`${urlPrefix}${d.value.url}`} target=\"_blank\">\n            {d.value.url}\n          </a>\n          <div>\n            <Widget\n              src=\"mob.near/widget/CommentButton\"\n              props={{\n                onClick: startCommentTo,\n              }}\n            />\n          </div>\n        </div>\n        <div>\n          <Widget\n            src=\"mob.near/widget/FollowButton\"\n            props={{ accountId: d.accountId }}\n          />\n\n          <CommitButton\n            data={{\n              index: {\n                kudo: JSON.stringify(\n                  {\n                    key: \"upvote\",\n                    value: {\n                      blockHeight: d.blockHeight,\n                    },\n                  },\n                  undefined,\n                  0\n                ),\n              },\n            }}\n          >\n            Upvote 1\n          </CommitButton>\n          <span>\n            {upvotesMap[d.blockHeight] ? upvotesMap[d.blockHeight] : 0} upvotes\n          </span>\n        </div>\n        {RenderCommentInput(Number(d.blockHeight))}\n      </div>\n\n      {\n        //RenderAllCommentAnswerBox(d)\n      }\n    </>\n  );\n};\n/* END KudoBox  */\n\nreturn (\n  <>\n    {RenderKudoBox(props.d)}\n    <div className=\"border rounded-4 p-3 pb-1\">\n      <Widget\n        src=\"mob.near/widget/MainPage.Post.Header\"\n        props={{\n          accountId,\n          blockHeight,\n          link,\n          postType: \"post\",\n          flagItem: item,\n        }}\n      />\n      <div className=\"mt-3 text-break\">\n        <Widget\n          src=\"mob.near/widget/MainPage.Post.Content\"\n          props={{ content, raw }}\n        />\n      </div>\n      {blockHeight !== \"now\" && (\n        <div className=\"mt-1 d-flex justify-content-between\">\n          <div>\n            <span className=\"me-4\">\n              <Widget\n                src=\"mob.near/widget/LikeButton\"\n                props={{\n                  notifyAccountId,\n                  item,\n                }}\n              />\n            </span>\n            <Widget\n              src=\"mob.near/widget/CommentButton\"\n              props={{\n                onClick: () =>\n                  !state.showReply && State.update({ showReply: true }),\n              }}\n            />\n          </div>\n          <div>\n            <Widget\n              src=\"mob.near/widget/MainPage.Post.ShareButton\"\n              props={{ accountId, blockHeight, postType: \"post\" }}\n            />\n          </div>\n        </div>\n      )}\n      <div className=\"mt-3 ps-5\">\n        {state.showReply && (\n          <div className=\"mb-2\">\n            <Widget\n              src=\"mob.near/widget/MainPage.Comment.Compose\"\n              props={{\n                notifyAccountId,\n                item,\n                onComment: () => State.update({ showReply: false }),\n              }}\n            />\n          </div>\n        )}\n        <Widget\n          src=\"mob.near/widget/MainPage.Comment.Feed\"\n          props={{\n            item,\n            highlightComment: props.highlightComment,\n            limit: props.commentsLimit,\n            subscribe,\n            raw,\n          }}\n        />\n      </div>\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/silkking.near/widget/MainPage.Post"}