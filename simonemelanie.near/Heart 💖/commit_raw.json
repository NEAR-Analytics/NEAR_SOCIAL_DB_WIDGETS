{"tx_hash": "AEZL4gDuH36oZgLdfNc9pRri6btdANteSRZ8F8c7AyYN", "action_id_social": "5cGTK6t2DCSWoXf1Fns7GGJx4vGBRXire3HcAAeGhVRn-0-widget", "block_id": 80648843, "block_timestamp": "2022-12-14 18:23:03.995", "signer_id": "simonemelanie.near", "widget_name": "Heart \ud83d\udc96", "source_code": "let index = state.index ?? Storage.get(\"index\");\nif (index !== null) {\n  index = index || [];\n\n  const lastBlockHeight = index[0].blockHeight || 0;\n\n  const newIndex = Social.index(\"like\", \"like-click\", {\n    order: \"asc\",\n    from: lastBlockHeight + 1,\n  });\n\n  if (newIndex !== null && newIndex.length > 0) {\n    index = [...newIndex.reverse(), ...index];\n    Storage.set(\"index\", index);\n  }\n\n  if ((state.index.length || 0) < (index.length || 0)) {\n    State.update({\n      index,\n    });\n  }\n}\n\nif (!state.likeSound) {\n  State.update({\n    likeSound:\n      \"https://www.youtube.com/watch?v=o7fXzwTVA-w&ab_channel=SoundEffectDatabase\",\n  });\n  new Audio(state.likeSound);\n}\n\nconst likes = index;\n\nconst counter = {};\nconst uniqueLikes = {};\n\nif (likes) {\n  likes.forEach(({ accountId, value }) => {\n    const key = JSON.stringify({ accountId, value });\n    if (key in uniqueLikes) {\n      return;\n    }\n    counter[accountId] = (counter[accountId] || 0) + 1;\n    uniqueLikes[key] = true;\n  });\n}\n\nconst top = Object.entries(counter);\ntop.sort((a, b) => b[1] - a[1]);\n\nconst flyAnimation = styled.keyframes`\n 0% { left: max(-20vh, -20vw);  font-size: min(20vh, 20vw); }\n 50% {  font-size: min(70vh, 70vw); }\n 100% { left: calc(100vw + min(20vh, 20vw)); font-size: min(20vh, 20vw); }\n`;\n\nconst Heart = styled.div`\n  z-index: 900;\n  left: max(-20vh, -20vw);\n  font-size: min(20vh, 20vw);\n  display: inline-block;\n  position: fixed;\n  top: 50vh;\n  transform: translate(-50%, -50%);\n  animation-name: ${flyAnimation};\n  animation-timing-function: linear;\n  animation-duration: 3s;\n  animation-iteration-count: 1;\n`;\n\nfunction renderLikes(accountIds) {\n  return (\n    <div className=\"d-flex flex-wrap gap-3\">\n      {accountIds &&\n        accountIds.map((accountId, i) => {\n          return (\n            <div className=\"position-relative\" key={i}>\n              <a\n                href={`#/mob.near/widget/ProfilePage?accountId=${accountId}`}\n                className=\"text-decoration-none\"\n              >\n                <Widget\n                  src=\"mob.near/widget/ProfileImage\"\n                  props={{\n                    accountId,\n                    className: \"d-inline-block overflow-hidden\",\n                  }}\n                />\n              </a>\n              <span\n                className=\"position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success\"\n                style={{ zIndex: 1, border: \"1px solid rgb(15,81,51)\" }}\n              >\n                {counter[accountId]}\n              </span>\n            </div>\n          );\n        })}\n    </div>\n  );\n}\n\nreturn (\n  <div>\n    <div className=\"mb-4\">\n      <CommitButton\n        className=\"btn btn-lg btn-success\"\n        onClick={() => {\n          const sound = new Audio(state.likeSound);\n          sound.play();\n          State.update({\n            lastLike: Date.now(),\n          });\n        }}\n        onCommit={() => {\n          State.update({\n            lastLike: null,\n          });\n        }}\n        onCancel={() => {\n          State.update({\n            lastLike: null,\n          });\n        }}\n        data={() => ({\n          index: {\n            like: JSON.stringify({\n              key: \"like-click\",\n              value: Date.now(),\n            }),\n          },\n        })}\n      >\n        Like \ud83d\udc96\n      </CommitButton>\n    </div>\n    <div className=\"mb-4\">\n      <h4>Top 10</h4>\n      <div>{renderLikes(top.slice(0, 10).map((a) => a[0]))}</div>\n    </div>\n    <div className=\"mb-4\">\n      <h4>Last 10 </h4>\n      <div>\n        {likes && renderLikes(likes.slice(0, 10).map((a) => a.accountId))}\n      </div>\n    </div>\n    {state.lastLike && <Heart key={`like-${state.lastLike}`}>\ud83d\udc96</Heart>}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/simonemelanie.near/widget/Heart \ud83d\udc96"}