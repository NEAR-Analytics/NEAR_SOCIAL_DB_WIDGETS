{"tx_hash": "HtwPyYvGsxdMkBsqGW1KqqTFwdBorbTX1BERbXdkNDk7", "action_id_social": "BLCA7KcfrSX5fL2GEp4sQwyGurpqX43CrDE4nVXsuXae-0-widget", "block_id": 89407444, "block_timestamp": "2023-04-12 11:16:42.064", "signer_id": "vlodkow.near", "widget_name": "Test1", "source_code": null, "metadata": null, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/vlodkow.near/widget/Test1", "branch.draft.": "let user_account = context.accountId;\n\nconst contract = \"chatme.near\";\nconst testChatAccount = \"chat-bot.near\";\n\nState.init({\n  messages: [],\n  newMessage: \"\",\n});\n\nconst getPrivateChatId = (user1, user2) => {\n  if (user1 > user2) {\n    return user1.concat(\"|\").concat(user2);\n  }\n  return user2.concat(\"|\").concat(user1);\n};\n\nconst sourceURL =\n  \"https://api.thegraph.com/subgraphs/name/vlodkomr/chatme-main\";\n\nconst id = getPrivateChatId(user_account, testChatAccount);\nconst reqData = JSON.stringify({\n  query: `{ privateMessages(orderBy: created_at, orderDirection: desc, where: { chat_id: \"${id}\"}) {id inner_id text image from_address to_address created_at deposit encrypt_key reply_message {id, from_address, text, image, encrypt_key}}}`,\n  variables: {},\n});\nconsole.log(reqData);\n\nconst chatData = fetch(sourceURL, {\n  method: \"POST\",\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n  body: reqData,\n});\nif (!chatData) return;\n\nconsole.log(chatData?.body?.data?.privateMessages);\nState.update({ messages: chatData?.body?.data?.privateMessages });\n\nconst onTextareatChange = ({ target }) => {\n  State.update({ newMessage: target.value });\n};\n\nconst sendMessage = () => {\n  Near.call(contract, \"send_private_message\", {\n    to_address: testChatAccount,\n    text: newMessage,\n    image: \"\",\n  });\n};\n\nreturn (\n  <>\n    <div class=\"container border border-info p-2 text-center\">\n      {user_account ? (\n        <>\n          <h1>Messages for: {user_account}</h1>\n          <hr />\n\n          {state.messages.length > 0 ? (\n            <div>\n              {state.messages.map((message) => (\n                <p>\n                  {message.text} | {message.created_at}\n                </p>\n              ))}\n            </div>\n          ) : (\n            <p>No Messages</p>\n          )}\n          <hr />\n          <textarea onChange={onTextareatChange}></textarea>\n          <button onClick={sendMessage}>Send Message</button>\n        </>\n      ) : (\n        <>*Please, LogIn using your NEAR wallet</>\n      )}\n    </div>\n  </>\n);\n", "branch.draft.metadata": NaN}