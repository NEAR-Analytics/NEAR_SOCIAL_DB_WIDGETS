{"tx_hash": "G76rRaevSnshQR1JnF55ftZ9sPf4N1fqVoGirukRGx7c", "action_id_social": "2qooLanWn1rL5xyEKZebcSPvanfR1C1MCaqCTvL5rbtv-0-widget", "block_id": 86638601, "block_timestamp": "2023-03-05 21:11:54.987", "signer_id": "toolipse.near", "widget_name": "nft_show_toolipse", "source_code": "const accountId = props.accountId || context.accountId;\r\nconst marketId = \"simple.market.mintbase1.near\";\r\nconst AFFILIATE_ACCOUNT = props.affiliateAccount || \"toolipse.near\";\r\n\r\nconst data_sell = fetch(\"https://graph.mintbase.xyz\", {\r\n  method: \"POST\",\r\n  headers: {\r\n    \"mb-api-key\": \"anon\",\r\n    \"Content-Type\": \"application/json\",\r\n    \"x-hasura-role\": \"anonymous\",\r\n  },\r\n  body: JSON.stringify({\r\n    query: `\r\n      query MyQuery {\r\n        mb_views_active_listings(limit: 700, order_by: {price: desc},where: {minter: {_eq: \"toolipse.near\"}, _and: {nft_contract_id: {_eq: \"toolipse.mintbase1.near\"}}}) {\r\n            listed_by\r\n            created_at\r\n            price\r\n            nft_contract_id\r\n            token_id\r\n            metadata_id\r\n        }   \r\n      }\r\n`,\r\n  }),\r\n});\r\nconst data_show = fetch(\"https://graph.mintbase.xyz\", {\r\n  method: \"POST\",\r\n  headers: {\r\n    \"mb-api-key\": \"anon\",\r\n    \"Content-Type\": \"application/json\",\r\n    \"x-hasura-role\": \"anonymous\",\r\n  },\r\n  body: JSON.stringify({\r\n    query: `\r\n      query MyQuery {\r\n        mb_views_nft_tokens(limit: 30, order_by: {last_transfer_timestamp: desc},where: {minter: {_eq: \"toolipse.near\"}, _and: {nft_contract_id: {_eq: \"toolipse.mintbase1.near\"}}}) {\r\n            created_at\r\n            token_id\r\n            metadata_id\r\n            title\r\n            description\r\n            media\r\n            nft_contract_id\r\n        }   \r\n      }\r\n`,\r\n  }),\r\n});\r\n\r\nconst YoctoToNear = (amountYocto) =>\r\n  new Big(amountYocto).div(new Big(10).pow(24)).toString();\r\n\r\nlet buy = (price, token_id, nft_contract_id) => {\r\n  const gas = 200000000000000;\r\n  const deposit = new Big(price).toFixed(0);\r\n\r\n  Near.call(\r\n    marketId,\r\n    \"buy\",\r\n    {\r\n      nft_contract_id: nft_contract_id,\r\n      token_id: token_id,\r\n      referrer_id: AFFILIATE_ACCOUNT,\r\n    },\r\n    gas,\r\n    deposit\r\n  );\r\n};\r\n\r\nif (!data_sell.ok) {\r\n  return \"Loading\";\r\n}\r\n\r\nif (!data_show.ok) {\r\n  return \"Loading\";\r\n}\r\n\r\nconst size = \"30em\";\r\n\r\nreturn data_sell !== null && data_show !== null ? (\r\n  <>\r\n    <h1>Artworks available on @mintbase</h1>\r\n    <p>Nice to see that my artworks can be buyable from here.</p>\r\n    <div className=\"d-flex gap-4 flex-wrap\">\r\n      {data_sell.body.data?.mb_views_active_listings.map((listing, i) => {\r\n        const priceYocto = listing.price.toLocaleString().replace(/,/g, \"\");\r\n        const priceNear = YoctoToNear(priceYocto);\r\n\r\n        return (\r\n          <div className=\"d-flex flex-column gap-1\">\r\n            <a\r\n              href={`https://mintbase.xyz/meta/${listing.metadata_id}/`}\r\n              target=\"_blank\"\r\n            >\r\n              <Widget\r\n                src=\"toolipse.near/widget/NftImage_toolipse\"\r\n                props={{\r\n                  nft: {\r\n                    tokenId: listing.token_id,\r\n                    contractId: listing.nft_contract_id,\r\n                  },\r\n                  style: {\r\n                    width: size,\r\n                    height: size,\r\n                    objectFit: \"contain\",\r\n                    minWidth: size,\r\n                    minHeight: size,\r\n                    maxWidth: size,\r\n                    maxHeight: size,\r\n                    overflowWrap: \"break-word\",\r\n                  },\r\n                  thumbnail: \"thumbnail\",\r\n                  className: \"\",\r\n                  fallbackUrl:\r\n                    \"https://ipfs.near.social/ipfs/bafkreihdiy3ec4epkkx7wc4wevssruen6b7f3oep5ylicnpnyyqzayvcry\",\r\n                }}\r\n              />\r\n            </a>\r\n            <button\r\n              disabled={!accountId}\r\n              onClick={() => {\r\n                if (!accountId) return;\r\n                buy(priceYocto, listing.token_id, listing.nft_contract_id);\r\n              }}\r\n            >\r\n              Buy for {priceNear} N\r\n            </button>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n    <div className=\"d-flex gap-4 flex-wrap\">\r\n      {data_sell.body.data?.mb_views_active_listings.map((listing, i) => {\r\n        const priceYocto = listing.price.toLocaleString().replace(/,/g, \"\");\r\n        const priceNear = YoctoToNear(priceYocto);\r\n\r\n        return (\r\n          <div className=\"d-flex flex-column gap-1\">\r\n            <a\r\n              href={`https://mintbase.xyz/meta/${listing.metadata_id}/`}\r\n              target=\"_blank\"\r\n            >\r\n              <Widget\r\n                src=\"toolipse.near/widget/NftImage_toolipse\"\r\n                props={{\r\n                  nft: {\r\n                    tokenId: listing.token_id,\r\n                    contractId: listing.nft_contract_id,\r\n                  },\r\n                  style: {\r\n                    width: size,\r\n                    height: size,\r\n                    objectFit: \"contain\",\r\n                    minWidth: size,\r\n                    minHeight: size,\r\n                    maxWidth: size,\r\n                    maxHeight: size,\r\n                    overflowWrap: \"break-word\",\r\n                  },\r\n                  thumbnail: \"thumbnail\",\r\n                  className: \"\",\r\n                  fallbackUrl:\r\n                    \"https://ipfs.near.social/ipfs/bafkreihdiy3ec4epkkx7wc4wevssruen6b7f3oep5ylicnpnyyqzayvcry\",\r\n                }}\r\n              />\r\n            </a>\r\n            <button\r\n              disabled={!accountId}\r\n              onClick={() => {\r\n                if (!accountId) return;\r\n                buy(priceYocto, listing.token_id, listing.nft_contract_id);\r\n              }}\r\n            >\r\n              Buy for {priceNear} N\r\n            </button>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  </>\r\n) : (\r\n  <p>loading...</p>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/toolipse.near/widget/nft_show_toolipse"}