{"tx_hash": "5GSmHrCudEu8iYPMQFmNna2hPx374CpFpqVzL3VSScpt", "action_id_social": "HzAok6CQZGcNaXGtDvKkTKbyiEA4iAmb4GC3PmAxUWZ-0-widget", "block_id": 84704281, "block_timestamp": "2023-02-07 15:39:16.890", "signer_id": "microchipgnu.near", "widget_name": "ListFromCollection", "source_code": "const accountId = context?.accountId;\n\nconst size = \"5em\";\n\nState.init({\n  tokens: {},\n});\n\nconst _data = fetch(\"https://graph.mintbase.xyz\", {\n  method: \"POST\",\n  headers: {\n    \"mb-api-key\": \"omni-site\",\n    \"Content-Type\": \"application/json\",\n    \"x-hasura-role\": \"anonymous\",\n  },\n  body: JSON.stringify({\n    query: `\n        query MyQuery ($accountId: String){\n            mb_views_nft_owned_tokens(limit: 100, where: {listing_kind: {_is_null: true}, owner: {_eq: $accountId}}) {\n                token_id\n                nft_contract_id\n            }\n        }\n`,\n    variables: {\n      accountId: accountId,\n    },\n  }),\n});\n\nconst data = _data.body.data.mb_views_nft_owned_tokens;\n\nconst addToListCart = (token_id, nft_contract_id) => {\n  const key = `${token_id}::${nft_contract_id}`;\n\n  const _tokens = {\n    ...state.tokens,\n    [key]: {\n      tokenId: token_id,\n      nftContractId: nft_contract_id,\n    },\n  };\n\n  State.update({\n    tokens: _tokens,\n  });\n};\n\nconst removeFromCart = (token_id, nft_contract_id) => {\n  const key = `${token_id}::${nft_contract_id}`;\n\n  delete state.tokens[key];\n\n  State.update({\n    tokens: state.tokens,\n  });\n};\n\nconst listMarket = () => {};\n\nconst numTokensSelected = Object.keys(state.tokens).length;\n\nreturn (\n  <div class=\"d-flex flex-column gap-2\">\n    <div>{numTokensSelected}</div>\n    <button>List for 1N</button>\n    {data.map(({ token_id, nft_contract_id }) => {\n      const key = `${token_id}::${nft_contract_id}`;\n      const addedToken = !!state.tokens[key];\n\n      return (\n        <button\n          class={`p-2 ${\n            addedToken ? \"bg-primary\" : \"bg-black\"\n          } text-white d-flex gap-2 rounded`}\n          key={key}\n          onClick={() => {\n            if (!addedToken) {\n              addToListCart(token_id, nft_contract_id);\n            } else {\n              removeFromCart(token_id, nft_contract_id);\n            }\n          }}\n        >\n          <Widget\n            src=\"mob.near/widget/NftImage\"\n            props={{\n              nft: {\n                tokenId: token_id,\n                contractId: nft_contract_id,\n              },\n              style: {\n                width: size,\n                height: size,\n                objectFit: \"cover\",\n                minWidth: size,\n                minHeight: size,\n                maxWidth: size,\n                maxHeight: size,\n                overflowWrap: \"break-word\",\n              },\n              thumbnail: \"thumbnail\",\n              className: \"\",\n              fallbackUrl:\n                \"https://ipfs.near.social/ipfs/bafkreihdiy3ec4epkkx7wc4wevssruen6b7f3oep5ylicnpnyyqzayvcry\",\n            }}\n          />\n          <div>\n            <p>{token_id}</p>\n            <p>{nft_contract_id}</p>\n          </div>\n        </button>\n      );\n    })}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/microchipgnu.near/widget/ListFromCollection"}