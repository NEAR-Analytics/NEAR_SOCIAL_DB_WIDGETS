{"tx_hash": "CeasHdF8hJonkSuwoZXTryZajUqeLgauNnSeBmdBuBhm", "action_id_social": "4ciQogYK1gmBoQEh8pWFWuCmRF1A5r4jAtXjqSR5tUhY-0-widget", "block_id": 85220868, "block_timestamp": "2023-02-14 14:47:02.128", "signer_id": "microchipgnu.near", "widget_name": "GrantPermissions", "source_code": "const connected_account = context.accountId;\n\nconst social_contract_id = \"social.near\";\n\nState.init({\n  account: \"\",\n});\n\nlet data = {\n  accountId: state.account,\n};\n\nconst accounts_granted_permissions = Near.view(\n  social_contract_id,\n  \"debug_get_permissions\",\n  { account_id: connected_account }\n);\n\nconst handleGrantAccount = () => {\n  const account = data.accountId;\n\n  Near.call([\n    {\n      contractName: social_contract_id,\n      methodName: \"grant_write_permission\",\n      args: { predecessor_id: data.accountId, keys: [connected_account] },\n      deposit: \"1\",\n    },\n  ]);\n};\n\nconst filtered_accounts_granted_permissions =\n  accounts_granted_permissions.filter((permissions) => {\n    return Object.keys(permissions[0])[0] === \"AccountId\";\n  });\n\nconst map_filtered_accounts_granted_permissions =\n  filtered_accounts_granted_permissions.map((filter) => {\n    return filter[0].AccountId;\n  });\n\nreturn (\n  <div class=\"d-flex flex-column gap-4\">\n    <div>\n      <h4>Grant Permissions</h4>\n      {!!data.accountId && (\n        <p>\n          You are granting write permissions to{\" \"}\n          <span class=\"fw-bold\">{data.accountId}</span>\n        </p>\n      )}\n    </div>\n    <div class=\"w-100 d-flex gap-4\">\n      <input id=\"accountid\" type=\"text\" value={state.account}></input>\n      <button\n        onClick={() => {\n          handleGrantAccount();\n        }}\n      >\n        Grant\n      </button>\n    </div>\n\n    <a href=\"https://near.social/#/mob.near/widget/MainPage.Post.Page?accountId=root.near&blockHeight=85026336\">\n      Learn more (Illia's post)\n    </a>\n\n    <div>\n      <h4>Accounts Granted</h4>\n      <ul>\n        {map_filtered_accounts_granted_permissions.map((accountId) => {\n          return <li>{accountId}</li>;\n        })}\n      </ul>\n    </div>\n    <div>\n      <h4>Future</h4>\n      <ul>\n        <li>Revoke permissions</li>\n        <li>\n          Set granular permissions (for example, just posting {account}/post/**)\n        </li>\n      </ul>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/microchipgnu.near/widget/GrantPermissions"}