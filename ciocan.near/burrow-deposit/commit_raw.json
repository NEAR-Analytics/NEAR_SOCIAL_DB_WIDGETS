{"tx_hash": "GKubzDfrB9Lxmh9aorbTG9jBAAg1mczq9KZMw4JRJQEE", "action_id_social": "eWDXhg5SoopPgy9gc6wzDKPwiBQn31WgzHSNJMri55Y-0-widget", "block_id": 83097966, "block_timestamp": "2023-01-16 18:04:50.998", "signer_id": "ciocan.near", "widget_name": "burrow-deposit", "source_code": "let BURROW_CONTRACT = \"contract.main.burrow.near\";\nlet accountId = context.accountId;\nlet selectedTokenId;\nlet amount;\n\nif (!accountId) {\n  return \"Please sign in with NEAR wallet\";\n}\n\nfunction getAssets() {\n  const assets = Near.view(BURROW_CONTRACT, \"get_assets_paged\");\n  if (!assets) return null;\n\n  const tokenIds = assets?.map(([id]) => id);\n  const assetsDetailed = tokenIds.map((token_id) =>\n    Near.view(BURROW_CONTRACT, \"get_asset\", { token_id })\n  );\n  const metadata = tokenIds?.map((token_id) =>\n    Near.view(token_id, \"ft_metadata\")\n  );\n  const balances = tokenIds.map((token_id) =>\n    Near.view(token_id, \"ft_balance_of\", { account_id: accountId })\n  );\n\n  return assetsDetailed?.map((asset, i) => {\n    return {\n      ...asset,\n      metadata: metadata?.[i],\n      accountBalance: balances?.[i],\n    };\n  });\n}\n\nconst assets = getAssets();\n// console.log(assets);\n\nif (!assets.length || !assets[0]) return <div>loading...</div>;\n\nconst listAssets = assets\n  ?.filter((a) => a.accountBalance > 0)\n  ?.map((asset) => {\n    console.log(asset);\n    return <option value={asset.token_id}>{asset.metadata.symbol}</option>;\n  });\n\nconst handleSelect = (e) => {\n  selectedTokenId = e.target.value;\n};\n\nconst handleAmount = (e) => {\n  amount = e.target.value;\n};\n\nconst handleDeposit = () => {\n  console.log(selectedTokenId, amount);\n  if (!selectedTokenId || !amount) return;\n\n  Near.call([\n    {\n      contractName: \"wrap.near\",\n      methodName: \"near_deposit\",\n    },\n    {\n      contractName: \"wrap.near\",\n      methodName: \"ft_transfer_call\",\n      args: {\n        receiver_id: \"contract.main.burrow.near\",\n        amount: \"1000000000000000000000000\",\n        msg: '{\"Execute\":{\"actions\":[{\"IncreaseCollateral\":{\"token_id\":\"wrap.near\",\"max_amount\":\"1000000000000000000000000\"}}]}}',\n      },\n    },\n  ]);\n};\n\nreturn (\n  <div class=\"card\" style={{ maxWidth: \"300px\" }}>\n    <div class=\"card-body d-grid gap-3\">\n      <select onChange={handleSelect}>\n        <option value=\"\">Deposit an asset</option>\n        {listAssets}\n      </select>\n      <input type=\"number\" onChange={handleAmount} />\n      <button onClick={handleDeposit}>Deposit</button>\n    </div>\n  </div>\n);\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ciocan.near/widget/burrow-deposit", "metadata.image.ipfs_cid": NaN, "metadata.linktree.website": NaN, "metadata.name": NaN, "metadata.tags.burrow": NaN, "metadata.tags.widget": NaN}