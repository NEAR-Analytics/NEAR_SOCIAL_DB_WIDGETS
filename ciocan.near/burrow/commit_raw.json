{"tx_hash": "3DXSgPPZysAcz4kbDq3Fq5BSMZaVBxvNvXhwHynT7afo", "action_id_social": "A6bKjzJDetxHVSraJ4AWRAu4Qd6AXFZt3j4e8a8XBjpf-0-widget", "block_id": 78950542, "block_timestamp": "2022-11-21 16:22:50.335", "signer_id": "ciocan.near", "widget_name": "burrow", "source_code": "function power(x, y) {\n  if (y === 0) {\n    return 1;\n  } else if (y % 2 === 0) {\n    return power(x, parseInt(y / 2)) * power(x, parseInt(y / 2));\n  } else {\n    return x * power(x, parseInt(y / 2)) * power(x, parseInt(y / 2));\n  }\n}\n\nfunction getAssets() {\n  const assets = Near.view(\"contract.main.burrow.near\", \"get_assets_paged\");\n  const tokenIds = assets.map(([id]) => id);\n\n  const assetsDetailed = tokenIds.map((token_id) =>\n    Near.view(\"contract.main.burrow.near\", \"get_asset\", { token_id })\n  );\n\n  const metadata = tokenIds.map((token_id) =>\n    Near.view(token_id, \"ft_metadata\")\n  );\n\n  const config = Near.view(\"contract.main.burrow.near\", \"get_config\");\n  const prices = Near.view(config[\"oracle_account_id\"], \"get_price_data\");\n\n  const refPricesResponse = fetch(\n    \"https://raw.githubusercontent.com/NearDeFi/token-prices/main/ref-prices.json\"\n  );\n  const refPrices = JSON.parse(refPricesResponse.body);\n\n  return assetsDetailed.map((asset, i) => {\n    const price = prices.prices.find((p) => p.asset_id === asset.token_id);\n    const decimals = parseInt(price.price.decimals) - metadata[i].decimals;\n    const usd = price.price.multiplier / power(10, decimals);\n\n    return {\n      ...asset,\n      metadata: metadata[i],\n      price: {\n        ...price.price,\n        usd: usd ? usd : refPrices[asset.token_id].price,\n      },\n    };\n  });\n}\n\nconst assets = getAssets();\nconsole.log(assets);\n\nconst allAssets = assets.map((asset) => (\n  <li>\n    <span>{asset.metadata.symbol}</span>\n  </li>\n));\n\nreturn (\n  <ul>\n    <h4>Assets</h4>\n    {allAssets}\n  </ul>\n);\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ciocan.near/widget/burrow", "metadata.linktree.website": NaN, "metadata.name": NaN, "metadata.tags.burrow": NaN, "metadata.tags.widget": NaN, "metadata.image.ipfs_cid": NaN}