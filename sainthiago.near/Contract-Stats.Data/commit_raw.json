{"tx_hash": "5SRE5S1VWsLEtJCbwfoa73h6bfv9bQzfRnQ6fnZUGAYL", "action_id_social": "H4i1KY6LZ77QZ3kNXDaHvD5Ra9bH8m417nVNLcEp2Mvz-0-widget", "block_id": 87952456, "block_timestamp": "2023-03-23 15:59:08.672", "signer_id": "sainthiago.near", "widget_name": "Contract-Stats.Data", "source_code": "const contractId = props.contractId;\nvar loadingData = props.loadingData || false;\nvar floor = props.floor;\nvar owners = props.owners;\nvar nfts = props.nfts;\nvar minters = props.minters;\nvar volume = props.volume;\n\nif (!contractId) {\n  return <></>;\n}\n\nconst statsQuery = JSON.stringify({\n  query: `\n  query getContractStats($contractId: String!){\n    nfts: nft_tokens_aggregate( where: {nft_contracts: {id: {_eq: $contractId}}}) {\n      aggregate {\n        count\n      }\n    }\n\n    owners: nft_tokens_aggregate(distinct_on: owner, where: {nft_contracts: {id: {_eq: $contractId}}}) {\n        aggregate {\n          count\n        }\n    }\n\n    floor: nft_listings(order_by: {price: asc}, where: {unlisted_at: {_is_null: true}, invalidated_at: {_is_null: true}, accepted_at: {_is_null: true}, nft_contracts: { id: {_eq: $contractId}}}, limit: 10) {\n      price\n    }   \n\n    minters: mb_store_minters_aggregate(where: {nft_contract_id: {_eq: $contractId}}) {\n        aggregate {\n        count\n        }\n    }   \n    volume: nft_earnings_aggregate(where: {nft_contract_id: {_eq: $contractId}, _and: {approval_id: {_is_null: false}}}) {\n        aggregate {\n            sum {\n            amount\n            }\n        }\n    }}\n`,\n  variables: {\n    contractId: contractId,\n  },\n});\n\nfunction getContractStats() {\n  loadingData = true;\n\n  asyncFetch(\"https://graph.mintbase.xyz\", {\n    method: \"POST\",\n    headers: {\n      \"mb-api-key\": \"omni-site\",\n      \"Content-Type\": \"application/json\",\n      \"x-hasura-role\": \"anonymous\",\n    },\n    body: statsQuery,\n  }).then((res) => {\n    loadingData = false;\n    floor = ((res?.body?.data[\"floor\"]?.price[0] || 0) / 1e24).toFixed(2);\n    owners = res?.body?.data[\"owners\"]?.aggregate?.count || 0;\n    volume = (\n      (res?.body?.data[\"volume\"]?.aggregate?.sum?.amount || 0) / 1e24\n    ).toFixed(2);\n    nfts = res?.body?.data[\"nfts\"]?.aggregate?.count || 0;\n    minters = res?.body?.data[\"minters\"]?.aggregate?.count || 0;\n  });\n}\n\nreturn <></>;\n", "metadata": null, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/sainthiago.near/widget/Contract-Stats.Data", "branch.draft.": NaN, "branch.draft.metadata": NaN}