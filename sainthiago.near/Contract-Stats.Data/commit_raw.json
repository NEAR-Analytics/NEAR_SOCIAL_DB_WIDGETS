{"tx_hash": "EpbgNfA4YYnBN3FgQt9uCyUN4rXnXTX1BxgFuBMetXox", "action_id_social": "HU9MB7rkC6SdSa7EKSArZXUDQxKrVyEqzi8Ys9sTrJ9w-0-widget", "block_id": 87954273, "block_timestamp": "2023-03-23 16:37:22.277", "signer_id": "sainthiago.near", "widget_name": "Contract-Stats.Data", "source_code": "const contractId = props.contractId || \"rui\";\nconst button = props.button || <button>Check Stats</button>;\nconst getContractData = props.getContractData;\n\nif (!contractId) {\n  return <></>;\n}\n\nconst statsQuery = JSON.stringify({\n  query: `\n  query getContractStats($contractId: String!){\n    nfts: nft_tokens_aggregate( where: {nft_contracts: {id: {_eq: $contractId}}}) {\n      aggregate {\n        count\n      }\n    }\n\n    owners: nft_tokens_aggregate(distinct_on: owner, where: {nft_contracts: {id: {_eq: $contractId}}}) {\n        aggregate {\n          count\n        }\n    }\n\n    floor: nft_listings(order_by: {price: asc}, where: {unlisted_at: {_is_null: true}, invalidated_at: {_is_null: true}, accepted_at: {_is_null: true}, nft_contracts: { id: {_eq: $contractId}}}, limit: 10) {\n      price\n    }   \n\n    minters: mb_store_minters_aggregate(where: {nft_contract_id: {_eq: $contractId}}) {\n        aggregate {\n        count\n        }\n    }   \n    volume: nft_earnings_aggregate(where: {nft_contract_id: {_eq: $contractId}, _and: {approval_id: {_is_null: false}}}) {\n        aggregate {\n            sum {\n            amount\n            }\n        }\n    }}\n`,\n  variables: {\n    contractId: contractId,\n  },\n});\n\nfunction getContractStats() {\n  asyncFetch(\"https://graph.mintbase.xyz\", {\n    method: \"POST\",\n    headers: {\n      \"mb-api-key\": \"omni-site\",\n      \"Content-Type\": \"application/json\",\n      \"x-hasura-role\": \"anonymous\",\n    },\n    body: statsQuery,\n  }).then((res) => {\n    State.update({\n      loading: false,\n      floor: ((res?.body?.data[\"floor\"]?.price[0] || 0) / 1e24).toFixed(2),\n      owners: res?.body?.data[\"owners\"]?.aggregate?.count || 0,\n      volume: (\n        (res?.body?.data[\"volume\"]?.aggregate?.sum?.amount || 0) / 1e24\n      ).toFixed(2),\n      nfts: res?.body?.data[\"nfts\"]?.aggregate?.count || 0,\n      minters: res?.body?.data[\"minters\"]?.aggregate?.count || 0,\n    });\n\n    getContractData({\n      floor: state.floor,\n      loading: state.loading,\n      minters: state.minters,\n      nfts: state.nfts,\n      owners: state.owners,\n      volume: state.volume,\n    });\n  });\n}\n\nconsole.log(state);\n\nreturn (\n  <div\n    onClick={() => {\n      State.update({\n        loading: true,\n      });\n      getContractStats();\n    }}\n  >\n    {button}\n  </div>\n);\n", "metadata": null, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/sainthiago.near/widget/Contract-Stats.Data", "branch.draft.": NaN, "branch.draft.metadata": NaN}