{"tx_hash": "CSWQFeQAcMef7FVG96oGqiWjKnzYjUMjSxpysScwSnZL", "action_id_social": "Hqk6o8dpWdc3rDoKZzyRYCqpZiZhrwdTrjTm8aMsi7pw-1-widget", "block_id": 85158584, "block_timestamp": "2023-02-13 18:28:55.246", "signer_id": "rayfoster.near", "widget_name": "NFTAudio", "source_code": "const nftSelectArea = styled.div`\r\n  text-align:center;\r\n  margin-bottom:20px;\r\n`;\r\n\r\nconst nftSelect = styled.select`\r\nwidth: 300px;\r\n    background-color: #62949b;\r\n    color: white;\r\n    text-shadow: 0 0 4px white;\r\n    text-align: center;\r\n`;\r\n\r\nconst playerArea = styled.div`\r\n  width:500px;\r\n  height:500px;\r\n  background-color:rgba(240,240,240,0.5);\r\n  border-radius:30px;\r\n  padding:30px;\r\n  backdrop-filter: blur(50px);\r\n`;\r\n\r\nconst broadcaster = styled.h2`\r\n  color:#555;\r\n  text-align:center;\r\n`;\r\nconst song = styled.h3`\r\n  color:#666;\r\n  text-align:center;\r\n`;\r\nconst description = styled.p`\r\n  display:block;\r\n  font-size:11px;\r\n  border-radius:10px;\r\n  padding:10px;\r\n  background-color:rgb(219, 219, 219,0.2);;\r\n`;\r\nconst uiButtons = styled.button`\r\n  background-color:  rgba(255,255,255,0.2);\r\n  border-radius:20px;\r\n  width:50px;\r\n  height:50px;\r\n  border-width:0px;\r\n  filter: drop-shadow(0px 1px 2px #555);\r\n  margin-left:10px;\r\n  margin-right:10px;\r\n  &:hover {\r\n    background-color: white;\r\n    }\r\n`;\r\n\r\nconst uiButtonArea = styled.div`\r\n  margin:auto;\r\n  text-align:center;\r\n`;\r\nconst rotate = styled.keyframes`\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n\r\n  to {\r\n    transform: rotate(360deg);\r\n  }`;\r\nconst bgThumb = styled.img`\r\n    position: absolute;\r\n    top: 160px;\r\n    width: 350px;\r\n    max-height: 350px;\r\n    left:85px;\r\n    z-index: -1;\r\n    animation: ${rotate} 10s linear infinite;\r\n`;\r\nconst fgThumb = styled.img`\r\n  width: 200px;\r\n    margin-left: 120px;\r\n    margin-top: 10px;\r\n    filter: drop-shadow(2px 4px 6px black);\r\n    border-radius:15px;\r\n`;\r\nconst playThis = styled.button`\r\n  padding:20px;\r\n`;\r\n\r\nconst accountId = context.accountId;\r\nconst nftList = fetch(\"https://graph.mintbase.xyz\", {\r\n  method: \"POST\",\r\n  headers: {\r\n    \"mb-api-key\": \"omni-site\",\r\n    \"Content-Type\": \"application/json\",\r\n    \"x-hasura-role\": \"anonymous\",\r\n  },\r\n  body: JSON.stringify({\r\n    query: `\r\n        query MyQuery ($accountId: String){\r\n            mb_views_nft_owned_tokens(limit: 100, where: {listing_kind: {_is_null: true}, owner: {_eq: $accountId}}) {\r\n                token_id\r\n                nft_contract_id\r\n                metadata_id\r\n                title\r\n                minter                \r\n            }\r\n        }\r\n`,\r\n    variables: {\r\n      accountId: accountId,\r\n    },\r\n  }),\r\n}).body.data.mb_views_nft_owned_tokens;\r\nlet thisIndex = state.index ?? 0;\r\nlet thisToken = nftList[thisIndex];\r\n\r\nconst tokenId = thisToken.token_id;\r\nconst contractId = thisToken.nft_contract_id;\r\nconst rootId = thisToken.token_id.slice(0, thisToken.token_id.length - 3);\r\n\r\nconst nftMetadata = Near.view(contractId, \"nft_metadata\");\r\nconst tokenMetadata = Near.view(contractId, \"nft_token\", {\r\n  token_id: tokenId,\r\n}).metadata;\r\nlet extra = JSON.parse(tokenMetadata.extra);\r\nlet audioExist = !!extra.music_cid;\r\n\r\nlet audioUri = `https://daorecords.io:8443/fetch?cid=${extra.music_cid}`;\r\nlet newAudio = new Audio(audioUri);\r\nlet artUrl = `https://daorecords.io:8443/get/thumbnail?root_id=${rootId}&contract=${contractId}`;\r\nlet artRes = fetch(artUrl).body.thumbnail;\r\nlet artData = `data:image/webp;base64,${artRes}`;\r\n\r\n//Get's current time\r\n//newAudio.currentTime\r\n\r\nfunction playAudio() {\r\n  newAudio.play();\r\n}\r\n\r\nfunction pauseAudio() {\r\n  newAudio.pause();\r\n}\r\n\r\nfunction stopAudio() {\r\n  newAudio.load();\r\n}\r\n\r\nfunction selectedValue(v) {\r\n  let index = parseInt(v.target.value);\r\n  index = index === 0 ? 0 : index - 1;\r\n  State.update({ index });\r\n}\r\n\r\nreturn (\r\n  <div>\r\n    <nftSelectArea>\r\n      <h5>Select Audio NFT</h5>\r\n      <nftSelect name=\"token\" onChange={selectedValue}>\r\n        <option value=\"0\">Tokens</option>\r\n        {nftList.map((x, i) => (\r\n          <option value={i + 1}>{`${x.title} (${x.nft_contract_id})`}</option>\r\n        ))}\r\n      </nftSelect>\r\n    </nftSelectArea>\r\n    {(!state.index && state.index !== 0) || !audioExist ? (\r\n      <p>Select a compatible NFT</p>\r\n    ) : (\r\n      <div>\r\n        <bgThumb src={artData} />\r\n\r\n        <playerArea>\r\n          <broadcaster>{nftMetadata.symbol}</broadcaster>\r\n\r\n          <song>{tokenMetadata.title}</song>\r\n          <description> {tokenMetadata.description}</description>\r\n\r\n          <uiButtonArea>\r\n            <uiButtons\r\n              style={ui.btnPlay ? { \"background-color\": \"#fff\" } : {}}\r\n              onClick={playAudio}\r\n            >\r\n              <svg width=\"24\" height=\"24\">\r\n                <path d=\"M23 12l-22 12v-24l22 12zm-21 10.315l18.912-10.315-18.912-10.315v20.63z\" />\r\n              </svg>\r\n            </uiButtons>\r\n\r\n            <uiButtons\r\n              style={ui.btnPause ? { \"background-color\": \"#fff\" } : {}}\r\n              onClick={pauseAudio}\r\n            >\r\n              <svg width=\"24\" height=\"24\">\r\n                <path d=\"M10 24h-6v-24h6v24zm10 0h-6v-24h6v24zm-11-23h-4v22h4v-22zm10 0h-4v22h4v-22z\" />\r\n              </svg>\r\n            </uiButtons>\r\n\r\n            <uiButtons\r\n              style={ui.btnStop ? { \"background-color\": \"#fff\" } : {}}\r\n              onClick={stopAudio}\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\">\r\n                <path d=\"M2 2h20v20h-20z\" />\r\n              </svg>\r\n            </uiButtons>\r\n          </uiButtonArea>\r\n          <fgThumb src={artData} />\r\n        </playerArea>\r\n      </div>\r\n    )}\r\n  </div>\r\n);\r\n", "metadata": NaN, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/rayfoster.near/widget/NFTAudio", "metadata.name": NaN}