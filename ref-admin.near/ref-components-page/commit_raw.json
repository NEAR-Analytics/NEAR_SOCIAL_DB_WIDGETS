{"tx_hash": "EwkNzGo5RnLaQ6yXyf81xAj7y2pcR7mRje1ydqSjUVaQ", "action_id_social": "DkrJGe5WX517MfKE7wGVAAswGSMpBxAv49iFPtZTPZSv-0-widget", "block_id": 91366551, "block_timestamp": "2023-05-08T08:22:32.760Z", "signer_id": "ref-admin.near", "widget_name": "ref-components-page", "source_code": "const limitPerPage = 18;\nlet components = [];\nlet totalApps = 0;\nlet totalComponents = 0;\nconst componentsUrl = \"#/near/widget/ComponentsPage\";\nconst searchPlaceholder = \"Search\";\n\nconst current_mode = Storage.get(\n  \"ref-mode\",\n  \"ref-admin.near/widget/user-builder\"\n);\n\nconst filterMap = {\n  Chain: [\"NEAR\", \"Ethereum\", \"Arbitrum\"],\n  Infrastructure: [\"Wallets\", \"Bridges\", \"Validators\", \"Expolorers\"],\n  Dapps: [\n    \"Liquid staking\",\n    \"Defi\",\n    \"Dex\",\n    \"Lending\",\n    \"Derivatives\",\n    \"Insurance\",\n    \"Stablecoins\",\n    \"Yield Aggregators\",\n    \"Launch Pad\",\n  ],\n  NFT: [\"NFT marketplace\", \"Collectibles\"],\n};\n\nconst { role } = props;\n\nconst addComponentIcon = (\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M13.9534 7.40151H13.0906V4.71665C13.0906 3.75737 12.3243 2.89458 11.2685 2.89458H8.5855V2.03179C8.5855 1.07251 7.81919 0.209717 6.76343 0.209717C5.80415 0.209717 4.94136 0.976025 4.94136 2.03179V2.89458H2.25835C1.29907 2.89458 0.436279 3.66089 0.436279 4.71665V7.40151H1.29907C2.25835 7.40151 3.12114 8.16782 3.12114 9.22358C3.12114 10.1829 2.35483 11.0457 1.29907 11.0457H0.436279V13.7305C0.436279 14.6898 1.20259 15.5526 2.25835 15.5526H4.94321V14.6898C4.94321 13.7305 5.70952 12.8677 6.76528 12.8677C7.72456 12.8677 8.58735 13.634 8.58735 14.6898V15.5507H11.2722C12.2315 15.5507 13.0943 14.7844 13.0943 13.7287V11.0438H13.9571C14.9164 11.0438 15.7791 10.2775 15.7791 9.22173C15.7754 8.16782 14.9126 7.40151 13.9534 7.40151Z\"\n      fill=\"white\"\n    />\n  </svg>\n);\n\nconst curComponent = \"ref-admin.near/widget/ref-components-page\";\n\nState.init({\n  currentPage: 0,\n  selectedTab: props.tab || \"all\",\n  filters: Storage.get(\"ref-filters\", curComponent) || [\"Defi\"],\n  counts: {\n    Chain: 0,\n    Infrastructure: 0,\n    Dapps: 0,\n    NFT: 0,\n  },\n});\n\nif (props.tab && props.tab !== state.selectedTab) {\n  State.update({\n    selectedTab: props.tab,\n  });\n}\n\nconst tagsData = Social.get(\"*/widget/*/metadata/tags/*\", \"final\");\n\nconst data = Social.keys(\"*/widget/*\", \"final\", {\n  return_type: \"BlockHeight\",\n});\n\nif (data) {\n  const result = [];\n\n  Object.keys(data).forEach((accountId) => {\n    return Object.keys(data[accountId].widget).forEach((widgetName) => {\n      totalComponents++;\n\n      //   if (state.selectedTab === \"apps\") {\n\n      const tags = Object.keys(\n        tagsData[accountId].widget[widgetName]?.metadata?.tags || {}\n      );\n\n      const hasRefTag = tags.some((t) =>\n        state.filters.map((f) => f.toLowerCase()).includes(t.toLowerCase())\n      );\n\n      if (!hasRefTag && state.filters.length > 0) return;\n\n      //     const hasAppTag =\n      //       tagsData[accountId].widget[widgetName]?.metadata?.tags[\"app\"] === \"\";\n      //     if (!hasAppTag) return;\n      //     totalApps++;\n      //   }\n\n      result.push({\n        accountId,\n        widgetName,\n        blockHeight: data[accountId].widget[widgetName],\n        tags: tags,\n      });\n    });\n  });\n\n  result.sort((a, b) => b.blockHeight - a.blockHeight);\n  components = result.slice(0, state.currentPage * limitPerPage + limitPerPage);\n}\n\nfunction onSearchChange({ result, term }) {\n  if (term.trim()) {\n    State.update({ searchResults: result || [] });\n  } else {\n    State.update({ searchResults: null });\n  }\n}\n\nconst items = state.searchResults || components;\n\nconst counts = {\n  Chain:\n    items?.filter((i) => {\n      return i.tags.some(\n        (i) =>\n          filterMap[\"Chain\"]\n            .map((f) => f.toLowerCase())\n            .includes(i.toLowerCase()) &&\n          filterMap[\"Chain\"].some((f) => state.filters.includes(f))\n      );\n    })?.length || 0,\n  Infrastructure:\n    items?.filter((i) => {\n      return i.tags.some(\n        (i) =>\n          filterMap[\"Infrastructure\"]\n            .map((f) => f.toLowerCase())\n            .includes(i.toLowerCase()) &&\n          filterMap[\"Infrastructure\"].some((f) => state.filters.includes(f))\n      );\n    })?.length || 0,\n\n  Dapps:\n    items?.filter((i) => {\n      return i.tags.some(\n        (i) =>\n          filterMap[\"Dapps\"]\n            .map((f) => f.toLowerCase())\n            .includes(i.toLowerCase()) &&\n          filterMap[\"Dapps\"].some((f) => state.filters.includes(f))\n      );\n    })?.length || 0,\n\n  NFT:\n    items?.filter((i) => {\n      return i.tags.some(\n        (i) =>\n          filterMap[\"NFT\"]\n            .map((f) => f.toLowerCase())\n            .includes(i.toLowerCase()) &&\n          filterMap[\"NFT\"].some((f) => state.filters.includes(f))\n      );\n    })?.length || 0,\n};\n\nconst Wrapper = styled.div`\n  gap: 48px;\n  padding-bottom: 48px;\n  padding-top: 18px;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n`;\n\nconst H1 = styled.h1`\n  font-weight: 600;\n  font-size: 32px;\n  line-height: 39px;\n  color: #11181c;\n  margin: 0;\n`;\n\nconst H2 = styled.h2`\n  font-weight: 400;\n  font-size: 20px;\n  line-height: 24px;\n  color: #687076;\n  margin: 0;\n`;\n\nconst Text = styled.p`\n  margin: 0;\n  line-height: 1.5rem;\n  color: ${(p) => (p.bold ? \"#11181C\" : \"#687076\")} !important;\n  font-weight: ${(p) => (p.bold ? \"600\" : \"400\")};\n  font-size: ${(p) => (p.small ? \"12px\" : \"14px\")};\n  overflow: ${(p) => (p.ellipsis ? \"hidden\" : \"\")};\n  text-overflow: ${(p) => (p.ellipsis ? \"ellipsis\" : \"\")};\n  white-space: ${(p) => (p.ellipsis ? \"nowrap\" : \"\")};\n  overflow-wrap: anywhere;\n\n  b {\n    font-weight: 600;\n    color: #11181c;\n  }\n\n  &[href] {\n    display: inline-flex;\n    gap: 0.25rem;\n\n    &:hover,\n    &:focus {\n      text-decoration: underline;\n    }\n  }\n`;\n\nconst Items = styled.div`\n  display: grid;\n  width: 100%;\n  grid-template-columns: repeat(auto-fill, 350px);\n  gap: 20px;\n  height: 100%;\n`;\n\nconst FlexStart = styled.div`\n  display: flex;\n  align-items: center;\n`;\n\nconst ContentWrapper = styled.div`\n  display: flex;\n  margin-top: 20px;\n`;\n\nconst FunctionArea = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n`;\n\nconst AddComponentWrapper = styled.a`\n  height: 36px;\n  display: flex;\n  align-items: center;\n  background: #2d4348;\n  border-radius: 10px;\n  padding: 8px 16px 8px 16px;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 14px;\n  line-height: 19px;\n  gap: 10px;\n  margin-left: 12px;\n  cursor: pointer;\n  color: #ffffff;\n\n  :hover {\n    color: white;\n    text-decoration: none;\n  }\n`;\n\nconst FunctionWrapper = styled.div`\n  height: 36px;\n  display: flex;\n  align-items: center;\n  background: #2d4348;\n  border-radius: 10px;\n  padding: 8px 16px 8px 16px;\n  font-style: normal;\n  font-weight: 500;\n  font-size: 14px;\n  line-height: 19px;\n  gap: 10px;\n  margin-left: 12px;\n  cursor: pointer;\n\n  color: #ffffff;\n`;\n\nconst sortIcon = (\n  <svg\n    width=\"12\"\n    height=\"10\"\n    viewBox=\"0 0 12 10\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect width=\"12\" height=\"2\" rx=\"1\" fill=\"white\" />\n    <rect x=\"1\" y=\"4\" width=\"9\" height=\"2\" rx=\"1\" fill=\"white\" />\n    <rect x=\"3\" y=\"8\" width=\"5\" height=\"2\" rx=\"1\" fill=\"white\" />\n  </svg>\n);\n\nconst gridView = (\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect x=\"0.5\" y=\"0.5\" width=\"6.2\" height=\"6.2\" rx=\"1.5\" stroke=\"#7E8A93\" />\n    <rect\n      x=\"0.5\"\n      y=\"9.30005\"\n      width=\"6.2\"\n      height=\"6.2\"\n      rx=\"1.5\"\n      stroke=\"#7E8A93\"\n    />\n    <rect\n      x=\"9.29999\"\n      y=\"0.5\"\n      width=\"6.2\"\n      height=\"6.2\"\n      rx=\"1.5\"\n      stroke=\"#7E8A93\"\n    />\n    <rect\n      x=\"9.29999\"\n      y=\"9.30005\"\n      width=\"6.2\"\n      height=\"6.2\"\n      rx=\"1.5\"\n      stroke=\"#7E8A93\"\n    />\n  </svg>\n);\n\nconst arrowDown = (\n  <svg\n    width=\"9\"\n    height=\"12\"\n    viewBox=\"0 0 9 12\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M4.53662 0.999998L4.53662 10.0732M4.53662 10.0732L7.78623 6.82363M4.53662 10.0732L1.0549 6.59152\"\n      stroke=\"white\"\n      stroke-width=\"2\"\n      stroke-linecap=\"round\"\n      stroke-linejoin=\"round\"\n    />\n  </svg>\n);\n\nconst wideView = (\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect width=\"16\" height=\"7\" rx=\"2\" fill=\"#00FFD1\" />\n    <rect y=\"9\" width=\"16\" height=\"7\" rx=\"2\" fill=\"#00FFD1\" />\n  </svg>\n);\n\nconst CardView = styled.div`\n  width: 36px;\n  height: 36px;\n\n  background: #1a2e33;\n  border-radius: 10px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst ViewMoreWrapper = styled.div`\n  white-space: nowrap;\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  gap: 7px;\n  height: 36px;\n  opacity: 0.5;\n  border: 1px solid #ffffff;\n  border-radius: 10px;\n  cursor: pointer;\n  color: #ffffff;\n  padding: 0px 25px 0px 25px;\n  max-width: max-content;\n  margin: auto;\n  margin-top: 20px;\n  position: relative;\n  left: 100px;\n`;\n\nreturn (\n  <Wrapper className=\"\">\n    <div\n      style={{\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"space-between\",\n      }}\n    >\n      <FlexStart>\n        <Widget\n          src=\"ref-admin.near/widget/ref-component-search\"\n          props={{\n            limit: 21,\n            onChange: onSearchChange,\n            placeholder: searchPlaceholder,\n            filterTags: state.filters.length === 0 ? null : state.filters,\n          }}\n        />\n\n        {role === \"Builder\" && (\n          <AddComponentWrapper href={\"#edit\"}>\n            {addComponentIcon}\n            <span>Add Component</span>\n          </AddComponentWrapper>\n        )}\n      </FlexStart>\n\n      <FunctionArea>\n        <FunctionWrapper>\n          {sortIcon}\n\n          <span>Latest</span>\n        </FunctionWrapper>\n\n        <CardView>{gridView}</CardView>\n        <CardView>{wideView}</CardView>\n      </FunctionArea>\n    </div>\n\n    <ContentWrapper>\n      <Widget\n        src=\"ref-admin.near/widget/ref-component-left-bar\"\n        props={{\n          filters: state.filters,\n          counts: counts,\n          updateFilters: (newFilters) => {\n            Storage.set(\"ref-filters\", newFilters);\n            State.update({\n              filters: newFilters,\n            });\n          },\n        }}\n      />\n      {state.searchResults?.length === 0 && (\n        <Text>No components matched your search.</Text>\n      )}\n\n      {items.length > 0 && (\n        <Items>\n          {items.map((component, i) => (\n            <Widget\n              key={component.accountId + component.widgetName}\n              src=\"ref-admin.near/widget/ref-component-card-wide\"\n              props={{\n                src: `${component.accountId}/widget/${component.widgetName}`,\n                blockHeight: component.blockHeight,\n                role: role,\n              }}\n            />\n          ))}\n        </Items>\n      )}\n    </ContentWrapper>\n\n    {!state.searchResults && items.length > 17 && (\n      <ViewMoreWrapper\n        onClick={() => State.update({ currentPage: state.currentPage + 1 })}\n      >\n        <span>View More</span>\n\n        {arrowDown}\n      </ViewMoreWrapper>\n    )}\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ref-admin.near/widget/ref-components-page", "__row_index": 1}