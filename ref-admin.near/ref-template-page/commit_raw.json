{"tx_hash": "ApjeWEgcpRXWtXC3QYBkmp6nvbejX22mRcTW1SogH7Zu", "action_id_social": "A4axsxV9gRUVgRdpUq5sYQ4W8jnBnkrmNDmAof4WLkPa-0-widget", "block_id": 90845387, "block_timestamp": "2023-05-01 10:02:34.435", "signer_id": "ref-admin.near", "widget_name": "ref-template-page", "source_code": "const limitPerPage = 18;\nlet components = [];\nlet totalApps = 0;\nlet totalComponents = 0;\nconst componentsUrl = \"#/near/widget/ComponentsPage\";\nconst searchPlaceholder = \"Search\";\n\nconst current_mode = Storage.get(\n  \"ref-mode\",\n  \"ref-admin.near/widget/user-builder\"\n);\n\nconst { role } = props;\n\nconst addComponentIcon = (\n  <svg\n    width=\"19\"\n    height=\"19\"\n    viewBox=\"0 0 19 19\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M18.9979 4.76397C18.9979 4.74248 18.9893 4.72099 18.9871 4.6995C18.9828 4.62644 18.9742 4.55338 18.9549 4.48247C18.942 4.44164 18.9227 4.40511 18.9055 4.36643C18.8841 4.31701 18.8669 4.26759 18.839 4.22246C18.8132 4.18163 18.781 4.1451 18.751 4.10857C18.7209 4.07204 18.693 4.03336 18.6565 4.00113C18.6179 3.9646 18.5749 3.93667 18.532 3.90658C18.5062 3.88724 18.4826 3.86361 18.4547 3.84642C18.4418 3.83997 18.4268 3.83567 18.4139 3.82922C18.3967 3.82063 18.3838 3.80559 18.3645 3.79699L10.8697 0.255711C10.4232 0.0451256 9.92297 0 9.58161 0C9.07065 0 8.58545 0.100995 8.21619 0.281497L0.620506 3.98394C0.238361 4.17089 -0.0042377 4.54908 5.60765e-05 4.96166C5.60765e-05 4.97026 0.00434995 4.9767 0.00434995 4.98745C0.00434995 4.99604 5.60765e-05 5.00464 5.60765e-05 5.01323V14.077C5.60765e-05 14.7088 0.558247 15.4458 1.26887 15.7789L8.64986 18.8754C8.81517 18.9592 8.99551 19 9.178 19C9.3154 19 9.45065 18.9678 9.58161 18.9183C9.70184 18.9033 9.82206 18.8775 9.9337 18.8259L17.699 15.5554C18.4397 15.2073 19 14.4681 19 13.8385V4.77471V4.77041C18.9979 4.76827 18.9979 4.76612 18.9979 4.76397ZM9.7641 7.49729C9.62884 7.55101 9.25099 7.55745 9.12862 7.51663L3.66909 4.93802L9.24026 2.22404C9.26817 2.21115 9.39054 2.17677 9.58161 2.17677C9.74048 2.17677 9.84353 2.20041 9.87359 2.21115L15.3267 4.78761L9.7641 7.49729ZM16.7286 13.5828C16.72 13.5892 16.7114 13.5935 16.705 13.5978L10.5219 16.4515L10.3094 9.72993C10.3223 9.72133 10.3352 9.71273 10.3502 9.70629L16.7307 6.55825V13.5828H16.7286Z\"\n      fill=\"white\"\n    />\n  </svg>\n);\n\nState.init({\n  currentPage: 0,\n  selectedTab: props.tab || \"all\",\n  filters: [],\n  counts: {\n    Chain: 0,\n    Infrastructure: 0,\n    Dapps: 0,\n    NFT: 0,\n  },\n});\n\nif (props.tab && props.tab !== state.selectedTab) {\n  State.update({\n    selectedTab: props.tab,\n  });\n}\n\nconst tagsData = Social.get(\"*/widget/*/metadata/tags/*\", \"final\");\n\nconst data = Social.keys(\"*/widget/*\", \"final\", {\n  return_type: \"BlockHeight\",\n});\n\nif (data) {\n  const result = [];\n\n  Object.keys(data).forEach((accountId) => {\n    return Object.keys(data[accountId].widget).forEach((widgetName) => {\n      totalComponents++;\n\n      //   if (state.selectedTab === \"apps\") {\n\n      const tags = Object.keys(\n        tagsData[accountId].widget[widgetName]?.metadata?.tags || {}\n      );\n\n      const hasRefTag = tags.some((t) =>\n        state.filters.map((f) => f.toLowerCase()).includes(t.toLowerCase())\n      );\n\n      if (!hasRefTag && state.filters.length > 0) return;\n\n      //     const hasAppTag =\n      //       tagsData[accountId].widget[widgetName]?.metadata?.tags[\"app\"] === \"\";\n      //     if (!hasAppTag) return;\n      //     totalApps++;\n      //   }\n\n      result.push({\n        accountId,\n        widgetName,\n        blockHeight: data[accountId].widget[widgetName],\n        tags: tags,\n      });\n    });\n  });\n\n  result.sort((a, b) => b.blockHeight - a.blockHeight);\n  components = result.slice(0, state.currentPage * limitPerPage + limitPerPage);\n}\n\nfunction onSearchChange({ result, term }) {\n  if (term.trim()) {\n    State.update({ searchResults: result || [] });\n  } else {\n    State.update({ searchResults: null });\n  }\n}\n\nconst items = state.searchResults || components;\n\nconst Wrapper = styled.div`\n  gap: 48px;\n  padding-bottom: 48px;\n  padding-top: 18px;\n`;\n\nconst Text = styled.p`\n  margin: 0;\n  line-height: 1.5rem;\n  color: ${(p) => (p.bold ? \"#11181C\" : \"#687076\")} !important;\n  font-weight: ${(p) => (p.bold ? \"600\" : \"400\")};\n  font-size: ${(p) => (p.small ? \"12px\" : \"14px\")};\n  overflow: ${(p) => (p.ellipsis ? \"hidden\" : \"\")};\n  text-overflow: ${(p) => (p.ellipsis ? \"ellipsis\" : \"\")};\n  white-space: ${(p) => (p.ellipsis ? \"nowrap\" : \"\")};\n  overflow-wrap: anywhere;\n\n  b {\n    font-weight: 600;\n    color: #11181c;\n  }\n\n  &[href] {\n    display: inline-flex;\n    gap: 0.25rem;\n\n    &:hover,\n    &:focus {\n      text-decoration: underline;\n    }\n  }\n`;\n\nconst Items = styled.div`\n  display: grid;\n  width: 100%;\n  grid-template-columns: repeat(auto-fill, 415px);\n  gap: 20px;\n  height: 100%\n\n`;\n\nconst Item = styled.div`\n  :hover{\n  transform: ${(p) => (p.role === \"Builder\" ? \"\" : \"scale(1.05)\")}\n\n  }\n\n`;\n\nconst FlexStart = styled.div`\n    display:flex;\nalign-items:center;\n`;\n\nconst ContentWrapper = styled.div`\n  display: flex;\n  margin-top: 20px;\n\n  \n`;\n\nconst FunctionArea = styled.div`\n    display: flex;\n    align-items:center;\n    gap:12px;\n\n`;\n\nconst AddComponentWrapper = styled.a`\n\nheight: 36px;\ndisplay:flex;\nalign-items:center;\nbackground: #2D4348;\nborder-radius: 10px;\npadding: 8px 16px 8px 16px;\nfont-style: normal;\nfont-weight: 500;\nfont-size: 14px;\nline-height: 19px;\ngap:10px;\nmargin-left:12px;\ncursor:pointer;\ncolor: #FFFFFF;\n\n:hover{\n    color: white;\n    text-decoration:none;    \n}\n`;\n\nconst FunctionWrapper = styled.div`\n\nheight: 36px;\ndisplay:flex;\nalign-items:center;\nbackground: #2D4348;\nborder-radius: 10px;\npadding: 8px 16px 8px 16px;\nfont-style: normal;\nfont-weight: 500;\nfont-size: 14px;\nline-height: 19px;\ngap:10px;\nmargin-left:12px;\ncursor:pointer;\ncolor: #FFFFFF;\n`;\n\nconst sortIcon = (\n  <svg\n    width=\"12\"\n    height=\"10\"\n    viewBox=\"0 0 12 10\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect width=\"12\" height=\"2\" rx=\"1\" fill=\"white\" />\n    <rect x=\"1\" y=\"4\" width=\"9\" height=\"2\" rx=\"1\" fill=\"white\" />\n    <rect x=\"3\" y=\"8\" width=\"5\" height=\"2\" rx=\"1\" fill=\"white\" />\n  </svg>\n);\n\nconst gridView = (\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect x=\"0.5\" y=\"0.5\" width=\"6.2\" height=\"6.2\" rx=\"1.5\" stroke=\"#7E8A93\" />\n    <rect\n      x=\"0.5\"\n      y=\"9.30005\"\n      width=\"6.2\"\n      height=\"6.2\"\n      rx=\"1.5\"\n      stroke=\"#7E8A93\"\n    />\n    <rect\n      x=\"9.29999\"\n      y=\"0.5\"\n      width=\"6.2\"\n      height=\"6.2\"\n      rx=\"1.5\"\n      stroke=\"#7E8A93\"\n    />\n    <rect\n      x=\"9.29999\"\n      y=\"9.30005\"\n      width=\"6.2\"\n      height=\"6.2\"\n      rx=\"1.5\"\n      stroke=\"#7E8A93\"\n    />\n  </svg>\n);\n\nconst wideView = (\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <rect width=\"16\" height=\"7\" rx=\"2\" fill=\"#00FFD1\" />\n    <rect y=\"9\" width=\"16\" height=\"7\" rx=\"2\" fill=\"#00FFD1\" />\n  </svg>\n);\n\nconst isHomeIndex = [\n  Social.get(`${context.accountId}/myHomePagePath`) ===\n    `juaner.near/widget/ref-home`,\n\n  Social.get(`${context.accountId}/myHomePagePath`) ===\n    `ref-admin.near/widget/xBox`,\n];\n\nconst itemList = [\n  <Item role={role}>\n    <Widget\n      key={\"juaner.near\" + \"ref-home\"}\n      src=\"ref-admin.near/widget/ref-template-card\"\n      props={{\n        src: `juaner.near/widget/ref-home`,\n        isHome:\n          Social.get(`${context.accountId}/myHomePagePath`) ===\n          `juaner.near/widget/ref-home`,\n        blockHeight: component.blockHeight,\n        imageSrc: \"https://assets.ref.finance/images/ref_and_burrow.png\",\n        role: role,\n      }}\n    />\n  </Item>,\n\n  <Item role={role}>\n    <Widget\n      key={\"ref-admin.near/widget/xBox\"}\n      src=\"ref-admin.near/widget/ref-template-card\"\n      props={{\n        src: `ref-admin.near/widget/xBox`,\n        isHome:\n          Social.get(`${context.accountId}/myHomePagePath`) ===\n          `ref-admin.near/widget/xBox`,\n        blockHeight: component.blockHeight,\n        imageSrc: \"https://assets.ref.finance/images/xbox_banner.png\",\n        role: role,\n      }}\n    />\n  </Item>,\n];\n\nconst displayItems = [];\n\nif (\n  Social.get(`${context.accountId}/myHomePagePath`) ===\n    `juaner.near/widget/ref-home` ||\n  !Social.get(`${context.accountId}/myHomePagePath`)\n) {\n  displayItems.push(itemList[0]);\n  displayItems.push(itemList[1]);\n} else {\n  displayItems.push(itemList[1]);\n  displayItems.push(itemList[0]);\n}\n\nreturn (\n  <Wrapper className=\"\">\n    <div\n      style={{\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"space-between\",\n      }}\n    >\n      <FlexStart>\n        <Widget\n          src=\"ref-admin.near/widget/ref-component-search\"\n          props={{\n            limit: 21,\n            placeholder: searchPlaceholder,\n            filterTags: state.filters.length === 0 ? null : state.filters,\n          }}\n        />\n\n        {role === \"Builder\" && (\n          <AddComponentWrapper href={\"#edit\"}>\n            {addComponentIcon}\n            <span>Add Template</span>\n          </AddComponentWrapper>\n        )}\n      </FlexStart>\n\n      <FunctionArea>\n        <FunctionWrapper>\n          {sortIcon}\n\n          <span>Latest</span>\n        </FunctionWrapper>\n      </FunctionArea>\n    </div>\n\n    <ContentWrapper>\n      {state.searchResults?.length === 0 && (\n        <Text>No components matched your search.</Text>\n      )}\n\n      <Items>{displayItems.map((item) => item)}</Items>\n    </ContentWrapper>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ref-admin.near/widget/ref-template-page"}