{"tx_hash": "5bsygjuv9EzYPq9MEqbiRqkctRmdgAFQyKhG7qHqpZ2e", "action_id_social": "E2MGT6FJazTXY2jLRcxK4s7PkYhZyhHe3JPTWW4f4P47-0-widget", "block_id": 90841107, "block_timestamp": "2023-05-01 08:41:33.975", "signer_id": "ref-admin.near", "widget_name": "ComponentBanner", "source_code": "if (!props.src) return \"\";\n\nconst { commitLoading, customHomeLoading } = state;\nState.init({\n  copiedShareUrl: false,\n  commitLoading: false,\n  customHomeLoading: canCustomHome ? true : false,\n});\n\nconst { canCustomHome, src, mode } = props;\nconst primaryAction = props.primaryAction || \"viewDetails\";\nlet myHomePagePath;\nlet myHomePagePathDataFromCache;\nif (canCustomHome || props.primaryAction) {\n  myHomePagePath = Social.get(`${context.accountId}/myHomePagePath`);\n  myHomePagePathDataFromCache = Storage.get(\"myHomePagePathData\");\n}\nif (myHomePagePath !== null && myHomePagePathDataFromCache !== null) {\n  State.update({\n    customHomeLoading: false,\n  });\n}\n// console.log(\"66666666666666-canCustomHome\", canCustomHome);\n// console.log(\"66666666666666-myHomePagePath\", myHomePagePath);\n// console.log(\n//   \"66666666666666-myHomePagePathDataFromCache\",\n//   myHomePagePathDataFromCache\n// );\nif (customHomeLoading) return \"\";\nconst finalSrc = canCustomHome ? myHomePagePath || src : src; // src \u53d6url\u4e2d\u7684\u6ca1\u6709\u7684\u8bdd\u53d6\u9ed8\u8ba4\u503c\nconst [accountId, widget, widgetName] = finalSrc.split(\"/\");\nconst data = Social.get(`${accountId}/widget/${widgetName}/metadata/**`);\nconst metadata = data || {};\nconst tags = Object.keys(metadata.tags || {});\nconst appUrl = `/#/${finalSrc}`;\nconst detailsUrl = `/#/ref-admin.near/widget/ComponentDetailsPage?src=${finalSrc}`;\nconst shareUrl = `https://alpha.near.org${detailsUrl}`;\nconst size = props.size || \"large\";\nconst primaryActions = {\n  open: {\n    display: \"Open\",\n    url: appUrl,\n  },\n  viewDetails: {\n    display: \"View Details\",\n    url: detailsUrl,\n  },\n};\n\nconst sizes = {\n  medium: {\n    gap: \"16px\",\n    thumbnail: \"56px\",\n    title: \"16px\",\n  },\n  large: {\n    gap: \"16px\",\n    thumbnail: \"100px\",\n    title: \"26px\",\n  },\n};\nconst Wrapper = styled.div`\n   background-repeat:no-repeat;\n   background-size: cover;\n   background-image:${() => {\n     return props.primaryAction\n       ? 'url(\"https://ipfs.near.social/ipfs/bafybeiduczlwb5wvqng2jjyifcyuyj4hs3mpfdgoex6xkswbqyviywkaje\")'\n       : \"none\";\n   }};\n   border-radius:10px;\n   padding: 0 10px 16px 0;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  align-items: center;\n  gap: ${(p) => sizes[p.size].gap};\n  margin-bottom: 32px;\n\n  > * {\n    min-width: 0;\n  }\n\n  @media (max-width: 770px) {\n    gap: 16px;\n  }\n`;\n\nconst TagsWrapper = styled.div`\n  margin-bottom: 32px;\n`;\n\nconst Actions = styled.div`\n  display: flex;\n  align-items:center;\n  justify-content:${props.mode == \"user\" ? \"flex-end\" : \"space-between\"};\n  flex-wrap: wrap;\n  .actionsDiv{\n    display: ${props.mode == \"user\" ? \"none\" : \"flex\"};\n    align-items:center;\n    gap:12px;\n  }\n`;\n\nconst Title = styled.h1`\n  font-size: ${(p) => sizes[p.size].title};\n  color: #fff;\n  margin: 0 0 8px;\n  font-weight: 500;\n\n  @media (max-width: 770px) {\n    font-size: 16px;\n    margin: 0;\n  }\n`;\n\nconst Thumbnail = styled.div`\n  width: ${(p) => sizes[p.size].thumbnail};\n  height: ${(p) => sizes[p.size].thumbnail};\n  flex-shrink: 0;\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0px 1px 3px rgba(16, 24, 40, 0.1),\n    0px 1px 2px rgba(16, 24, 40, 0.06);\n\n  img {\n    object-fit: cover;\n    width: 100%;\n    height: 100%;\n  }\n\n  @media (max-width: 770px) {\n    width: 58px;\n    height: 58px;\n  }\n`;\n\nconst sharedButtonStyles = `\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n  padding: 8px 16px;\n  height: 32px;\n  border-radius: 50px;\n  font-weight: 600;\n  font-size: 12px;\n  line-height: 15px;\n  text-align: center;\n  cursor: pointer;\n\n  &:hover,\n  &:focus {\n    text-decoration: none;\n    outline: none;\n  }\n\n  i {\n    color: #7E868C;\n  }\n\n  .bi-16 {\n    font-size: 16px;\n  }\n`;\n\nconst Button = styled.button`\n//   ${sharedButtonStyles}\n//   color: ${(p) => (p.primary ? \"#09342E\" : \"#11181C\")} !important;\n//   background: ${(p) => (p.primary ? \"#59E692\" : \"#FBFCFD\")};\n//   border: ${(p) => (p.primary ? \"none\" : \"1px solid #D7DBDF\")};\n\n//   &:hover,\n//   &:focus {\n//     background: ${(p) => (p.primary ? \"rgb(112 242 164)\" : \"#ECEDEE\")};\n//   }\nbackground: rgba(26, 46, 51, 0.25);\n  border: 0.5px solid rgba(255, 255, 255, 0.3);\n  border-radius: 38px;\n  color:#fff;\n`;\n\nconst ButtonLink = styled.a`\n//   ${sharedButtonStyles}\n//   color: ${(p) => (p.primary ? \"#09342E\" : \"#11181C\")} !important;\n//   background: ${(p) => (p.primary ? \"#59E692\" : \"#FBFCFD\")};\n//   border: ${(p) => (p.primary ? \"none\" : \"1px solid #D7DBDF\")};\n\n//   &:hover,\n//   &:focus {\n//     background: ${(p) => (p.primary ? \"rgb(112 242 164)\" : \"#ECEDEE\")};\n//   }\n  background: rgba(26, 46, 51, 0.25);\n  border: 0.5px solid rgba(255, 255, 255, 0.3);\n  border-radius: 38px;\n  color:#fff;\n  &:hover{\n    color:#fff;\n  }\n`;\n\nconst Text = styled.p`\n  margin: 0;\n  font-size: 14px;\n  line-height: 20px;\n  color: #fff;\n  font-weight: 500;\n  font-size: ${(p) => (p.small ? \"12px\" : \"14px\")};\n  overflow: ${(p) => (p.ellipsis ? \"hidden\" : \"visible\")};\n  text-overflow: ${(p) => (p.ellipsis ? \"ellipsis\" : \"unset\")};\n  white-space: ${(p) => (p.ellipsis ? \"nowrap\" : \"\")};\n\n  i {\n    margin-right: 4px;\n  }\n`;\nfunction applyHomePage() {\n  if (commitLoading) return;\n  State.update({ commitLoading: true });\n  const storageDataOld = myHomePagePathDataFromCache;\n  // console.log(\"666666666666-storageDataOld\", storageDataOld);\n  let storageDataOldCopy;\n  try {\n    storageDataOldCopy = JSON.parse(JSON.stringify(storageDataOld)) || {};\n  } catch (error) {\n    storageDataOldCopy = {};\n  }\n  // console.log(\"666666666666-storageDataOldCopy\", storageDataOldCopy);\n  const storageDataNew = {\n    ...storageDataOldCopy,\n    [context.accountId]: finalSrc,\n  };\n\n  Storage.set(\"myHomePagePathData\", storageDataNew);\n  Social.set(\n    {\n      myHomePagePath: finalSrc,\n    },\n    {\n      force: true,\n      onCommit: () => {\n        State.update({ commitLoading: false });\n      },\n      onCancel: () => {\n        State.update({ commitLoading: false });\n        Storage.set(\"myHomePagePathData\", storageDataOldCopy);\n      },\n    }\n  );\n}\nconst Loading = (\n  <span\n    className=\"spinner-grow spinner-grow-sm me-1\"\n    role=\"status\"\n    aria-hidden=\"true\"\n  />\n);\nconst homeIcon = (\n  <svg\n    width=\"17\"\n    height=\"17\"\n    viewBox=\"0 0 17 17\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M9.21538 0.961838C9.0131 0.797784 8.76058 0.708252 8.50014 0.708252C8.2397 0.708252 7.98717 0.797784 7.7849 0.961838L1.14533 6.3179C0.646314 6.72023 0.562022 7.45832 0.957273 7.9669C1.11461 8.17027 1.33557 8.31504 1.58486 8.37809L1.64648 8.39155L1.64613 14.3933C1.64613 15.3789 2.38456 16.1942 3.34825 16.2838L3.42688 16.2898L3.50904 16.2916H13.4909C14.4843 16.2916 15.3014 15.4979 15.352 14.4768L15.3538 14.3933L15.3541 8.39155L15.3949 8.3834C15.8879 8.26971 16.2608 7.83409 16.2899 7.30496L16.2916 7.23838C16.2916 6.87961 16.1308 6.54067 15.8546 6.31755L9.21538 0.961838ZM8.43975 1.79236C8.45678 1.77856 8.47804 1.77102 8.49996 1.77102C8.52188 1.77102 8.54314 1.77856 8.56017 1.79236L15.1926 7.15763C15.2042 7.16708 15.2135 7.17897 15.2198 7.19244C15.2262 7.20592 15.2295 7.22064 15.2295 7.23555C15.2295 7.2908 15.1859 7.33542 15.1321 7.33542H14.8197C14.5286 7.33507 14.2927 7.57625 14.2927 7.8734V14.3901L14.2916 14.4464C14.27 14.8838 13.9155 15.2291 13.4852 15.2291H3.52817L3.47292 15.2277C3.04508 15.2057 2.70756 14.8434 2.70756 14.4039V7.87375C2.70756 7.57625 2.47169 7.33542 2.18056 7.33542H1.86819C1.83844 7.33542 1.81046 7.32161 1.79169 7.29788C1.77569 7.27705 1.7684 7.25081 1.77138 7.22471C1.77435 7.19861 1.78735 7.17468 1.80763 7.15798L8.43975 1.79236ZM6.14652 11.1672C6.0555 11.2747 6.01094 11.414 6.02263 11.5544C6.03432 11.6948 6.10131 11.8248 6.20886 11.9159C6.85875 12.4659 7.5685 12.7499 8.32288 12.7499C9.07725 12.7499 9.787 12.4659 10.4373 11.9159C10.4905 11.8707 10.5344 11.8156 10.5663 11.7535C10.5982 11.6915 10.6176 11.6237 10.6234 11.5542C10.6291 11.4846 10.6211 11.4146 10.5998 11.3481C10.5785 11.2817 10.5443 11.22 10.4992 11.1668C10.4541 11.1135 10.399 11.0697 10.3369 11.0378C10.2748 11.0058 10.2071 10.9864 10.1375 10.9807C10.068 10.9749 9.99797 10.9829 9.9315 11.0042C9.86504 11.0255 9.80342 11.0597 9.75017 11.1048C9.28515 11.499 8.81446 11.6874 8.32288 11.6874C7.83165 11.6874 7.36096 11.499 6.89558 11.1048C6.84232 11.0597 6.78069 11.0255 6.71421 11.0042C6.64773 10.9829 6.5777 10.975 6.50813 10.9807C6.43857 10.9865 6.37083 11.006 6.30878 11.038C6.24673 11.0699 6.19159 11.1138 6.14652 11.1672Z\"\n      fill=\"white\"\n    />\n  </svg>\n);\nconst current_mode = Storage.get(\n  \"ref-mode\",\n  \"ref-admin.near/widget/user-builder\"\n);\nreturn (\n  <Wrapper>\n    <Header size={size}>\n      <Thumbnail size={size}>\n        <Widget\n          src=\"mob.near/widget/Image\"\n          props={{\n            image: metadata.image,\n            fallbackUrl:\n              \"https://ipfs.near.social/ipfs/bafkreifc4burlk35hxom3klq4mysmslfirj7slueenbj7ddwg7pc6ixomu\",\n            alt: metadata.name,\n          }}\n        />\n      </Thumbnail>\n\n      <div>\n        <Title size={size}>{metadata.name || widgetName}</Title>\n        {props.mode == \"user\" ? <Text ellipsis>{finalSrc}</Text> : null}\n      </div>\n    </Header>\n\n    {props.showTags && tags.length > 0 && (\n      <TagsWrapper>\n        <Widget\n          src=\"ref-admin.near/widget/Tags\"\n          props={{\n            tags,\n          }}\n        />\n      </TagsWrapper>\n    )}\n    <Actions>\n      <div class=\"actionsDiv\">\n        <ButtonLink primary href={primaryActions[primaryAction].url}>\n          {primaryActions[primaryAction].display}\n        </ButtonLink>\n\n        <ButtonLink href={`/#/edit/${finalSrc}`}>\n          {context.accountId === accountId ? (\n            <>\n              <i className=\"bi bi-pencil-fill\"></i> Edit\n            </>\n          ) : (\n            <>\n              <i className=\"bi bi-git\"></i> Fork\n            </>\n          )}\n        </ButtonLink>\n\n        <ButtonLink href={`${detailsUrl}&tab=source`}>\n          <i className=\"bi bi-code-square\"></i>\n          View Source\n        </ButtonLink>\n\n        <OverlayTrigger\n          placement=\"top\"\n          overlay={<Tooltip>Copy URL to clipboard</Tooltip>}\n        >\n          <Button\n            type=\"button\"\n            onMouseLeave={() => {\n              State.update({ copiedShareUrl: false });\n            }}\n            onClick={() => {\n              clipboard.writeText(shareUrl).then(() => {\n                State.update({ copiedShareUrl: true });\n              });\n            }}\n          >\n            {state.copiedShareUrl ? (\n              <i className=\"bi bi-16 bi-check\"></i>\n            ) : (\n              <i className=\"bi bi-16 bi-link-45deg\"></i>\n            )}\n            Share\n          </Button>\n        </OverlayTrigger>\n      </div>\n      {props.primaryAction && (\n        <ButtonLink onClick={applyHomePage}>\n          {commitLoading ? Loading : homeIcon}\n          Apply as homepage\n        </ButtonLink>\n      )}\n    </Actions>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ref-admin.near/widget/ComponentBanner"}