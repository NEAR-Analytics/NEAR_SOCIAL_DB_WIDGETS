{"tx_hash": "31JPKFt4vZnmUs3ixThYJixCftcMMncGSHkPUt46k8kH", "action_id_social": "5ZRUFqiAK3HnXJrcFspsRhWuNDjzrR6pAUrTRU6vAfpy-0-widget", "block_id": 83334292, "block_timestamp": "2023-01-19 20:56:09.658", "signer_id": "eugenewolf507.near", "widget_name": "TestWiki_CreateArticle", "source_code": "// =========  =========\nconst accountId = props.accountId ?? context.accountId;\n\nconst initialBody = `# Markdown heading level 1\n\nThis is a markdown paragraph. So, here are a few examples of markdown syntax and what it looks like.\n\n1. markdown\n2. ordered\n3. list`;\n\nconst errTextNoBody = \"ERROR: no article Body\",\n  errTextNoId = \"ERROR: no article Id\",\n  errTextDublicatedId = \"ERROR: there is article with such name\";\n\nconst initialState = {\n  articleId: \"\",\n  articleBody: initialBody,\n  errorId: \"\",\n  errorBody: \"\",\n};\n\nState.init(initialState);\n\n// === SAVE HANDLER ===\nconst saveHandler = () => {\n  State.update({ ...state, errorId: \"\", errorBody: \"\" });\n  if (state.articleId && state.articleBody) {\n    const articles = Near.view(\"testwiki.near\", \"get_article_ids_paged\", {\n      from_index: 0,\n      limit: 250,\n    });\n    console.log(articles);\n    const isArticleIdDublicated = articles\n      ? articles.some(\n          (id) => id.toLowerCase() === state.articleId.toLowerCase()\n        )\n      : false;\n    if (!isArticleIdDublicated) {\n      console.log(\"SAVE ARTICLE\");\n      Social.set({\n        articlesPersonal2: {\n          [state.articleId]: {\n            author: accountId,\n            body: state.articleBody,\n            navigation_id: null,\n          },\n        },\n      });\n    } else {\n      State.update({ ...state, errorId: errTextDublicatedId });\n    }\n  } else {\n    if (!state.articleId) {\n      State.update({ ...state, errorId: errTextNoId });\n    }\n    if (!state.articleBody) {\n      State.update({ ...state, errorBody: errTextNoBody });\n    }\n  }\n};\n\n// === CANCEL HANDLER ===\nconst cancelHandler = () => {\n  State.update({\n    articleId: \"\",\n    articleBody: \"\",\n    errorId: null,\n    errorBody: null,\n  });\n};\n\n// === RETURN ===\nreturn (\n  <div>\n    <div>\n      <button\n        type=\"submit\"\n        className=\"btn btn-success\"\n        onClick={(e) => saveHandler(e)}\n      >\n        Save Article\n      </button>\n      <button\n        type=\"button\"\n        className=\"btn btn-danger\"\n        onClick={() => cancelHandler()}\n      >\n        Cancel / Clear\n      </button>\n    </div>\n    <div class=\"d-flex flex-column pt-3\">\n      <label for=\"inputArticleId\">\n        Input article id (case-sensitive, without spaces):\n      </label>\n      <label for=\"inputArticleId\" class=\"small text-danger\">\n        {state.errorId}\n      </label>\n      <input\n        className=\"form-control mt-2\"\n        id=\"inputArticleId\"\n        value={state.articleId}\n        onChange={(e) => {\n          State.update({\n            ...state,\n            articleId: e.target.value.replace(/\\s+/g, \"\"),\n          });\n        }}\n      />\n    </div>\n    <div class=\"d-flex flex-column pt-3\">\n      <label for=\"textareaArticleBody\">\n        Input article body (in makrdown format):\n      </label>\n      <label for=\"textareaArticleBody\" class=\"small text-danger\">\n        {state.errorBody}\n      </label>\n      <textarea\n        id=\"textareaArticleBody\"\n        type=\"text\"\n        value={state.articleBody}\n        rows={10}\n        className=\"form-control mt-2\"\n        onChange={(e) => {\n          State.update({ ...state, articleBody: e.target.value });\n        }}\n      />\n    </div>\n    <div class=\"pt-3\">\n      Article preview:\n      <Markdown text={state.articleBody} />\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/eugenewolf507.near/widget/TestWiki_CreateArticle"}