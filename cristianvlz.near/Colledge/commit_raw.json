{"tx_hash": "54AZtk796i8tkrEk5GkFkwgH5mDjhrsSJ1xek44L5DYv", "action_id_social": "FRi9nEjSfGdXJszMhS9KAcZPtXWRkdc5gjHjuNtm7zfZ-0-widget", "block_id": 94341135, "block_timestamp": "2023-06-16T22:16:23.177Z", "signer_id": "cristianvlz.near", "widget_name": "Colledge", "source_code": "/* NEAR BLOCKCHAIN */\nconst contract = \"hello.near-examples.near\";\nconst greeting = Near.view(contract, \"get_greeting\", {});\n\nconsole.log(\"print info\");\nconsole.log(context);\nconsole.log(context.accountId);\nconsole.log(\"print info2\");\nconsole.log(user);\nconsole.log(user.near);\n// Use and manipulate state\nState.init({ new_greeting2: greeting });\nState.init({ new_greeting_text: \"\" });\n\nState.init({ new_greeting: \"\" });\nState.init({ new_certificado: \"\" });\nState.init({ strUrl: \"url...\" });\nState.init({ strEmail: \"\" });\nState.init({ strNombreAlumno: \"\" });\nState.init({ strNombreCurso: \"\" });\nState.init({ strFecha: \"\" });\n\nconst onBtnClick = () => {\n  State.update({\n    new_greeting_text: \"Buscando...\",\n  });\n  return asyncFetch(\"https://certificates.blckchn.xyz/verify/credential\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({\n      jwt: state.strUrl,\n    }),\n  }).then((responseGql) => {\n    if (responseGql.body.verification) {\n      State.update({\n        new_greeting:\n          \"https://certificates.blckchn.xyz/certificado?jwt=\" + state.strUrl,\n      });\n      State.update({\n        new_greeting_text: \"Descargar\",\n      });\n    }\n  });\n};\n\nconst onBtnClickGenerate = () => {\n  console.log(\n    state.strEmail,\n    state.strNombreAlumno,\n    state.strNombreCurso,\n    state.sender\n  );\n\n  return asyncFetch(\"https://certificates.blckchn.xyz/create/credential\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({\n      email: state.strEmail,\n      nombre: state.strNombreAlumno,\n      curso: state.strNombreCurso,\n      wallet: state.sender,\n    }),\n  }).then((jwt) => {\n    State.update({\n      new_certificado:\n        \"https://certificates.blckchn.xyz/certificado?jwt=\" + jwt.body.jwt,\n    });\n    Near.call(contract, \"set_greeting\", {\n      greeting:\n        \"https://certificates.blckchn.xyz/certificado?jwt=\" + jwt.body.jwt,\n    });\n  });\n\n  /*let responseCreate = fetch(\n    \"https://certificates.blckchn.xyz/create/credential\",\n    {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        email: state.strEmail,\n        nombre: state.strNombreAlumno,\n        curso: state.strNombreCurso,\n        wallet: state.sender,\n      }),\n    }\n  );\n\n  let jwt = responseCreate;\n  if (jwt != null) {\n    State.update({\n      new_certificado:\n        \"https://certificates.blckchn.xyz/certificado?jwt=\" + jwt.body.jwt,\n    });\n    Near.call(contract, \"set_greeting\", {\n      greeting:\n        \"https://certificates.blckchn.xyz/certificado?jwt=\" + jwt.body.jwt,\n    });\n  }*/\n\n  /*Near.call(contract, \"set_greeting\", {\n    greeting: state.new_greeting,\n  });*/\n};\n\n/* END NEAR BLOCKCHAIN */\n\n// FETCH LIDO ABI\n\nconst lidoContract = \"0xae7ab96520de3a18e5e111b5eaab095312d7fe84\";\nconst tokenDecimals = 18;\n\nconst lidoAbi = fetch(\n  \"https://raw.githubusercontent.com/lidofinance/lido-subgraph/master/abis/Lido.json\"\n);\nif (!lidoAbi.ok) {\n  return \"Loading\";\n}\n\nconst iface = new ethers.utils.Interface(lidoAbi.body);\n\n// FETCH LIDO STAKING APR\n\n// HELPER FUNCTIONS\n\nconst getStakedBalance = (receiver) => {\n  const encodedData = iface.encodeFunctionData(\"balanceOf\", [receiver]);\n\n  return Ethers.provider()\n    .call({\n      to: lidoContract,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      const receiverBalanceHex = iface.decodeFunctionResult(\n        \"balanceOf\",\n        rawBalance\n      );\n\n      return Big(receiverBalanceHex.toString())\n        .div(Big(10).pow(tokenDecimals))\n        .toFixed(2)\n        .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n    });\n};\n\nconst submitEthers = (strEther, _referral) => {\n  if (!strEther) {\n    return console.log(\"Amount is missing\");\n  }\n  const erc20 = new ethers.Contract(\n    lidoContract,\n    lidoAbi.body,\n    Ethers.provider().getSigner()\n  );\n\n  let amount = ethers.utils.parseUnits(strEther, tokenDecimals).toHexString();\n\n  erc20.submit(lidoContract, { value: amount }).then((transactionHash) => {\n    console.log(\"transactionHash is \" + transactionHash);\n  });\n};\n\n// DETECT SENDER\n\nif (state.sender === undefined) {\n  State.update({ sender: Ethers.send(\"eth_requestAccounts\", [])[0] });\n}\n\nif (!state.sender) return \"Please login first\";\n\n// FETCH SENDER BALANCE\n\nif (state.balance === undefined) {\n  Ethers.provider()\n    .getBalance(state.sender)\n    .then((balance) => {\n      State.update({ balance: Big(balance).div(Big(10).pow(18)).toFixed(2) });\n    });\n}\n\n// FETCH SENDER STETH BALANCE\n\nif (state.stakedBalance === undefined) {\n  getStakedBalance(state.sender).then((stakedBalance) => {\n    State.update({ stakedBalance });\n  });\n}\n\n// FETCH TX COST\n\nif (state.txCost === undefined) {\n  const gasEstimate = ethers.BigNumber.from(1875000);\n  const gasPrice = ethers.BigNumber.from(1500000000);\n\n  const gasCostInWei = gasEstimate.mul(gasPrice);\n  const gasCostInEth = ethers.utils.formatEther(gasCostInWei);\n\n  let responseGql = fetch(\n    \"https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2\",\n    {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        query: `{\n          bundle(id: \"1\" ) {\n            ethPrice\n          }\n        }`,\n      }),\n    }\n  );\n\n  if (!responseGql) return \"\";\n\n  const ethPriceInUsd = responseGql.body.data.bundle.ethPrice;\n\n  const txCost = Number(gasCostInEth) * Number(ethPriceInUsd);\n\n  State.update({ txCost: `$${txCost.toFixed(2)}` });\n}\n\n// FETCH CSS\n\nconst cssFont = fetch(\n  \"https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800\"\n).body;\nconst css = fetch(\n  \"https://pluminite.mypinata.cloud/ipfs/Qmboz8aoSvVXLeP5pZbRtNKtDD3kX5D9DEnfMn2ZGSJWtP\"\n).body;\n\nif (!cssFont || !css) return \"\";\n\nif (!state.theme) {\n  State.update({\n    theme: styled.div`\n    font-family: Manrope, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\n    ${cssFont}\n    ${css}\n\n    .customSubHeader {\n      text-align: center;\n      padding: 4px;\n    }\n\n    .img-fluid  {\n      width: 30%    \n    }\n\n    .CentrarContenido {\n      text-align: center;\n      padding: 20px;\n  }\n\n  button.LidoStakeFormSubmitContainer {\n    background-color: black!important;\n  }\n\n  a.LidoStakeFormSubmitContainer {\n    background-color: black!important;\n    width: 100% !important;\n    margin-top;10px !important;\n  }\n\n  .LidoForm {\n    background: #3c3c3b; \n    }\n\n  .inputsClass {\n    border-right: 1px solid rgba(0, 10, 61, 0.12);\n    text-align: center;\n    text-align-last: center;\n     }\n\n      .inputsCenter {\n    text-align: center;\n    text-align-last: center;\n     }\n\n     .wrap-text{\n       overflow-wrap: break-word;\n     }\n\n     .colledge-link{\n       color:blue\n     }\n`,\n  });\n}\nconst Theme = state.theme;\n\n// OUTPUT UI\n\nif (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n}\nif (state.chainId !== undefined && state.chainId !== 1) {\n  return (\n    <Theme>\n      <div class=\"LidoContainer\">\n        <div class=\"CentrarContenido\">\n          <img\n            class=\"img-fluid\"\n            src={\n              \"https://www.colledge.social/pluginfile.php/1/theme_edumy/footerlogo1/1681760484/LogoFondoOscuro.svg\"\n            }\n          />\n        </div>\n        <div class=\"Header\">Cambiar a red Ethereum Mainnet</div>\n        <div class=\"SubHeader\"></div>\n      </div>\n    </Theme>\n  );\n}\n\nreturn (\n  <Theme>\n    <div class=\"LidoContainer\">\n      <div class=\"CentrarContenido\">\n        <img\n          class=\"img-fluid\"\n          src={\n            \"https://www.colledge.social/pluginfile.php/1/theme_edumy/footerlogo1/1681760484/LogoFondoOscuro.svg\"\n          }\n        />\n      </div>\n      <div class=\"Header\">Generar certificados</div>\n      <div class=\"SubHeader\"></div>\n\n      <div\n        class=\"LidoForm\"\n        style={{\n          backgroundImage: `url(\"https://raw.githubusercontent.com/somos-colledge/website-colledge/32782c96838fe7ed0f2bc7ecf27ae2630de9f013/Ilustracion_Instruct.svg\")`,\n          backgroundSize: \"300px 100px\",\n          backgroundPosition: \"140% 42%\",\n          backgroundRepeat: \"no-repeat\",\n        }}\n      >\n        <div class=\"LidoFormTopContainer\">\n          <div class=\"LidoFormTopContainerLeft\">\n            <div class=\"LidoFormTopContainerLeftContent1\">\n              <div class=\"LidoFormTopContainerLeftContent1Container\">\n                <span>Usuario</span>\n                <div class=\"LidoFormTopContainerLeftContent1Circle\" />\n              </div>\n            </div>\n            <div class=\"LidoFormTopContainerLeftContent2\">\n              <div class=\"LidoFormTopContainerLeftContent1\">\n                <div class=\"LidoFormTopContainerLeftContent1Text\">\n                  <span>\n                    {state.sender.substring(0, 6)}...\n                    {state.sender.substring(\n                      state.sender.length - 4,\n                      state.sender.length\n                    )}{\" \"}\n                  </span>\n                </div>\n              </div>{\" \"}\n            </div>\n          </div>\n        </div>\n        <div class=\"LidoSplitter\" />\n      </div>\n      <div class=\"LidoStakeForm\">\n        <div class=\"LidoStakeFormInputContainer\">\n          <span class=\"LidoStakeFormInputContainerSpan2 inputsClass\">\n            <input\n              class=\"LidoStakeFormInputContainerSpan2Input\"\n              value={state.strEmail}\n              onChange={(e) => State.update({ strEmail: e.target.value })}\n              placeholder=\"Email\"\n            />\n          </span>\n          <span class=\"LidoStakeFormInputContainerSpan2 inputsCenter\">\n            <input\n              class=\"LidoStakeFormInputContainerSpan2Input\"\n              type=\"date\"\n              value={state.strFecha}\n              onChange={(e) => State.update({ strFecha: e.target.value })}\n              placeholder=\"Fecha\"\n            />\n          </span>\n        </div>\n\n        <div\n          class=\"LidoStakeForm\"\n          style={{\n            padding: \"32px 0px 0px 0px\",\n          }}\n        >\n          <div class=\"LidoStakeFormInputContainer\">\n            <span class=\"LidoStakeFormInputContainerSpan2 inputsClass\">\n              <input\n                class=\"LidoStakeFormInputContainerSpan2Input\"\n                value={state.strNombreCurso}\n                onChange={(e) =>\n                  State.update({ strNombreCurso: e.target.value })\n                }\n                placeholder=\"Nombre de curso\"\n              />\n            </span>\n            <span class=\"LidoStakeFormInputContainerSpan2 inputsCenter\">\n              <input\n                class=\"LidoStakeFormInputContainerSpan2Input\"\n                value={state.strNombreAlumno}\n                onChange={(e) =>\n                  State.update({ strNombreAlumno: e.target.value })\n                }\n                placeholder=\"Nombre de alumno\"\n              />\n            </span>\n          </div>\n        </div>\n\n        <div class=\"LidoFooterContainer\">\n          <div class=\"LidoFooterRaw\">\n            <div class=\"LidoFooterRawLeft\">Correo: </div>\n            <div class=\"LidoFooterRawRight\">\n              {state.strEmail ?? \"correo\"}{\" \"}\n            </div>{\" \"}\n          </div>\n          <div class=\"LidoFooterRaw\">\n            <div class=\"LidoFooterRawLeft\">Fecha del certificado:</div>\n            <div class=\"LidoFooterRawRight\">{state.strFecha ?? \"fecha\"} </div>\n          </div>\n          <div class=\"LidoFooterRaw\">\n            <div class=\"LidoFooterRawLeft\">Nombre del curso:</div>\n            <div class=\"LidoFooterRawRight\">\n              {state.strNombreCurso ?? \"nombreCurso\"}{\" \"}\n            </div>\n          </div>\n          <div class=\"LidoFooterRaw\">\n            <div class=\"LidoFooterRawLeft\">Nombre del alumno:</div>\n            <div class=\"LidoFooterRawRight\">\n              {state.strNombreAlumno ?? \"nombreAlumno\"}{\" \"}\n            </div>\n          </div>\n        </div>\n        {/*<a\n          href=\"https://www.colledge.social/mod/page/view.php?id=2429&uuid=1889-2-e3879b-c1992l\"\n          target=\"_blank\"\n        >\n          {\" \"}\n          <button\n            class=\"LidoStakeFormSubmitContainer\"\n            onClick={() => submitEthers(state.strEther, state.sender)}\n          >\n            <span>Solicitar certificado</span>{\" \"}\n          </button>\n        </a>*/}\n        <button\n          class=\"LidoStakeFormSubmitContainer\"\n          onClick={onBtnClickGenerate}\n        >\n          <span>Solicitar certificado</span>{\" \"}\n        </button>\n        <br />\n        <p class=\"text-center\">certificado:</p>\n        <p class=\"text-center wrap-text\">{state.new_certificado} </p>\n      </div>\n    </div>\n\n    <div class=\"LidoContainer\" style={{ marginTop: 70 }}>\n      <div\n        class=\"LidoForm\"\n        style={{\n          backgroundImage: `url(\"https://raw.githubusercontent.com/somos-colledge/website-colledge/c357a6b67a8bef546399d72ef6a3b430d2075ff2/Academia.svg\")`,\n          backgroundSize: \"300px 100px\",\n          backgroundPosition: \"127% 50%\",\n          backgroundRepeat: \"no-repeat\",\n        }}\n      >\n        <div class=\"LidoFormTopContainer\">\n          <div class=\"LidoFormTopContainerLeft\">\n            <div class=\"LidoFormTopContainerLeftContent1\">\n              <div class=\"LidoFormTopContainerLeftContent1Container\">\n                <span>Usuario</span>\n                <div class=\"LidoFormTopContainerLeftContent1Circle\" />\n              </div>\n            </div>\n            <div class=\"LidoFormTopContainerLeftContent2\">\n              <div class=\"LidoFormTopContainerLeftContent1\">\n                <div class=\"LidoFormTopContainerLeftContent1Text\">\n                  <span>\n                    {state.sender.substring(0, 6)}...\n                    {state.sender.substring(\n                      state.sender.length - 4,\n                      state.sender.length\n                    )}{\" \"}\n                  </span>\n                </div>\n              </div>{\" \"}\n            </div>\n          </div>\n        </div>\n        <div class=\"LidoSplitter\" />\n      </div>\n      <div class=\"LidoStakeForm\">\n        <div class=\"LidoStakeFormInputContainer\">\n          <span class=\"LidoStakeFormInputContainerSpan2\">\n            <input\n              class=\"LidoStakeFormInputContainerSpan2Input\"\n              value={state.strUrl}\n              onChange={(e) => State.update({ strUrl: e.target.value })}\n              placeholder=\"Url del certificado\"\n            />\n          </span>\n        </div>\n        <button class=\"LidoStakeFormSubmitContainer mt-4\" onClick={onBtnClick}>\n          <span>Validar certificado</span>{\" \"}\n        </button>\n\n        <p class=\"text-center mt-2\">Descargar certificado:</p>\n        <p class=\"text-center text-decoration-underline wrap-text \">\n          <a href={state.new_greeting} target=\"_blank\" class=\"colledge-link\">\n            {state.new_greeting_text}\n          </a>\n        </p>\n\n        {/*<p class=\"text-center mt-2\">Descargar ultimo certificado:</p>\n        <p class=\"text-center text-decoration-underline wrap-text \">\n          <a href={state.new_greeting2} target=\"_blank\" class=\"colledge-link\">\n            Descargar\n          </a>\n        </p>*/}\n        <p class=\"text-center mt-2\">Ver mis transacciones:</p>\n        <p class=\"text-center text-decoration-underline wrap-text \">\n          <a\n            href=\"https://wallet.near.org/\"\n            target=\"_blank\"\n            class=\"colledge-link\"\n          >\n            NEAR blockchain\n          </a>\n        </p>\n        {/*<div class=\"LidoFooterContainer\">\n          <div class=\"LidoFooterRaw\">\n            <div class=\"LidoFooterRawLeft\">URL: </div>\n            <div class=\"LidoFooterRawRight\">{state.strUrl ?? \"url\"} </div>{\" \"}\n          </div>\n        </div>*/}\n        {/*<a\n          href=\"https://www.colledge.social/mod/page/view.php?id=2429&uuid=1889-2-e3879b-c1992l\"\n          target=\"_blank\"\n        >\n          {\" \"}\n          <button\n            class=\"LidoStakeFormSubmitContainer\"\n            onClick={() => submitEthers(state.strUrl, state.sender)}\n          >\n            <span>Validar certificado</span>{\" \"}\n          </button>\n          </a>*/}\n      </div>\n    </div>\n  </Theme>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/cristianvlz.near/widget/Colledge", "__row_index": 3}