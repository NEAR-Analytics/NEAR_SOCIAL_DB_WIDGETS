{"tx_hash": "9JaksqFQc7WrbxULCqzwBtXsg5jt31bxmHkuucSn3nSm", "action_id_social": "CKfpohTSmYKbGiWoJUbj8pDFLybo9gqT7QhuKJwBqE2h-0-widget", "block_id": 91097614, "block_timestamp": "2023-05-04 18:44:21.211", "signer_id": "cristianvlz.near", "widget_name": "ColledgeCertificate", "source_code": "// FETCH LIDO ABI\r\n\r\nconst lidoContract = \"0xae7ab96520de3a18e5e111b5eaab095312d7fe84\";\r\nconst tokenDecimals = 18;\r\n\r\nconst lidoAbi = fetch(\r\n  \"https://raw.githubusercontent.com/lidofinance/lido-subgraph/master/abis/Lido.json\"\r\n);\r\nif (!lidoAbi.ok) {\r\n  return \"Loading\";\r\n}\r\n\r\nconst iface = new ethers.utils.Interface(lidoAbi.body);\r\n\r\n// FETCH LIDO STAKING APR\r\n\r\nif (state.lidoArp === undefined) {\r\n  const apr = fetch(\r\n    \"https://api.allorigins.win/get?url=https://stake.lido.fi/api/sma-steth-apr\"\r\n  );\r\n  if (!apr) return;\r\n  State.update({ lidoArp: JSON.parse(apr?.body?.contents) ?? \"...\" });\r\n}\r\n\r\n// HELPER FUNCTIONS\r\n\r\nconst getStakedBalance = (receiver) => {\r\n  const encodedData = iface.encodeFunctionData(\"balanceOf\", [receiver]);\r\n\r\n  return Ethers.provider()\r\n    .call({\r\n      to: lidoContract,\r\n      data: encodedData,\r\n    })\r\n    .then((rawBalance) => {\r\n      const receiverBalanceHex = iface.decodeFunctionResult(\r\n        \"balanceOf\",\r\n        rawBalance\r\n      );\r\n\r\n      return Big(receiverBalanceHex.toString())\r\n        .div(Big(10).pow(tokenDecimals))\r\n        .toFixed(2)\r\n        .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\r\n    });\r\n};\r\n\r\nconst submitEthers = (strEther, _referral) => {\r\n  if (!strEther) {\r\n    return console.log(\"Amount is missing\");\r\n  }\r\n  const erc20 = new ethers.Contract(\r\n    lidoContract,\r\n    lidoAbi.body,\r\n    Ethers.provider().getSigner()\r\n  );\r\n\r\n  let amount = ethers.utils.parseUnits(strEther, tokenDecimals).toHexString();\r\n\r\n  erc20.submit(lidoContract, { value: amount }).then((transactionHash) => {\r\n    console.log(\"transactionHash is \" + transactionHash);\r\n  });\r\n};\r\n\r\n// DETECT SENDER\r\n\r\nif (state.sender === undefined) {\r\n  State.update({ sender: Ethers.send(\"eth_requestAccounts\", [])[0] });\r\n}\r\n\r\nif (!state.sender) return \"Please login first\";\r\n\r\n// FETCH SENDER BALANCE\r\n\r\nif (state.balance === undefined) {\r\n  Ethers.provider()\r\n    .getBalance(state.sender)\r\n    .then((balance) => {\r\n      State.update({ balance: Big(balance).div(Big(10).pow(18)).toFixed(2) });\r\n    });\r\n}\r\n\r\n// FETCH SENDER STETH BALANCE\r\n\r\nif (state.stakedBalance === undefined) {\r\n  getStakedBalance(state.sender).then((stakedBalance) => {\r\n    State.update({ stakedBalance });\r\n  });\r\n}\r\n\r\n// FETCH TX COST\r\n\r\nif (state.txCost === undefined) {\r\n  const gasEstimate = ethers.BigNumber.from(1875000);\r\n  const gasPrice = ethers.BigNumber.from(1500000000);\r\n\r\n  const gasCostInWei = gasEstimate.mul(gasPrice);\r\n  const gasCostInEth = ethers.utils.formatEther(gasCostInWei);\r\n\r\n  let responseGql = fetch(\r\n    \"https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2\",\r\n    {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        query: `{\r\n          bundle(id: \"1\" ) {\r\n            ethPrice\r\n          }\r\n        }`,\r\n      }),\r\n    }\r\n  );\r\n\r\n  if (!responseGql) return \"\";\r\n\r\n  const ethPriceInUsd = responseGql.body.data.bundle.ethPrice;\r\n\r\n  const txCost = Number(gasCostInEth) * Number(ethPriceInUsd);\r\n\r\n  State.update({ txCost: `$${txCost.toFixed(2)}` });\r\n}\r\n\r\n// FETCH CSS\r\n\r\nconst cssFont = fetch(\r\n  \"https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800\"\r\n).body;\r\nconst css = fetch(\r\n  \"https://pluminite.mypinata.cloud/ipfs/Qmboz8aoSvVXLeP5pZbRtNKtDD3kX5D9DEnfMn2ZGSJWtP\"\r\n).body;\r\n\r\nif (!cssFont || !css) return \"\";\r\n\r\nif (!state.theme) {\r\n  State.update({\r\n    theme: styled.div`\r\n    font-family: Manrope, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;\r\n    ${cssFont}\r\n    ${css}\r\n\r\n    .customSubHeader {\r\n      text-align: center;\r\n      padding: 4px;\r\n    }\r\n\r\n    .img-fluid  {\r\n      width: 30%    \r\n    }\r\n\r\n    .CentrarContenido {\r\n      text-align: center;\r\n      padding: 20px;\r\n  }\r\n\r\n  button.LidoStakeFormSubmitContainer {\r\n    background-color: black!important;\r\n  }\r\n\r\n  a.LidoStakeFormSubmitContainer {\r\n    background-color: black!important;\r\n    width: 100% !important;\r\n    margin-top;10px !important;\r\n  }\r\n\r\n  .LidoForm {\r\n    background: #3c3c3b; \r\n     }\r\n`,\r\n  });\r\n}\r\nconst Theme = state.theme;\r\n\r\n// OUTPUT UI\r\n\r\nif (\r\n  state.chainId === undefined &&\r\n  ethers !== undefined &&\r\n  Ethers.send(\"eth_requestAccounts\", [])[0]\r\n) {\r\n  Ethers.provider()\r\n    .getNetwork()\r\n    .then((chainIdData) => {\r\n      if (chainIdData?.chainId) {\r\n        State.update({ chainId: chainIdData.chainId });\r\n      }\r\n    });\r\n}\r\nif (state.chainId !== undefined && state.chainId !== 1) {\r\n  return (\r\n    <Theme>\r\n      <div class=\"LidoContainer\">\r\n        <div class=\"CentrarContenido\">\r\n          <img\r\n            class=\"img-fluid\"\r\n            src={\r\n              \"https://www.colledge.social/pluginfile.php/1/theme_edumy/footerlogo1/1681760484/LogoFondoOscuro.svg\"\r\n            }\r\n          />\r\n        </div>\r\n        <div class=\"Header\">Cambiar a red Ethereum Mainnet</div>\r\n        <div class=\"SubHeader\"></div>\r\n      </div>\r\n    </Theme>\r\n  );\r\n}\r\n\r\nreturn (\r\n  <Theme>\r\n    <div class=\"LidoContainer\">\r\n      <div class=\"CentrarContenido\">\r\n        <img\r\n          class=\"img-fluid\"\r\n          src={\r\n            \"https://www.colledge.social/pluginfile.php/1/theme_edumy/footerlogo1/1681760484/LogoFondoOscuro.svg\"\r\n          }\r\n        />\r\n      </div>\r\n      <div class=\"Header\">Generar certificados</div>\r\n      <div class=\"SubHeader\"></div>\r\n\r\n      <div\r\n        class=\"LidoForm\"\r\n        style={{\r\n          backgroundImage: `url(\"https://raw.githubusercontent.com/somos-colledge/website-colledge/32782c96838fe7ed0f2bc7ecf27ae2630de9f013/Ilustracion_Instruct.svg\")`,\r\n          backgroundSize: \"300px 100px\",\r\n          backgroundPosition: \"140% 42%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n        }}\r\n      >\r\n        <div class=\"LidoFormTopContainer\">\r\n          <div class=\"LidoFormTopContainerLeft\">\r\n            <div class=\"LidoFormTopContainerLeftContent1\">\r\n              <div class=\"LidoFormTopContainerLeftContent1Container\">\r\n                <span>Usuario</span>\r\n                <div class=\"LidoFormTopContainerLeftContent1Circle\" />\r\n              </div>\r\n            </div>\r\n            <div class=\"LidoFormTopContainerLeftContent2\">\r\n              <div class=\"LidoFormTopContainerLeftContent1\">\r\n                <div class=\"LidoFormTopContainerLeftContent1Text\">\r\n                  <span>\r\n                    {state.sender.substring(0, 6)}...\r\n                    {state.sender.substring(\r\n                      state.sender.length - 4,\r\n                      state.sender.length\r\n                    )}{\" \"}\r\n                  </span>\r\n                </div>\r\n              </div>{\" \"}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"LidoSplitter\" />\r\n      </div>\r\n      <div class=\"LidoStakeForm\">\r\n        <div class=\"LidoStakeFormInputContainer\">\r\n          <span class=\"LidoStakeFormInputContainerSpan2\">\r\n            <input\r\n              class=\"LidoStakeFormInputContainerSpan2Input\"\r\n              value={state.strEther}\r\n              onChange={(e) => State.update({ strEther: e.target.value })}\r\n              placeholder=\"Email\"\r\n            />\r\n          </span>\r\n          <span class=\"LidoStakeFormInputContainerSpan2\">\r\n            <input\r\n              class=\"LidoStakeFormInputContainerSpan2Input\"\r\n              value={state.strNombre}\r\n              onChange={(e) => State.update({ strNombre: e.target.value })}\r\n              placeholder=\"Nombre\"\r\n            />\r\n          </span>\r\n          <span class=\"LidoStakeFormInputContainerSpan2\">\r\n            <input\r\n              class=\"LidoStakeFormInputContainerSpan2Input\"\r\n              type=\"date\"\r\n              value={state.strFecha}\r\n              onChange={(e) => State.update({ strFecha: e.target.value })}\r\n              placeholder=\"Fecha\"\r\n            />\r\n          </span>\r\n        </div>\r\n\r\n        <div class=\"LidoFooterContainer\">\r\n          <div class=\"LidoFooterRaw\">\r\n            <div class=\"LidoFooterRawLeft\">Correo: </div>\r\n            <div class=\"LidoFooterRawRight\">\r\n              {state.strEther ?? \"correo\"}{\" \"}\r\n            </div>{\" \"}\r\n          </div>\r\n          <div class=\"LidoFooterRaw\">\r\n            <div class=\"LidoFooterRawLeft\">Nombre del certificado:</div>\r\n            <div class=\"LidoFooterRawRight\">{state.strNombre ?? \"nombre\"} </div>\r\n          </div>\r\n          <div class=\"LidoFooterRaw\">\r\n            <div class=\"LidoFooterRawLeft\">Fecha del certificado:</div>\r\n            <div class=\"LidoFooterRawRight\">{state.strFecha ?? \"fecha\"} </div>\r\n          </div>\r\n        </div>\r\n        <a\r\n          href=\"https://www.colledge.social/mod/page/view.php?id=2429&uuid=1889-2-e3879b-c1992l\"\r\n          target=\"_blank\"\r\n        >\r\n          {\" \"}\r\n          <button\r\n            class=\"LidoStakeFormSubmitContainer\"\r\n            onClick={() => submitEthers(state.strEther, state.sender)}\r\n          >\r\n            <span>Solicitar certificado</span>{\" \"}\r\n          </button>\r\n        </a>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"LidoContainer\" style={{ marginTop: 70 }}>\r\n      <div\r\n        class=\"LidoForm\"\r\n        style={{\r\n          backgroundImage: `url(\"https://raw.githubusercontent.com/somos-colledge/website-colledge/c357a6b67a8bef546399d72ef6a3b430d2075ff2/Academia.svg\")`,\r\n          backgroundSize: \"300px 100px\",\r\n          backgroundPosition: \"127% 50%\",\r\n          backgroundRepeat: \"no-repeat\",\r\n        }}\r\n      >\r\n        <div class=\"LidoFormTopContainer\">\r\n          <div class=\"LidoFormTopContainerLeft\">\r\n            <div class=\"LidoFormTopContainerLeftContent1\">\r\n              <div class=\"LidoFormTopContainerLeftContent1Container\">\r\n                <span>Usuario</span>\r\n                <div class=\"LidoFormTopContainerLeftContent1Circle\" />\r\n              </div>\r\n            </div>\r\n            <div class=\"LidoFormTopContainerLeftContent2\">\r\n              <div class=\"LidoFormTopContainerLeftContent1\">\r\n                <div class=\"LidoFormTopContainerLeftContent1Text\">\r\n                  <span>\r\n                    {state.sender.substring(0, 6)}...\r\n                    {state.sender.substring(\r\n                      state.sender.length - 4,\r\n                      state.sender.length\r\n                    )}{\" \"}\r\n                  </span>\r\n                </div>\r\n              </div>{\" \"}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"LidoSplitter\" />\r\n      </div>\r\n      <div class=\"LidoStakeForm\">\r\n        <div class=\"LidoStakeFormInputContainer\">\r\n          <span class=\"LidoStakeFormInputContainerSpan2\">\r\n            <input\r\n              class=\"LidoStakeFormInputContainerSpan2Input\"\r\n              value={state.strUrl}\r\n              onChange={(e) => State.update({ strUrl: e.target.value })}\r\n              placeholder=\"Url del certificado\"\r\n            />\r\n          </span>\r\n        </div>\r\n\r\n        <div class=\"LidoFooterContainer\">\r\n          <div class=\"LidoFooterRaw\">\r\n            <div class=\"LidoFooterRawLeft\">URL: </div>\r\n            <div class=\"LidoFooterRawRight\">{state.strUrl ?? \"url\"} </div>{\" \"}\r\n          </div>\r\n        </div>\r\n        <a\r\n          href=\"https://www.colledge.social/mod/page/view.php?id=2429&uuid=1889-2-e3879b-c1992l\"\r\n          target=\"_blank\"\r\n        >\r\n          {\" \"}\r\n          <button\r\n            class=\"LidoStakeFormSubmitContainer\"\r\n            onClick={() => submitEthers(state.strUrl, state.sender)}\r\n          >\r\n            <span>Validar certificado</span>{\" \"}\r\n          </button>\r\n        </a>\r\n      </div>\r\n    </div>\r\n  </Theme>\r\n);\r\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/cristianvlz.near/widget/ColledgeCertificate", "metadata.image.ipfs_cid": NaN, "metadata.linktree.website": NaN, "metadata.name": NaN, "metadata.tags.colledge": NaN, "metadata.tags.ethdenver2023": "", "metadata.description": NaN}