{"tx_hash": "DnMjf2eTpQGvJhry1fg4DUCtqa9WCeoq7m73DzpocjBd", "action_id_social": "Fyukajmsqy5ppCiNmL2W7aaqprW2ZKpzRnK3St6PreAW-0-widget", "block_id": 87811277, "block_timestamp": "2023-03-21 17:52:36.658", "signer_id": "wendersonpires.near", "widget_name": "NearSocialBridge_Demo", "source_code": "// Load React, React Dom and the Core Bridge library\nconst code = `\n<script src=\"https://unpkg.com/react@18/umd/react.development.js\" crossorigin></script>\n<script src=\"https://unpkg.com/react-dom@18/umd/react-dom.development.js\" crossorigin></script>\n<div id=\"bridge-root\"></div>\n<script src=\"https://unpkg.com/near-social-bridge@1.0.0-beta3/bridge.min.js\" crossorigin></script>\n`;\n\n// External App Url\n// const externalAppUrl = \"https://near-test-app.firebaseapp.com/\";\nconst externalAppUrl = \"https://petite-shoes-move-179-189-40-212.loca.lt/\";\n\n// Initial Path\nconst initialPath = props.path;\n\n// Initial iframe height\nconst initialIframeHeight = 500;\n\n// Initial State\nState.init({\n  iframeHeight: initialIframeHeight,\n  currentMessage: {\n    type: \"connect-view\",\n    externalAppUrl,\n    initialPath,\n    initialIframeHeight,\n  },\n});\n\n// Message sender\nconst sendMessage = (message) => {\n  State.update({\n    currentMessage: message,\n  });\n};\n\n// Answer Factory\nconst buildAnswer = (requestType, payload) => {\n  return {\n    from: \"view\",\n    type: \"answer\",\n    requestType,\n    payload,\n    created_at: Date.now(),\n  };\n};\n\nconst onMessageHandler = (message) => {\n  requestsHandler(message);\n};\n\n// REQUEST HANDLERS BELOW\nconst requestsHandler = (message) => {\n  switch (message.type) {\n    case \"nsb:navigation:sync-content-height\":\n      setIframeHeight(message.type, message.payload);\n      break;\n    case \"get-user-info\":\n      sendUserInfo(message.type, message.payload);\n      break;\n    case \"get-room-data\":\n      getRoomDataHandler(message.type, message.payload);\n      break;\n  }\n};\n\n// [DON'T REMOVE]: Set thew new iFrame height based on the new screen/route\nconst setIframeHeight = (requestType, payload) => {\n  State.update({ iframeHeight: payload.height + 20 });\n};\n\n// [E.g]Get user info\nconst sendUserInfo = (requestType, payload) => {\n  const accountId = context.accountId ?? \"*\";\n  const profileInfo = Social.getr(`${accountId}/profile`);\n  const responseBody = buildAnswer(requestType, {\n    accountId,\n    profileInfo,\n  });\n  sendMessage(responseBody);\n};\n\n// Get room data handler\nconst getRoomDataHandler = (requestType, payload) => {\n  const roomData = Social.index(payload.roomId, \"data\", {\n    limit: 100,\n    order: \"desc\",\n  });\n\n  // Wait data to come\n  setTimeout(() => {\n    const roomExists = roomData && roomData.length > 0;\n\n    if (!roomExists) {\n      const responseBody = buildAnswer(requestType, {\n        error: \"room not found\",\n      });\n      sendMessage(responseBody);\n      return;\n    }\n\n    const responseBody = buildAnswer(requestType, {\n      messages: roomData,\n    });\n    sendMessage(responseBody);\n  }, payload.wait || 1000);\n};\n// REQUEST HANDLERS ABOVE\n\nreturn (\n  <div>\n    <iframe\n      className=\"w-100\"\n      style={{ height: `${state.iframeHeight}px` }}\n      srcDoc={code}\n      message={state.currentMessage}\n      onMessage={onMessageHandler}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/wendersonpires.near/widget/NearSocialBridge_Demo"}