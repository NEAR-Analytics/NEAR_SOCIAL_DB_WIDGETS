{"tx_hash": "6r7FLN5TFUzHgYGiX3PZ3jVB1Z655jGtpciSzTc7yAeJ", "action_id_social": "Ga8pxKYCZtcQANhJ66Xhs8hrtFeeYbjoGnniJRfQKgjQ-0-widget", "block_id": 80793667, "block_timestamp": "2022-12-16 17:30:01.370", "signer_id": "wendersonpires.near", "widget_name": "HelloWorld", "source_code": "State.init({ roomIdToJoin: \"\", input: \"\" });\n\nconst accountId = props.accountId ?? context.accountId ?? \"*\";\n\n// const roomId = props.room_id || \"roomId_0\"; // TODO\nconst roomId = props.room_id; // TODO\n\nconst profileInfo = props.profile ?? Social.getr(`${accountId}/profile`);\n\n// console.log(\"PROFILE\", profileInfo);\n\n// Room Creator Screen\n\n// console.log(Social.get(`${accountId}/index/roomId_0`));\n\nconst joinRoom = (roomIdInfo) => {\n  console.log(roomIdInfo);\n\n  // This method gets only data inside stored on my user\n  // const roomInfo = Social.get(`${accountId}/index/${roomIdInfo}`);\n\n  const roomInfo = Social.index(roomIdInfo, \"data\");\n  const roomExists = roomInfo && roomInfo.length > 0;\n\n  if (!roomExists) {\n    // Update error state\n    return;\n  }\n};\n\nif (!roomId) {\n  return (\n    <>\n      <div>\n        <h3>Hello, {profileInfo.name}!</h3>\n        <p>\n          You can join a room or create a new room and invite your friends.\n          [texto falando sobre a possibilidade de usar query param]\n        </p>\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            marginTop: 52,\n          }}\n        >\n          <p style={{ marginBottom: 8 }}>\n            <strong>Join an existing room:</strong>\n          </p>\n          <input\n            placeholder=\"Room ID\"\n            style={{ marginBottom: 8 }}\n            onChange={(e) => {\n              State.update({ roomIdToJoin: e.target.value });\n            }}\n          />\n          <button\n            class=\"btn btn-primary\"\n            role=\"button\"\n            onClick={() => joinRoom(state.roomIdToJoin)}\n          >\n            Join Room\n          </button>\n        </div>\n      </div>\n    </>\n  );\n}\n\n// Chat Room Screen\n\nconst data = Social.index(roomId, \"data\");\n\nif (!data) {\n  return \"Loading...\";\n}\n\n// Last messages on the bottom\nconst sortedData = data.sort((d1, d2) => d1.blockHeight - d2.blockHeight);\n\nconst buildMessage = (messageData) => {\n  return {\n    user: messageData.accountId,\n    userName: messageData.value.userName,\n    userAvatarImage: messageData.value.userAvatarImage,\n    message: messageData.value.text,\n  };\n};\n\nconst getChatHistory = (indexData) => {\n  const chatHistory = [];\n  indexData.forEach((item) => {\n    chatHistory.push(buildMessage(item));\n  });\n  return chatHistory;\n};\n\nconst chatHistory = getChatHistory(sortedData);\nconsole.log(\"CHAT HISTORY:\", chatHistory);\n\nconst onChangeMessage = (message) => {\n  State.update({\n    input: message,\n    userName: profileInfo.name, // TODO: move to const\n    userAvatarImage: profileInfo.ipfs_cid, // TODO: move to const\n  });\n};\n\nreturn (\n  <>\n    <h4 className=\"mb-5\">Chat Widget</h4>\n    <div className=\"mb-2 mt-2\" style={{ background: \"#F8F9FA\", padding: 8 }}>\n      {chatHistory.map((chatItem, index) => {\n        return (\n          <div\n            style={{\n              display: \"flex\",\n              alignItems: \"center\",\n              marginTop: index !== 0 ? 8 : 0,\n            }}\n          >\n            <img\n              src={`https://i.pravatar.cc/50?u=${accountId}`}\n              style={{ width: 50, borderRadius: 999 }}\n            />\n            <p style={{ margin: 0, marginLeft: 12 }}>\n              <strong style={{ color: \"#212121\" }}>\n                {chatItem.userName || chatItem.user}:\n              </strong>\n            </p>\n            <p style={{ margin: 0, marginLeft: 6 }}>{chatItem.message}</p>\n          </div>\n        );\n      })}\n    </div>\n    <textarea\n      type=\"text\"\n      rows={1}\n      className=\"form-control\"\n      placeholder=\"Message\"\n      onChange={(e) => onChangeMessage(e.target.value)}\n    />\n    <br />\n    <CommitButton\n      data={{\n        index: {\n          [roomId]: JSON.stringify(\n            {\n              key: \"data\",\n              value: {\n                userName: state.userName,\n                userAvatarImage: state.userAvatarImage,\n                text: state.input,\n              },\n            },\n            undefined,\n            0\n          ),\n        },\n      }}\n      onCommit={() => {\n        // CHECK THIS\n        // State.update({reloadData: true})\n      }}\n    >\n      Send Message\n    </CommitButton>\n  </>\n);\n\n// <button type=\"button\" style={{ background: \"#ff0000\" }}>\n//   Send\n// </button>\n\n// const homepage = accountId\n//   ? Social.get(`${accountId}/settings/near.social/homepage`)\n//   : undefined;\n\n// if (homepage === null) {\n//   return \"Loading\";\n// }\n\n// return <Widget src={homepage ?? \"mob.near/widget/Welcome\"} />;\n", "metadata": NaN, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/wendersonpires.near/widget/HelloWorld", "metadata.name": NaN, "branch.draft": NaN, "metadata.tags.ethdenver2023": NaN, "metadata.linktree.website": NaN}