{"tx_hash": "7bvxDbCkSKvQA4629eRkt6h7Qzyr2bBYpVNTTaYwP5Bc", "action_id_social": "9uFB6xgK4ffdow3G4jEDE3Yk2ATGvKg43SkGeNdaHCjJ-0-widget", "block_id": 87746729, "block_timestamp": "2023-03-20 21:08:38.397", "signer_id": "wendersonpires.near", "widget_name": "NearSocialBridgeWithExternalApp_Test", "source_code": "// Load React, React Dom and the Core Bridge library\nconst code = `\n<script src=\"https://unpkg.com/react@18/umd/react.development.js\" crossorigin></script>\n<script src=\"https://unpkg.com/react-dom@18/umd/react-dom.development.js\" crossorigin></script>\n<div id=\"bridge-root\"></div>\n<script src=\"https://unpkg.com/near-social-bridge@1.0.0-beta3/bridge.min.js\" crossorigin></script>\n`;\n\n// External App Url\nconst externalAppUrl = \"https://7ff7317ebfc4.ngrok.app\";\n\n// Initial Path\nconst initialPath = props.path;\n\n// Initial iframe height\nconst initialIframeHeight = 500;\n\n// Initial State\nState.init({\n  iframeHeight: initialIframeHeight,\n  currentMessage: {\n    type: \"connect-view\",\n    externalAppUrl,\n    initialPath,\n    initialIframeHeight,\n  },\n});\n\n// Message sender\nconst sendMessage = (message) => {\n  State.update({\n    currentMessage: message,\n  });\n};\n\n// Answer Factory\nconst buildAnswer = (requestType, payload) => {\n  return {\n    from: \"view\",\n    type: \"answer\",\n    requestType,\n    payload,\n    created_at: Date.now(),\n  };\n};\n\nconst onMessageHandler = (message) => {\n  requestsHandler(message);\n};\n\n// REQUEST HANDLERS BELOW\nconst requestsHandler = (message) => {\n  switch (message.type) {\n    case \"nsb:navigation:sync-content-height\":\n      setIframeHeight(message.type, message.payload);\n      break;\n    case \"get-user-info\":\n      sendUserInfo(message.type, message.payload);\n      break;\n  }\n};\n\n// [DON'T REMOVE]: Set thew new iFrame height based on the new screen/route\nconst setIframeHeight = (requestType, payload) => {\n  State.update({ iframeHeight: payload.height + 20 });\n};\n\n// [E.g]Get user info\nconst sendUserInfo = (requestType, payload) => {\n  const accountId = context.accountId ?? \"*\";\n  const profileInfo = Social.getr(`${accountId}/profile`);\n  const responseBody = buildAnswer(requestType, {\n    accountId,\n    profileInfo,\n  });\n  sendMessage(responseBody);\n};\n// REQUEST HANDLERS ABOVE\n\nreturn (\n  <div>\n    <iframe\n      className=\"w-100\"\n      style={{ height: `${state.iframeHeight}px` }}\n      srcDoc={code}\n      message={state.currentMessage}\n      onMessage={onMessageHandler}\n    />\n    <Markdown text={state.m} />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/wendersonpires.near/widget/NearSocialBridgeWithExternalApp_Test"}