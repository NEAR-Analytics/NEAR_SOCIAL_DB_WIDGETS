{"tx_hash": "BToBz3CYxaR7BWNQa2Qc1mTc6v7aK78iVHSmSqF7vvNU", "action_id_social": "JCqdvp6K3ifkK8VQZQ8VxY8o1mRWB5Qumu9knc4FEh9-0-widget", "block_id": 94630343, "block_timestamp": "2023-06-20T17:38:56.346Z", "signer_id": "jaswinder.near", "widget_name": "MusicPlayer-Harmonic", "source_code": "const accountId = props.accountId || context.accountId;\nconst marketId = \"simple.market.mintbase1.near\";\nconst AFFILIATE_ACCOUNT = props.affiliateAccount || \"jass.near\";\n\nconst data = fetch(\"https://graph.mintbase.xyz\", {\n  method: \"POST\",\n  headers: {\n    \"mb-api-key\": \"omni-site\",\n    \"Content-Type\": \"application/json\",\n    \"x-hasura-role\": \"anonymous\",\n  },\n  body: JSON.stringify({\n    query: `\n     query MyQuery {\n  mb_views_active_listings(\n    order_by: {}\n    where: {nft_contract_id: {_eq: \"daorecords.mintbase1.near\"}}\n    distinct_on: metadata_id\n  ) {\n    listed_by\n    created_at\n    price\n    nft_contract_id\n    token_id\n    metadata_id\n    title\n    reference_blob(path: \"animation_url\")\n  }\n}\n`,\n  }),\n});\n\n// Initialize state\nlet songs = data.body.data.mb_views_active_listings.filter(\n  (listing) => listing.reference_blob !== \"https://near.social/null\"\n);\nState.init({\n  currentSongIndex: 0,\n});\n\nlet audioElem = new Audio();\n\n// Call this when you want to play the current song\nfunction playCurrentSong() {\n  audioElem.src = songs[state.currentSongIndex].reference_blob;\n  audioElem.play();\n}\n\n// Call this when you want to pause the current song\nfunction pauseCurrentSong() {\n  audioElem.pause();\n}\n\n// Call this when you want to play the next song\nfunction playNextSong() {\n  // Update the current song index\n  let nextSongIndex = (state.currentSongIndex + 1) % songs.length;\n  State.update({\n    currentSongIndex: nextSongIndex,\n  });\n}\n\nreturn (\n  <>\n    <h1 className=\"text-3xl font-bold text-center my-6\">\n      Decentralised Music Streaming\n    </h1>\n    <div className=\"flex flex-col items-center justify-center h-full space-y-6\">\n      <div className=\"text-2xl font-bold\">\n        Currently playing: {songs[state.currentSongIndex].title}\n      </div>\n      <p className=\"text-xl font-medium\">\n        (Note: Still working on some State management so you got to pause the\n        current song before playing the next one.)\n      </p>\n      <Widget\n        src=\"mob.near/widget/NftImage\"\n        props={{\n          nft: {\n            tokenId: songs[state.currentSongIndex].token_id,\n            contractId: songs[state.currentSongIndex].nft_contract_id,\n          },\n          style: {\n            width: 300,\n            height: 300,\n            objectFit: \"cover\",\n            minWidth: size,\n            minHeight: size,\n            maxWidth: size,\n            maxHeight: size,\n            overflowWrap: \"break-word\",\n          },\n          thumbnail: \"thumbnail\",\n          className: \"w-64 h-64 object-cover shadow-lg\",\n          fallbackUrl:\n            \"https://ipfs.near.social/ipfs/bafkreihdiy3ec4epkkx7wc4wevssruen6b7f3oep5ylicnpnyyqzayvcry\",\n        }}\n      />\n      <div className=\"mt-2 flex space-x-4\">\n        <button\n          className=\"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-opacity-50\"\n          onClick={pauseCurrentSong}\n        >\n          Pause\n        </button>\n        <button\n          className=\"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-opacity-50\"\n          onClick={playCurrentSong}\n        >\n          Play\n        </button>\n        <button\n          className=\"px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-opacity-50\"\n          onClick={playNextSong}\n        >\n          Next\n        </button>\n      </div>\n    </div>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/jaswinder.near/widget/MusicPlayer-Harmonic", "__row_index": 0}