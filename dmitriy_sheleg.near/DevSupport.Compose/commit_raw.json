{"tx_hash": "64zKWzG4kGFZC187tbWLutJ1XD1zDXPkm2f2DYDNiQ9A", "action_id_social": "68wEkP2Tu9cXzkpsvoeZnifS96CAWv1HjePvGNkAkzHD-0-widget", "block_id": 88257154, "block_timestamp": "2023-03-27 22:08:18.549", "signer_id": "dmitriy_sheleg.near", "widget_name": "DevSupport.Compose", "source_code": "if (state.image === undefined) {\n  State.init({\n    image: {},\n    text: props.initialText || \"\",\n  });\n\n  if (props.onHelper) {\n    const extractMentions = (text) => {\n      const mentionRegex =\n        /@((?:(?:[a-z\\d]+[-_])*[a-z\\d]+\\.)*(?:[a-z\\d]+[-_])*[a-z\\d]+)/gi;\n      mentionRegex.lastIndex = 0;\n      const accountIds = new Set();\n      for (const match of text.matchAll(mentionRegex)) {\n        if (\n          !/[\\w`]/.test(match.input.charAt(match.index - 1)) &&\n          !/[/\\w`]/.test(match.input.charAt(match.index + match[0].length)) &&\n          match[1].length >= 2 &&\n          match[1].length <= 64\n        ) {\n          accountIds.add(match[1].toLowerCase());\n        }\n      }\n      return [...accountIds];\n    };\n    const extractTagNotifications = (text, item) =>\n      extractMentions(text || \"\").map((accountId) => ({\n        key: accountId,\n        value: {\n          type: \"mention\",\n          item,\n        },\n      }));\n\n    props.onHelper({\n      extractMentions,\n      extractTagNotifications,\n    });\n  }\n}\n\nconst content = (state.text || state.image.cid) && {\n  type: \"md\",\n  text: state.text,\n  image: state.image.cid ? { ipfs_cid: state.image.cid } : undefined,\n};\n\nconst onChange = (text) => {\n  State.update({\n    text,\n  });\n};\n\nconst jContent = JSON.stringify(content);\nif (props.onChange && jContent !== state.jContent) {\n  State.update({\n    jContent,\n  });\n  props.onChange({ content });\n}\n\nconst onCompose = () => {\n  State.update({\n    image: {},\n    text: \"\",\n  });\n};\n\nconst TextArea = styled.textarea`\n  min-height: \"30vh\";\n`;\n\nreturn (\n  <div>\n    <div className=\"py-2\">\n      <TextArea\n        className=\"form-control border-1\"\n        style={{ \"min-height\": \"30vh\" }}\n        value={state.text || \"\"}\n        onChange={(e) => onChange(e.target.value)}\n        placeholder={props.placeholder ?? \"What's happening?\"}\n      />\n    </div>\n    <div className=\"d-flex flex-row py-2\">\n      <div className=\"flex-grow-1\">\n        <IpfsImageUpload\n          image={state.image}\n          className=\"btn btn-outline-secondary\"\n          style={{\n            backgroundColor: \"#FAFAFA\",\n            color: \"#006ADC\",\n            fontWeight: 600,\n            borderRadius: \"50px\",\n            border: \"1px solid #E6E8EB\",\n            padding: \".5rem 1.75rem\",\n          }}\n        />\n      </div>\n      <div>{props.composeButton && props.composeButton(onCompose)}</div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dmitriy_sheleg.near/widget/DevSupport.Compose"}