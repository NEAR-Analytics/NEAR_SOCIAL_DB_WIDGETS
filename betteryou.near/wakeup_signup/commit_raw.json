{"tx_hash": "3e55BBgVhDNTL1dxQ8at1hPrjf6Mx6WCJs6rymeoHati", "action_id_social": "BWLFFiS9HFuQ36nxxwHE1gZuWSDdMTKeYZjXZQt62gc5-0-widget", "block_id": 80810711, "block_timestamp": "2022-12-16 23:04:32.250", "signer_id": "betteryou.near", "widget_name": "wakeup_signup", "source_code": "///\n/// CSS\n///\n\nconst signUp = {\n  fontFamily: \"Inter\",\n  background: \"#F7F7F7\",\n  // width: \"800px\",\n  borderRadius: \"10px\",\n  textAlign: \"center\",\n  padding: \"20px\",\n  alignItems: \"center\",\n};\n\nconst challengeTitle = {\n  padding: \"20px\",\n  fontFamily: \"Roboto\",\n  fontStyle: \"normal\",\n  fontWeight: \"400\",\n  fontSize: \"44px\",\n  lineHeight: \"32px\",\n};\n\nconst challengeSubTitle = {\n  fontFamily: \"Roboto\",\n  fontStyle: \"normal\",\n  fontWeight: \"400\",\n  fontSize: \"20px\",\n  lineHeight: \"130%\",\n};\n\nconst howItWorks = {\n  width: \"50%\",\n  marginLeft: \"25%\",\n  marginTop: \"30px\",\n  background: \"#F4FEFF\",\n  borderRadius: \"6px\",\n  fontFamily: \"Roboto\",\n  fontWeight: \"400\",\n  fontSize: \"16px\",\n  lineHeight: \"130%\",\n  color: \"#49454F\",\n  paddingLeft: \"18px\",\n  paddingRight: \"18px\",\n  paddingTop: \"5px\",\n  paddingBottom: \"5px\",\n};\n\nconst howItWorksSpan = {\n  fontFamily: \"Inter\",\n  fontWeight: \"700\",\n};\n\nconst inputBox = {\n  padding: \"10px\",\n  border: \"1px solid black\",\n  width: \"30%\",\n  marginLeft: \"35%\",\n  borderRadius: \"10px\",\n  marginTop: \"10px\",\n  marginBottom: \"10px\",\n};\n\nconst inputBoxInput = {\n  width: \"80%\",\n  height: \"30px\",\n};\n\nconst inputBoxSelect = {\n  width: \"80%\",\n  height: \"30px\",\n};\n\nconst inputBoxTitle = {\n  display: \"block\",\n  paddingBottom: \"5px\",\n  fontSize: \"12px\",\n  textAlign: \"left\",\n  paddingLeft: \"10%\",\n};\n\nconst commitButton = {\n  backgroundColor: \"#2D949A\",\n  color: \"white\",\n  borderRadius: \"100px\",\n  border: \"0px\",\n  paddingLeft: \"24px\",\n  paddingRight: \"24px\",\n  paddingTop: \"10px\",\n  paddingBottom: \"10px\",\n};\n\n///\n/// JS\n///\n\nconst contractId = \"wakeup.betteryou.near\";\nconst accountId = context.accountId;\n\nif (!accountId) {\n  return \"Please log in to view your own challenge or specify account id to view in props.\";\n}\n\nconst challenge_state = Near.view(contractId, \"get_challenge\", {\n  account_id: accountId,\n});\n\nif (challenge_state) {\n  return \"Challenge in progress please go to the main challenge page.\";\n}\n\n// TODO if challenge in progress redirect to the main challenge page\n\n// I can't properly handle inputs so here we go, global variables.\n// Make sure the defaults here are the same as in the html. Sorry.\nlet daysInputValue = 30;\nlet livesInputValue = 4;\nlet depositInputValue = 0.0;\nlet wakeUpTimeInputValue = \"06:00\";\n\nconst test_challenge_lives = 3;\nconst test_challenge_days = 5;\nconst test_challenge_first_day_delay = 10;\nconst test_challenge_timeout = 30;\nconst test_challenge_deposit = 0.1;\nconst test_challenge_day_length = 60;\n\nfunction ms2s(ms) {\n  return Math.floor(ms / 1000);\n}\n\nfunction getTomorrowDate() {\n  const now = new Date();\n  const tomorrow = new Date(\n    now.getFullYear(),\n    now.getMonth(),\n    now.getDate() + 1\n  );\n  return tomorrow;\n}\n\nfunction getTomorrowAtTimeTimestamp(time) {\n  console.log(\"tim e\", time);\n  const tomorrow = getTomorrowDate();\n  // the format of the time is dependent on locale so use the Date.parse method to hopefully deal with it\n  // construct a string for the date tomorrow at the specified time\n  // the month is indexed from 0 so add 1\n  // god forgive me please\n  const year = tomorrow.getFullYear();\n  const month = tomorrow.getMonth() + 1;\n  const day = tomorrow.getDate();\n  const tomorrow_morning_string = `${year}-${month}-${day} ${time}`;\n  console.log(\"tomorrow_morning_string\", tomorrow_morning_string);\n  return ms2s(Date.parse(tomorrow_morning_string));\n}\n\nfunction create_challenge() {\n  const start_timestamp = getTomorrowAtTimeTimestamp(wakeUpTimeInputValue);\n  console.log(\"start_timestamp\", start_timestamp);\n  const timeout = 1 * 60 * 60;\n\n  Near.call(\n    contractId,\n    \"create_challenge\",\n    {\n      config: {\n        days: parseInt(daysInputValue),\n        lives: parseInt(livesInputValue),\n        first_day: start_timestamp,\n        timeout: timeout,\n      },\n    },\n    None, // default gas\n    parseFloat(depositInputValue) * Math.pow(10, 24) // yocto for the win\n  );\n}\n\nfunction create_test_challenge() {\n  console.log(\"create test challenge\");\n\n  Near.call(\n    contractId,\n    \"create_challenge\",\n    {\n      config: {\n        days: test_challenge_days,\n        lives: test_challenge_lives,\n        first_day: ms2s(Date.now()) + test_challenge_first_day_delay,\n        timeout: test_challenge_timeout,\n        day_length: test_challenge_day_length,\n      },\n    },\n    None, // default gas\n    test_challenge_deposit * Math.pow(10, 24) // yocto for the win\n  );\n}\n\nfunction on_change_wakeup(change) {\n  wakeUpTimeInputValue = change.target.value;\n  console.log(\"on_change_wakeup\", wakeUpTimeInputValue);\n}\n\nfunction on_change_duration(change) {\n  daysInputValue = parseInt(change.target.value);\n  console.log(\"on_change_duration\", daysInputValue);\n}\n\nfunction on_change_skip_days(change) {\n  livesInputValue = parseInt(change.target.value) + 1;\n  console.log(\"on_change_skip_days\", livesInputValue);\n}\n\nfunction on_change_deposit(change) {\n  depositInputValue = parseFloat(change.target.value);\n  console.log(\"on_change_deposit\", depositInputValue);\n}\n\nfunction getMaybeTestChallengeButton() {\n  if (accountId == \"betteryou.testnet\") {\n    return (\n      <div>\n        Create a test challenge. It will begin in{\" \"}\n        {test_challenge_first_day_delay}\n        seconds, you will have {test_challenge_lives} lives, it will last{\" \"}\n        {test_challenge_days} days but each day will last only{\" \"}\n        {test_challenge_day_length} seconds. The deposit will be{\" \"}\n        {test_challenge_deposit}N. Refresh this page often ;).\n        <br /> <br />\n        <button style={commitButton} onClick={create_test_challenge}>\n          TEST CHALLENGE\n        </button>\n      </div>\n    );\n  } else {\n    return <div />;\n  }\n}\n\nreturn (\n  <div style={signUp}>\n    <div style={challengeTitle}>Wake up earlier</div>\n    <div style={challengeSubTitle}>\n      Commit to waking up every day at given time frame\n    </div>\n    <div style={howItWorks}>\n      <span>How it works:</span>\n      Once you commit to the challenge, you need to check in every morning on\n      your active challenges page. Get your money back if you succeed!\n    </div>\n    <div style={inputBox}>\n      <span style={inputBoxTitle}>Wake up period</span>\n      <select\n        style={inputBoxSelect}\n        name=\"wakeupTime\"\n        id=\"wakeupTime\"\n        onChange={on_change_wakeup}\n      >\n        <option value=\"05:00\">5:00AM - 6:00AM</option>\n        <option value=\"06:00\" selected>\n          6:00AM - 7:00AM\n        </option>\n        <option value=\"07:00\">7:00AM - 8:00AM</option>\n      </select>\n    </div>\n    <div style={inputBox}>\n      <span style={inputBoxTitle}>Duration</span>\n      <select\n        style={inputBoxSelect}\n        name=\"duration\"\n        id=\"duration\"\n        onChange={on_change_duration}\n      >\n        <option value=\"10\">10 days</option>\n        <option value=\"20\">20 days</option>\n        <option value=\"30\" selected>\n          30 days\n        </option>\n      </select>\n    </div>\n    <div style={inputBox}>\n      <span style={inputBoxTitle}>Permitted Skip Days</span>\n      <select\n        style={inputBoxSelect}\n        name=\"skipDays\"\n        id=\"skipDays\"\n        onChange={on_change_skip_days}\n      >\n        <option value=\"0\">0 days - hardcore option</option>\n        <option value=\"3\" selected>\n          3 days\n        </option>\n        <option value=\"6\">6 days</option>\n      </select>\n    </div>\n    <div style={inputBox}>\n      <span style={inputBoxTitle}>NEAR to stake</span>\n      <input style={inputBoxInput} onChange={on_change_deposit} />\n    </div>\n    <button style={commitButton} onClick={create_challenge}>\n      COMMIT TO CHALLENGE\n    </button>\n    <br /> <br />\n    {getMaybeTestChallengeButton()}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/betteryou.near/widget/wakeup_signup"}