{"tx_hash": "HTirkDQVvnm8hvKLH3Y1CS2xah9MXqyPZMWkFSAJ92dN", "action_id_social": "3THR1G9i4H9aHHeqkAzKmiVL6pbshaK3V7Z3bx2LQyB8-0-widget", "block_id": 95332127, "block_timestamp": "2023-06-29T21:44:38.925Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "SayALot_Reactions", "source_code": "// Don't forget to put space between emoji and text -> \"\u2764\ufe0f Positive\"\r\nconst initialEmoji = \"\ud83e\udd0d Like\";\r\n// It is important that 'Heart' Positive emoji is first\r\nconst emojiArray = [\r\n  \"\u2764\ufe0f Positive\",\r\n  \"\ud83d\ude4f Thank you\",\r\n  \"\ud83d\udcaf Definitely\",\r\n  \"\ud83d\udc40 Thinking\",\r\n  \"\ud83d\udd25 Awesome\",\r\n  \"\ud83d\udc4d Like\",\r\n  \"\ud83d\ude4c Celebrate\",\r\n  \"\ud83d\udc4f Applause\",\r\n  \"\u26a1 Lightning\",\r\n  \"\u22c8 Bowtie\",\r\n];\r\nconst item = props.item;\r\n\r\nconst accountThatIsLoggedIn = context.accountId;\r\n\r\nif (!item) {\r\n  return \"\";\r\n}\r\n\r\nState.init({\r\n  emoji: undefined,\r\n  likesStatistics: [],\r\n  show: false,\r\n  loading: false,\r\n});\r\n\r\n// ========= UNFILTERED LIKES and SOCIAL.INDEX =========\r\nconst unfilteredLikes = Social.index(\"like\", item, {\r\n  order: \"desc\",\r\n});\r\n\r\n// ========= ARRAY LAST LIKE FOR EACH USER =========\r\n// arrayLastLikeForEachUser - array of objects {accountId, blockHeight, value: {type: \"\ud83d\ude01 LOL\"}}\r\nconst uniqueAccounts = [];\r\nconst arrayLastLikeForEachUser =\r\n  unfilteredLikes &&\r\n  unfilteredLikes.filter((obj) => {\r\n    if (!uniqueAccounts.includes(obj.accountId)) {\r\n      uniqueAccounts.push(obj.accountId);\r\n      return true;\r\n    }\r\n    return false;\r\n  });\r\n\r\n// ========= GET USER EMOJI =========\r\nconst userEmoji = arrayLastLikeForEachUser.find((obj) => {\r\n  return obj.accountId === accountThatIsLoggedIn;\r\n});\r\n\r\n// ========= GET LIKES STATISTICS =========\r\nconst getLikeStats = (acc, likeObj) => {\r\n  if (likeObj.value.type === initialEmoji) {\r\n    return acc;\r\n  }\r\n  if (!acc.hasOwnProperty(likeObj.value.type)) {\r\n    acc[likeObj.value.type] = {\r\n      quantity: 0,\r\n      emoji: likeObj.value.type.slice(0, 2),\r\n      text: likeObj.value.type.slice(2),\r\n      accounts: [],\r\n    };\r\n    // acc[likeObj.value.type].quantity = 0;\r\n    // acc[likeObj.value.type].emoji = likeObj.value.type.slice(0, 2);\r\n    // acc[likeObj.value.type].accounts = [];\r\n  }\r\n  acc[likeObj.value.type].quantity += 1;\r\n  acc[likeObj.value.type].accounts = [\r\n    likeObj.accountId,\r\n    ...acc[likeObj.value.type].accounts,\r\n  ];\r\n\r\n  return acc;\r\n};\r\nconst countLikesStats = (arr) => Object.values(arr.reduce(getLikeStats, {}));\r\nlet likesStatistics =\r\n  arrayLastLikeForEachUser && countLikesStats(arrayLastLikeForEachUser);\r\nif (state.likesStatistics.length === 0 || state.likesStatistics === null) {\r\n  State.update({\r\n    likesStatistics,\r\n  });\r\n}\r\n//likesStatistics - array of objects {emoji: '\ud83d\ude01', quantity: 2, accounts: []}\r\n\r\n// ========= CHECK DOES USER VOTED =========\r\nconst doesUserVoted = () => {\r\n  const resObject = arrayLastLikeForEachUser.find(\r\n    (item) => item.accountId === accountThatIsLoggedIn\r\n  );\r\n  return resObject;\r\n};\r\n\r\n// ========= UPDATE EMOJI STATE IF USER VOTED SOMETIME BEFORE =========\r\nconst updateEmojiIfUserVoted = () => {\r\n  const resObject = arrayLastLikeForEachUser.find(\r\n    (item) => item.accountId === accountThatIsLoggedIn\r\n  );\r\n  if (resObject) {\r\n    State.update({ emoji: resObject.value.type });\r\n  }\r\n};\r\nstate.emoji === undefined &&\r\n  arrayLastLikeForEachUser &&\r\n  updateEmojiIfUserVoted();\r\n\r\n// ========= UPDATE LIKE STATISTICS IF USER VOTED RIGHT NOW=========\r\nconst updateLikesStatisticsIfUserVoted = (newEmoji) => {\r\n  const resObject = arrayLastLikeForEachUser.find(\r\n    (item) => item.accountId === accountThatIsLoggedIn\r\n  );\r\n  if (!resObject) {\r\n    arrayLastLikeForEachUser = [\r\n      ...arrayLastLikeForEachUser,\r\n      {\r\n        accountId: accountThatIsLoggedIn,\r\n        blockHeight: item.blockHeight,\r\n        value: { type: newEmoji },\r\n      },\r\n    ];\r\n  } else {\r\n    arrayLastLikeForEachUser =\r\n      arrayLastLikeForEachUser &&\r\n      arrayLastLikeForEachUser.map((item) => {\r\n        if (item.accountId === accountThatIsLoggedIn) {\r\n          return { ...item, value: { type: newEmoji } };\r\n        }\r\n        return item;\r\n      });\r\n  }\r\n  likesStatistics =\r\n    arrayLastLikeForEachUser && countLikesStats(arrayLastLikeForEachUser);\r\n  State.update({\r\n    likesStatistics,\r\n  });\r\n};\r\n\r\n// ================= Mouse Handlers ===============\r\n\r\nconst handleOnMouseEnter = (e) => {\r\n  State.update({ show: true });\r\n};\r\n\r\nconst handleOnMouseLeave = (e) => {\r\n  State.update({ show: false });\r\n};\r\n\r\nconst clickHandler = (emojiMessage) => {\r\n  if (state.loading) {\r\n    return;\r\n  }\r\n  State.update({\r\n    loading: true,\r\n  });\r\n\r\n  // decide to put unique emoji or white heart (unlike emoji)\r\n  const emojiToWrite =\r\n    emojiMessage === initialEmoji && state.emoji === initialEmoji\r\n      ? emojiArray[0]\r\n      : emojiMessage;\r\n\r\n  const data = {\r\n    index: {\r\n      like: JSON.stringify({\r\n        key: item,\r\n        value: {\r\n          type: emojiToWrite,\r\n        },\r\n      }),\r\n    },\r\n  };\r\n\r\n  Social.set(data, {\r\n    onCommit: () => {\r\n      updateLikesStatisticsIfUserVoted(emojiToWrite);\r\n      State.update({ emoji: emojiToWrite, loading: false, show: false });\r\n    },\r\n    onCancel: () => State.update({ loading: false, show: false }),\r\n  });\r\n};\r\n\r\nfunction showWhenCalled() {\r\n  return state.showReactionsListModal == obj.text || true\r\n    ? { display: \"block\" }\r\n    : {};\r\n}\r\n\r\n// =============== CSS Styles ===============\r\nconst Button = styled.button`\r\n  min-width: fit-content;\r\n  background: transparent;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: start;\r\n  width: 8em;\r\n  height: 2.5em;\r\n  padding: 6px 12px;\r\n  margin: 2px 0;\r\n  border: 0;\r\n  border-radius: .375rem;\r\n  :hover {\r\n    background: #EBEBEB; \r\n    outline: 1px solid #C6C7C8;\r\n  }\r\n`;\r\n\r\nconst SmallButton = styled.button`\r\nposition: relative;\r\n  border: 0;\r\n  background: transparent;\r\n  width: 35px;\r\n  height: 35px;\r\n  color: ${({ isHeart }) => (isHeart ? \"red\" : \"\")};\r\n`;\r\n\r\nconst SmallButtonSpan = styled.span`\r\n  font-size: 19px;\r\n  :hover{\r\n      position: absolute;\r\n      font-size: 35px;\r\n      bottom: -5px;\r\n      width: 35px;\r\n      height: 40px;\r\n      transform: translateX(-50%) translateY(-50%);\r\n  }\r\n  \r\n  @media (max-width: 599px) {\r\n      ::before { \r\n          position: absolute;\r\n          width: 100%;\r\n          height: 100%;\r\n          background-color: rgba(255, 255, 255, .4);\r\n          content: \"\";}\r\n      :hover{\r\n      ::before { \r\n          position: absolute;\r\n          width: 100%;\r\n          height: 120%;\r\n          background-color: rgba(255, 255, 255, .4);\r\n          content: \"\";}\r\n  }\r\n      \r\n  }\r\n`;\r\n\r\n// =============== NEW CSS Styles ===============!!!!!!!!\r\nconst EmojiWrapper = styled.div`\r\ndisplay: inline-block;\r\nposition: relative;\r\noverflow: visible !important;\r\npadding-left: 8px;\r\n`;\r\n\r\nconst Reactions = styled.div`\r\n  position: relative;\r\n  background: transparent;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: start;\r\n  width: 8em;\r\n  height: 2.5em;\r\n  padding: 6px 12px;\r\n  margin: 2px 0;\r\n  border: 0;\r\n  border-radius: .375rem;\r\n`;\r\n\r\nconst EmojiListWrapper = styled.div`\r\ndisplay: flex;\r\nflex-wrap: wrap;\r\npadding: 0.5rem;\r\n\r\nbackground: white;\r\nborder-radius: 1rem;\r\nbox-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15) !important;\r\n@media (min-width: 600px) {\r\n    display: ${({ show }) => (show ? \"flex\" : \"none\")};\r\n    height: 3.2rem;\r\n    flex-wrap: nowrap;\r\n    position: absolute;\r\n    transform: translateY(-10%);\r\n    zIndex: 2;\r\n  }\r\n`;\r\n\r\nconst StatWrapper = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n  position: relative;\r\n  overflow: visible !important;\r\n  border-radius: ${({ isUserVote }) => (isUserVote ? \"1rem\" : \"0\")};\r\n  background-color: ${({ isUserVote }) =>\r\n    isUserVote ? \"rgba(0, 191, 255, 0.3)\" : \"transparent\"};\r\n`;\r\n\r\nconst EmojiQty = styled.span`\r\n  width: 1rem;\r\n  padding-right: 8px;\r\n`;\r\n\r\nconst AccountsListBigContainer = styled.div`\r\n  position: absolute;\r\n  overflow: hidden;\r\n  bottom: 2rem;\r\n  background-color: rgb(230, 230, 230);\r\n  border-radius: 12px;\r\n  width: 40vw;\r\n`;\r\n\r\nconst AccountsListSmallContainer = styled.div`\r\n  margin: 0.5rem;\r\n  border-radius: 12px;\r\n  overflow: hidden;\r\n  padding: 10px;\r\n  text-overflow: ellipsis;\r\n  background-color: white;\r\n  max-height: 20rem;\r\n`;\r\n\r\nconst AccountContainer = styled.p`\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  max-width: 100%;\r\n  text-align: start;\r\n  margin-left: 0.2rem;\r\n  margin-right: 0.2rem;\r\n`;\r\n\r\nconst ShowMoreIndicator = styled.p`\r\n  color: var(--bs-link-color);\r\n  cursor: pointer;\r\n  text-decoration: underline;\r\n  text-align: start;\r\n  margin-left: 0.2rem;\r\n  margin-right: 0.2rem;\r\n\r\n  :hover {\r\n      color: var(--bs-indigo);\r\n  }\r\n`;\r\n\r\n// =============== NEW JSX ===============!!!!!!!!\r\nconst Overlay = () => (\r\n  <EmojiListWrapper\r\n    onMouseEnter={handleOnMouseEnter}\r\n    onMouseLeave={handleOnMouseLeave}\r\n    show={state.show}\r\n  >\r\n    {emojiArray &&\r\n      emojiArray.map((item, index) => (\r\n        <SmallButton onClick={() => clickHandler(item)} isHeart={index === 0}>\r\n          <OverlayTrigger\r\n            placement=\"top\"\r\n            overlay={\r\n              <Tooltip>\r\n                <div className=\"text-truncate text-start\">{item.slice(2)}</div>\r\n              </Tooltip>\r\n            }\r\n          >\r\n            <SmallButtonSpan>{item.slice(0, 2)}</SmallButtonSpan>\r\n          </OverlayTrigger>\r\n        </SmallButton>\r\n      ))}\r\n  </EmojiListWrapper>\r\n);\r\n\r\nlet maxAmountOfAccountsShown = 7;\r\n\r\nconst renderReactionListModal = (accounts, objText) => {\r\n  let accountsa = [\r\n    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,\r\n    22, 23, 24, 25, 26, 27, 28, 29, 30, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,\r\n  ];\r\n\r\n  return (\r\n    <div className=\"modal\" style={showWhenCalled()} tabindex=\"-1\" role=\"dialog\">\r\n      <div className=\"modal-dialog\" role=\"document\">\r\n        <div className=\"modal-content\">\r\n          <div className=\"modal-header\">\r\n            <h5 className=\"modal-title\">{`All ${objText} reactions`}</h5>\r\n            <button\r\n              onClick={() => State.update({ showReactionsListModal: \"\" })}\r\n              type=\"button\"\r\n              className=\"close\"\r\n              aria-label=\"Close\"\r\n            >\r\n              <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n          </div>\r\n          <div className=\"modal-body\">\r\n            {accountsa.map((acc) => {\r\n              return <AccountContainer>{acc}</AccountContainer>;\r\n            })}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst renderReactionList = (accounts, objText) => {\r\n  let accountsa = [\r\n    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,\r\n    22, 23, 24, 25, 26, 27, 28, 29, 30, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,\r\n  ];\r\n\r\n  return (\r\n    <AccountsListBigContainer\r\n      onMouseLeave={() => State.update({ expandReactionList: \"\" })}\r\n    >\r\n      <AccountsListSmallContainer>\r\n        {accountsa &&\r\n          accountsa.map((acc, i) => {\r\n            if (i < maxAmountOfAccountsShown - 1) {\r\n              return <AccountContainer>{acc}</AccountContainer>;\r\n            } else if (i == maxAmountOfAccountsShown) {\r\n              return (\r\n                <ShowMoreIndicator\r\n                  onClick={() =>\r\n                    State.update({ showReactionsListModal: objText })\r\n                  }\r\n                >{`And ${\r\n                  accountsa.length - maxAmountOfAccountsShown\r\n                } more...`}</ShowMoreIndicator>\r\n              );\r\n            } else {\r\n              return <></>;\r\n            }\r\n          })}\r\n      </AccountsListSmallContainer>\r\n    </AccountsListBigContainer>\r\n  );\r\n};\r\n\r\nconst Stats = () =>\r\n  likesStatistics && likesStatistics.length ? (\r\n    likesStatistics.map((obj) => {\r\n      const userReaction = userEmoji ? userEmoji.value.type.slice(0, 2) : \"\";\r\n      return (\r\n        <div\r\n          onMouseOver={() => State.update({ expandReactionList: obj.text })}\r\n          onMouseLeave={() => State.update({ expandReactionList: \"\" })}\r\n        >\r\n          {state.expandReactionList == obj.text &&\r\n            renderReactionList(obj.accounts, obj.text)}\r\n          {(state.showReactionsListModal == obj.text || true) &&\r\n            renderReactionListModal(obj.accounts, obj.text)}\r\n          <StatWrapper\r\n            title={`${obj.text}`}\r\n            isUserVote={obj.emoji === userReaction}\r\n          >\r\n            <EmojiWrapper>{obj.emoji}</EmojiWrapper>\r\n            <EmojiQty>{obj.quantity}</EmojiQty>\r\n          </StatWrapper>\r\n        </div>\r\n      );\r\n    })\r\n  ) : (\r\n    <></>\r\n  );\r\n\r\nconst Spinner = () => {\r\n  return (\r\n    <div\r\n      className=\"spinner-border text-secondary\"\r\n      style={{ height: \"1rem\", width: \"1rem\", marginTop: \"2px\" }}\r\n      role=\"status\"\r\n    >\r\n      <span className=\"sr-only\" title=\"Loading...\"></span>\r\n    </div>\r\n  );\r\n};\r\n\r\nreturn (\r\n  <EmojiWrapper>\r\n    <Button onMouseEnter={handleOnMouseEnter} onMouseLeave={handleOnMouseLeave}>\r\n      {state.loading && <Spinner />}\r\n      {!userEmoji ? initialEmoji : <Stats />}\r\n    </Button>\r\n    {!userEmoji ? (\r\n      <Reactions>\r\n        <Stats />\r\n      </Reactions>\r\n    ) : (\r\n      <></>\r\n    )}\r\n    <Overlay />\r\n  </EmojiWrapper>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/SayALot_Reactions", "__row_index": 66}