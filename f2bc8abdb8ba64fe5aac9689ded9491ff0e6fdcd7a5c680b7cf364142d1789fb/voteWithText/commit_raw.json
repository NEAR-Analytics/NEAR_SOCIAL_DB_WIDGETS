{"tx_hash": "CHxsu7PR66QQACu8e5tTuEGwYBsyQido8Z9PNQodXyxe", "action_id_social": "DRshzSjToZXFh72qrVe8zoRabEsuB6j5iM5yLtL3RRUE-0-widget", "block_id": 80591895, "block_timestamp": "2022-12-13 23:50:28.009", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "voteWithText", "source_code": "if (!props.isPreview && !props.blockHeight) {\n  return \"Property blockHeight not set\";\n}\n\nlet isPreview = props.isPreview;\nconst questionBlockHeight = props.blockHeight;\nState.init({ vote: \"\", showErrorsInForm: false });\n\nconst answers = Social.index(\"poll_question\", \"answer-v3.0.1\");\nconst answersToThisQuestion = answers.filter(\n  (a) => a.value.questionBlockHeight == questionBlockHeight\n);\n\nlet userVote;\nconst loggedAccountId = context.accountId ?? \"\";\nfunction userHasVoted() {\n  return (\n    answersToThisQuestion.find((a) => a.accountId == loggedAccountId) !=\n    undefined\n  );\n}\nlet hasVoted = userHasVoted();\n\nconst getPublicationParams = () => {\n  return {\n    index: {\n      poll_question: JSON.stringify(\n        {\n          key: \"answer-v3.0.1\",\n          value: {\n            answer: state.vote,\n            questionBlockHeight: props.blockHeight,\n          },\n        },\n        undefined,\n        0\n      ),\n    },\n  };\n};\n\nconst isValidInput = () => {\n  let result = state.vote != \"\";\n  return result && !isPreview;\n};\n\nconst renderAnswers = () => {\n  return answsers.map((answer) => {\n    return (\n      <Widget\n        src=\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/answer_poll-coment-container\"\n        props={{ comment, answerTimeStamp, accountId }}\n      />\n    );\n  });\n};\n\nreturn (\n  <div>\n    {hasVoted ? (\n      <p\n        className=\"text-primary\"\n        style={{ textAlign: \"center\", fontWeight: \"500\" }}\n      >\n        You have already voted\n      </p>\n    ) : (\n      <div>\n        <textarea\n          value={state.vote}\n          onChange={(e) => State.update({ vote: e.target.value })}\n          style={{ width: \"100%\" }}\n        />\n        {renderAnswers()}\n        {isValidInput() ? (\n          <CommitButton\n            className=\"my-2 btn btn-primary\"\n            data={getPublicationParams()}\n          >\n            Done\n          </CommitButton>\n        ) : (\n          <button\n            className=\"my-2 btn btn-primary\"\n            onClick={() => State.update({ showErrorsInForm: true })}\n          >\n            Done\n          </button>\n        )}\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/voteWithText"}