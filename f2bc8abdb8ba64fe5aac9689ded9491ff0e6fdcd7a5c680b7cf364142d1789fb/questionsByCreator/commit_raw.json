{"tx_hash": "E9LLbS2pTa9v6QZME7KTUUL74U4P5wNfyNeNCZa48kRt", "action_id_social": "FKnWA2bYDzo2K451DYoE8YmAMj86wZyLjpEXTys36f9f-0-widget", "block_id": 83789614, "block_timestamp": "2023-01-25 21:35:02.889", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "questionsByCreator", "source_code": "/********** Start initialization ************/\r\n\r\nState.init({\r\n  showQuestion: false,\r\n  modalBlockHeight: 0,\r\n  polls: {},\r\n  answers: {},\r\n});\r\n\r\n// When true, displays only two polls.\r\nlet isShort = props.isShort;\r\n\r\nlet polls = Social.index(\"poll_question\", \"question-v3.1.1\", {\r\n  accountId: props.accountId,\r\n});\r\nif (!polls) {\r\n  return \"Loading\";\r\n}\r\nif (JSON.stringify(polls) != JSON.stringify(state.polls)) {\r\n  State.update({ polls });\r\n}\r\n\r\n/********** End initialization ************/\r\n\r\n/********** Start constants ************/\r\n\r\nlet widgetOwner =\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\r\n\r\nconst QUESTION_STATUSES = {\r\n  ACTIVE: {\r\n    id: 0,\r\n    text: \"Active\",\r\n    backgroundColor: \"#D9FCEF\",\r\n    fontColor: \"#00B37D\",\r\n  },\r\n  CLOSED: {\r\n    id: 1,\r\n    text: \"Closed\",\r\n    backgroundColor: \"#FFE5E5\",\r\n    fontColor: \"#FF4747\",\r\n  },\r\n  UPCOMING: {\r\n    id: 2,\r\n    text: \"Upcoming\",\r\n    backgroundColor: \"#FFF3B4\",\r\n    fontColor: \"#FFC905\",\r\n  },\r\n};\r\n/********** End constants ************/\r\n\r\n/********** Start styles ************/\r\n/********** End styles ************/\r\n\r\n/********** Start functions ************/\r\n\r\nfunction sliceString(string, newStringLength) {\r\n  if (string.length > newStringLength) {\r\n    return string.slice(0, newStringLength) + \"...\";\r\n  }\r\n  return string;\r\n}\r\n\r\nfunction isActive(poll) {\r\n  return (\r\n    poll.value.startTimestamp < Date.now() &&\r\n    Date.now() < poll.value.endTimestamp\r\n  );\r\n}\r\n\r\nfunction getQuestionStatus(poll) {\r\n  return isUpcoming(poll)\r\n    ? QUESTION_STATUSES.UPCOMING\r\n    : isActive(poll)\r\n    ? QUESTION_STATUSES.ACTIVE\r\n    : QUESTION_STATUSES.CLOSED;\r\n}\r\n\r\nfunction isUpcoming(poll) {\r\n  return poll.value.startTimestamp > Date.now();\r\n}\r\n\r\nfunction getValidAnswersQtyFromQuestion(questionBlockHeight) {\r\n  const answers = Social.index(\"poll_question\", \"answer-v3.1.1\");\r\n\r\n  if (JSON.stringify(answers) != JSON.stringify(state.answers)) {\r\n    State.update({ answers: answers });\r\n  }\r\n\r\n  if (!answers) {\r\n    return \"Loading\";\r\n  }\r\n  const answersFromThisQuestion = answers.filter(\r\n    (a) => a.value.questionBlockHeight == questionBlockHeight\r\n  );\r\n  const usersWithAnswers = answersFromThisQuestion.map((a) => a.accountId);\r\n  const usersWithAnswersWithoutDuplicates = usersWithAnswers.filter(\r\n    (u, index) => usersWithAnswers.indexOf(u) == index\r\n  );\r\n  return usersWithAnswersWithoutDuplicates.length;\r\n}\r\n\r\nfunction closeModalClickingOnTransparent() {\r\n  return (e) => {\r\n    e.target.id == \"modal\" && State.update({ showQuestion: false });\r\n  };\r\n}\r\n/********** End functions ************/\r\n\r\n/********** Start components ************/\r\nconst renderPollTypeIcon = () => {\r\n  let allPollTypes = [];\r\n  for (let i = 0; i < poll.value.questions.length; i++) {\r\n    if (!allPollTypes.includes(poll.value.questions[i].questionType)) {\r\n      allPollTypes.push(poll.value.questions[i].questionType);\r\n    }\r\n  }\r\n\r\n  return allPollTypes.length == 1 &&\r\n    (allPollTypes[0] == \"0\" || allPollTypes[0] == \"1\") ? (\r\n    <i className=\"bi bi-pie-chart\" style={{ padding: \"0.6rem 0.8rem\" }}></i>\r\n  ) : allPollTypes.length == 1 && allPollTypes[0] == \"2\" ? (\r\n    <i\r\n      style={{\r\n        transform: \"rotate(90deg)\",\r\n        padding: \"0.6rem 0.8rem\",\r\n      }}\r\n      className=\"bi bi-bar-chart-line\"\r\n    ></i>\r\n  ) : allPollTypes.length == 1 && allPollTypes[0] == \"3\" ? (\r\n    <i className=\"bi bi-file-text\" style={{ padding: \"0.6rem 0.8rem\" }}></i>\r\n  ) : (\r\n    <i className=\"bi bi-collection\" style={{ padding: \"0.6rem 0.8rem\" }}></i>\r\n  );\r\n};\r\n\r\nconst renderModal = () => {\r\n  return (\r\n    <div\r\n      className=\"modal\"\r\n      id=\"modal\"\r\n      style={\r\n        state.showQuestion && { display: \"block\", backgroundColor: \"#7e7e7e70\" }\r\n      }\r\n      tabindex=\"-1\"\r\n      role=\"dialog\"\r\n      onClick={closeModalClickingOnTransparent()}\r\n    >\r\n      <div className=\"modal-dialog\" style={{ maxWidth: \"95%\" }} role=\"document\">\r\n        <div\r\n          className=\"modal-content\"\r\n          style={{ backgroundColor: \"rgb(230, 230, 230)\" }}\r\n        >\r\n          <div className=\"modal-header flex-row-reverse\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"close\"\r\n              dataDismiss=\"modal\"\r\n              ariaLabel=\"Close\"\r\n              onClick={() => State.update({ showQuestion: false })}\r\n            >\r\n              <span ariaHidden=\"true\">&times;</span>\r\n            </button>\r\n          </div>\r\n          <div className=\"modal-body\" style={{ backgroundColor: \"#FAFAFB\" }}>\r\n            <Widget\r\n              src={`${widgetOwner}/widget/newVotingInterface`}\r\n              props={{\r\n                blockHeight: state.modalBlockHeight,\r\n                shouldDisplayViewAll: true,\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"modal-footer\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-secondary\"\r\n              data-dismiss=\"modal\"\r\n              onClick={() => State.update({ showQuestion: false })}\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n/********** End components ************/\r\n\r\nreturn (\r\n  <>\r\n    {polls.map((poll, index) => {\r\n      const questionStatus = getQuestionStatus(poll);\r\n      if ((isShort && index < 2) || !isShort) {\r\n        return (\r\n          <div\r\n            className=\"mt-2\"\r\n            style={\r\n              index == 0\r\n                ? { cursor: \"pointer\", backGroundColor: \"white\" }\r\n                : {\r\n                    paddingTop: \"1rem\",\r\n                    backGroundColor: \"white\",\r\n                    borderTop: \"1px solid #ced4da\",\r\n                    marginTop: \"1rem\",\r\n                    cursor: \"pointer\",\r\n                  }\r\n            }\r\n            onClick={() => {\r\n              State.update({\r\n                showQuestion: true,\r\n                modalBlockHeight: poll.blockHeight,\r\n              });\r\n            }}\r\n          >\r\n            <div className=\"d-flex align-content-center\">\r\n              <div\r\n                className=\"d-flex justify-content-center\"\r\n                style={{\r\n                  maxHeight: \"2.8rem\",\r\n                  aspectRatio: \"1\",\r\n                  borderRadius: \"16px\",\r\n                  backgroundColor: \"#F2F6FA\",\r\n                  marginRight: \"0.8rem\",\r\n                }}\r\n              >\r\n                {renderPollTypeIcon(poll)}\r\n              </div>\r\n              <p style={{ margin: \"0.5rem 0 0 0\", fontWeight: \"500\" }}>\r\n                {sliceString(poll.value.title, 20)}\r\n              </p>\r\n            </div>\r\n            <div className=\"d-flex\">\r\n              <div\r\n                className=\"d-flex justify-content-center\"\r\n                style={{\r\n                  width: \"2.8rem\",\r\n                  marginRight: \"0.8rem\",\r\n                }}\r\n              >\r\n                {/*Structural div, do not delete*/}\r\n              </div>\r\n              <div className=\"d-flex w-100 justify-content-between flex-nowrap text-secondary mb-2\">\r\n                <div>\r\n                  <i className=\"bi bi-people\"></i>\r\n                  <span>\r\n                    {getValidAnswersQtyFromQuestion(poll.blockHeight)}\r\n                  </span>\r\n                </div>\r\n                <span>\r\n                  {Date.now() < poll.value.startTimestamp ||\r\n                  (Date.now() > poll.value.startTimestamp &&\r\n                    Date.now() < poll.value.endTimestamp) ? (\r\n                    <span>Ends</span>\r\n                  ) : (\r\n                    <span>Ended</span>\r\n                  )}\r\n                  <Widget\r\n                    src={`silkking.near/widget/timeAgo`}\r\n                    props={{\r\n                      reduced: true,\r\n                      timeInFuture: poll.value.endTimestamp,\r\n                    }}\r\n                  />\r\n                </span>\r\n                <span\r\n                  style={{\r\n                    backgroundColor: questionStatus.backgroundColor,\r\n                    height: \"1.5rem\",\r\n                    width: \"4rem\",\r\n                    textAlign: \"center\",\r\n                    borderRadius: \"16px\",\r\n                    marginRight: \"1rem\",\r\n                    lineHeight: \"1.5rem\",\r\n                    fontSize: \"0.8rem\",\r\n                    letterSpacing: \"-0.025rem\",\r\n                    color: questionStatus.fontColor,\r\n                    fontWeight: \"500\",\r\n                  }}\r\n                >\r\n                  {questionStatus.text}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n    })}\r\n    {state.showQuestion && renderModal()}\r\n  </>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/questionsByCreator"}