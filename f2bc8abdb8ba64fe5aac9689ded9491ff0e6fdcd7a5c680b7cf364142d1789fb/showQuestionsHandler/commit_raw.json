{"tx_hash": "4GAGRADbpkpCPK9R53Wuk5yqN3SM9bd3ceBA2kzrkhs1", "action_id_social": "HW6sWiGAa612EoKAXZMem7NanJknBBYmtnf8udojfbj1-0-widget", "block_id": 91641237, "block_timestamp": "2023-05-11T23:31:40.625Z", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "showQuestionsHandler", "source_code": "/********** Start initialization ************/\n\nlet sharedBlockHeight = props.sharedBlockHeight;\n\nlet globalAccountId = props.accountId ?? context.accountId;\n\nState.init({\n  polls: {},\n  showQuestion: sharedBlockHeight,\n  modalBlockHeight: sharedBlockHeight ?? question.blockHeight,\n});\n\nlet polls = Social.index(\"poll_question\", \"question-v3.1.1\");\nif (JSON.stringify(polls) != JSON.stringify(state.polls)) {\n  State.update({ polls: polls });\n}\n\nif (!polls) {\n  return \"Loading\";\n}\n\nconst onlyUsersPolls = props.onlyUser ?? false;\nif (onlyUsersPolls) {\n  polls = state.polls.filter((poll) => poll.accountId == globalAccountId);\n}\n\npolls = polls.sort((q1, q2) => {\n  const isQ1Finished = q1.value.endTimestamp < Date.now();\n  const isQ2Finished = q2.value.endTimestamp < Date.now();\n  if (isQ1Finished && !isQ2Finished) return 1;\n  if (!isQ1Finished && isQ2Finished) return -1;\n  if (isQ1Finished && isQ2Finished)\n    return q2.value.endTimestamp - q1.value.endTimestamp;\n  return q1.value.endTimestamp - q2.value.endTimestamp;\n});\n\nlet usersMakingQuestions = [];\nfor (let i = 0; i < polls.length; i++) {\n  if (!usersMakingQuestions.includes(polls[i].accountId)) {\n    usersMakingQuestions.push(polls[i].accountId);\n  }\n}\n/********** End initialization ************/\n\n/********** Start constants ************/\n\nconst widgetOwner =\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\n\n// Whether it should be display the questions of only one user or all\n\n/********** End constants ************/\n\n/********** Start styles ************/\n/********** End styles ************/\n\n/********** Start functions ************/\n\nfunction closeModalClickingOnTransparent() {\n  return (e) => {\n    e.target.id == \"modal\" && State.update({ showQuestion: false });\n  };\n}\n\n/********** End functions ************/\n\n/********** Start components ************/\n\nconst renderModal = () => {\n  return (\n    <div\n      className=\"modal\"\n      id=\"modal\"\n      style={\n        state.showQuestion && { display: \"block\", backgroundColor: \"#7e7e7e70\" }\n      }\n      tabindex=\"-1\"\n      role=\"dialog\"\n      onClick={closeModalClickingOnTransparent()}\n    >\n      <div className=\"modal-dialog\" style={{ maxWidth: \"95%\" }} role=\"document\">\n        <div\n          className=\"modal-content\"\n          style={{ backgroundColor: \"rgb(230, 230, 230)\" }}\n        >\n          <div className=\"modal-header flex-row-reverse\">\n            <button\n              type=\"button\"\n              className=\"close\"\n              dataDismiss=\"modal\"\n              ariaLabel=\"Close\"\n              onClick={() => State.update({ showQuestion: false })}\n            >\n              <span ariaHidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div className=\"modal-body\" style={{ backgroundColor: \"#FAFAFB\" }}>\n            <Widget\n              src={`${widgetOwner}/widget/newVotingInterface`}\n              props={{\n                blockHeight: state.modalBlockHeight,\n                shouldDisplayViewAll: false,\n              }}\n            />\n          </div>\n          <div className=\"modal-footer\">\n            <button\n              type=\"button\"\n              className=\"btn btn-secondary\"\n              data-dismiss=\"modal\"\n              onClick={() => State.update({ showQuestion: false })}\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst renderPolls = (onlyUsersPolls) => {\n  if (onlyUsersPolls) {\n    console.log(polls);\n    return polls.map((poll) => {\n      return (\n        <div\n          className=\"mx-1 py-3 px-4 my-2\"\n          style={\n            polls.length == 1\n              ? {\n                  boxSizing: \"border-box\",\n                  boxShadow: \"0px 8px 28px rgba(43, 68, 106, 0.05)\",\n                  backgroundColor: \"white\",\n                  borderRadius: \"1rem\",\n                  cursor: \"pointer\",\n                  maxWidth: \"40vw\",\n                }\n              : {\n                  boxSizing: \"border-box\",\n                  boxShadow: \"0px 8px 28px rgba(43, 68, 106, 0.05)\",\n                  backgroundColor: \"white\",\n                  borderRadius: \"1rem\",\n                  cursor: \"pointer\",\n                }\n          }\n          onClick={() => {\n            State.update({\n              showQuestion: true,\n              modalBlockHeight: poll.blockHeight,\n            });\n          }}\n        >\n          <Widget\n            src={`${widgetOwner}/widget/minimalistQuestionHeader`}\n            props={{ ...poll }}\n          />\n          <Widget\n            src={`${widgetOwner}/widget/minimalistQuestionGeneralInfo`}\n            props={{ ...poll }}\n          />\n        </div>\n      );\n    });\n  } else {\n    return (\n      <>\n        {usersMakingQuestions.map((accountId) => {\n          return (\n            <div\n              className=\"mx-1 py-3 px-4 my-2\"\n              style={{\n                boxSizing: \"border-box\",\n                boxShadow: \"0px 8px 28px rgba(43, 68, 106, 0.05)\",\n                backgroundColor: \"white\",\n                borderRadius: \"1rem\",\n              }}\n            >\n              <Widget\n                src={`${widgetOwner}/widget/displayQuestionHeader`}\n                props={{ allUsersQuestions: polls, accountId }}\n              />\n              <Widget\n                src={`${widgetOwner}/widget/questionsByCreator`}\n                props={{ accountId }}\n              />\n            </div>\n          );\n        })}\n      </>\n    );\n  }\n};\n\n/********** End components ************/\n\nreturn (\n  <div\n    style={{\n      borderRadius: \"3px\",\n      backgroundColor: \"rgb(230, 230, 230)\",\n    }}\n  >\n    <div\n      style={\n        onlyUsersPolls\n          ? {\n              display: \"grid\",\n              gridTemplateColumns: \" repeat(2, 1fr)\",\n            }\n          : {\n              display: \"grid\",\n              gridTemplateColumns: \" repeat(3, 1fr)\",\n            }\n      }\n    >\n      {renderPolls(onlyUsersPolls)}\n    </div>\n    {/*TODO add a page picker instead the infinite scroll?*/}\n    {state.showQuestion && renderModal()}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/showQuestionsHandler", "__row_index": 0}