{"tx_hash": "49EkBeiznr3rBrn1GGLdDyWdZznQuLRz7CJPG6EABhn3", "action_id_social": "HeLWfCZLRRW4g8LJDpLq1o7T524vPByTqEiRNL84j9zb-0-widget", "block_id": 80509894, "block_timestamp": "2022-12-12 21:07:12.274", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "voteMultipleChoice", "source_code": "function validateProps(props) {\n  let errors = [];\n  if (!props.question) errors.push(\"Props doesn't contain question key\");\n  if (!props.option) errors.push(\"Props doesn't contain option key\");\n  if (!props.index) errors.push(\"Props doesn't contain index key\");\n  if (!props.haveVoted) errors.push(\"Props doesn't contain haveVoted key\");\n  if (!props.userVote) errors.push(\"Props doesn't contain userVote key\");\n  return errors;\n}\n\nconst propErrors = validateProps(props);\nif (propErrors.length > 0) {\n  return (\n    <>\n      {propErrors.map((e) => (\n        <div>{e}</div>\n      ))}\n    </>\n  );\n}\n\nlet question = props.question;\nlet option = props.option;\nlet index = props.index;\nlet haveVoted = props.haveVoted;\nlet userVote = props.userVote;\nlet isPreview = props.isPreview;\n\nState.init({\n  vote: userVote ?? \"\",\n});\n\nconst getPublicationParams = () => {\n  return {\n    index: {\n      poll_question: JSON.stringify(\n        {\n          key: \"answer-v3.0.1\",\n          value: {\n            answer: state.vote,\n            questionBlockHeight: props.blockHeight,\n          },\n        },\n        undefined,\n        0\n      ),\n    },\n  };\n};\n\n//TODO get this data\nlet countVotes = [1, 0, 0];\n\nfunction calculatePercentage(votesToThisOption) {\n  return (votesToThisOption / question.value.answers.length) * 100;\n}\n\nlet styles = haveVoted\n  ? { color: \"#000\", width: \"90%\" }\n  : { color: \"#000\", width: \"100%\" };\n\nconst isValidInput = () => {\n  let result = state.vote != \"\";\n  return result && !isPreview;\n};\n\nreturn (\n  <div>\n    <div className=\"d-flex\">\n      <div style={styles}>\n        {/* Set the width of the next div to make the bar grow. At the same, use the same value to fill the span tag */}\n        <div\n          style={{\n            margin: \"0.3rem 0px\",\n            content: \"\",\n            display: \"table\",\n            clear: \"both\",\n            padding: \"0.01em 16px\",\n            display: \"inline-block\",\n            width: `${\n              haveVoted ? calculatePercentage(countVotes[index]) : 100\n            }%`,\n            textAlign: \"center\",\n            overflow: \"visible\",\n            whiteSpace: \"nowrap\",\n            textAlign: \"left\",\n            backgroundColor: `${\n              (haveVoted && state.vote == index) || state.vote == index + \"\"\n                ? \"rgb(153, 255, 153)\"\n                : \"lightgray\"\n            }`,\n          }}\n          onClick={() => !haveVoted && State.update({ vote: index + \"\" })}\n        >\n          <span style={{ overflow: \"visible\", fontWeight: \"500\" }}>\n            {option}\n            {haveVoted && (\n              <span\n                className=\"text-secondary\"\n                style={{ marginLeft: \"1rem\", fontWeight: \"400\" }}\n              >\n                ({question.answers.length} votes)\n              </span>\n            )}\n          </span>\n        </div>\n      </div>\n      {haveVoted && (\n        <span\n          style={{\n            minWidth: \"max-content\",\n            margin: \"0.3rem 0px 0.3rem 0.3rem\",\n            fontWeight: \"500\",\n          }}\n        >\n          {calculatePercentage(countVotes[index])}%\n        </span>\n      )}\n    </div>\n\n    {haveVoted ? (\n      <p\n        className=\"text-primary\"\n        style={{ textAlign: \"center\", fontWeight: \"500\" }}\n      >\n        Voted\n      </p>\n    ) : (\n      <CommitButton\n        className=\"my-2 btn btn-primary\"\n        data={getPublicationParams()}\n      >\n        Vote\n      </CommitButton>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/voteMultipleChoice"}