{"tx_hash": "6ApsfRzE7mbNzHwXT116sJoZZ8XkHU5hZWExgYbkbJ2x", "action_id_social": "4XAZCSrhNPpEaK5DwJLNdJCrZBW979QTPGeGwR9oYs9i-0-widget", "block_id": 83788495, "block_timestamp": "2023-01-25 21:14:02.469", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "pollQuestionMasterHandler", "source_code": "/********** Start initialization ************/\r\nlet sharedBlockHeight = props.sharedBlockHeight;\r\n\r\nconst TABS = {\r\n  MY_POLLS: { id: 0, text: \"My Polls\" },\r\n  ALL_EXISTING_POLLS: { id: 1, text: \"All existing polls\" },\r\n  NEW_POLL: { id: 2, text: \"Create a poll\" },\r\n};\r\n\r\nState.init({\r\n  displaying: TABS.MY_POLLS.id,\r\n  hoveringElement: \"\",\r\n  showAbortPollCreation: false,\r\n  abortThroughAllExistingPolls: false,\r\n  profile: {},\r\n  showLogInRequiredPopup: false,\r\n});\r\n\r\nconst profile = Social.getr(`${context.accountId}/profile`);\r\nif (JSON.stringify(profile) != JSON.stringify(state.profile)) {\r\n  State.update({ profile });\r\n}\r\n/********** End initialization ************/\r\n\r\n/********** Start constants ************/\r\nconst widgetOwner =\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\r\n\r\nconst MODAL = \"modal\";\r\n\r\nconst HOVERING_ELEMENTS = {\r\n  CANCEL_NEW_POLL: \"cancelNewPoll\",\r\n};\r\n\r\n/********** End constants ************/\r\n\r\n/********** Start styles ************/\r\n\r\nconst styleAlignCenter = {\r\n  display: \"flex\",\r\n  justifyContent: \"center\",\r\n  alignItems: \"center\",\r\n};\r\n\r\nconst styleColorGreyTransparent = {\r\n  backgroundColor: \"#7e7e7e70\",\r\n  backdropFilter: \"blur(4px)\",\r\n};\r\n\r\n/********** End styles ************/\r\n\r\n/********** Start functions ************/\r\nfunction makeAccountIdShorter(accountId, length) {\r\n  if (accountId.length > length) {\r\n    return accountId.slice(0, length) + \"...\";\r\n  }\r\n  return accountId;\r\n}\r\n\r\nfunction abortPollCreation() {\r\n  State.update({ showAbortPollCreation: true });\r\n}\r\n\r\nfunction closeModalClickingOnTransparent() {\r\n  return (e) => {\r\n    e.target.id == \"modal\" && State.update({ showAbortPollCreation: false });\r\n  };\r\n}\r\n\r\n/********** End functions ************/\r\n\r\nconst renderAbortPollCreationModal = () => {\r\n  return (\r\n    <div\r\n      className={MODAL}\r\n      id={MODAL}\r\n      style={\r\n        state.showAbortPollCreation && {\r\n          ...styleAlignCenter,\r\n          ...styleColorGreyTransparent,\r\n        }\r\n      }\r\n      tabindex=\"-1\"\r\n      role=\"dialog\"\r\n      onClick={closeModalClickingOnTransparent()}\r\n    >\r\n      <div\r\n        className=\"modal-dialog\"\r\n        style={{ width: \"540px\", borderRadius: \"28px\" }}\r\n        role=\"document\"\r\n      >\r\n        <div\r\n          className=\"modal-content\"\r\n          style={{ border: \"none\", borderRadius: \"28px\" }}\r\n        >\r\n          <div\r\n            className=\"modal-header flex-row-reverse\"\r\n            style={{ padding: \"0\", margin: \"0\", border: \"none\" }}\r\n          >\r\n            <button\r\n              type=\"button\"\r\n              className=\"close\"\r\n              style={{\r\n                border: \"none\",\r\n                backgroundColor: \"transparent\",\r\n                margin: \"0.5rem 0.5rem 0px 0px\",\r\n                borderRadius: \"28px\",\r\n                marginRight: \"0.3rem\",\r\n                padding: \"0.3rem 0.7rem 0 0\",\r\n              }}\r\n              dataDismiss=\"modal\"\r\n              ariaLabel=\"Close\"\r\n              onClick={() => State.update({ showAbortPollCreation: false })}\r\n            >\r\n              <i className=\"bi bi-x-lg\"></i>\r\n            </button>\r\n          </div>\r\n          <div\r\n            className=\"modal-body\"\r\n            style={{\r\n              width: \"90%\",\r\n              borderRadius: \"1rem\",\r\n              margin: \"0 auto\",\r\n              padding: \"0\",\r\n            }}\r\n          >\r\n            <h3\r\n              style={{\r\n                fontWeight: \"700\",\r\n                fontSize: \"1.5rem\",\r\n                letterSpacing: \"0.1px\",\r\n                textAlign: \"center\",\r\n              }}\r\n            >\r\n              Discard changes\r\n            </h3>\r\n            <p\r\n              style={{\r\n                letterSpacing: \"-0.01\",\r\n                color: \"#4B516A\",\r\n                fontSize: \"1rem\",\r\n                textAlign: \"center\",\r\n              }}\r\n            >\r\n              If you leave now, you will lose all your changes\r\n            </p>\r\n          </div>\r\n          <div\r\n            className=\"modal-footer\"\r\n            style={{ border: \"none\", justifyContent: \"space-around\" }}\r\n          >\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-secondary\"\r\n              data-dismiss=\"modal\"\r\n              style={{\r\n                padding: \"0.7rem\",\r\n                borderRadius: \"16px\",\r\n                width: \"45%\",\r\n                backgroundColor: \"white\",\r\n                border: \"1.5px solid #B0B3BE\",\r\n                color: \"#010A2D\",\r\n                fontWeight: \"700\",\r\n                letterSpacing: \"0.01em\",\r\n              }}\r\n              onClick={() => State.update({ showAbortPollCreation: false })}\r\n            >\r\n              Continue editing\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              className=\"btn btn-secondary\"\r\n              data-dismiss=\"modal\"\r\n              style={{\r\n                padding: \"0.7rem\",\r\n                borderRadius: \"16px\",\r\n                width: \"45%\",\r\n                backgroundColor: \"#FF4747\",\r\n                border: \"1.5px solid transparent\",\r\n                color: \"white\",\r\n                fontWeight: \"700\",\r\n                letterSpacing: \"0.01em\",\r\n              }}\r\n              onClick={() => {\r\n                if (state.abortThroughAllExistingPolls) {\r\n                  State.update({\r\n                    displaying: TABS.ALL_EXISTING_POLLS.id,\r\n                    abortThroughAllExistingPolls: false,\r\n                    hoveringElement: \"\",\r\n                    showAbortPollCreation: false,\r\n                  });\r\n                } else {\r\n                  State.update({\r\n                    displaying: TABS.MY_POLLS.id,\r\n                    hoveringElement: \"\",\r\n                    showAbortPollCreation: false,\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n              Discard changes\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n/********** Start rendering ************/\r\n\r\nif (!context.accountId) {\r\n  return (\r\n    <div\r\n      style={{\r\n        height: \"80vh\",\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        position: \"relative\",\r\n      }}\r\n    >\r\n      <button\r\n        style={\r\n          state.hoveringElement == \"connect-wallet-button\"\r\n            ? {\r\n                padding: \"20px 32px\",\r\n                width: \"50%\",\r\n                backgroundColor: \"white\",\r\n                borderRadius: \"20px\",\r\n                color: \"#010A2D\",\r\n                fontWeight: \"500\",\r\n                fontSize: \"0.8rem\",\r\n                letterSpacing: \"0.01em\",\r\n                border: \"1px #010A2D solid\",\r\n              }\r\n            : {\r\n                padding: \"20px 32px\",\r\n                width: \"50%\",\r\n                backgroundColor: \"#010A2D\",\r\n                borderRadius: \"20px\",\r\n                color: \"white\",\r\n                fontWeight: \"500\",\r\n                fontSize: \"0.8rem\",\r\n                letterSpacing: \"0.01em\",\r\n                border: \"1px #010A2D solid\",\r\n              }\r\n        }\r\n        onMouseEnter={() => {\r\n          State.update({ hoveringElement: \"connect-wallet-button\" });\r\n        }}\r\n        onMouseLeave={() => {\r\n          State.update({ hoveringElement: \"\" });\r\n        }}\r\n        onClick={() => State.update({ showLogInRequiredPopup: true })}\r\n      >\r\n        Connect wallet\r\n      </button>\r\n      {state.showLogInRequiredPopup && (\r\n        <div\r\n          className=\"alert alert-warning rounded-4 mb-3\"\r\n          style={{ position: \"absolute\", top: \"1rem\", width: \"90vw\" }}\r\n        >\r\n          <div className=\"text-end\">\r\n            <div className=\"fw-bold\">\r\n              Sign in by clicking\r\n              <div\r\n                className=\"profile-image d-inline-block\"\r\n                style={{ width: \"3em\", height: \"3em\" }}\r\n              >\r\n                <img\r\n                  className=\"rounded w-100 h-100\"\r\n                  src=\"https://i.near.social/thumbnail/https://ipfs.near.social/ipfs/bafkreibmiy4ozblcgv3fm3gc6q62s55em33vconbavfd2ekkuliznaq3zm\"\r\n                  alt=\"No-name profile @\"\r\n                  style={{ objectFit: \"cover\" }}\r\n                />\r\n              </div>\r\n              <i className=\"fs-1 align-middle bi bi-arrow-up-right\"></i>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nreturn (\r\n  <div\r\n    className=\"pb-5\"\r\n    style={{\r\n      backgroundColor: \"rgb(230, 230, 230)\",\r\n      fontFamily: \"Onest\",\r\n      fontStyle: \"normal\",\r\n      borderRadius: \"20px\",\r\n    }}\r\n  >\r\n    <div\r\n      className=\"d-flex justify-content-between align-items-center px-4 py-3\"\r\n      style={{\r\n        backgroundColor: \"white\",\r\n        boxShadow: \"0px 4px 28px rgba(43, 68, 106, 0.04)\",\r\n      }}\r\n    >\r\n      <a\r\n        href=\"https://near.social/#/mob.near/widget/ProfilePage?accountId=easypoll.near\"\r\n        className=\"d-flex align-items-center\"\r\n        style={{ cursor: \"pointer\", textDecoration: \"none\" }}\r\n      >\r\n        <div\r\n          className=\"d-flex align-items-center justify-content-center\"\r\n          style={{\r\n            backgroundColor: \"#010A2D\",\r\n            color: \"white\",\r\n            height: \"100%\",\r\n            minWidth: \"2.5rem\",\r\n            aspectRatio: \"1\",\r\n            borderRadius: \"12px\",\r\n          }}\r\n        >\r\n          <i className=\"bi bi-bar-chart-fill\"></i>\r\n        </div>\r\n        <h3\r\n          style={{\r\n            margin: \"0 0.5rem\",\r\n            color: \"#010A2D\",\r\n            fontWeight: \"700\",\r\n            fontSize: \"1.3rem\",\r\n            letterSpacing: \"0.1px\",\r\n          }}\r\n        >\r\n          EasyPoll\r\n        </h3>\r\n      </a>\r\n\r\n      <div\r\n        className=\"w-100 d-flex justify-content-between\"\r\n        style={{ margin: \"0 4rem\" }}\r\n      >\r\n        <div style={{ marginTop: \"0.6rem\" }}>\r\n          <div className=\"d-flex\">\r\n            {Object.keys(TABS).map((tabKey) => {\r\n              const tab = TABS[tabKey];\r\n              if (tab.id != TABS.NEW_POLL.id) {\r\n                return (\r\n                  <div\r\n                    style={{\r\n                      marginRight: \"1.5rem\",\r\n                      position: \"relative\",\r\n                      cursor: \"pointer\",\r\n                      userSelect: \"none\",\r\n                    }}\r\n                  >\r\n                    <p\r\n                      ariaCurrent=\"page\"\r\n                      onMouseEnter={() => {\r\n                        State.update({ hoveringElement: tab.id });\r\n                      }}\r\n                      onMouseLeave={() => {\r\n                        State.update({ hoveringElement: \"\" });\r\n                      }}\r\n                      onClick={() => {\r\n                        state.displaying != TABS.NEW_POLL.id\r\n                          ? State.update({ displaying: tab.id })\r\n                          : tab.id == TABS.ALL_EXISTING_POLLS.id\r\n                          ? State.update({\r\n                              showAbortPollCreation: true,\r\n                              abortThroughAllExistingPolls: true,\r\n                            })\r\n                          : State.update({ showAbortPollCreation: true });\r\n                      }}\r\n                      style={{\r\n                        fontWeight: \"500\",\r\n                        fontSize: \"1rem\",\r\n                        margin: \"0\",\r\n                      }}\r\n                    >\r\n                      {tab.text}\r\n                    </p>\r\n                    {(state.hoveringElement == tab.id ||\r\n                      state.displaying == tab.id) && (\r\n                      <div\r\n                        style={{\r\n                          height: \"0.2rem\",\r\n                          width: \"50%\",\r\n                          position: \"absolute\",\r\n                          bottom: \"-55%\",\r\n                          left: \"25%\",\r\n                          backgroundColor: \"#010A2D\",\r\n                          borderRadius: \"8px\",\r\n                        }}\r\n                      >\r\n                        {/*Decorative Div, do not delete*/}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              }\r\n            })}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"d-flex\">\r\n          <button\r\n            onMouseEnter={() => {\r\n              State.update({ hoveringElement: TABS.NEW_POLL.id });\r\n            }}\r\n            onMouseLeave={() => {\r\n              State.update({ hoveringElement: \"\" });\r\n            }}\r\n            onClick={() => {\r\n              State.update({ displaying: TABS.NEW_POLL.id });\r\n            }}\r\n            style={\r\n              state.hoveringElement == TABS.NEW_POLL.id ||\r\n              state.displaying == TABS.NEW_POLL.id\r\n                ? {\r\n                    border: \"2px solid black\",\r\n                    color: \"black\",\r\n                    backgroundColor: \"white\",\r\n                    fontWeight: \"500\",\r\n                    fontSize: \"1rem\",\r\n                    margin: \"0\",\r\n                    padding: \"0.3rem 1.5rem\",\r\n                    borderRadius: \"12px\",\r\n                  }\r\n                : {\r\n                    border: \"2px solid transparent\",\r\n                    fontWeight: \"500\",\r\n                    fontSize: \"1rem\",\r\n                    margin: \"0\",\r\n                    padding: \"0.3rem 1.5rem\",\r\n                    backgroundColor: \"#010A2D\",\r\n                    borderRadius: \"12px\",\r\n                    color: \"white\",\r\n                  }\r\n            }\r\n          >\r\n            <i\r\n              className=\"bi bi-plus-lg\"\r\n              style={\r\n                state.hoveringElement == TABS.NEW_POLL.id ||\r\n                state.displaying == TABS.NEW_POLL.id\r\n                  ? { color: \"black\" }\r\n                  : { color: \"white\" }\r\n              }\r\n            ></i>\r\n            {TABS.NEW_POLL.text}\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div className=\"p-2\">\r\n        {context.accountId && (\r\n          <div>\r\n            <p style={{ margin: \"0\", fontSize: \"0.8rem\" }}>\r\n              {makeAccountIdShorter(state.profile.name, 12)}\r\n            </p>\r\n            <p style={{ margin: \"0\", fontSize: \"0.8rem\" }}>\r\n              @{makeAccountIdShorter(context.accountId, 12)}\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n    {state.displaying == TABS.ALL_EXISTING_POLLS.id ? (\r\n      <div className=\"px-4\">\r\n        <h2 style={{ margin: \"2rem 0 0.5rem 0\", fontWeight: \"700\" }}>\r\n          All existing polls\r\n        </h2>\r\n        <Widget\r\n          src={`${widgetOwner}/widget/showQuestionsHandler`}\r\n          props={{ sharedBlockHeight }}\r\n        />\r\n      </div>\r\n    ) : state.displaying == TABS.MY_POLLS.id ? (\r\n      <div className=\"px-4\">\r\n        <h2 style={{ margin: \"2rem 0 0.5rem 0\", fontWeight: \"700\" }}>\r\n          My Polls\r\n        </h2>\r\n        <Widget\r\n          src={`${widgetOwner}/widget/showQuestionsHandler`}\r\n          props={{ sharedBlockHeight, onlyUser: true }}\r\n        />\r\n      </div>\r\n    ) : (\r\n      state.displaying == TABS.NEW_POLL.id && (\r\n        <div\r\n          className=\"px-4\"\r\n          style={{\r\n            backgroundColor: \"white\",\r\n            borderRadius: \"28px\",\r\n            margin: \"2rem auto 0 auto\",\r\n            width: \"60%\",\r\n          }}\r\n        >\r\n          <div style={{ position: \"relative\" }}>\r\n            <i\r\n              className=\"bi bi-x-lg\"\r\n              style={{\r\n                position: \"absolute\",\r\n                right: \"2rem\",\r\n                top: \"2rem\",\r\n                cursor: \"pointer\",\r\n              }}\r\n              onClick={abortPollCreation}\r\n            ></i>\r\n            <h2\r\n              style={{\r\n                padding: \"2rem\",\r\n                margin: \"2rem 0 0.5rem 0\",\r\n                fontWeight: \"700\",\r\n              }}\r\n            >\r\n              Create a poll\r\n            </h2>\r\n          </div>\r\n          <Widget src={`${widgetOwner}/widget/newPollQuestionInterface`} />\r\n          <button\r\n            onMouseEnter={() => {\r\n              State.update({\r\n                hoveringElement: HOVERING_ELEMENTS.CANCEL_NEW_POLL,\r\n              });\r\n            }}\r\n            onMouseLeave={() => {\r\n              State.update({ hoveringElement: \"\" });\r\n            }}\r\n            onClick={abortPollCreation}\r\n            style={\r\n              state.hoveringElement == HOVERING_ELEMENTS.CANCEL_NEW_POLL\r\n                ? {\r\n                    border: \"2px solid transparent\",\r\n                    fontWeight: \"500\",\r\n                    fontSize: \"1rem\",\r\n                    padding: \"0.3rem 1.5rem\",\r\n                    backgroundColor: \"#010A2D\",\r\n                    borderRadius: \"12px\",\r\n                    color: \"white\",\r\n                    transform: \"translateY(-2.3rem)\",\r\n                  }\r\n                : {\r\n                    border: \"2px solid black\",\r\n                    color: \"black\",\r\n                    backgroundColor: \"white\",\r\n                    fontWeight: \"500\",\r\n                    fontSize: \"1rem\",\r\n                    padding: \"0.3rem 1.5rem\",\r\n                    borderRadius: \"12px\",\r\n                    transform: \"translateY(-2.3rem)\",\r\n                  }\r\n            }\r\n          >\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      )\r\n    )}\r\n    {state.showAbortPollCreation && renderAbortPollCreationModal()}\r\n  </div>\r\n);\r\n/********** End rendering ************/\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/pollQuestionMasterHandler"}