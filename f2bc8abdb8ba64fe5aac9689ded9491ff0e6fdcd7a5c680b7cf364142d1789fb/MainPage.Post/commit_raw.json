{"tx_hash": "5wEvoMfvbKgiVz15L4fUktLLexyJ2BjCRoyQ4sMi2bt3", "action_id_social": "FZVvYptcR2sfYyD5u42XLGTpGdsAeVqeGVcqZjEk2XFS-0-widget", "block_id": 88041092, "block_timestamp": "2023-03-24 21:51:22.010", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "MainPage.Post", "source_code": "const updateGeneralState = props.updateGeneralState;\r\nconst thisWidgetInlineStyles = props.allWidgetsInlineStyles.mainPage_post;\r\nconst thisWidgetClassNames = props.allWidgetsClassNames.mainPage_post;\r\nconst standardButtonStyles = props.allWidgetsInlineStyles.standardButtonStyles;\r\nconst hoveringButtonStyles = props.allWidgetsInlineStyles.hoveringButtonStyles;\r\n\r\nconst content = props.content;\r\nconst accountId = content.accountId;\r\nconst blockHeight = parseInt(content.blockHeight);\r\n\r\nconst widgetOwner =\r\n  \"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb\";\r\n\r\nState.init({\r\n  displayCommentBox: false,\r\n  answer: \"\",\r\n  hoveringElement: \"\",\r\n});\r\n\r\nconst notifyAccountId = accountId;\r\nconst item = {\r\n  type: \"social\",\r\n  path: `${accountId}/post/main`,\r\n  blockHeight,\r\n};\r\n\r\nconst link = `#/mob.near/widget/MainPage.Post.Page?accountId=${accountId}&blockHeight=${blockHeight}`;\r\n\r\nconst startCommentTo = () => {\r\n  State.update({ displayCommentBox: !state.displayCommentBox });\r\n};\r\n\r\nconst RenderCommentInput = (blockHeight) => {\r\n  return state.displayCommentBox ? (\r\n    <div\r\n      style={thisWidgetInlineStyles.commentInput.container}\r\n      className={thisWidgetClassNames.commentInput.container}\r\n    >\r\n      <textarea\r\n        style={thisWidgetInlineStyles.commentInput.textArea}\r\n        rows=\"2\"\r\n        value={state.commentTextMap[blockHeight]}\r\n        onChange={(e) => {\r\n          State.update({ answer: e.target.value });\r\n        }}\r\n      />\r\n      <CommitButton\r\n        style={\r\n          state.hoveringElement == \"commitCommentButton\"\r\n            ? hoveringButtonStyles\r\n            : standardButtonStyles\r\n        }\r\n        data={{\r\n          index: {\r\n            kudo: JSON.stringify(\r\n              {\r\n                key: \"commentAnswers\",\r\n                value: {\r\n                  commentAnswer: state.answer,\r\n                  blockHeight,\r\n                },\r\n              },\r\n              undefined,\r\n              0\r\n            ),\r\n          },\r\n        }}\r\n        onCommit={() => {\r\n          let ctm = state.commentTextMap;\r\n          ctm[blockHeight] = \"\";\r\n          State.update({\r\n            commentTextMap: ctm,\r\n            reloadData: true,\r\n          });\r\n        }}\r\n        onMouseEnter={() => {\r\n          State.update({ hoveringElement: \"commitCommentButton\" });\r\n        }}\r\n        onMouseLeave={() => {\r\n          State.update({ hoveringElement: \"\" });\r\n        }}\r\n      >\r\n        Comment\r\n      </CommitButton>\r\n    </div>\r\n  ) : (\r\n    \"\"\r\n  );\r\n};\r\n\r\n/* START KudoBox */\r\nconst RenderKudoBox = (d) => {\r\n  const text = `From @${d.accountId} Kudos ${d.value.answer} `;\r\n  const content = { text };\r\n  return (\r\n    <>\r\n      <div style={thisWidgetInlineStyles.headerStyles}>\r\n        <Widget\r\n          src=\"mob.near/widget/MainPage.Post.Header\"\r\n          props={{\r\n            accountId,\r\n            blockHeight,\r\n            link,\r\n            postType: \"post\",\r\n            flagItem: item,\r\n          }}\r\n        />\r\n        <div style={thisWidgetInlineStyles.followButtonContainer}>\r\n          <Widget\r\n            src={`${widgetOwner}/widget/FollowButton`}\r\n            props={{ accountId: d.accountId }}\r\n          />\r\n        </div>\r\n      </div>\r\n      <div\r\n        className={thisWidgetClassNames.cardContent}\r\n        style={thisWidgetInlineStyles.cardContent}\r\n      >\r\n        <div style={thisWidgetInlineStyles.postContentContainer}>\r\n          <Widget\r\n            src=\"mob.near/widget/MainPage.Post.Content\"\r\n            props={{ content, raw }}\r\n          />\r\n        </div>\r\n        <a href={`${urlPrefix}${d.value.url}`} target=\"_blank\">\r\n          {d.value.url}\r\n        </a>\r\n        <div>\r\n          <Widget\r\n            src=\"mob.near/widget/CommentButton\"\r\n            props={{\r\n              onClick: startCommentTo,\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n      <div\r\n        style={thisWidgetInlineStyles.upVoteContainer}\r\n        className={thisWidgetClassNames.upVoteContainer}\r\n      >\r\n        <CommitButton\r\n          style={\r\n            state.hoveringElement == \"upVoteButton\"\r\n              ? hoveringButtonStyles\r\n              : standardButtonStyles\r\n          }\r\n          onMouseEnter={() => {\r\n            State.update({ hoveringElement: \"upVoteButton\" });\r\n          }}\r\n          onMouseLeave={() => {\r\n            State.update({ hoveringElement: \"\" });\r\n          }}\r\n          data={{\r\n            index: {\r\n              kudo: JSON.stringify(\r\n                {\r\n                  key: \"upvote\",\r\n                  value: {\r\n                    blockHeight: d.blockHeight,\r\n                  },\r\n                },\r\n                undefined,\r\n                0\r\n              ),\r\n            },\r\n          }}\r\n        >\r\n          Upvote\r\n        </CommitButton>\r\n        <span style={thisWidgetInlineStyles.upVoteCounter}>\r\n          {d.value.upvotes} {d.value.upvotes == 1 ? \"upvote\" : \"upvotes\"}\r\n        </span>\r\n      </div>\r\n      {RenderCommentInput(Number(d.blockHeight))}\r\n\r\n      {\r\n        //RenderAllCommentAnswerBox(d)\r\n      }\r\n    </>\r\n  );\r\n};\r\n/* END KudoBox  */\r\n\r\nreturn <>{RenderKudoBox(props.content)}</>;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/MainPage.Post"}