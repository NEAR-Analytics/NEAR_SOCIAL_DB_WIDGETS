{"tx_hash": "2aSjSzGspMf7Qs8Nace3WyBDYVPe5xfppG34Avr4TpXb", "action_id_social": "HYnCH2R7GcYiP66HKJ6N5Htr9xBhD5MuwHJHVDCHE47c-0-widget", "block_id": 89822598, "block_timestamp": "2023-04-17 22:51:35.630", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "MainPage.Post", "source_code": "const updateGeneralState = props.updateGeneralState;\r\nconst thisWidgetInlineStyles = props.allWidgetsInlineStyles.mainPage_post;\r\nconst thisWidgetClassNames = props.allWidgetsClassNames.mainPage_post;\r\nconst standardButtonStyles = props.allWidgetsInlineStyles.standardButtonStyles;\r\nconst hoveringButtonStyles = props.allWidgetsInlineStyles.hoveringButtonStyles;\r\n\r\nconst content = props.content;\r\nconst accountId = content.accountId;\r\nconst blockHeight = parseInt(content.blockHeight);\r\n\r\nconst widgetOwner = props.widgetOwner;\r\n\r\nState.init({\r\n  displayCommentBox: false,\r\n  answer: \"\",\r\n  hoveringElement: \"\",\r\n});\r\n\r\nlet item = {\r\n  type: \"social\",\r\n  path: `${accountId}/post/main`,\r\n  blockHeight,\r\n};\r\n\r\nconst reposts = Social.index(\"repost\", item);\r\n\r\nconst repostsByUsers = Object.fromEntries(\r\n  (reposts || [])\r\n    .filter((repost) => repost.value.type === \"repost\")\r\n    .map((repost) => [repost.accountId, repost])\r\n);\r\n\r\nif (state.hasRepost === true) {\r\n  repostsByUsers[context.accountId] = {\r\n    accountId: context.accountId,\r\n  };\r\n}\r\n\r\nconst hasRepost = context.accountId && !!repostsByUsers[context.accountId];\r\n\r\nconst repostSvg = (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    width=\"32\"\r\n    height=\"32\"\r\n    fill=\"currentColor\"\r\n    viewBox=\"0 0 24 24\"\r\n    style={thisWidgetInlineStyles.repostSvg}\r\n  >\r\n    <path\r\n      fill-rule=\"evenodd\"\r\n      d=\"M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z\"\r\n      transform=\"rotate(180, 12, 12), translate(0, 4)\"\r\n    />\r\n    <path\r\n      fill-rule=\"evenodd\"\r\n      d=\"M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z\"\r\n      transform=\"translate(0, 4)\"\r\n    />\r\n  </svg>\r\n);\r\n\r\nconst notifyAccountId = accountId;\r\n\r\nconst link = `#/mob.near/widget/MainPage.Post.Page?accountId=${accountId}&blockHeight=${blockHeight}`;\r\n\r\nconst startCommentTo = () => {\r\n  State.update({ displayCommentBox: !state.displayCommentBox });\r\n};\r\n\r\nconst RenderCommentInput = (blockHeight) => {\r\n  return state.displayCommentBox ? (\r\n    <div\r\n      style={thisWidgetInlineStyles.commentInput.container}\r\n      className={thisWidgetClassNames.commentInput.container}\r\n    >\r\n      <textarea\r\n        style={thisWidgetInlineStyles.commentInput.textArea}\r\n        rows=\"2\"\r\n        value={state.commentTextMap[blockHeight]}\r\n        onChange={(e) => {\r\n          State.update({ answer: e.target.value });\r\n        }}\r\n      />\r\n      <CommitButton\r\n        style={\r\n          state.hoveringElement == \"commitCommentButton\"\r\n            ? hoveringButtonStyles\r\n            : standardButtonStyles\r\n        }\r\n        data={{\r\n          index: {\r\n            kudo: JSON.stringify(\r\n              {\r\n                key: \"commentAnswers\",\r\n                value: {\r\n                  commentAnswer: state.answer,\r\n                  blockHeight,\r\n                },\r\n              },\r\n              undefined,\r\n              0\r\n            ),\r\n          },\r\n        }}\r\n        onCommit={() => {\r\n          let ctm = state.commentTextMap;\r\n          ctm[blockHeight] = \"\";\r\n          State.update({\r\n            commentTextMap: ctm,\r\n            reloadData: true,\r\n          });\r\n        }}\r\n        onMouseEnter={() => {\r\n          State.update({ hoveringElement: \"commitCommentButton\" });\r\n        }}\r\n        onMouseLeave={() => {\r\n          State.update({ hoveringElement: \"\" });\r\n        }}\r\n      >\r\n        Comment\r\n      </CommitButton>\r\n    </div>\r\n  ) : (\r\n    \"\"\r\n  );\r\n};\r\n\r\n/* START KudoBox */\r\nconst RenderKudoBox = (d) => {\r\n  const text = `From @${d.accountId} Kudos ${d.value.answer} `;\r\n  const content = { text };\r\n  return (\r\n    <>\r\n      <div className={thisWidgetClassNames.headerContainer}>\r\n        <Widget\r\n          src={`${widgetOwner}/widget/MainPage.Post.Header`}\r\n          props={{\r\n            widgetOwner,\r\n            accountId,\r\n            blockHeight: d.blockHeight,\r\n            link,\r\n            postType: \"post\",\r\n            flagItem: item,\r\n          }}\r\n        />\r\n        <div>{/*Decorative div, do not delete*/}</div>\r\n      </div>\r\n      <div\r\n        className={thisWidgetClassNames.cardContent}\r\n        style={thisWidgetInlineStyles.cardContent}\r\n      >\r\n        <div style={thisWidgetInlineStyles.postContentContainer}>\r\n          <Widget\r\n            src=\"mob.near/widget/MainPage.Post.Content\"\r\n            props={{ content, raw }}\r\n          />\r\n        </div>\r\n      </div>\r\n      {d.value.url != \"\" && d.value.url && (\r\n        <div\r\n          style={thisWidgetInlineStyles.postUrl}\r\n          className={thisWidgetClassNames.postUrl}\r\n        >\r\n          <span style={thisWidgetInlineStyles.postUrlSpan}>Url:</span>\r\n          <a href={`${urlPrefix}${d.value.url}`} target=\"_blank\">\r\n            {d.value.url}\r\n          </a>\r\n        </div>\r\n      )}\r\n      <div\r\n        style={thisWidgetInlineStyles.interactionButtonsContainer}\r\n        className={thisWidgetClassNames.interactionButtonsContainer}\r\n      >\r\n        <Widget\r\n          src=\"mob.near/widget/CommentButton\"\r\n          props={{\r\n            onClick: startCommentTo,\r\n          }}\r\n        />\r\n\r\n        <CommitButton\r\n          style={\r\n            state.hoveringElement == \"repostButton\"\r\n              ? thisWidgetInlineStyles.repostButtonHovering\r\n              : thisWidgetInlineStyles.repostButton\r\n          }\r\n          className={thisWidgetClassNames.repostButton}\r\n          onMouseEnter={() => {\r\n            State.update({ hoveringElement: \"repostButton\" });\r\n          }}\r\n          onMouseLeave={() => {\r\n            State.update({ hoveringElement: \"\" });\r\n          }}\r\n          data={{\r\n            index: {\r\n              repost: JSON.stringify(\r\n                {\r\n                  key: \"kudo\",\r\n                  value: {\r\n                    type: \"repost\",\r\n                    item: {\r\n                      type: \"social\",\r\n                      path: \"silkking.near/widget/Kudos\",\r\n                      blockHeight: d.blockHeight,\r\n                    },\r\n                  },\r\n                },\r\n                undefined,\r\n                0\r\n              ),\r\n            },\r\n          }}\r\n        >\r\n          <span style={hasRepost ? thisWidgetInlineStyles.repostSvgSpan : {}}>\r\n            {repostSvg}\r\n          </span>\r\n        </CommitButton>\r\n        <div className={thisWidgetClassNames.upVoteContainer}>\r\n          <CommitButton\r\n            style={\r\n              state.hoveringElement == \"upVoteButton\"\r\n                ? hoveringButtonStylesWithoutMargin\r\n                : standardButtonStylesWithoutMargin\r\n            }\r\n            onMouseEnter={() => {\r\n              State.update({ hoveringElement: \"upVoteButton\" });\r\n            }}\r\n            onMouseLeave={() => {\r\n              State.update({ hoveringElement: \"\" });\r\n            }}\r\n            data={{\r\n              index: {\r\n                kudo: JSON.stringify(\r\n                  {\r\n                    key: \"upvote\",\r\n                    value: {\r\n                      blockHeight: d.blockHeight,\r\n                    },\r\n                  },\r\n                  undefined,\r\n                  0\r\n                ),\r\n              },\r\n            }}\r\n          >\r\n            Upvote\r\n          </CommitButton>\r\n          <span style={thisWidgetInlineStyles.upVoteCounter}>\r\n            {d.value.upvotes} {d.value.upvotes == 1 ? \"upvote\" : \"upvotes\"}\r\n          </span>\r\n        </div>\r\n        <Widget\r\n          src=\"https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/shareWidget\"\r\n          props={{\r\n            popUpDescription: \"Use this link to share the kudo\",\r\n            shareingWidget: \"Kudos.Styles\",\r\n            propName: \"sharedBlockHeight\",\r\n            blockHeight: d.blockHeight,\r\n            widgetOwner,\r\n          }}\r\n        />\r\n      </div>\r\n      {RenderCommentInput(Number(d.blockHeight))}\r\n    </>\r\n  );\r\n};\r\n/* END KudoBox  */\r\n\r\nreturn <>{RenderKudoBox(content)}</>;\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/MainPage.Post"}