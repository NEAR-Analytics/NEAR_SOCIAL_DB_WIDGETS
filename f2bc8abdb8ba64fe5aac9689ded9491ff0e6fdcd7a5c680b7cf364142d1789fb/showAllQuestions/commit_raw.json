{"tx_hash": "AC9jCnhFqnqN9PXVTztBLxyzSohcmeMUW4vitFDSwUtY", "action_id_social": "4aDK8egWDGK7REG82eYmHucphqXZFs5f1pkkT7N1S1V6-0-widget", "block_id": 78180016, "block_timestamp": "2022-11-11 04:28:51.463", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "showAllQuestions", "source_code": "const accountId = props.accountId ?? \"*\";\r\n\r\nconst data = Social.keys(`${accountId}/post/poll_question`, \"final\", {\r\n  return_type: \"History\",\r\n});\r\n\r\nconsole.log(data);\r\n\r\nif (!data) {\r\n  return \"Loading\";\r\n}\r\n\r\nconst processData = (data) => {\r\n  const accounts = Object.entries(data);\r\n\r\n  const allQuestions = accounts\r\n    .map((account) => {\r\n      const accountId = account[0];\r\n      const blockHeights = account[1].post.poll_question;\r\n      return blockHeights.map((blockHeight) => ({\r\n        accountId,\r\n        blockHeight,\r\n      }));\r\n    })\r\n    .flat();\r\n\r\n  allQuestions.sort((a, b) => b.blockHeight - a.blockHeight);\r\n  return allQuestions;\r\n};\r\n\r\n// console.log(processData(data));\r\n\r\nconst questionToWidget = (a) => {\r\n  //   {\r\n  //     console.log(a);\r\n  //   }\r\n  return (\r\n    <div key={JSON.stringify(a)} style={{ minHeight: \"200px\" }}>\r\n      <a\r\n        className=\"text-decoration-none\"\r\n        //Check how href is done in memes widget of mob.near\r\n        href={`#`}\r\n      >\r\n        <Widget\r\n          src=\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/AddMeme\"\r\n          props={a}\r\n        />\r\n      </a>\r\n    </div>\r\n  );\r\n};\r\n\r\nState.init({\r\n  widgets: [],\r\n});\r\n\r\nif (JSON.stringify(data) !== JSON.stringify(state.data || {})) {\r\n  State.update({\r\n    data,\r\n    allQuestions: processData(data),\r\n  });\r\n}\r\n\r\nconst makeMoreQuestions = () => {\r\n  const newQuestions = state.allQuestions\r\n    .slice(state.widgets.length, state.widgets.length + 10)\r\n    .map(questionToWidget);\r\n  newQuestions.forEach((question) => state.widgets.push(question));\r\n  State.update();\r\n};\r\n\r\nreturn (\r\n  <div\r\n    className=\"px-2 mx-auto\"\r\n    style={{ background: \"#fff\", maxWidth: \"42em\" }}\r\n  >\r\n    {context.accountId && (\r\n      <Widget src=\"f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/PollQuestion\" />\r\n    )}\r\n\r\n    <InfiniteScroll\r\n      pageStart={0}\r\n      loadMore={makeMoreQuestions}\r\n      hasMore={state.widgets.length < state.allQuestions.length}\r\n      loader={<div className=\"loader\">Loading ...</div>}\r\n    >\r\n      {state.widgets}\r\n    </InfiniteScroll>\r\n  </div>\r\n);\r\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/showAllQuestions", "metadata.name": "Show all poll_questions", "metadata": NaN}