{"tx_hash": "5prj5bNKgKxjZAPLmQyBjQK43qiWEkVVxNPttUJSC8pt", "action_id_social": "6GVaucCygfnNnDFBDFBr2GizD6haENAsYWVUmxffohz4-0-widget", "block_id": 84374637, "block_timestamp": "2023-02-02 20:07:33.773", "signer_id": "f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb", "widget_name": "IndexFeed", "source_code": "const index = props.index;\r\nif (!index) {\r\n  return \"props.index is not defined\";\r\n}\r\nconsole.log(\"index: \", index);\r\n\r\nconst renderItem = props.renderItem ?? ((i) => JSON.stringify(i));\r\nindex.options = index.options || {};\r\nindex.options.limit = Math.min(index.options.limit, 100);\r\n\r\nconst initialItems = Social.index(index.action, index.key, index.options);\r\nif (initialItems === null) {\r\n  return \"\";\r\n}\r\n\r\nconst computeFetchFrom = (items) => {\r\n  if (!items || items.length === 0) {\r\n    return false;\r\n  }\r\n  const blockHeight = items[items.length - 1].blockHeight;\r\n  return index.options.order === \"desc\" ? blockHeight - 1 : blockHeight + 1;\r\n};\r\n\r\nconst jInitialItems = JSON.stringify(initialItems);\r\nif (state.jInitialItems !== jInitialItems) {\r\n  const jIndex = JSON.stringify(index);\r\n  if (jIndex !== state.jIndex) {\r\n    State.update({\r\n      jIndex,\r\n      jInitialItems,\r\n      initialItems,\r\n      items: [],\r\n      fetchFrom: false,\r\n      nextFetchFrom: computeFetchFrom(initialItems),\r\n    });\r\n  } else {\r\n    State.update({\r\n      initialItems,\r\n      jInitialItems,\r\n    });\r\n  }\r\n}\r\n\r\nif (state.fetchFrom) {\r\n  const newItems = Social.index(\r\n    index.action,\r\n    index.key,\r\n    Object.assign({}, index.options, {\r\n      from: state.fetchFrom,\r\n      subscribe: undefined,\r\n    })\r\n  );\r\n  if (newItems !== null) {\r\n    state.items.push(...newItems);\r\n    State.update({\r\n      fetchFrom: false,\r\n      nextFetchFrom: computeFetchFrom(newItems),\r\n    });\r\n  }\r\n}\r\n\r\nconst makeMoreItems = () => {\r\n  if (state.nextFetchFrom && state.nextFetchFrom !== state.fetchFrom) {\r\n    State.update({\r\n      fetchFrom: state.nextFetchFrom,\r\n    });\r\n  }\r\n};\r\n\r\nreturn (\r\n  <InfiniteScroll\r\n    pageStart={0}\r\n    loadMore={makeMoreItems}\r\n    hasMore={!!state.nextFetchFrom}\r\n    loader={\r\n      <div className=\"loader\">\r\n        <span\r\n          className=\"spinner-grow spinner-grow-sm me-1\"\r\n          role=\"status\"\r\n          aria-hidden=\"true\"\r\n        />\r\n        Loading ...\r\n      </div>\r\n    }\r\n  >\r\n    {state.initialItems &&\r\n      [...state.initialItems, ...state.items].map(renderItem)}\r\n  </InfiniteScroll>\r\n);\r\n", "metadata": NaN, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/f2bc8abdb8ba64fe5aac9689ded9491ff0e6fdcd7a5c680b7cf364142d1789fb/widget/IndexFeed", "branch.draft.": NaN, "branch.draft.metadata": NaN, "metadata.description": NaN, "metadata.name": NaN, "metadata.tags.feed": NaN, "metadata.tags.index": NaN, "metadata.tags.template": NaN, "metadata.image.ipfs_cid": NaN}