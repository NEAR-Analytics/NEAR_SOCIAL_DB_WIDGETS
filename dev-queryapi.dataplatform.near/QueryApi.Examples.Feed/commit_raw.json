{"tx_hash": "9BRdkGLv3JSembW9wF1C33FmZQfnDX6y5egASDmqpwZ", "action_id_social": "Htnk2bcHrdZmiSuJiYzbcZ2VVbyCNPDtwK1PQJMqZM3D-0-widget", "block_id": 93062572, "block_timestamp": "2023-05-30T14:15:24.602Z", "signer_id": "dev-queryapi.dataplatform.near", "widget_name": "QueryApi.Examples.Feed", "source_code": "\nconst GRAPHQL_ENDPOINT =\n  \"https://queryapi-hasura-graphql-24ktefolwq-ew.a.run.app\";\nconst APP_OWNER = \"dev-queryapi.dataplatform.near\";\nconst LIMIT = 10;\nconst option = props.postsOrderOption ?? \"blockHeight\";\n\nState.init({\n  posts: [],\n  postsCount: 0,\n});\n\nconst Subheading = styled.h2`\n  display: block;\n  margin: 0;\n  font-size: 14px;\n  line-height: 10px;\n  color: ${(p) => (p.bold ? \"#11181C !important\" : \"#687076 !important\")};\n  font-weight: ${(p) => (p.bold ? \"600\" : \"400\")};\n  font-size: ${(p) => (p.small ? \"12px\" : \"14px\")};\n  overflow: ${(p) => (p.ellipsis ? \"hidden\" : \"visible\")};\n  text-overflow: ${(p) => (p.ellipsis ? \"ellipsis\" : \"unset\")};\n  white-space: nowrap;\n  outline: none;\n`;\n\nlet querySortFilter = \"\";\nswitch (option) {\n  case \"recentComments\":\n    querySortFilter = `{ last_comment_timestamp: desc_nulls_last },`;\n    break;\n  // More options...\n  default:\n    querySortFilter = \"\";\n}\n\nconst indexerQueries = `\n  query GetPostsQuery($offset: Int) {\n  roshaan_near_feed_indexer_posts(order_by: [${querySortFilter} { block_height: desc }], offset: $offset, limit: ${LIMIT}) {\n    account_id\n    block_height\n    block_timestamp\n    content\n    receipt_id\n    accounts_liked\n    last_comment_timestamp\n    comments(order_by: {block_height: asc}) {\n      account_id\n      block_height\n      block_timestamp\n      content\n    }\n  }\n  roshaan_near_feed_indexer_posts_aggregate {\n    aggregate {\n      count\n    }\n  }\n}\n`;\n\nfunction fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(\n    `${GRAPHQL_ENDPOINT}/v1/graphql`,\n    {\n      method: \"POST\",\n      headers: { \"x-hasura-role\": \"roshaan_near\" },\n      body: JSON.stringify({\n        query: operationsDoc,\n        variables: variables,\n        operationName: operationName,\n      }),\n    }\n  );\n}\n\nconst Post = styled.div`\n  border-bottom: 1px solid #ECEEF0;\n  padding: 24px 0 12px;\n\n  @media (max-width: 1200px) {\n    padding: 12px 0 0;\n  }\n`;\n\nconst renderItem = (item, i) => {\n  if (item.accounts_liked.length !== 0) {\n    item.accounts_liked = JSON.parse(item.accounts_liked);\n  }\n  return (\n    <Post className=\"post\" key={item.block_height + \"_\" + item.account_id}>\n      <Widget\n        src={`${APP_OWNER}/widget/QueryApi.Examples.Feed.Post`}\n        props={{\n          accountId: item.account_id,\n          blockHeight: item.block_height,\n          content: item.content,\n          comments: item.comments,\n          likes: item.accounts_liked,\n        }}\n      />\n    </Post>\n  );\n};\n\nconst loadMorePosts = () => {\n  fetchGraphQL(indexerQueries, \"GetPostsQuery\", {\n    offset: state.posts.length,\n  }).then((result) => {\n    if (result.status === 200) {\n      let data = result.body.data;\n      if (data) {\n        const newPosts = data.roshaan_near_feed_indexer_posts;\n        console.log(newPosts);\n        const postsCount =\n          data.roshaan_near_feed_indexer_posts_aggregate.aggregate.count;\n        if (newPosts.length > 0) {\n          State.update({\n            posts: [...state.posts, ...newPosts],\n            postsCount: postsCount,\n          });\n        }\n      }\n    }\n  });\n};\n\nconst renderedItems = state.posts.map(renderItem);\nreturn (\n  <InfiniteScroll\n    pageStart={0}\n    loadMore={loadMorePosts}\n    hasMore={state.posts.length < state.postsCount || state.posts.length == 0}\n    loader={\n      <div className=\"loader\">\n        <span\n          className=\"spinner-grow spinner-grow-sm me-1\"\n          role=\"status\"\n          aria-hidden=\"true\"\n        />\n        Loading ...\n      </div>\n    }\n  >\n    {renderedItems}\n  </InfiniteScroll>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/dev-queryapi.dataplatform.near/widget/QueryApi.Examples.Feed", "__row_index": 1}