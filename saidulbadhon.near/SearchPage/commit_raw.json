{"tx_hash": "3gdQhjUSGDq9n8r9nzTcR5WALiw6PYyjCMz1oWQTU9jJ", "action_id_social": "EmiFk5K62Rcwb44Ci4UnUgizppX7p9xQXXDh1sgbJ65L-0-widget", "block_id": 88806417, "block_timestamp": "2023-04-04 14:31:46.335", "signer_id": "saidulbadhon.near", "widget_name": "SearchPage", "source_code": "const limitPerPage = 21;\r\nlet components = [];\r\nlet totalComponents = 0;\r\nconst componentsUrl = \"/#/adminalpha.near/widget/ComponentsPage\";\r\n\r\nState.init({\r\n  currentPage: 0,\r\n  selectedTab: props.tab || \"all\",\r\n});\r\n\r\nif (props.tab && props.tab !== state.selectedTab) {\r\n  State.update({\r\n    selectedTab: props.tab,\r\n  });\r\n}\r\n\r\nconst tagsData = Social.get(\"*/widget/*/metadata/tags/*\", \"final\");\r\n\r\nconst data = Social.keys(\"*/widget/*\", \"final\", {\r\n  return_type: \"BlockHeight\",\r\n});\r\n\r\nif (data) {\r\n  const result = [];\r\n\r\n  Object.keys(data).forEach((accountId) => {\r\n    return Object.keys(data[accountId].widget).forEach((widgetName) => {\r\n      totalComponents++;\r\n\r\n      if (state.selectedTab === \"apps\") {\r\n        const hasAppTag =\r\n          tagsData[accountId].widget[widgetName]?.metadata?.tags[\"app\"] === \"\";\r\n        if (!hasAppTag) return;\r\n      }\r\n\r\n      result.push({\r\n        accountId,\r\n        widgetName,\r\n        blockHeight: data[accountId].widget[widgetName],\r\n      });\r\n    });\r\n  });\r\n\r\n  result.sort((a, b) => b.blockHeight - a.blockHeight);\r\n  components = result.slice(0, state.currentPage * limitPerPage + limitPerPage);\r\n}\r\n\r\nfunction onSearchChange({ result, term }) {\r\n  console.log(result, term);\r\n  if (term.trim()) {\r\n    State.update({ searchResults: result || [] });\r\n  } else {\r\n    State.update({ searchResults: null });\r\n  }\r\n}\r\nconst items = state.searchResults || components;\r\n\r\nreturn (\r\n  <div\r\n    style={{\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      alignItems: \"flex-start\",\r\n      gap: 4,\r\n      width: \"100%\",\r\n    }}\r\n  >\r\n    <div\r\n      style={{\r\n        padding: \"4px 8px\",\r\n        gap: 8,\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n      }}\r\n    >\r\n      <p\r\n        style={{\r\n          color: props.theme.textColor2,\r\n          fontWeight: 400,\r\n          padding: 0,\r\n          margin: 0,\r\n          fontSize: 14,\r\n        }}\r\n      >\r\n        Discover the latest widgets from the NEAR community.\r\n      </p>\r\n\r\n      <div style={{ width: \"100%\" }}>\r\n        <Widget\r\n          src=\"saidulbadhon.near/widget/SearchPage.Searchbar\"\r\n          props={{\r\n            limit: 21,\r\n            onChange: onSearchChange,\r\n            theme: props.theme,\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <div\r\n      style={{\r\n        width: \"100%\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n      }}\r\n    >\r\n      {items.length > 0 &&\r\n        items?.map((component, index) => (\r\n          <div key={index}>\r\n            <Widget\r\n              src=\"saidulbadhon.near/widget/SearchPage.ComponentItem\"\r\n              props={{\r\n                src: `${component.accountId}/widget/${component.widgetName}`,\r\n                blockHeight: component.blockHeight,\r\n                theme: props.theme,\r\n              }}\r\n            />\r\n          </div>\r\n        ))}\r\n    </div>\r\n  </div>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/saidulbadhon.near/widget/SearchPage"}