{"tx_hash": "8Cd1CpFhFYegxJ4DJwuAgTnpxZbhsrRGxg8zeqyYU5SU", "action_id_social": "3DLnNQn2rb3QPqoKX3zwf5ehQQfNV4c4QJnSrknMh2Qu-0-widget", "block_id": 91170121, "block_timestamp": "2023-05-05T18:07:43.805Z", "signer_id": "bos-dev.near", "widget_name": "Tetris", "source_code": "const srcCode = `\n\n<div class=\"canvas_wrap\">\n\t<canvas id=\"tetris\" width=\"240\" height=\"400\"></canvas>\n\t<button type=\"button\" id=\"start_game\">Start</button>\n</div>\n\n<style>\nbody {\n  background-color: black;\n  background-image: radial-gradient(\n    rgba(0, 150, 0, 0.75), black 120%\n  );\n  height: 100vh;\n\n}\n*{\n\tmargin:0;\n\tpadding:0;\n}\n.canvas_wrap{\n\tdisplay:block;\n\tmargin:0 auto;\n\tpadding-top:25px;\n}\n.canvas_wrap>*{\n\tdisplay:block;\n\tmargin:0 auto;\n}\n.canvas_wrap>button{\n\tfont-family:Inconsolata, monospace;\n\tfont-size:22px;\n\tcolor:#000000\n\tbackground-color:black;\n\tborder:none;\n\tcursor:pointer;\n\ttransition-duration: .5s;\n\tborder-radius: 12px;\n\tpadding: 5px 12px;\n\tmargin-top: 5px;\n\tmargin-bottom: 10px;\n}\n\n.canvas_wrap>button:hover {\n  background-color: black;\n  color: white;\n}\n\n}\n</style>\n\n<script>\n\n(function(){\n\t\"use strict\";\n\tconst canvas=document.getElementById(\"tetris\");\n\tconst context=canvas.getContext(\"2d\");\n\tcontext.scale(20,20);\n\tlet makeMatrix=function(w,h){\n\t\tconst matrix=[];\n\t\twhile(h--){\n\t\t\tmatrix.push(new Array(w).fill(0));\n\t\t}\n\t\treturn matrix;\n\t};\n\tlet makePiece=function(type){\n\t\tif(type===\"t\"){\n\t\t\treturn [\n\t\t\t\t[0,0,0],\n\t\t\t\t[5,5,5],\n\t\t\t\t[0,5,0]\n\t\t\t];\n\t\t}\n\t\telse if(type===\"o\"){\n\t\t\treturn [\n\t\t\t\t[7,7],\n\t\t\t\t[7,7]\n\t\t\t];\n\t\t}\n\t\telse if(type===\"l\"){\n\t\t\treturn [\n\t\t\t\t[0,4,0],\n\t\t\t\t[0,4,0],\n\t\t\t\t[0,4,4]\n\t\t\t];\n\t\t}\n\t\telse if(type===\"j\"){\n\t\t\treturn [\n\t\t\t\t[0,1,0],\n\t\t\t\t[0,1,0],\n\t\t\t\t[1,1,0]\n\t\t\t];\n\t\t}\n\t\telse if(type===\"i\"){\n\t\t\treturn [\n\t\t\t\t[0,2,0,0],\n\t\t\t\t[0,2,0,0],\n\t\t\t\t[0,2,0,0],\n\t\t\t\t[0,2,0,0]\n\t\t\t];\n\t\t}\n\t\telse if(type===\"s\"){\n\t\t\treturn [\n\t\t\t\t[0,3,3],\n\t\t\t\t[3,3,0],\n\t\t\t\t[0,0,0]\n\t\t\t];\n\t\t}\n\t\telse if(type===\"z\"){\n\t\t\treturn [\n\t\t\t\t[6,6,0],\n\t\t\t\t[0,6,6],\n\t\t\t\t[0,0,0]\n\t\t\t];\n\t\t}\n\t};\n\tlet points=function(){\n\t\tlet rowCount=1;\n\t\touter:for(let y=area.length-1;y>0;--y){\n\t\t\tfor(let x=0;x<area[y].length;++x){\n\t\t\t\tif(area[y][x]===0){\n\t\t\t\t\tcontinue outer;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst row=area.splice(y,1)[0].fill(0);\n\t\t\tarea.unshift(row);\n\t\t\t++y;\n\t\t\tplayer.score+=rowCount*100;\n\t\t\trowCount*=2;\n\t\t}\n\t}\n\tlet collide=function(area,player){\n\t\tconst [m,o]=[player.matrix,player.pos];\n\t\tfor(let y=0;y<m.length;++y){\n\t\t\tfor(let x=0;x<m[y].length;++x){\n\t\t\t\tif(m[y][x]!==0&&(area[y+o.y]&&area[y+o.y][x+o.x])!==0){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t};\n\tlet drawMatrix=function(matrix,offset){\n\t\tmatrix.forEach((row,y)=>{\n\t\t\trow.forEach((value,x)=>{\n\t\t\t\tif(value!==0){\n\t\t\t\t\t// context.fillStyle=colors[value];\n\t\t\t\t\t// context.fillRect(x+offset.x,y+offset.y,1,1);\n\t\t\t\t\tlet imgTag=document.createElement(\"IMG\");\n\t\t\t\t\timgTag.src=colors[value];\n\t\t\t\t\tcontext.drawImage(imgTag,x+offset.x,y+offset.y,1,1);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\tlet merge=function(area,player){\n\t\tplayer.matrix.forEach((row,y)=>{\n\t\t\trow.forEach((value,x)=>{\n\t\t\t\tif(value!==0){\n\t\t\t\t\tarea[y+player.pos.y][x+player.pos.x]=value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\tlet rotate=function(matrix,dir){\n\t\tfor(let y=0;y<matrix.length;++y){\n\t\t\tfor(let x=0;x<y;++x){\n\t\t\t\t[\n\t\t\t\t\tmatrix[x][y],\n\t\t\t\t\tmatrix[y][x]\n\t\t\t\t]=[\n\t\t\t\t\tmatrix[y][x],\n\t\t\t\t\tmatrix[x][y],\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t\tif(dir>0){\n\t\t\tmatrix.forEach(row=>row.reverse());\n\t\t}\n\t\telse{\n\t\t\tmatrix.reverse();\n\t\t}\n\t};\n\tlet playerReset=function(){\n\t\tconst pieces=\"ijlostz\";\n\t\tplayer.matrix=makePiece(pieces[Math.floor(Math.random()*pieces.length)]);\n\t\tplayer.pos.y=0;\n\t\tplayer.pos.x=(Math.floor(area[0].length/2))-(Math.floor(player.matrix[0].length/2));\n\t\tif(collide(area,player)){\n\t\t\tarea.forEach(row=>row.fill(0));\n\t\t\tplayer.score=0;\n\t\t\tgameRun=false;\n\t\t}\n\t};\n\tlet playerDrop=function(){\n\t\tplayer.pos.y++;\n\t\tif(collide(area,player)){\n\t\t\tplayer.pos.y--;\n\t\t\tmerge(area,player);\n\t\t\tpoints();\n\t\t\tplayerReset();\n\t\t\tupdateScore();\n\t\t}\n\t};\n\tlet playerMove=function(dir){\n\t\tplayer.pos.x+=dir;\n\t\tif(collide(area,player)){\n\t\t\tplayer.pos.x-=dir;\n\t\t}\n\t};\n\tlet playerRotate=function(dir){\n\t\tconst pos=player.pos.x;\n\t\tlet offset=1;\n\t\trotate(player.matrix,dir);\n\t\twhile(collide(area,player)){\n\t\t\tplayer.pos.x+=offset;\n\t\t\toffset=-(offset+(offset>0?1:-1));\n\t\t\tif(offset>player.matrix[0].length){\n\t\t\t\trotate(player.matrix,-dir);\n\t\t\t\tplayer.pos.x=pos;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\tlet draw=function(){\n\t\tcontext.clearRect(0,0,canvas.width,canvas.height);\n\t\tcontext.fillStyle=\"#000000\";\n\t\tcontext.fillRect(0,0,canvas.width,canvas.height);\n\t\tupdateScore();\n\t\tdrawMatrix(area,{x:0,y:0});\n\t\tdrawMatrix(player.matrix,player.pos);\n\t};\n\tlet dropInter=100;\n\tlet time=0;\n\tlet update=function(){\n\t\ttime++;\n\t\tif(time>=dropInter){\n\t\t\tplayerDrop();\n\t\t\ttime=0;\n\t\t}\n\t\tdraw();\n\t};\n\tlet updateScore=function(){\n\t\tcontext.font=\"bold 1px Inconsolata, monospace\";\n\t\tcontext.fillStyle=\"#ffffff\";\n\t\tcontext.textAlign=\"left\";\n\t\tcontext.textBaseline=\"top\";\n\t\tcontext.fillText(player.score,0.2,0);\n\t};\n\tlet gameOver=function(){\n\t\tclearInterval(gameLoop);\n\t\tcontext.font=\"1.5px Inconsolata, monospace\";\n\t\tcontext.fillStyle=\"#ffffff\";\n\t\tcontext.textAlign=\"center\";\n\t\tcontext.textBaseline=\"middle\";\n\t\tcontext.fillText(\"game over\",(canvas.width/20)/2,(canvas.width/20)/2);\n\t\tcontext.font=\"4px Inconsolata, monospace\";\n\t\tcontext.fillText(\"\ud83d\ude22\",(canvas.width/20)/1.9,(canvas.width/20)/1);\n\t\tdocument.getElementById(\"start_game\").disabled=false;\n\t};\n\tconst colors=[\n\t\tnull,\n\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5/hPwAIAgL/4d1j8wAAAABJRU5ErkJggg==\",\n\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkuP//PwAFpALfeqlbzwAAAABJRU5ErkJggg==\",\n\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8fwHwAFLwIOh28W+gAAAABJRU5ErkJggg==\",\n\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mN0ecnwHwAE1AIuZgovtgAAAABJRU5ErkJggg==\",\n\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8v4rhPwAHAwKqSbSAoQAAAABJRU5ErkJggg==\",\n\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mN0Yvj/HwAEDwJCMmgnsgAAAABJRU5ErkJggg==\",\n\t\t\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOcxvD/PwAFXwKWLuL4TAAAAABJRU5ErkJggg==\"\n\t];\n\tconst area=makeMatrix(12,20);\n\tconst player={\n\t\tpos:{\n\t\t\tx:0,\n\t\t\ty:0\n\t\t},\n\t\tmatrix:null,\n\t\tscore:0\n\t};\n\tconst move=1;\n\tlet gameLoop;\n\tlet gameRun=false;\n\tplayerReset();\n\tdraw();\n\tgameOver();\n\tdocument.addEventListener('keydown',function(e){\n\t\tif(e.keyCode===37){\n\t\t\tplayerMove(-move);\n\t\t}\n\t\telse if(e.keyCode===39){\n\t\t\tplayerMove(+move);\n\t\t}\n\t\telse if(e.keyCode===40){\n\t\t\tconsole.log(player.pos);\n\t\t\tif(gameRun){\n\t\t\t\tplayerDrop();\n\t\t\t}\n\t\t}\n\t\telse if(e.keyCode===38){\n\t\t\tplayerRotate(-move);\n\t\t}\n\t});\n\tdocument.getElementById(\"start_game\").onclick=function(){\n\t\tgameRun=true;\n\t\tplayerReset();\n\t\tconsole.log(player.pos);\n\t\tgameLoop=setInterval(function(){\n\t\t\tif(gameRun){\n\t\t\t\tupdate();\n\t\t\t}\n\t\t\telse{\n\t\t\t\tgameOver();\n\t\t\t}\n\t\t},10);\n\t\tthis.disabled=true;\n\t};\n})();\n\n</script>\n\n`;\n\nreturn (\n  <>\n    <iframe\n      srcDoc={srcCode}\n      style={{\n        height: \"55vh\",\n        width: \"50%\",\n      }}\n    ></iframe>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/bos-dev.near/widget/Tetris", "__row_index": 2}