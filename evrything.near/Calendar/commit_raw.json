{"tx_hash": "DyoNanm9o9i5jJnNs9GEQ6KZxvmZCGfswxUEpp2ML9px", "action_id_social": "5bd14PW3uaTL3X3pytTKWnArL4dtqWcJHhV87RJ2JxZF-0-widget", "block_id": 89914807, "block_timestamp": "2023-04-19 04:06:03.490", "signer_id": "evrything.near", "widget_name": "Calendar", "source_code": "// CALENDAR FROM https://github.com/fullcalendar/fullcalendar/tree/main/bundle\n\nconst accountId = context.accountId;\n\n// Get Event data from thing\n\nconst index = {\n  action: \"everything\", // this could work as a sort of \"domain\"... ev02\n  key: \"main\",\n  options: {\n    order: \"desc\",\n    limit: 100,\n  },\n};\n\nconst type = \"evrything.near/type/Event\";\n\nconst initialItems = Social.index(index.action, index.key, index.options);\nif (initialItems === null) {\n  return <p>no events found</p>;\n}\nconst items = initialItems.filter((item) => item.value.type === type);\n\nconst events = items.map((it) => {\n  const accountId = it.accountId;\n  const blockHeight = parseInt(it.blockHeight);\n  const data = JSON.parse(\n    Social.get(`${accountId}/thing/main`, blockHeight) ?? \"null\"\n  );\n  if (data) {\n    return {\n      id: blockHeight,\n      source: accountId,\n      ...data.payload,\n      start: new Date(data.payload[\"startStr\"]),\n      end: new Date(data.payload[\"endStr\"]),\n    };\n  }\n});\n\nconsole.log(events);\n// events = [\n//   {\n//     id: \"89914147\",\n//     source: \"evrything.near\",\n\n//     allDay: true,\n//     startStr: \"2022-06-26T03:45:00.000Z\",\n//     endStr: \"2022-06-26T04:00:00.000Z\",\n//     title: \"first event :)\",\n//     url: \"https://everything.dev\",\n//   },\n// ];\n\nconst srcData = `\n<!DOCTYPE html>\n<html>\n  <head>\n    <script src='https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.js'></script>\n    <script>\n\n      document.addEventListener('DOMContentLoaded', function() {\n        const calendarEl = document.getElementById('calendar')\n        const calendar = new FullCalendar.Calendar(calendarEl, {\n          initialView: 'dayGridMonth',\n          editable: true,\n          customButtons: {\n            getEvents: {\n              text: 'load events',\n              click: () => window.top.postMessage({ score: \"hello\" }, \"*\")\n            }\n          },\n          headerToolbar: {\n            start: 'prev,next today', // will normally be on the left. if RTL, will be on the right\n            center: 'title',\n            end: 'dayGridMonth dayGridWeek dayGridDay list' // will normally be on the right. if RTL, will be on the left\n          },\n          navLinks: true,\n          events: ${JSON.stringify(events)}\n        })\n        calendar.render()\n      })\n    </script>\n  </head>\n  <body>\n    <div id='calendar'></div>\n  </body>\n</html>\n`;\n\nreturn (\n  <>\n    <iframe\n      srcDoc={srcData}\n      onMessage={(data) => {\n        console.log(data);\n      }}\n      style={{\n        height: \"80vh\",\n        width: \"100%\",\n      }}\n    />\n  </>\n);\n", "metadata": null, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/evrything.near/widget/Calendar", "branch.draft.": NaN, "branch.draft.metadata": NaN}