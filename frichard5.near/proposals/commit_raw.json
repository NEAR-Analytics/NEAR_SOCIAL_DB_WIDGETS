{"tx_hash": "42enpxg4UvMxp8Ud2nq756Zi4wGGvDMosXxND74brS2F", "action_id_social": "CU4zhT7JcSU4a6rZJLNq6LNbKQcnQUW6nzSPLDT67rbG-0-widget", "block_id": 89032615, "block_timestamp": "2023-04-07 13:32:44.405", "signer_id": "frichard5.near", "widget_name": "proposals", "source_code": "const widgetProvider = props.widgetProvider;\nconst account = props.account || \"marketing.sputnik-dao.near\";\nconst apiUrl = `https://api.pikespeak.ai/daos/proposals/${account}`;\nconst publicApiKey = \"36f2b87a-7ee6-40d8-80b9-5e68e587a5b5\";\n\nconst forgeUrl = (apiUrl, params) =>\n  apiUrl +\n  Object.keys(params).reduce(\n    (paramString, p) => paramString + `${p}=${params[p]}&`,\n    \"?\"\n  );\n\nconst ProposalContainer = styled.div`\n`;\n\nconst resPerPage = 10;\n\nState.init({\n  offset: 0,\n  lastProposalFetch: [],\n  proposals: [],\n  isLoading: false,\n  type: \"all\",\n});\n\nconst columns = [\n  {\n    id: \"submission_time\",\n    label: \"Submission time\",\n  },\n  {\n    id: \"proposal_id\",\n    label: \"Proposal Id\",\n  },\n  {\n    id: \"status\",\n    label: \"Status\",\n  },\n  {\n    id: \"proposal_type\",\n    label: \"type\",\n  },\n];\n\nconst nextPage = () => {\n  State.update({ offset: state.offset + resPerPage });\n};\n\nconst previousPage = () => {\n  State.update({ offset: state.offset - resPerPage });\n};\n\nconst GenericTable = (\n  <Widget\n    src={`${widgetProvider}/widget/generic_table`}\n    props={{\n      title: `${account} proposals`,\n      columns,\n      data: state.proposals,\n      nextPage,\n      previousPage,\n      offset: state.offset,\n      resPerPage,\n    }}\n  />\n);\n\nconst fetchProposal = (params) => {\n  const proposals = asyncFetch(forgeUrl(apiUrl, params), {\n    mode: \"cors\",\n    headers: {\n      \"x-api-key\": publicApiKey,\n    },\n  }).then(({ err, body, ok }) => {\n    if (ok) {\n      const allProposals = [...state.proposals, ...body];\n      State.update({\n        lastProposalFetch: body,\n        proposals: allProposals,\n        isLoading: false,\n      });\n    }\n  });\n};\n\nif (!state.proposals.length) {\n  fetchProposal({\n    limit: resPerPage,\n    offset: state.offset,\n    proposal_type: state.type,\n  });\n}\n\nconst fetchMore = () => {\n  if (!state.isLoading) {\n    State.update({ offset: state.offset + resPerPage, isLoading: true });\n    fetchProposal({ limit: resPerPage, offset: state.offset });\n  }\n};\n\nconst ProposalCards = [];\nconsole.log(\"state PROPOSALS\", state.proposals);\nstate.proposals.forEach((proposal) => {\n  ProposalCards.push(\n    <Widget\n      src={`${widgetProvider}/widget/NDC-proposal-card`}\n      props={{\n        proposal,\n      }}\n    />\n  );\n});\n\nconst selectType = (e) => {\n  State.update({ type: e.target.value, proposals: [] });\n  fetchProposal({\n    limit: resPerPage,\n    offset: state.offset,\n    proposal_type: state.type,\n  });\n};\nconsole.log(state.type);\nconst SelectType = (\n  <Widget\n    src={`${widgetProvider}/widget/NDC-select`}\n    props={{\n      options: [\n        { value: \"All\", label: \"All\" },\n        { value: \"Transfer\", label: \"Transfer\" },\n        { value: \"FunctionCall\", label: \"Function Call\" },\n        { value: \"AddBounty\", label: \"Add Bounty\" },\n      ],\n      selectedOption: state.type,\n      onChange: selectType,\n    }}\n  />\n);\n\nconst ProposalInfiniteScroll = (\n  <Widget\n    src={`${widgetProvider}/widget/proposals_scroll`}\n    props={{\n      cards: ProposalCards,\n      fetchMore: fetchMore,\n      hasMore: state.lastProposalFetch.length === resPerPage,\n    }}\n  />\n);\n\nreturn (\n  <ProposalContainer>\n    {SelectType}\n    {ProposalInfiniteScroll}\n  </ProposalContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/frichard5.near/widget/proposals"}