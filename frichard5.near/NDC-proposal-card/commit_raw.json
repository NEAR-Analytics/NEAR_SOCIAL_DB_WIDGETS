{"tx_hash": "Ca8zDoaQuqhoMhrQeoBNQUVjYKB7Php8kwEL77cfP7rZ", "action_id_social": "HKaSBYmWPan7iUpaV3o3CxBpURfLwyGWqfnUfpCrMnNU-0-widget", "block_id": 91593845, "block_timestamp": "2023-05-11T08:29:28.978Z", "signer_id": "frichard5.near", "widget_name": "NDC-proposal-card", "source_code": "const { proposal, council, ftList, widgetProvider, voteExpired } = props;\nconst userAccountId = context.accountId;\n\nState.init({\n  showClipboardTooltip: false,\n  canVote: council.includes(userAccountId),\n  displayComments: false,\n});\n\nconst formatCountdown = (seconds) => {\n  const d = Math.floor(seconds / (24 * 3600));\n  const h = Math.floor((seconds - d * 24 * 3600) / 3600);\n  const m = Math.floor((seconds - d * 24 * 3600 - h * 3600) / 60);\n  const s = Math.floor(seconds - d * 24 * 3600 - h * 3600 - m * 60);\n\n  let res = \"\";\n\n  if (d > 0) {\n    res += `${d}d `;\n  }\n\n  if (h > 0) {\n    res += `${h}h `;\n  }\n\n  if (m > 0) {\n    res += `${m}m `;\n  }\n\n  if (!res && s > 0 && s < 60) {\n    res = \"less than a minute\";\n  }\n\n  return res;\n};\n\nconst ProposalCard = styled.div`\n  position: relative;\n  height: 370px;\n  width: 80%;\n  margin: 50px auto;\n  box-shadow: 3px 2px 24px rgba(68, 152, 224, 0.3);\n  overflow: auto;\n  border-radius: 4px;\n  padding: 20px;\n  background: white;\n  svg {\n    height: 20px;\n    &.approved-icon {\n      fill:#13a36e;\n    }\n    &.rejected-icon {\n      fill: #ff5e03;\n    }\n    &.not-voted-yet-icon {\n      fill:  rgb(140, 140, 140)\n    }\n  }\n`;\n\nconst VoteList = styled.div`\n  display:flex;\n  flex-direction:column;\n`;\n\nconst VoteLine = styled.div`\n    display: flex;\n    justify-content: space-between;\n`;\n\nconst thumbUpSvg = (\n  <svg\n    class=\"approved-icon\"\n    focusable=\"false\"\n    aria-hidden=\"true\"\n    viewBox=\"0 0 24 24\"\n    data-testid=\"ThumbUpIcon\"\n  >\n    <path d=\"M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z\"></path>\n  </svg>\n);\nconst thumbDownSvg = (\n  <svg\n    class=\"rejected-icon\"\n    focusable=\"false\"\n    aria-hidden=\"true\"\n    viewBox=\"0 0 24 24\"\n    data-testid=\"ThumbDownIcon\"\n  >\n    <path d=\"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z\"></path>\n  </svg>\n);\nconst notVotedYetSvg = (\n  <svg\n    class=\"not-voted-yet-icon\"\n    focusable=\"false\"\n    aria-hidden=\"true\"\n    viewBox=\"0 0 24 24\"\n    data-testid=\"ThumbsUpDownIcon\"\n  >\n    <path d=\"M12 6c0-.55-.45-1-1-1H5.82l.66-3.18.02-.23c0-.31-.13-.59-.33-.8L5.38 0 .44 4.94C.17 5.21 0 5.59 0 6v6.5c0 .83.67 1.5 1.5 1.5h6.75c.62 0 1.15-.38 1.38-.91l2.26-5.29c.07-.17.11-.36.11-.55V6zm10.5 4h-6.75c-.62 0-1.15.38-1.38.91l-2.26 5.29c-.07.17-.11.36-.11.55V18c0 .55.45 1 1 1h5.18l-.66 3.18-.02.24c0 .31.13.59.33.8l.79.78 4.94-4.94c.27-.27.44-.65.44-1.06v-6.5c0-.83-.67-1.5-1.5-1.5z\"></path>\n  </svg>\n);\n\nconst clipboardSvg = (\n  <svg\n    class=\"MuiSvgIcon-root MuiSvgIcon-fontSizeMedium copy-icon css-vubbuv\"\n    focusable=\"false\"\n    aria-hidden=\"true\"\n    viewBox=\"0 0 24 24\"\n    data-testid=\"ContentCopyIcon\"\n    aria-label=\"Copied to clipboard!\"\n  >\n    <path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path>\n  </svg>\n);\n\nconst votes = proposal.proposal.votes;\n\nconst getVoteSvg = (vote) => {\n  switch (vote) {\n    case \"Reject\":\n    case \"Reject=0x1\":\n      return thumbDownSvg;\n    case \"Approve\":\n    case \"Approve=0x0\":\n      return thumbUpSvg;\n  }\n};\n\nconst parseDescription = (description) => {\n  const parsedDesc = description\n    .replaceAll(\"$$$$\", \" \")\n    .replaceAll(\"\\n\\n\", \" \");\n  const parts = parsedDesc.split(\" \");\n\n  const parsedParts = parts.map((p) => {\n    const url = p.match(/https:\\/\\/\\S*/g);\n    if (url) {\n      return (\n        <a href={p} target=\"_blank\">\n          {p}\n        </a>\n      );\n    }\n    return p + \" \";\n  });\n\n  return parsedParts;\n};\n\nconst voteList =\n  council && votes\n    ? council.map((member) => {\n        const hasVoted = Object.keys(votes)\n          .map((v) => v)\n          .includes(member);\n\n        return (\n          <VoteLine>\n            <a\n              href={`https://explorer.near.org/accounts/${member}`}\n              target=\"_blank\"\n            >\n              {member}\n            </a>\n            <span>\n              {hasVoted ? getVoteSvg(votes[member]) : notVotedYetSvg}{\" \"}\n            </span>\n          </VoteLine>\n        );\n      })\n    : \"\";\n\nconst Status = styled.div`\n  font-weight: 700;\n  color: ${(props) => {\n    switch (props.status) {\n      case \"Rejected\":\n        return \"#ff5e03\";\n      case \"Approved\":\n        return \"#13a36e\";\n      case \"Expired\":\n        return \"grey\";\n      case \"InProgress\":\n        return \"#ff8743\";\n    }\n  }}\n`;\n\nconst ProposalId = styled.div`\n  color:#8c8c8c;\n  font-size: 11px;\n`;\nconst Label = styled.span`\n  color:#8c8c8c;\n  font-size: 11px;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nconst InfoWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-bottom: 8px;\n`;\n\nconst Type = styled.div`\n  font-size: 22px;\n  font-weight: 700;\n  margin-bottom: 10px;\n`;\n\nconst PropInfos = styled.div`\n  float: right;\n  padding: 10px;\n  background: rgba(68, 152, 224, 0.1);\n  border-radius: 4px;\n`;\n\nconst VoteInfos = styled.div`\n  float: right;\n  padding: 10px;\n  background: rgba(68, 152, 224, 0.1);\n  border-radius: 4px;\n`;\n\nconst Description = styled.div`\n  overflow:auto;\n  max-height: 150px;\n`;\n\nlet TimeLeft = styled.span`\n    color: rgba(68, 152, 224);\n    margin-left: 10px;\n`;\n\nlet ClipboardButton = styled.button`\n  position: absolute;\n  width: 190px;\n  right: 20px;\n  display: flex;\n  justify-content: space-evenly;\n  align-items: center;\n  border-radius: 4px;\n`;\n\nconst getTimeLeft = (proposal) => {\n  if (proposal.status === \"InProgress\") {\n    const timeLeft = (Date.now() - new Date(proposal.submission_time)) / 1000;\n\n    const isTechnicallyExpired =\n      Math.floor(timeLeft / (24 * 3600)) >=\n      Math.floor(voteExpired / Math.pow(10, 9) / (24 * 3600));\n    if (!isTechnicallyExpired) {\n      return `${formatCountdown(timeLeft)}  left`;\n    } else {\n      return \"Time for vote expired.\";\n    }\n  }\n  return \"\";\n};\n\nfunction copy(proposal_id) {\n  const link = `https://near.social/#/${widgetProvider}/widget/NDC-Page?tab=proposal&proposal_id=${proposal_id}`;\n\n  return () => {\n    State.update({ showClipboardTooltip: true });\n    setTimeout(() => {\n      State.update({ showClipboardTooltip: false });\n    }, 1000);\n    clipboard.writeText(link);\n  };\n}\n\nconst VoteOnProposal = (\n  <Widget\n    src={`${widgetProvider}/widget/NDC-vote-on-proposal`}\n    props={{\n      account: state.selectedDao,\n      widgetProvider,\n      proposal_id: proposal.proposal_id,\n      daoId: proposal.dao_id,\n    }}\n  />\n);\n\nconst CommunityDiscussion = (\n  <Widget\n    src={`${widgetProvider}/widget/NDC-proposal-community-discussion`}\n    props={{\n      account: state.selectedDao,\n      widgetProvider,\n      proposal_id: proposal.proposal_id,\n      daoId: proposal.dao_id,\n    }}\n  />\n);\n/*<PropInfos>{CommunityDiscussion}</PropInfos>*/\nreturn (\n  <>\n    {proposal && council ? (\n      <ProposalCard>\n        <Header>\n          <Status status={proposal.status}>\n            {proposal.status} <TimeLeft>{getTimeLeft(proposal)}</TimeLeft>\n          </Status>\n          <ProposalId>\n            <div>Proposal Id {proposal.proposal_id}</div>\n            <OverlayTrigger\n              key={\"left\"}\n              placement={\"left\"}\n              overlay={\n                <Tooltip id={`tooltip`}>\n                  Proposal link added to clipboard.\n                </Tooltip>\n              }\n              show={state.showClipboardTooltip}\n            >\n              <ClipboardButton onClick={copy(proposal.proposal_id)}>\n                <span>Copy proposal link </span>\n                {clipboardSvg}\n              </ClipboardButton>\n            </OverlayTrigger>\n          </ProposalId>\n        </Header>\n        <Type>{proposal.proposal_type}</Type>\n        <PropInfos>\n          <InfoWrapper>\n            <Label>Proposer</Label>\n            <a\n              href={`https://explorer.near.org/accounts/${proposal.proposal.proposer}`}\n              target=\"_blank\"\n            >\n              {proposal.proposal.proposer}\n            </a>\n          </InfoWrapper>\n          <InfoWrapper>\n            <Label>Submission Time</Label>\n            <span>{new Date(proposal.submission_time).toLocaleString()}</span>\n          </InfoWrapper>\n          <InfoWrapper>\n            <Label>\n              Votes ({Object.keys(votes).length}/{council.length})\n            </Label>\n            <VoteList>{voteList}</VoteList>\n          </InfoWrapper>\n        </PropInfos>\n\n        <InfoWrapper>\n          <Label>Dao id</Label>\n          <a\n            href={`https://explorer.near.org/accounts/${proposal.dao_id}`}\n            target=\"_blank\"\n          >\n            {proposal.dao_id}\n          </a>\n        </InfoWrapper>\n        <InfoWrapper>\n          <Label>Description</Label>\n          <Description>\n            {parseDescription(proposal.proposal.description)}\n          </Description>\n        </InfoWrapper>\n        {proposal.proposal_type === \"Transfer\" ? (\n          <InfoWrapper>\n            <Label>Target</Label>\n            <div style={{ display: \"flex\" }}>\n              <Widget\n                src={`${widgetProvider}/widget/table_ft_formatter`}\n                props={{\n                  ftList,\n                  ft: proposal.proposal.kind.token_id,\n                  amount: proposal.proposal.kind.amount,\n                }}\n              />\n              <span style={{ marginLeft: \"5px\" }}>\n                to\n                <a\n                  href={`https://explorer.near.org/accounts/${proposal.proposal.kind.receiver_id}`}\n                  target=\"_blank\"\n                >\n                  {proposal.proposal.kind.receiver_id}\n                </a>\n              </span>\n            </div>\n          </InfoWrapper>\n        ) : (\n          \"\"\n        )}\n        {state.canVote && proposal.status === \"InProgress\" ? (\n          VoteOnProposal\n        ) : (\n          <Label>You don't have the permission to vote on proposals.</Label>\n        )}\n        <div>\n          <button\n            onClick={() =>\n              State.update({ displayComments: !state.displayComments })\n            }\n          >\n            Comments\n          </button>\n        </div>\n        {state.displayComments ? (\n          <Widget\n            src={`${widgetProvider}/widget/NDC-proposal-community-discussion`}\n            props={{\n              widgetProvider,\n              proposal_id: proposal.proposal_id,\n              displayComments: state.displayComments,\n            }}\n          />\n        ) : (\n          \"\"\n        )}\n      </ProposalCard>\n    ) : (\n      \"\"\n    )}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/frichard5.near/widget/NDC-proposal-card", "__row_index": 21}