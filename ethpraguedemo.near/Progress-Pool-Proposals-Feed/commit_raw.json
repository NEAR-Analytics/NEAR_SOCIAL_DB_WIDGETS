{"tx_hash": "5H5TS88xhRkMyxi4WtqhTauP3ieCSZDNjoN7PHVzSJnt", "action_id_social": "FXHM3TXWxxtS4bPeaUBAkGxdZXwUP73MrQrqXm9pwQLC-0-widget", "block_id": 93962964, "block_timestamp": "2023-06-11T12:01:31.575Z", "signer_id": "ethpraguedemo.near", "widget_name": "Progress-Pool-Proposals-Feed", "source_code": "if (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n}\n\nlet updateFlag = false;\nconst toggleUpdateFlag = () => {\n  if (state.pulled_proposals) {\n    updateFlag = !updateFlag;\n    console.log(\"rerender should happen \", state.pulled_proposals);\n  }\n};\n\nconst proposalContract = \"0x0C78c1c4D8bD0C79c2E22fB981fDc913922d66A3\";\n\nconst proposalAbi = [\n  {\n    inputs: [\n      {\n        internalType: \"address\",\n        name: \"_votingTokenAddress\",\n        type: \"address\",\n      },\n    ],\n    stateMutability: \"nonpayable\",\n    type: \"constructor\",\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: \"address\",\n        name: \"recipient\",\n        type: \"address\",\n      },\n      {\n        indexed: false,\n        internalType: \"string\",\n        name: \"message\",\n        type: \"string\",\n      },\n    ],\n    name: \"ProposalSubmitted\",\n    type: \"event\",\n  },\n  {\n    anonymous: false,\n    inputs: [\n      {\n        indexed: true,\n        internalType: \"address\",\n        name: \"sender\",\n        type: \"address\",\n      },\n      {\n        indexed: true,\n        internalType: \"address\",\n        name: \"proposalOwner\",\n        type: \"address\",\n      },\n      {\n        indexed: false,\n        internalType: \"uint8\",\n        name: \"accept\",\n        type: \"uint8\",\n      },\n    ],\n    name: \"VoteCasted\",\n    type: \"event\",\n  },\n  {\n    inputs: [],\n    name: \"SUBMISSION_PERIOD\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"TRANSITION_PERIOD\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"VOTING_PERIOD\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        components: [\n          {\n            internalType: \"uint256\",\n            name: \"proposalIndex\",\n            type: \"uint256\",\n          },\n          {\n            internalType: \"uint8\",\n            name: \"decision\",\n            type: \"uint8\",\n          },\n        ],\n        internalType: \"struct ProposalVoting.Vote[]\",\n        name: \"_votes\",\n        type: \"tuple[]\",\n      },\n    ],\n    name: \"castVote\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"castedVotes\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"hackathonEndTime\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    name: \"proposals\",\n    outputs: [\n      {\n        internalType: \"string\",\n        name: \"description\",\n        type: \"string\",\n      },\n      {\n        internalType: \"address\",\n        name: \"proposalOwner\",\n        type: \"address\",\n      },\n      {\n        internalType: \"uint256\",\n        name: \"votes\",\n        type: \"uint256\",\n      },\n      {\n        internalType: \"bool\",\n        name: \"accepted\",\n        type: \"bool\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"proposalsCount\",\n    outputs: [\n      {\n        internalType: \"uint256\",\n        name: \"\",\n        type: \"uint256\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [\n      {\n        internalType: \"string\",\n        name: \"_description\",\n        type: \"string\",\n      },\n    ],\n    name: \"submitProposal\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"votingToken\",\n    outputs: [\n      {\n        internalType: \"contract IERC20\",\n        name: \"\",\n        type: \"address\",\n      },\n    ],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n];\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n  }\n}\n\nif (state.proposalNumber !== undefined && state.proposalNumber > 0) {\n  if (!state.proposalChecked) {\n    console.log(\"Calling props contract\");\n    const proposals = new ethers.Contract(\n      proposalContract,\n      proposalAbi,\n      Ethers.provider().getSigner()\n    );\n\n    proposals.castedVotes().then((numVotes) => {\n      State.update({ totalVotes: numVotes.toNumber() });\n    });\n\n    let all_pulled_proposals = [];\n    let indexed_votes = [];\n\n    for (let num = 0; num < state.proposalNumber; num++) {\n      proposals.proposals(num).then((result) => {\n        console.log(\"result: \", result);\n        all_pulled_proposals.push({ num, result });\n        indexed_votes.push(0);\n        State.update({\n          pulled_proposals: all_pulled_proposals,\n        });\n        toggleUpdateFlag();\n      });\n    }\n    State.update({ proposalChecked: true });\n    State.update({ votes: indexed_votes });\n  }\n}\n\n// HELPER FUNCTIONS\n\nconst pullProposals = () => {\n  if (!state.chainId || !state.sender) {\n    return console.log(\"Connect first\");\n  }\n\n  const proposals = new ethers.Contract(\n    proposalContract,\n    proposalAbi,\n    Ethers.provider().getSigner()\n  );\n\n  proposals.proposalsCount().then((_number) => {\n    if (_number > 0) {\n      State.update({ proposalNumber: _number.toNumber() });\n    }\n  });\n};\n\nconst vote = () => {\n  const proposals = new ethers.Contract(\n    proposalContract,\n    proposalAbi,\n    Ethers.provider().getSigner()\n  );\n\n  proposals.castVote([\n    [0, 1],\n    [1, 0],\n    [2, 1],\n    [3, 1],\n    [4, 0],\n    [5, 0],\n    [6, 1],\n  ]);\n};\n\nif (state.sender !== undefined) {\n  pullProposals();\n}\n\nconst ComponentToForceRender = ({ updateFlag }) => {\n  console.log(state);\n  console.log(\"Updating state \", state.pulled_proposals);\n  if (!state.pulled_proposals) return null;\n  return (\n    <div>\n      {state.pulled_proposals.map((item) => (\n        <div style={{ marginTop: \"20px\" }}>\n          <Widget\n            src=\"ethpraguedemo.near/widget/Progress-Pool-Question-Preview\"\n            props={{\n              result: item.result,\n              index: item.num,\n              totalVotes: state.totalVotes,\n              state: state,\n            }}\n          />\n        </div>\n      ))}\n    </div>\n  );\n};\n\nconst H2 = styled.h2`\n  font-size: 20px;\n  font-weight: 600;\n  color: #11181C;\n\n  a {\n    color: inherit;\n    transition: color .15s ease;\n    &:hover {\n      color: #30A46C;\n      text-decoration: none;\n\n      & + i {\n        visibility: visible;\n      }\n    }\n\n    & + i {\n      transition: visibility .1s ease-out;\n      visibility: hidden;\n      color: #30A46C;\n    }\n  }\n`;\nconst H6 = styled.h6`\n  font-size: 14px;\n  font-weight: 500;\n  color: #687076;\n`;\nconst Trancate = styled.span`\n  text-overflow: ellipsis;\n  overflow: hidden;\n`;\nconst TopicName = styled.span`\n  color: #006ADC;\n  font-weight: 500;\n  font-size: 14px;\n  white-space: nowrap;\n`;\nconst CardWrapper = styled.div`\n  z-index: 100;\n  padding: 6px;\n`;\nconst Card = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: stretch;\n  gap: 12px;\n  width: 275px;\n  border-radius: 12px;\n  z-index: 1070;\n  background: #fff;\n  border: 1px solid #eceef0;\n  box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);\n  padding: 12px;\n`;\nconst Item = styled.div`\n  padding: 0;\n  .btn {\n    width: 100%;\n    text-align: left;\n    &:hover,\n    &:focus {\n      background-color: #ECEDEE;\n      text-decoration: none;\n      outline: none;\n    }\n\n    &.report-btn, &.hide-btn {\n      i {\n        color: #7E868C;\n      }\n    }\n    span {\n      font-weight: 500;\n    }\n  }\n`;\n\nconst Button = styled.a`\n  display: block;\n  color: #ffffff;\n  background-color: #30A46C;\n  font-size: 14px;\n  font-weight: 600;\n  padding: 8px 24px;\n  border: none;\n  border-radius: 50px;\n  float: inline-end;\n\n  :hover{ color: #ffffff; cursor: pointer; }\n`;\n\nreturn (\n  <div>\n    <ComponentToForceRender updateFlag={state.proposalChecked} />\n    <div class=\"d-flex\" style={{ marginTop: \"30px\" }}>\n      <Web3Connect\n        className=\"LidoStakeFormSubmitContainer\"\n        connectLabel=\"Connect\"\n      />\n      <div class=\"col-lg-2 col-sm-12 text-center\">\n        <Button\n          class=\"btn btn-primary btn-sm\"\n          onClick={vote}\n          style={{ marginLeft: \"20px\", width: \"200px\" }}\n        >\n          Cast Your Vote\n        </Button>\n      </div>\n    </div>\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ethpraguedemo.near/widget/Progress-Pool-Proposals-Feed", "__row_index": 135}