{"tx_hash": "333LBbqCc8hnEFi9rVMd8id2mL7UPoVG8WfDT6UMoubE", "action_id_social": "5bQQbtw8QDDtt1PUhSReeoTsQvqisHHbVSvkBinzJW7Q-0-widget", "block_id": 91981913, "block_timestamp": "2023-05-16T09:59:41.834Z", "signer_id": "sking.near", "widget_name": "DAO.Proposal.Vote", "source_code": "const accountId = context.accountId;\nconst daoId = props.daoId ?? \"multi.sputnik-dao.near\";\nconst vote_counts = props.proposal.vote_counts ?? {\n  // yes, no, spam\n  community: [3, 0, 2],\n  council: [1, 6, 0],\n};\n\nconst userVote = props.proposal.votes[accountId];\nconst canVote =\n  !userVote && props.proposal.status === \"In Progress\" && accountId;\nconst yesWin = props.proposal.status === \"Approved\";\nconst noWin = props.proposal.status === \"Rejected\";\n\nlet totalYesVotes = 0;\nlet totalNoVotes = 0;\nlet totalSpamVotes = 0;\nObject.keys(vote_counts).forEach((key) => {\n  totalYesVotes += vote_counts[key][0];\n  totalNoVotes += vote_counts[key][1];\n  totalSpamVotes += vote_counts[key][2];\n});\nconst totalVotes = totalYesVotes + totalNoVotes + totalSpamVotes;\n\n// Functions\n\nconst handleApprove = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"act_proposal\",\n      args: {\n        id: JSON.parse(props.proposal.id),\n        action: \"VoteApprove\",\n      },\n      gas: 200000000000000,\n    },\n  ]);\n};\n\nconst handleReject = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"act_proposal\",\n      args: {\n        id: JSON.parse(props.proposal.id),\n        action: \"VoteReject\",\n      },\n      gas: 200000000000000,\n    },\n  ]);\n};\n\nconst handleSpam = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"act_proposal\",\n      args: {\n        id: JSON.parse(props.proposal.id),\n        action: \"VoteRemove\",\n      },\n      gas: 200000000000000,\n    },\n  ]);\n};\n\nconst VoteButton = styled.button`\n  border-radius: 20px;\n  border: none;\n  display: flex;\n  padding: 0;\n  position: relative;\n  background: #f3f3f2;\n  width: 100%;\n  margin-bottom: 14px;\n  cursor: pointer;\n\n  .button {\n    border-radius: 20px;\n    padding: 12px 20px;\n    text-align: left;\n    font-weight: 600;\n    font-size: 15px;\n    transition: all 0.4s ease-in-out;\n    text-align: center;\n    display: flex;\n    justify-content: center;\n    min-width: 90px;\n    width: 90px;\n\n    @media (max-width: 600px) {\n      justify-content: start;\n    }\n  }\n\n  .vote {\n    opacity: 0;\n    transition: all 0.4s ease-in-out;\n    max-width: 0;\n    display: block;\n    margin-right: 3px;\n    position: relative;\n    z-index: 1;\n  }\n\n  .votes {\n    text-align: right;\n    padding: 12px 16px;\n    position: absolute;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    color: rgb(27, 27, 24);\n  }\n\n  .preview {\n    position: absolute;\n    top: 0;\n    left: 0;\n    height: 100%;\n    border-radius: 20px;\n    transition: all 0.4s ease-in-out;\n    z-index: 0;\n  }\n\n  &:hover {\n    .button {\n      width: 100%;\n    }\n    .vote {\n      opacity: 1;\n      max-width: 100px;\n    }\n  }\n\n  &[disabled] {\n    cursor: not-allowed;\n    opacity: 0.8;\n\n    .vote {\n      opacity: 0;\n      max-width: 0;\n    }\n\n    &.yes .button {\n      width: ${(totalYesVotes / totalVotes) * 100 || 0}%;\n    }\n    &.no .button {\n      width: ${(totalNoVotes / totalVotes) * 100 || 0}%;\n    }\n    &.spam .button {\n      width: ${(totalSpamVotes / totalVotes) * 100 || 0}%;\n    }\n  }\n\n  &.yes {\n    .button {\n      background-color: #59e692;\n      color: #000;\n    }\n    .preview {\n      background-color: #59e69220;\n      width: ${(totalYesVotes / totalVotes) * 100 || 0}%;\n    }\n  }\n\n  &.no {\n    .button {\n      background-color: #e5484d;\n      color: #fff;\n    }\n    .preview {\n      background-color: #e5484d20;\n      width: ${(totalNoVotes / totalVotes) * 100 || 0}%;\n    }\n  }\n\n  &.spam {\n    .button {\n      background-color: #ffda09;\n      color: #000;\n    }\n    .preview {\n      background-color: #ffda0920;\n      width: ${(totalSpamVotes / totalVotes) * 100 || 0}%;\n    }\n  }\n`;\n\nreturn (\n  <>\n    <VoteButton onClick={handleApprove} disabled={!canVote} className=\"yes\">\n      <span className=\"button\">\n        <span className=\"vote\">Vote </span> Yes\n      </span>\n      <span className=\"votes\">\n        <span className=\"preview\" />\n        {totalYesVotes} Votes (\n        {Math.round((totalYesVotes / totalVotes) * 100 || 0)}%)\n      </span>\n    </VoteButton>\n    <VoteButton onClick={handleReject} disabled={!canVote} className=\"no\">\n      <span className=\"button no\">\n        <span className=\"vote\">Vote </span> No\n      </span>\n      <span className=\"votes\">\n        <span className=\"preview\" />\n        {totalNoVotes} Votes (\n        {Math.round((totalNoVotes / totalVotes) * 100 || 0)}%)\n      </span>\n    </VoteButton>\n    <VoteButton onClick={handleSpam} disabled={!canVote} className=\"spam\">\n      <span className=\"button spam\">\n        <span className=\"vote\">Vote </span> Spam\n      </span>\n      <span className=\"votes\">\n        <span className=\"preview\" />\n        {totalSpamVotes} Votes (\n        {Math.round((totalSpamVotes / totalVotes) * 100 || 0)}%)\n      </span>\n    </VoteButton>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sking.near/widget/DAO.Proposal.Vote", "__row_index": 1}