{"tx_hash": "48jLPAGExDX7B1fWV5dxo4cG6SdJ9ryerSxmSb5fzgHP", "action_id_social": "9rE7NuBZSmrtNfgSdeKiZkSytbjd12f81FRLAoGhwr2b-0-widget", "block_id": 91608293, "block_timestamp": "2023-05-11T13:00:32.075Z", "signer_id": "sking.near", "widget_name": "DAO.Proposal.Vote", "source_code": "const accountId = context.accountId;\nconst daoId = props.daoId ?? \"multi.sputnik-dao.near\";\nconst vote_counts = props.proposal.vote_counts ?? {\n  // yes, no, spam\n  community: [3, 0, 0],\n  council: [1, 6, 0],\n};\n\nconst alreadyVoted = props.proposal.votes[accountId];\nconst canVote = !alreadyVoted && props.proposal.status === \"In Progress\" && accountId;\nconst yesLost = props.proposal.status === \"Failed\";\nconst noLost = props.proposal.status === \"Approved\";\n\nlet totalYesVotes = 0;\nlet totalNoVotes = 0;\nObject.keys(vote_counts).forEach((key) => {\n  totalYesVotes += vote_counts[key][0];\n  totalNoVotes += vote_counts[key][1];\n});\nconst totalVotes = totalYesVotes + totalNoVotes;\n\n// Functions\n\nconst handleApprove = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"act_proposal\",\n      args: {\n        id: JSON.parse(props.proposal.id),\n        action: \"VoteApprove\",\n      },\n      gas: 200000000000000,\n    },\n  ]);\n};\n\nconst handleReject = () => {\n  Near.call([\n    {\n      contractName: daoId,\n      methodName: \"act_proposal\",\n      args: {\n        id: JSON.parse(props.proposal.id),\n        action: \"VoteReject\",\n      },\n      gas: 200000000000000,\n    },\n  ]);\n};\n\nconst VoteButton = styled.button`\n  border-radius: 20px;\n  border: none;\n  display: flex;\n  padding: 0;\n  position: relative;\n  background: #f3f3f2;\n  width: 100%;\n  margin-bottom: 14px;\n  cursor: default !important;\n\n  .count {\n    border-radius: 20px;\n    padding: 12px 20px;\n    text-align: left;\n    font-weight: 600;\n    font-size: 15px;\n    min-width: 70px;\n    transition: all 0.4s ease-in-out;\n    width: 100%;\n    text-align: center;\n    display: flex;\n    justify-content: center;\n\n    &.yes {\n      background-color: #59e692;\n      color: #000;\n      max-width: ${(totalYesVotes / totalVotes) * 100 || 0}%;\n\n      ${yesLost &&\n      `\n        opacity: 0.5;\n      `}\n    }\n    &.no {\n      background-color: #e5484d;\n      color: #fff;\n      max-width: ${(totalNoVotes / totalVotes) * 100 || 0}%;\n\n      ${noLost &&\n      `\n        opacity: 0.5;\n      `}\n    }\n    .vote {\n      opacity: 0;\n      transition: all 0.4s ease-in-out;\n      max-width: 0;\n      display: block;\n      margin-right: 3px;\n    }\n  }\n  .votes {\n    text-align: right;\n    padding: 12px 16px;\n    position: absolute;\n    right: 0;\n    top: 0;\n    color: rgb(27, 27, 24);\n  }\n  \n\n  ${canVote &&\n    `\n    &:hover .count, &:focus .count {\n      max-width: 100%;\n      cursor: pointer;\n      .vote {\n        opacity: 1;\n        max-width: 100px;\n      }\n      &.yes {\n        background-color: #70f2a4;\n      }\n      &.no {\n        background-color: #f26f7e;\n      }\n    }`}\n`;\n\nreturn (\n  <>\n    <VoteButton onClick={handleApprove} disabled={!canVote}>\n      <span className=\"count yes\">\n        <span className=\"vote\">Vote </span> Yes\n      </span>\n      <span className=\"votes\">{totalYesVotes} Votes</span>\n    </VoteButton>\n    <VoteButton onClick={handleReject} disabled={!canVote}>\n      <span className=\"count no\">\n        <span className=\"vote\">Vote </span> No\n      </span>\n      <span className=\"votes\">{totalNoVotes} Votes</span>\n    </VoteButton>\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/sking.near/widget/DAO.Proposal.Vote", "__row_index": 0}