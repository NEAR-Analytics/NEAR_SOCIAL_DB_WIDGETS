{"tx_hash": "6QiL6z349oxJBZQGh65PgV5VP66A9hS5s3RBQq52jkUa", "action_id_social": "DqPZtULm9aHEm5iNT6JJwix287DzSDzQBimoUQyytwtT-0-widget", "block_id": 93303218, "block_timestamp": "2023-06-02T18:37:24.489Z", "signer_id": "idknwhoru.near", "widget_name": "Liquity", "source_code": null, "metadata": null, "branch": {"draft": {"": "const setcoll = (depositChangeEvent) => {\n  const coll = Number(depositChangeEvent.target.value);\n  const { totalcoll } = state;\n  const collateralRatio = ((coll * 1882) / Number(totalcoll)) * 100;\n\n  State.update({ coll, collateralRatio });\n\n  validateTrove();\n};\n\nconst setBorrow = (borrowChangeEvent) => {\n  const { coll, liquidationReserve } = state;\n  const borrow = Number(borrowChangeEvent.target.value);\n  const borrowingFee = (borrow * 0.5) / 100;\n  const totalcoll =\n    borrow + Number(borrowingFee.toFixed(2)) + liquidationReserve;\n  const collateralRatio = ((coll * 1882) / Number(totalcoll)) * 100;\n\n  State.update({ borrow, borrowingFee, totalcoll, collateralRatio });\n  validateTrove();\n};\n\nconst validateTrove = () => {\n  const { coll, borrow, totalcoll, balance } = state;\n\n  if (borrow < 1800) {\n    State.update({ msg: \"Borrow must be at least 1800 LUSD.\" });\n    return;\n  }\n\n  const collateralRatio = ((coll * 1882) / Number(totalcoll)) * 100;\n  if (collateralRatio < 110) {\n    State.update({ msg: \"Collateral ratio must be at least 110%.\" });\n    return;\n  }\n\n  if (coll > Number(balance)) {\n    State.update({\n      msg: `The amount you're trying to deposit exceeds your balance by ${coll} ETH.`,\n    });\n    return;\n  }\n  State.update({ msg: \"\" });\n};\n\nconst address = \"0xD69fC8928D4F3229341cb431263F1EBd87B1ade8\";\n\nconst borrowerOperationAbi = fetch(\n  \"https://api-sepolia.etherscan.io/api?module=contract&action=getabi&address=0xcb306e2509ca52872c2d04160F3c1fa7bc013064\"\n);\n\n// const iface = new ethers.utils.Interface(borrowerOperationAbi.body);\n\nconst openTrove = () => {\n  const borrowerOperationContract = new ethers.Contract(\n    address,\n    borrowerOperationAbi.body.result,\n    Ethers.provider().getSigner()\n  );\n\n  console.log(123);\n  console.log(\n    ethers.BigNumber.from(\n      (state.coll * 10000000000000000).toString()\n    ).toString()\n  );\n\n  borrowerOperationContract.openTrove(\n    ethers.BigNumber.from(5000000000000000),\n    ethers.BigNumber.from((state.borrow * 10000000000000000).toString()),\n    \"0x1Bc65296aa95A0fD41d6A8AEb34C49665c6de81d\",\n    \"0x1Bc65296aa95A0fD41d6A8AEb34C49665c6de81d\",\n\n    {\n      value: ethers.BigNumber.from((state.coll * 10000000000000000).toString()),\n    }\n  );\n};\n\nState.init({\n  coll: 0,\n  borrow: 0,\n  borrowingFee: 0,\n  totalcoll: 200,\n  collateralRatio: 0,\n  liquidationReserve: 200,\n  msg: \"\",\n  sender: undefined,\n  chainId: undefined,\n  balance: undefined,\n});\n\nif (\n  state.chainId === undefined &&\n  ethers !== undefined &&\n  Ethers.send(\"eth_requestAccounts\", [])[0]\n) {\n  Ethers.provider()\n    .getNetwork()\n    .then((chainIdData) => {\n      if (chainIdData?.chainId) {\n        State.update({ chainId: chainIdData.chainId });\n      }\n    });\n}\n\nif (state.sender === undefined) {\n  const accounts = Ethers.send(\"eth_requestAccounts\", []);\n  if (accounts.length) {\n    State.update({ sender: accounts[0] });\n  }\n}\n\nif (state.balance === undefined && state.sender) {\n  Ethers.provider()\n    .getBalance(state.sender)\n    .then((balance) => {\n      State.update({ balance: Big(balance).div(Big(10).pow(18)).toFixed(2) });\n    });\n}\n\nreturn (\n  <>\n    {state.chainId === 11155111 ? (\n      <div>\n        <div class=\"TroveHead_wrapper__2deZb\">\n          <div class=\"TroveHead_body__1ysLq TroveHead_noTroveBody__2S1Gf\">\n            You have no active troves. Deposit to open trove.\n          </div>\n        </div>\n        <div class=\"Tabs_tabs__HvDAh Tabs_threeTabs__1s_G7\">\n          <div class=\"Tabs_tab__2wXzT Tabs_tabActive__1_3sf\">Deposit</div>\n          <div class=\"Tabs_tab__2wXzT\">Withdraw</div>\n          <div class=\"Tabs_tab__2wXzT\">Redemption</div>\n        </div>\n        <div class=\"TroveEditor_wrapper__15ofX\">\n          <div class=\"Row_row__2iFJs\">\n            <div class=\"Row_labelContainer__1QMyH\">\n              <div>deposit</div>\n            </div>\n            <div class=\"Input_wrapper__3ej-M\">\n              <input\n                class=\"Input_input__3PNbO\"\n                type=\"number\"\n                placeholder=\"0.0000\"\n                min=\"0\"\n                step=\"0.1\"\n                onChange={setcoll}\n              />\n              <div class=\"Input_contentRight__270ZM\">\n                <div class=\"Input_contentRightAvailable__1htHm\">\n                  Wallet: 0.0000\n                </div>\n                <div class=\"Input_contentRightBottom__2csmy\">\n                  <button class=\"Button_wrapper__1pHwk Input_contentRightButton__hPGF1 Button_small__1zbeU Button_primary__1mTxz\">\n                    max\n                  </button>\n                  <div class=\"Input_contentRightValues__23MfN\">\n                    <p class=\"Input_contentRightCurrency__WrZrm\">ETH</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"Row_row__2iFJs\">\n            <div class=\"Row_labelContainer__1QMyH\">\n              <div>borrow</div>\n            </div>\n            <div class=\"Input_wrapper__3ej-M\">\n              <input\n                class=\"Input_input__3PNbO\"\n                type=\"number\"\n                placeholder=\"0.0000\"\n                min=\"0\"\n                step=\"100\"\n                onChange={setBorrow}\n              />\n              <div class=\"Input_contentRight__270ZM Input_contentRightNoInfo__1aulc\">\n                <div class=\"Input_contentRightBottom__2csmy\">\n                  <div class=\"Input_contentRightValues__23MfN\">\n                    <p class=\"Input_contentRightCurrency__WrZrm\">LUSD</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"TroveManager_container__37C51\">\n            <p class=\"ErrorDescription_wrapper__3nGA7\">\n              {state.msg}\n              {/** highlight area */}\n              <span style={{ fontWeight: \"bold\", whiteSpace: \"nowrap\" }}></span>\n            </p>\n            {state.sender ? (\n              <button\n                class=\"Button_wrapper__1pHwk TroveManager_action__3q0yT Button_large__3F305 Button_primary__1mTxz Button_disabled__2c3jr\"\n                disabled=\"\"\n                onClick={openTrove}\n              >\n                Confirm\n              </button>\n            ) : (\n              <Web3Connect connectLabel=\"Connect Wallet\" />\n            )}\n          </div>\n          <div>\n            {state.coll > 0 ? (\n              <div class=\"StaticRow_staticRow__3Tsxc\">\n                <p class=\"\">Deposit</p>\n                <p class=\"\">\n                  {\" \"}\n                  <span class=\"\">{state.coll}</span> ETH{\" \"}\n                </p>\n              </div>\n            ) : null}\n            {state.coll > 0 || state.borrow > 0 ? (\n              <>\n                <div class=\"StaticRow_staticRow__3Tsxc\">\n                  <p class=\"\">\n                    Liquidation Reserve\n                    <span\n                      aria-expanded=\"false\"\n                      style={{ display: \"inline-flex\", color: \"#bbb\" }}\n                    ></span>\n                  </p>\n                  <p class=\"\">\n                    {\" \"}\n                    <span class=\"\">{state.liquidationReserve}</span> LUSD{\" \"}\n                  </p>\n                </div>\n                <div class=\"StaticRow_staticRow__3Tsxc\">\n                  <p class=\"\">\n                    Borrowing Fee\n                    <span\n                      aria-expanded=\"false\"\n                      style={{ display: \"inline-flex\", color: \"#bbb\" }}\n                    ></span>\n                  </p>\n                  <p class=\"\">\n                    {\" \"}\n                    <span class=\"\">{state.borrowingFee.toFixed(2)}</span> LUSD\n                    (0.50%)\n                  </p>\n                </div>\n              </>\n            ) : null}\n            {state.borrow > 0 ? (\n              <div class=\"StaticRow_staticRow__3Tsxc\">\n                <p class=\"\">Recieve</p>\n                <p class=\"\">\n                  {\" \"}\n                  <span class=\"\">{state.borrow.toFixed(2)}</span> LUSD{\" \"}\n                </p>\n              </div>\n            ) : null}\n            {state.totalcoll > 200 ? (\n              <div class=\"StaticRow_staticRow__3Tsxc\">\n                <p class=\"\">\n                  Total debt\n                  <span\n                    aria-expanded=\"false\"\n                    style={{ display: \"inline-flex\", color: \"#bbb\" }}\n                  >\n                    &nbsp;\n                  </span>\n                </p>\n                <p class=\"\">\n                  {\" \"}\n                  <span class=\"\">{state.totalcoll.toFixed(2)}</span> LUSD{\" \"}\n                </p>\n              </div>\n            ) : null}\n            {state.coll > 0 && state.borrow > 0 ? (\n              <div class=\"StaticRow_staticRow__3Tsxc\">\n                <p class=\"\">\n                  Collateral ratio\n                  <span\n                    aria-expanded=\"false\"\n                    style={{ display: \"inline-flex\", color: \"#bbb\" }}\n                  ></span>\n                </p>\n                <p class=\"StaticRow_success__351Dr\">\n                  <span>\n                    <span>{state.collateralRatio.toFixed(1)}%</span>\n                  </span>\n                </p>\n              </div>\n            ) : null}\n          </div>\n        </div>\n      </div>\n    ) : (\n      <div>\n        <div>Network\ub97c Sepolia Testnet\uc73c\ub85c \ubc14\uafd4\uc8fc\uc138\uc694.</div>\n        <a href=\"https://chainlist.org/chain/11155111\" target=\"_blank\">\n          https://chainlist.org/chain/11155111\n        </a>\n      </div>\n    )}\n  </>\n);\n"}}, "widget_modules_used": null, "widget_url": "https://near.social/#/idknwhoru.near/widget/Liquity", "__row_index": 1}