{"tx_hash": "D5yaNSadBX993BeWnFnrcJx8aS8iT6N58WwX7y1THSzF", "action_id_social": "HzvrPM1Nj2FboKBECgSBxKvUB9cQhBsZPP6oEp1MyR7a-0-widget", "block_id": 89507362, "block_timestamp": "2023-04-13 18:40:15.226", "signer_id": "roshaan.near", "widget_name": "Posts.Post", "source_code": "const accountId = props.accountId;\nconst blockHeight =\n  props.blockHeight === \"now\" ? \"now\" : parseInt(props.blockHeight);\n// const subscribe = !!props.subscribe;\nconst notifyAccountId = accountId;\nconst postUrl = `https://alpha.near.org/#/roshaan.near/widget/PostPage?accountId=${accountId}&blockHeight=${blockHeight}`;\n\nState.init({\n  postExists: true,\n  comments: props.comments ?? undefined,\n  content: JSON.parse(props.content) ?? undefined,\n  likes: props.likes ?? undefined,\n});\n\nconst item = {\n  type: \"social\",\n  path: `${accountId}/post/main`,\n  blockHeight,\n};\n\n// Load post if not contents and comments are not passed in\nif (!state.content || !state.comments || !state.likes) {\n  console.log(\"making call again\");\n  const postsQuery = `\nquery IndexerQuery {\n  roshaan_near_alphaindexer_posts(\n    order_by: {block_height: desc}\n    where: {_and: {block_height: {_eq: ${blockHeight}}, account_id: {_eq: \"${accountId}\"}}}\n  ) {\n    account_id\n    block_height\n    block_timestamp\n    content\n    receipt_id\n    accounts_liked\n    comments(order_by: {block_height: asc}) {\n      account_id\n      block_height\n      block_timestamp\n      content\n    }\n  }\n}\n`;\n\n  function fetchGraphQL(operationsDoc, operationName, variables) {\n    return asyncFetch(\n      \"https://query-api-hasura-vcqilefdcq-uc.a.run.app/v1/graphql\",\n      {\n        method: \"POST\",\n        headers: { \"x-hasura-role\": \"roshaan_near\" },\n        body: JSON.stringify({\n          query: operationsDoc,\n          variables: variables,\n          operationName: operationName,\n        }),\n      }\n    );\n  }\n\n  fetchGraphQL(postsQuery, \"IndexerQuery\", {}).then((result) => {\n    if (result.status === 200) {\n      if (result.body.data) {\n        const posts = result.body.data.roshaan_near_alphaindexer_posts;\n        if (posts.length > 0) {\n          const post = posts[0];\n          let content = JSON.parse(post.content);\n          const comments = post.comments;\n          State.update({\n            content: content,\n            comments: comments,\n            likes: post.accounts_liked,\n          });\n        } else {\n          State.update({\n            postExists: false,\n          });\n        }\n      }\n    }\n  });\n  if (state.postExists == false) {\n    return \"Post does not exist.\";\n  }\n  return \"loading...\";\n}\n\nconst Post = styled.div`\n  position: relative;\n\n  &::before {\n    content: '';\n    display: block;\n    position: absolute;\n    left: 19px;\n    top: 52px;\n    bottom: 12px;\n    width: 2px;\n    background: #ECEEF0;\n  }\n`;\n\nconst Header = styled.div`\n  margin-bottom: 0;\n  display: inline-flex;\n`;\n\nconst Body = styled.div`\n  padding-left: 52px;\n  padding-bottom: 1px;\n`;\n\nconst Content = styled.div`\n  img {\n    display: block;\n    max-width: 100%;\n    max-height: 80vh;\n    margin: 0 0 12px;\n  }\n`;\n\nconst Text = styled.p`\n  display: block;\n  margin: 0;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: 400;\n  color: #687076;\n  white-space: nowrap;\n`;\n\nconst Actions = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  margin: -6px -6px 6px;\n`;\n\nconst Comments = styled.div`\n  > div > div:first-child {\n    padding-top: 12px;\n  }\n`;\nconst CommentWrapper = styled.div`\n  > div:first-child {\n    > a:first-child {\n      display: inline-flex;\n      margin-bottom: 24px;\n      font-size: 14px;\n      line-height: 20px;\n      color: #687076;\n      outline: none;\n      font-weight: 600;\n\n      &:hover,\n      &:focus {\n        color: #687076;\n        text-decoration: underline;\n      }\n    }\n  }\n`;\n\nconst renderComment = (a) => {\n  return (\n    <div key={JSON.stringify(a)}>\n      <Widget\n        src=\"roshaan.near/widget/Comments.Comment\"\n        props={{\n          accountId: a.account_id,\n          blockHeight: a.block_height,\n          content: a.content,\n          highlight:\n            a.account_id === props.highlightComment?.accountId &&\n            a.block_height === props.highlightComment?.blockHeight,\n        }}\n      />\n    </div>\n  );\n};\n\nconst renderedComments = state.comments.map(renderComment);\nreturn (\n  <Post>\n    <Header>\n      <Widget\n        src=\"calebjacob.near/widget/AccountProfile\"\n        props={{\n          accountId,\n          hideAccountId: true,\n          inlineContent: (\n            <>\n              <Text as=\"span\">\uff65</Text>\n              <Text>\n                {blockHeight === \"now\" ? (\n                  \"now\"\n                ) : (\n                  <>\n                    <Widget\n                      src=\"mob.near/widget/TimeAgo\"\n                      props={{ blockHeight }}\n                    />{\" \"}\n                    ago\n                  </>\n                )}\n              </Text>\n            </>\n          ),\n        }}\n      />\n    </Header>\n\n    <Body>\n      {state.content && (\n        <Content>\n          {state.content.text && (\n            <Widget\n              src=\"calebjacob.near/widget/SocialMarkdown\"\n              props={{ text: state.content.text }}\n            />\n          )}\n\n          {state.content.image && (\n            <Widget\n              src=\"mob.near/widget/Image\"\n              props={{\n                image: state.content.image,\n              }}\n            />\n          )}\n        </Content>\n      )}\n\n      {blockHeight !== \"now\" && (\n        <Actions>\n          <Widget\n            src=\"roshaan.near/widget/LikeButton\"\n            props={{\n              item,\n              notifyAccountId,\n              likes: state.likes,\n            }}\n          />\n          <Widget\n            src=\"calebjacob.near/widget/CommentButton\"\n            props={{\n              item,\n              onClick: () => State.update({ showReply: !state.showReply }),\n            }}\n          />\n          <Widget\n            src=\"calebjacob.near/widget/CopyUrlButton\"\n            props={{\n              url: postUrl,\n            }}\n          />\n        </Actions>\n      )}\n\n      {state.showReply && (\n        <div className=\"mb-2\">\n          <Widget\n            src=\"calebjacob.near/widget/Comments.Compose\"\n            props={{\n              notifyAccountId,\n              item,\n              onComment: () => State.update({ showReply: false }),\n            }}\n          />\n        </div>\n      )}\n      {renderedComments && (\n        <Comments>\n          <CommentWrapper>{renderedComments}</CommentWrapper>\n        </Comments>\n      )}\n    </Body>\n  </Post>\n);\n", "metadata": null, "branch": NaN, "widget_modules_used": null, "widget_url": "https://near.social/#/roshaan.near/widget/Posts.Post", "branch.draft": NaN}