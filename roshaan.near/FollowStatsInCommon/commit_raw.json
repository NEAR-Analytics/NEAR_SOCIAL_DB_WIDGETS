{"tx_hash": "AywCADdxFWzsXqDhhfAvQQP8WaXPc8AFfJgjxqaSybZn", "action_id_social": "87uKJhE8sVxGhZHdh4BgC39xmwnxMX6MGXCYy6SJJsJT-0-widget", "block_id": 81601301, "block_timestamp": "2022-12-27 21:34:17.896", "signer_id": "roshaan.near", "widget_name": "FollowStatsInCommon", "source_code": "const accountId = props.accountId;\nconst userId = context.accountId;\n\nif (!accountId) {\n  return \"\";\n}\n\nconst following = Social.keys(`${accountId}/graph/follow/*`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true,\n});\n\nconst followers = Social.keys(`*/graph/follow/${accountId}`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true,\n});\n\nconst numFollowing = following\n  ? Object.keys(following[accountId].graph.follow || {}).length\n  : null;\nconst numFollowers = followers ? Object.keys(followers || {}).length : null;\n\nconst accounts = Social.keys(`*/graph/follow/*`, \"final\", {\n  return_type: \"BlockHeight\",\n  values_only: true,\n});\n\nlet followingsPerAccount = Object.keys(accounts).reduce(\n  (res, id) => ({\n    ...res,\n    [id]: Object.keys(accounts[id].graph.follow).filter((x) => x !== accountId),\n  }),\n  {}\n);\n\nconst myTags = Social.getr(`${userId}/profile/tags`, \"final\") || [];\nconst profileVisitedTags =\n  Social.getr(`${accountId}/profile/tags`, \"final\") || [];\n\nconst myFriends = followingsPerAccount[userId] || [];\n\nconst findFriendsInCommon = (accountId) => {\n  return myFriends.filter((a) => followingsPerAccount[accountId].includes(a));\n};\n\nconst friendsInCommon = findFriendsInCommon(accountId);\nconst tagsInCommon = () => {\n  return myTags.filter(\n    (a) => profileVisitedTags.length > 0 && profileVisitedTags.includes(a)\n  );\n};\n\nreturn (\n  <div>\n    <div className=\"d-flex flex-row\">\n      <div className=\"me-4\">\n        <a\n          href={`#/mob.near/widget/FollowPage?accountId=${accountId}&tab=following`}\n          className=\"text-dark\"\n          target=\"_blank\"\n        >\n          {numFollowing !== null ? (\n            <span className=\"fw-bolder\">{numFollowing}</span>\n          ) : (\n            \"?\"\n          )}{\" \"}\n          <span className=\"text-muted\">Following</span>\n        </a>\n      </div>\n      <div>\n        <a\n          href={`#/mob.near/widget/FollowPage?accountId=${accountId}&tab=followers`}\n          className=\"text-dark\"\n          target=\"_blank\"\n        >\n          {numFollowers !== null ? (\n            <span className=\"fw-bolder\">{numFollowers}</span>\n          ) : (\n            \"?\"\n          )}{\" \"}\n          <span className=\"text-muted\">\n            Follower{numFollowers !== 1 && \"s\"}\n          </span>\n        </a>\n      </div>\n    </div>\n    {userId && (\n      <div>\n        {friendsInCommon.length > 0 && (\n          <OverlayTrigger\n            placement=\"auto\"\n            overlay={\n              <Tooltip>\n                <span> You both follow </span>\n                <br />\n                <br />\n                {friendsInCommon.map((friendsInCommon) => {\n                  return (\n                    <li className={`list-group-item`}>{friendsInCommon}</li>\n                  );\n                })}\n              </Tooltip>\n            }\n          >\n            <span\n              className=\"badge rounded-pill bg-primary\"\n              title={`${friendsInCommon.length} followers in common`}\n            >\n              {friendsInCommon.length} friends in common\n            </span>\n          </OverlayTrigger>\n        )}\n        {tagsInCommon.length > 0 && (\n          <OverlayTrigger\n            placement=\"auto\"\n            overlay={\n              <Tooltip>\n                {tagsInCommon.map((tag) => {\n                  return <li className={`list-group-item`}>{tag}</li>;\n                })}\n              </Tooltip>\n            }\n          >\n            <span\n              className=\"badge rounded-pill bg-primary\"\n              title={`${tagsInCommon.length} tags in common`}\n            >\n              {tagsInCommon.length} common tags\n            </span>\n          </OverlayTrigger>\n        )}\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/roshaan.near/widget/FollowStatsInCommon"}