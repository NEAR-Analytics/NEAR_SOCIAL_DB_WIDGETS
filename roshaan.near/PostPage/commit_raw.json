{"tx_hash": "EaDTUD5orHawF33PPnvZFRRk66aG8ppNprtY2o4nMVni", "action_id_social": "FJHo2ARC1c2JWNH7Dmc3aTygGeQiCqca3ZQbUGaz58Zc-0-widget", "block_id": 88453721, "block_timestamp": "2023-03-30 18:17:10.292", "signer_id": "roshaan.near", "widget_name": "PostPage", "source_code": "const accountId = props.accountId;\nconst commentBlockHeight = parseInt(props.commentBlockHeight);\n\nState.init({\n  parentPostLoaded: false,\n  originalPostLikes: undefined,\n  originalAuthorAccountId: undefined,\n  originalAuthorBlockHeight: undefined,\n  originalPostContent: undefined,\n});\n\nconst parentPostByComment = `query ParentPostByComment {\n  roshaan_near_alphaindexer_comments(\n    where: {_and: {account_id: {_eq: \"${accountId}\"}, block_height: {_eq: ${commentBlockHeight}}}}\n  ) {\n    post {\n      account_id\n      accounts_liked\n      block_height\n      block_timestamp\n      content\n      id\n      receipt_id\n      comments {\n        account_id\n        block_height\n        block_timestamp\n        content\n        receipt_id\n        id\n      }\n      post_likes {\n        account_id\n        block_height\n        block_timestamp\n        receipt_id\n      }\n    }\n    receipt_id\n    id\n  }\n}`;\n\nfunction fetchGraphQL(operationsDoc, operationName, variables) {\n  return asyncFetch(\n    \"https://query-api-hasura-vcqilefdcq-uc.a.run.app/v1/graphql\",\n    {\n      method: \"POST\",\n      headers: { \"x-hasura-role\": \"roshaan_near\" },\n      body: JSON.stringify({\n        query: operationsDoc,\n        variables: variables,\n        operationName: operationName,\n      }),\n    }\n  );\n}\n\nif (commentBlockHeight) {\n  fetchGraphQL(parentPostByComment, \"ParentPostByComment\", {}).then(\n    (result) => {\n      if (result.status === 200) {\n        if (result.body.data) {\n          const posts = result.body.data.roshaan_near_alphaindexer_comments;\n          if (posts.length > 0) {\n            const post = posts[0].post;\n            let content = JSON.parse(post.content);\n            const comments = post.comments;\n            State.update({\n              parentPostLoaded: true,\n              originalAuthorAccountId: post.account_id,\n              originalAuthorBlockHeight: post.block_height,\n              originalPostContent: content,\n              comments: comments,\n              originalPostLikes: post.accounts_liked,\n            });\n          }\n        }\n      }\n    }\n  );\n}\nif (state.parentPostLoaded && commentBlockHeight) {\n  return (\n    <Widget\n      src=\"roshaan.near/widget/Posts.Post\"\n      props={{\n        accountId: state.originalAuthorAccountId,\n        blockHeight: state.originalAuthorBlockHeight,\n        content: state.originalPostContent,\n        highlightComment: { accountId, blockHeight: commentBlockHeight },\n        comments: state.comments,\n        likes: state.likes,\n      }}\n    />\n  );\n}\n\nreturn (\n  <Widget\n    src=\"roshaan.near/widget/Posts.Post\"\n    props={{ ...props, commentsLimit: 30, subscribe: true }}\n  />\n);\n", "metadata": null, "widget_modules_used": null, "widget_url": "https://near.social/#/roshaan.near/widget/PostPage", "branch.draft.": NaN, "branch.draft.metadata": NaN, "branch": NaN}