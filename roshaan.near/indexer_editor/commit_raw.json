{"tx_hash": "G6zd8gbapvnLzhk78qr5KZgkXpC7fggQkYnN5SYmjtrE", "action_id_social": "HKgWwALMMf2ZxhR6s1GpkhAK6We3DLBnBR2fAbBB13K8-0-widget", "block_id": 86255202, "block_timestamp": "2023-02-28 17:35:25.420", "signer_id": "roshaan.near", "widget_name": "indexer_editor", "source_code": "let initialText = \"\";\nconst indexerName = props.indexerName;\nconst registry_contract_id =\n  props.registry_contract_id || \"registry.queryapi.near\";\nlet accountId = props.accountId || context.accountId;\nlet base = props.base ?? \"query-api-editor\";\n\nif (!accountId) {\n  return \"Please sign in to use this widget.\";\n}\n\nlet updateIndexerCode = (data) => {\n  const gas = 200000000000000;\n  Near.call(\n    registry_contract_id,\n    \"register_indexer_function\",\n    {\n      function_name: data.indexerName || indexerName,\n      code: data.code,\n      start_block_height: data.startBlockHeight,\n      schema: data.schema,\n    },\n    gas\n  );\n};\n\nconst reducer = (message) => {\n  switch (message.action) {\n    case \"register_function\":\n      updateIndexerCode(message.value);\n      break;\n\n    case \"initial_load\":\n      State.update({ code: message.value });\n      break;\n\n    case \"default\":\n      console.log(\"default case\");\n  }\n};\nconst code = `\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<style>\n.container {\n max-width: 800px;\n}\n\n.iframe-wrapper {\n  position: relative;\n  width: 100%;\n  overflow: hidden;\n  padding-top: 56.25%; /* 16:9 Aspect Ratio */\n}\n\n.responsive-iframe {\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  border: none;\n}\n</style>\n    <script>\n   let iframe = null;\n\n  function createIframe(base, accountId, indexerName) {\n    console.log(accountId, \"account ID\")\n    console.log(indexerName, \"indexerName ID\")\n    console.log(base, \"base\")\n    iframe = document.createElement('iframe');\n    // iframe.src = 'https://query-api-react.vercel.app';\n        iframe.src = 'http://localhost:3000';\n\n    if (base) {\n      console.log(\"added base\")\n      iframe.src += base;\n    }\n    if(base.includes(\"create-new-indexer\")) {\n       iframe.style.height = '1000px';\n    } else if(base.includes(\"query-api-editor\")) {\n      iframe.style.height = '500px';\n    }\n\n    if (accountId != undefined && indexerName != undefined) {\n      iframe.src += \"?accountId=${accountId}&indexerName=${indexerName}\"\n    } else if (accountId != undefined ){\n      iframe.src += \"?accountId=${accountId}\"\n\n    }\n    iframe.name = \"react-app\"\n    iframe.id = \"react-app-iframe\"\n    iframe.style.width = '1250px';\n    // iframe.class = \"responsive-iframe\";\n    // iframe.allowFullScreen=\"true\";\n    // iframe_wrapper = document.createElement(\"div\");\n\n    // iframe_wrapper.class = \"iframe-wrapper\";\n    // container_div = document.createElement(\"div\");\n    // container_div.class = \"container\";\n\n    // iframe_wrapper.appendChild(iframe);\n    // container_div.appendChild(iframe_wrapper)\n    document.body.appendChild(iframe);\n  }\n\n  window.addEventListener('message', function (event) {\n      if (event.data.action === \"register_function\") {\n        console.log(\"registering\")\n        window.top.postMessage(event.data, \"*\");\n      }\n    if (event.data.action === 'createIframe') {\n      // Check if the iframe element already exists\n      if (iframe) {\n        // The iframe already exists, do nothing\n        return;\n      }\n      createIframe(event.data.value.base, event.data.value.accountId, event.data.value.indexerName);\n    }\n  });\n    </script>\n`;\n\nreturn (\n  <div>\n    <iframe\n      name=\"widget-iframe\"\n      className=\"w-100\"\n      style={{ height: \"500px\" }}\n      srcDoc={code}\n      message={{\n        action: \"createIframe\",\n        value: {\n          indexerName: indexerName,\n          accountId: accountId,\n          base,\n        },\n        from: \"widget\",\n      }}\n      onMessage={(message) => reducer(message)}\n    />\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/roshaan.near/widget/indexer_editor"}