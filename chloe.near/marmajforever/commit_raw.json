{"tx_hash": "GjYzpBFwm4HVJ1iXevPWJvmWAZDyMq3o3ByzXe8mYx3V", "action_id_social": "CHZQ36TJ7FSDwx4LM6Mc6CEVmAv3E4B1pBTTzcEFKmCV-0-widget", "block_id": 94340387, "block_timestamp": "2023-06-16T22:02:22.921Z", "signer_id": "chloe.near", "widget_name": "marmajforever", "source_code": "const accountId = props.accountId || context.accountId;\n\nconst GameButton = styled.button`\n  background: palevioletred;\n  color: white;\n  font-size: 1em;\n  margin: 10px;\n  padding: 0.5em 1em;\n  border: 2px solid palevioletred;\n  border-radius: 10px;\n  &:hover {\n    background: white;\n    color: palevioletred;\n  }\n`;\n\nif (!accountId) {\n  return (\n    <div>\n      <p>Please connect your NEAR wallet or create a new one:</p>\n      <a href=\"https://near.org/signup\" target=\"_blank\" rel=\"noreferrer\">\n        <GameButton>Create NEAR Wallet</GameButton>\n      </a>\n    </div>\n  );\n}\n\nconst GameContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 100vh;\n  background: #282c34;\n  color: white;\n  font-size: calc(10px + 2vmin);\n  padding: 20px;\n  box-sizing: border-box;\n`;\n\nconst Title = styled.h1`\n  font-weight: bold;\n  margin-top: 20px;\n`;\n\nconst Info = styled.p`\n  margin-top: 10px;\n`;\n\nconst RulesContainer = styled.div`\n  margin-top: 20px;\n  text-align: center;\n`;\n\nfunction initGameState() {\n  return {\n    clickCount: 0,\n    love: 0,\n    bossHP: 100,\n    bossLevel: 1,\n    totalLove: 0,\n    loveSpent: 0,\n    claimLoveCounter: 0,\n    gameStarted: false,\n    startingBlockHeight: 0,\n    highScore: 0,\n  };\n}\n\nState.init(initGameState());\n\nfunction startGame() {\n  asyncFetch(\"https://rpc.mainnet.near.org/status\").then((res) => {\n    const data = res.body;\n    if (res.ok) {\n      const blockHeight = data.sync_info.latest_block_height;\n      State.update({\n        ...initGameState(),\n        blockHeight: blockHeight,\n        startingBlockHeight: blockHeight,\n        gameStarted: true,\n      });\n    } else {\n      console.error(\"Error fetching data: \", data.error);\n    }\n  });\n}\n\nfunction claimLove() {\n  const oldBlockHeight = state.blockHeight;\n  const oldLove = state.love;\n  let totalLove = state.totalLove;\n  let claimLoveCounter = state.claimLoveCounter;\n\n  asyncFetch(\"https://rpc.mainnet.near.org/status\").then((res) => {\n    const data = res.body;\n    if (res.ok) {\n      const newBlockHeight = data.sync_info.latest_block_height;\n      if (newBlockHeight > oldBlockHeight) {\n        const blockDifference = newBlockHeight - oldBlockHeight;\n        const love = blockDifference;\n\n        totalLove += love;\n        claimLoveCounter++;\n\n        State.update({\n          blockHeight: newBlockHeight,\n          love: oldLove + love,\n          totalLove: totalLove,\n          claimLoveCounter: claimLoveCounter,\n        });\n      } else {\n        State.update({ blockHeight: newBlockHeight });\n      }\n    } else {\n      console.error(\"Error fetching data: \", data.error);\n    }\n  });\n}\n\nfunction newGame() {\n  const score = calculateScore();\n  const previousHighScore = state.highScore || 0;\n\n  State.update({\n    ...initGameState(),\n    highScore: Math.max(score, previousHighScore),\n  });\n}\n\nfunction spreadLove() {\n  const love = state.totalLove;\n  let bossHP = state.bossHP;\n  let bossLevel = state.bossLevel;\n  const clickCount = state.clickCount + 1;\n\n  bossHP -= love;\n\n  if (bossHP <= 0) {\n    bossLevel++;\n    bossHP = 100 * bossLevel + clickCount * 2;\n  }\n\n  State.update({\n    bossHP: bossHP,\n    bossLevel: bossLevel,\n    clickCount: clickCount,\n    totalLove: 0,\n    claimLoveCounter: 0,\n    loveSpent: state.loveSpent + love,\n  });\n}\n\nfunction calculateScore() {\n  if (state.gameStarted) {\n    const { bossLevel, startingBlockHeight, blockHeight } = state;\n    const blockDifference = blockHeight - startingBlockHeight;\n    if (blockDifference <= 0) {\n      return 0;\n    }\n    const previousScore = state.score || 0;\n    const score = previousScore + bossLevel * blockDifference;\n    return Math.max(score, 0);\n  } else {\n    return 0;\n  }\n}\n\nreturn (\n  <GameContainer>\n    <Title>Marma J Forever!</Title>\n    {!state.gameStarted && (\n      <div>\n        <Info>Player ID: {accountId}</Info>\n        <div>High Score: {state.highScore}</div>\n        <GameButton onClick={startGame}>Start Game</GameButton>\n      </div>\n    )}\n    {state.gameStarted && (\n      <div>\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            marginBottom: \"20px\",\n            width: \"100%\",\n          }}\n        >\n          <div>\n            <Info>Current Love: {state.totalLove}</Info>\n            <Info>Love Spent: {state.loveSpent}</Info>\n            <GameButton onClick={claimLove}>Claim Love</GameButton>\n          </div>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              alignItems: \"flex-end\",\n            }}\n          >\n            <Info>Boss Level: {state.bossLevel}</Info>\n            <Info>Boss HP: {state.bossHP}</Info>\n            <GameButton\n              onClick={state.claimLoveCounter > 0 ? spreadLove : undefined}\n              disabled={state.claimLoveCounter === 0}\n              style={{\n                backgroundColor:\n                  state.claimLoveCounter === 0 ? \"grey\" : \"palevioletred\",\n              }}\n            >\n              {state.claimLoveCounter > 0 ? \"Spread Love\" : \"Claim First\"}\n            </GameButton>\n          </div>\n        </div>\n        <RulesContainer>\n          <p>\n            <Info>Player ID: {accountId}</Info>\n          </p>\n          <ol>\n            <li>Claim Love</li>\n            <li>Spread it to attack the boss</li>\n            <li>New Game to reset</li>\n          </ol>\n        </RulesContainer>\n        <GameButton onClick={newGame}>New Game</GameButton>\n        <div>Current Score: {calculateScore()}</div>\n      </div>\n    )}\n  </GameContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/chloe.near/widget/marmajforever", "__row_index": 7}