{"tx_hash": "Crth5KHjp64QYaspvXscbCtg8ycrh3HFnkLJhZvF2fwd", "action_id_social": "CzGBjZJnZqLShsuMEiatdwbPvjjETreTzf4JSH4T7YLR-0-widget", "block_id": 94333629, "block_timestamp": "2023-06-16T19:55:45.456Z", "signer_id": "chloe.near", "widget_name": "marmajforever", "source_code": "const accountId = props.accountId || context.accountId;\n\nif (!accountId) {\n  return (\n    <div>\n      <p>Please connect your NEAR wallet or create a new one:</p>\n      <a href=\"https://near.org/signup\" target=\"_blank\" rel=\"noreferrer\">\n        <FakeButton>Create NEAR Wallet</FakeButton>\n      </a>\n    </div>\n  );\n}\n\nconst GameContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n  background: #282c34;\n  color: white;\n  font-size: calc(10px + 2vmin);\n  border: 2px solid white; /* Added border */\n  margin: 20px; /* Added margin */\n`;\n\nconst GameButton = styled.button`\n  background: palevioletred;\n  color: white;\n  font-size: 1em;\n  margin: 1em;\n  padding: 0.25em 1em;\n  border: 2px solid palevioletred;\n  border-radius: 10px;\n  &:hover {\n    background: white;\n    color: palevioletred;\n  }\n`;\n\nconst Title = styled.h1`\n  font-weight: bold;\n  padding-top: 10px; // Added top padding\n`;\n\nconst Info = styled.p`\n  margin-top: 1em;\n`;\n\nfunction initGameState() {\n  return {\n    clickCount: 0,\n    love: 0,\n    bossHP: 100,\n    bossLevel: 1,\n    boostLevel: 1,\n    totalLove: 0,\n    claimLoveCounter: 0,\n    gameStarted: false,\n  };\n}\n\nState.init(initGameState());\n\nfunction startGame() {\n  asyncFetch(\"https://rpc.mainnet.near.org/status\").then((res) => {\n    const data = res.body;\n    if (res.ok) {\n      State.update({\n        ...initGameState(), // Reset game state\n        gameStarted: true,\n      });\n    } else {\n      console.error(\"Error fetching data: \", data.error);\n    }\n  });\n}\n\nfunction claimLove() {\n  const oldBlockHeight = state.blockHeight;\n  const oldLove = state.love;\n  const boostLevel = state.boostLevel;\n  let totalLove = state.totalLove;\n  let claimLoveCounter = state.claimLoveCounter;\n\n  asyncFetch(\"https://rpc.mainnet.near.org/status\").then((res) => {\n    const data = res.body;\n    if (res.ok) {\n      const newBlockHeight = data.sync_info.latest_block_height;\n      if (newBlockHeight > oldBlockHeight) {\n        const blockDifference = newBlockHeight - oldBlockHeight;\n        const love = oldLove + blockDifference * boostLevel; // Increase love based on block difference * boost level\n\n        // Update totalLove\n        totalLove += blockDifference * boostLevel;\n        claimLoveCounter++;\n\n        State.update({\n          blockHeight: newBlockHeight,\n          love: love,\n          totalLove: totalLove,\n          claimLoveCounter: claimLoveCounter,\n        });\n      } else {\n        State.update({ blockHeight: newBlockHeight });\n      }\n    } else {\n      console.error(\"Error fetching data: \", data.error);\n    }\n  });\n}\n\nfunction spreadLove() {\n  const love = state.totalLove; // Use totalLove to spread love\n  let bossHP = state.bossHP;\n  let bossLevel = state.bossLevel;\n  const clickCount = state.clickCount + 1;\n\n  bossHP -= love; // Decrease boss HP by love value\n\n  if (bossHP <= 0) {\n    bossLevel++;\n    bossHP = 100 * bossLevel + clickCount * 2;\n  }\n\n  const difference = state.love - state.totalLove; // Calculate the difference between love and totalLove\n  const totalLove = difference > 0 ? state.totalLove + difference : 0; // Add the difference back to totalLove (minimum 0)\n\n  State.update({\n    bossHP: bossHP,\n    bossLevel: bossLevel,\n    clickCount: clickCount,\n    totalLove: totalLove, // Update totalLove with the new value\n    love: 0, // Reset love to 0\n    claimLoveCounter: 0, // Reset claimLoveCounter to 0\n  });\n}\n\nfunction boostLove() {\n  const clickCount = state.clickCount + 1;\n  const updatedLove = state.love * clickCount;\n  const updatedBoostLevel = state.boostLevel + 1;\n\n  State.update({\n    love: updatedLove,\n    boostLevel: updatedBoostLevel,\n    clickCount: clickCount,\n  });\n}\n\nfunction newGame() {\n  State.update(initGameState()); // Reset the game state\n}\n\nreturn (\n  <GameContainer>\n    <Title>Marma J Forever!</Title>\n    {!state.gameStarted && (\n      <>\n        <Info>Player ID: {accountId}</Info> {/* Display Player ID */}\n        <GameButton onClick={startGame}>Start Game</GameButton>\n      </>\n    )}\n    {state.gameStarted && (\n      <div>\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            width: \"100%\",\n          }}\n        >\n          <div>\n            <Info>Total Love: {state.totalLove}</Info>\n            <Info>Boost Level: {state.boostLevel}</Info>{\" \"}\n            {/* Display Boost Level */}\n            <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n              <GameButton onClick={claimLove}>Claim Love</GameButton>\n              <GameButton onClick={boostLove}>Boost Love</GameButton>\n            </div>\n          </div>\n          <div\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              alignItems: \"flex-end\",\n            }}\n          >\n            <Info>Player ID: {accountId}</Info> {/* Display Player ID */}\n            <Info>Boss Level: {state.bossLevel}</Info>{\" \"}\n            {/* Display Boss Level */}\n            <Info>Boss HP: {state.bossHP}</Info> {/* Display Boss HP */}\n            <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n              <GameButton\n                onClick={state.claimLoveCounter > 0 ? spreadLove : undefined}\n                disabled={state.claimLoveCounter === 0}\n              >\n                Spread the Love\n              </GameButton>\n              <GameButton onClick={newGame}>New Game</GameButton>\n            </div>\n          </div>\n        </div>\n        <div style={{ marginTop: \"20px\" }}>\n          {\" \"}\n          {/* Added margin */}\n          <p>Rules:</p>\n          <p>1. Claim love</p>\n          <p>2. Spread it to attack the boss</p>\n          <p>3. Boost to generate love faster</p>\n          <p>4. New game to reset</p>\n        </div>\n      </div>\n    )}\n  </GameContainer>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/chloe.near/widget/marmajforever", "__row_index": 3}