{"tx_hash": "9bofm32oDjtRQrpNCwUDYBTB833Fk81N4MMBJudELZf", "action_id_social": "Dwp1PUDuBRHkicwW1ghgZXDjZYvYJm3gkY48UReDjiCD-0-widget", "block_id": 84650187, "block_timestamp": "2023-02-06 20:45:22.160", "signer_id": "calebjacob.near", "widget_name": "GlobalSearch", "source_code": "const profiles =\n  Social.get([\"*/profile/name\", \"*/profile/tags/*\"], \"final\") || {};\n\nconst appMetadata =\n  Social.get(\n    [\"*/widget/*/metadata/name\", \"*/widget/*/metadata/tags/*\"],\n    \"final\"\n  ) || {};\n\nconst appKeys =\n  Social.keys([\"*/widget/*\"], \"final\", { values_only: true }) || {};\n\nconst appFilterTag = \"app\";\nconst limitPerGroup = 10;\n\nconst computeResults = (term) => {\n  const terms = (term || \"\")\n    .toLowerCase()\n    .split(/[^\\w._-]/)\n    .filter((s) => !!s.trim());\n\n  const matchedAccountIds = [];\n  const matchedApps = [];\n  const MaxSingleScore = 20;\n  const MaxScore = MaxSingleScore * 3;\n\n  const computeScore = (s) => {\n    s = s.toLowerCase();\n    return (\n      terms\n        .map((term) => {\n          const pos = s.indexOf(term);\n          return pos >= 0 ? Math.max(1, 20 - pos) : 0;\n        })\n        .reduce((s, v) => s + v, 0) / terms.length\n    );\n  };\n\n  // Search people:\n\n  Object.entries(profiles).forEach(([accountId, data]) => {\n    const accountIdScore = computeScore(accountId);\n    const name = data.profile.name || \"\";\n    const tags = Object.keys(data.profile.tags || {}).slice(0, 10);\n    const nameScore = computeScore(name);\n    const tagsScore = Math.min(\n      20,\n      tags.map(computeScore).reduce((s, v) => s + v, 0)\n    );\n    const score = (accountIdScore + nameScore + tagsScore) / MaxScore;\n    if (score > 0) {\n      matchedAccountIds.push({ score, accountId, name, tags });\n    }\n  });\n\n  matchedAccountIds.sort((a, b) => b.score - a.score);\n  const people = matchedAccountIds.slice(0, limitPerGroup);\n\n  // Search apps:\n\n  Object.entries(appKeys).forEach(([accountId, data]) => {\n    const accountIdScore = computeScore(accountId);\n    Object.keys(data.widget).forEach((componentId) => {\n      const componentIdScore = computeScore(componentId);\n      const metadata = appMetadata[accountId].widget[componentId].metadata;\n      const name = metadata.name || \"\";\n      if (appFilterTag && !(metadata.tags && appFilterTag in metadata.tags)) {\n        return;\n      }\n      const tags = Object.keys(metadata.tags || {}).slice(0, 10);\n      const nameScore = computeScore(name);\n      const tagsScore = Math.min(\n        20,\n        tags.map(computeScore).reduce((s, v) => s + v, 0)\n      );\n      const score =\n        (accountIdScore / 2 + componentIdScore + nameScore + tagsScore) /\n        MaxScore;\n      if (score > 0) {\n        matchedApps.push({\n          score,\n          accountId,\n          widgetName: componentId,\n          widgetSrc: `${accountId}/widget/${componentId}`,\n          name,\n          tags,\n        });\n      }\n    });\n  });\n\n  matchedApps.sort((a, b) => b.score - a.score);\n  const apps = matchedApps.slice(0, limitPerGroup);\n\n  // Update state:\n\n  State.update({\n    term,\n    people,\n    apps,\n  });\n};\n\nreturn (\n  <div>\n    <div>\n      <input\n        type=\"text\"\n        value={state.term ?? \"\"}\n        onChange={(e) => computeResults(e.target.value)}\n        placeholder=\"Search...\"\n      />\n      {state.term && (\n        <button type=\"button\" onClick={() => computeResults(\"\")}>\n          Clear\n        </button>\n      )}\n    </div>\n\n    {state.term && (\n      <>\n        {state.people?.length > 0 && (\n          <div>\n            <p>People:</p>\n\n            <ul>\n              {state.people.map((person, i) => (\n                <li key={i}>\n                  {person.name}, {person.accountId}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        {state.apps?.length > 0 && (\n          <div>\n            <p>Applications:</p>\n\n            <ul>\n              {state.apps.map((app, i) => (\n                <li key={i}>\n                  {app.widgetName}, {app.accountId}\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </>\n    )}\n\n    {state.term && state.apps?.length === 0 && state.people?.length === 0 && (\n      <p>No people or applications match your search.</p>\n    )}\n\n    {props.debug && (\n      <div>\n        <p>Debug Data:</p>\n        <pre>{JSON.stringify(state, undefined, 2)}</pre>\n      </div>\n    )}\n  </div>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/calebjacob.near/widget/GlobalSearch"}