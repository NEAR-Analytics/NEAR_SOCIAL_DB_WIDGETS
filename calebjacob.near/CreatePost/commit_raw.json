{"tx_hash": "85LVvxQo7jvSypNKevHpHJt1YzWAUiPBxhGg25KquymW", "action_id_social": "CPy3uMaVrLErR3Y28Ea4TDBi2Q9uEN9gLXDri8JgNmd-0-widget", "block_id": 84793133, "block_timestamp": "2023-02-08 21:14:12.660", "signer_id": "calebjacob.near", "widget_name": "CreatePost", "source_code": "if (!context.accountId) {\n  return \"\";\n}\n\nState.init({\n  image: {},\n  text: \"\",\n});\n\nfunction extractMentions(text) {\n  const mentionRegex =\n    /@((?:(?:[a-z\\d]+[-_])*[a-z\\d]+\\.)*(?:[a-z\\d]+[-_])*[a-z\\d]+)/gi;\n  mentionRegex.lastIndex = 0;\n  const accountIds = new Set();\n  for (const match of text.matchAll(mentionRegex)) {\n    if (\n      !/[\\w`]/.test(match.input.charAt(match.index - 1)) &&\n      !/[/\\w`]/.test(match.input.charAt(match.index + match[0].length)) &&\n      match[1].length >= 2 &&\n      match[1].length <= 64\n    ) {\n      accountIds.add(match[1].toLowerCase());\n    }\n  }\n  return [...accountIds];\n}\n\nfunction extractTagNotifications(text, item) {\n  return extractMentions(text || \"\")\n    .filter((accountId) => accountId !== context.accountId)\n    .map((accountId) => ({\n      key: accountId,\n      value: {\n        type: \"mention\",\n        item,\n      },\n    }));\n}\n\nfunction composeData() {\n  const data = {\n    post: {\n      main: JSON.stringify({\n        type: \"md\",\n        text: state.text,\n        image: state.image.cid ? { ipfs_cid: state.image.cid } : undefined,\n      }),\n    },\n    index: {\n      post: JSON.stringify({\n        key: \"main\",\n        value: {\n          type: \"md\",\n        },\n      }),\n    },\n  };\n\n  const notifications = extractTagNotifications(state.text, {\n    type: \"social\",\n    path: `${context.accountId}/post/main`,\n  });\n\n  if (notifications.length) {\n    data.index.notify = JSON.stringify(\n      notifications.length > 1 ? notifications : notifications[0]\n    );\n  }\n\n  return data;\n}\n\nfunction onCommit() {\n  console.log(\"committed!\");\n}\n\nconst Wrapper = styled.div`\n  border: 1px solid;\n  position: relative;\n`;\n\nconst Avatar = styled.div`\n  width: 40px;\n  height: 40px;\n  pointer-events: none;\n  position: absolute;\n  top: 24px;\n  left: 24px;\n\n  img {\n    object-fit: cover;\n    border-radius: 40px;\n    width: 100%;\n  }\n`;\n\nconst Textarea = styled.div`\n  display: grid;\n  vertical-align: top;\n  align-items: center;\n  position: relative;\n  align-items: stretch;\n  \n  &::after,\n  textarea {\n    width: 100%;\n    min-width: 1em;\n    height: unset;\n    min-height: 130px;\n    font: inherit;\n    padding: 24px 24px 24px 88px;\n    margin: 0;\n    resize: none;\n    background: none;\n    appearance: none;\n    border: none;\n    grid-area: 1 / 1;\n    overflow: hidden;\n    outline: none;\n  }\n  \n  &::after {\n    content: attr(data-value) ' ';\n    visibility: hidden;\n    white-space: pre-wrap;\n  }\n`;\n\nconst Button = styled.button`\n  background: #0091FF;\n  border-radius: 6px;\n  color: #fff;\n  height: 40px;\n  padding: 0 35px;\n  font-weight: 600;\n  font-size: 14px;\n  border: none;\n`;\n\nconst Actions = styled.div`\n  display: flex;\n  justify-content: end;\n  gap: 12px;\n`;\n\nconsole.log(composeData());\n\nreturn (\n  <Wrapper>\n    <Avatar>\n      <img src=\"https://i.near.social/thumbnail/https://ipfs.near.social/ipfs/bafkreibhm4kokjpetrr7ztaixyanzbn5djvj4h4ryjshsfh2hgpi3v7uqu\" />\n    </Avatar>\n\n    <Textarea data-value={state.text}>\n      <textarea\n        placeholder=\"What's happening?\"\n        onInput={(event) => State.update({ text: event.target.value })}\n      ></textarea>\n    </Textarea>\n\n    <Actions>\n      // <Button type=\"button\">Post</Button>\n      <CommitButton\n        disabled={!state.text}\n        force\n        className=\"btn btn-dark rounded-3\"\n        data={composeData}\n        onCommit={onCommit}\n      >\n        Post\n      </CommitButton>\n    </Actions>\n  </Wrapper>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/calebjacob.near/widget/CreatePost"}