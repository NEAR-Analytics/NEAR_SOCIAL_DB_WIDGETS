{"tx_hash": "Di6EZSNfA5oiwQwPxSCbbHfkBcJLPxVRX5mrPu8wBWSc", "action_id_social": "4bNKQMw9V3DnAhKG1yKzUqvV6EpPBQfQEBhKWL2GE1vc-0-widget", "block_id": 87345876, "block_timestamp": "2023-03-15 11:05:58.386", "signer_id": "reallyveryy.near", "widget_name": "Flipside-BarChart-V2.1", "source_code": "State.init({\n  imgSrc: \"\",\n});\n\nlet { query, rowValue, columnValue } = props;\nconsole.log({ rowValue, columnValue });\nvar formBody = [];\nformBody.push(`statement=${query}`);\nformBody = formBody.join(\"&\");\n\n// Query API\nconst options = {\n  method: \"POST\",\n  headers: {\n    Accept: \"application/json\",\n    \"Content-Type\": \"application/x-www-form-urlencoded;charset=UTF-8\",\n  },\n  body: formBody,\n};\n\nasyncFetch(\"https://flipside.leslug.com/execute\", options).then((res) => {\n  let queryResults = res.body;\n\n  console.log(\"queryResults\", queryResults);\n  const chartType = `\"bar\"`;\n  let chartBottomAxisLabels = \"[\";\n  let chartValues = \"[\";\n\n  // parsing of data from flipside\n  if (queryResults !== 0) {\n    // parsing of labels\n    queryResults.map((d, i) => {\n      if (i !== 0) {\n        chartBottomAxisLabels += \",\";\n        chartValues += \",\";\n      } else {\n        chartValues += `{label: '${props.title}', data:[`;\n      }\n      console.log(d);\n      chartBottomAxisLabels += \"'\";\n      chartBottomAxisLabels += d[rowValue];\n      chartBottomAxisLabels += \"'\";\n\n      chartValues += \"'\";\n      chartValues += d[columnValue];\n      chartValues += \"'\";\n    });\n\n    chartValues += \"]}]\";\n    chartBottomAxisLabels += \"]\";\n    const imgTemplate = `https://quickchart.io/chart?width=${props.chartWidth}&height=${props.chartHeight}&chart={type:${chartType},data:{labels:${chartBottomAxisLabels}, datasets:${chartValues}}}`;\n    State.update({\n      imgSrc: imgTemplate,\n    });\n  }\n});\n\nreturn (\n  <>\n    {state.imgSrc === \"\" ? <div>Loading ...</div> : <img src={state.imgSrc} />}\n  </>\n);\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/reallyveryy.near/widget/Flipside-BarChart-V2.1"}