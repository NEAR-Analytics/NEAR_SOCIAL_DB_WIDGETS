{"tx_hash": "5Q1d4ugjoCk62xpHEGr1FRZXyd5gRHgrhGxJTouZ71Tk", "action_id_social": "Hs1TbBULeTrfsBRCczJ5wbuPaZhXfPJyqMZGPfhWWvSQ-0-widget", "block_id": 87354949, "block_timestamp": "2023-03-15 14:01:19.686", "signer_id": "reallyveryy.near", "widget_name": "Flipside-BarChart-V2.1", "source_code": "State.init({\r\n  imgSrc: \"\",\r\n  currentQuery: \"\",\r\n});\r\n\r\nlet { query, rowValue, columnValue } = props;\r\nvar formBody = [];\r\nformBody.push(`statement=${query}`);\r\nformBody = formBody.join(\"&\");\r\n\r\n// Query API\r\nconst options = {\r\n  method: \"POST\",\r\n  headers: {\r\n    Accept: \"application/json\",\r\n    \"Content-Type\": \"application/x-www-form-urlencoded;charset=UTF-8\",\r\n  },\r\n  body: formBody,\r\n};\r\n\r\nif (state.currentQuery != props.query) {\r\n  State.update({\r\n    currentQuery: props.query,\r\n    imgSrc: \"\",\r\n  });\r\n\r\n  asyncFetch(\"https://flipside.leslug.com/execute\", options).then((res) => {\r\n    let queryResults = res.body;\r\n\r\n    console.log(\"queryResults\", queryResults);\r\n    const chartType = `\"bar\"`;\r\n    let chartBottomAxisLabels = \"[\";\r\n    let chartValues = \"[\";\r\n\r\n    // parsing of data from flipside\r\n    if (queryResults !== 0) {\r\n      // parsing of labels\r\n      let currentRows = [];\r\n      queryResults.map((d, i) => {\r\n        if (currentRows.includes(d[rowValue])) {\r\n          return; // no duplicates\r\n        }\r\n\r\n        if (i !== 0) {\r\n          chartBottomAxisLabels += \",\";\r\n          chartValues += \",\";\r\n        } else {\r\n          chartValues += `{label: '${props.title}', data:[`;\r\n        }\r\n\r\n        currentRows.push(d[rowValue]);\r\n        chartBottomAxisLabels += \"'\";\r\n        chartBottomAxisLabels += d[rowValue];\r\n        chartBottomAxisLabels += \"'\";\r\n\r\n        chartValues += \"'\";\r\n        chartValues += d[columnValue];\r\n        chartValues += \"'\";\r\n      });\r\n\r\n      chartValues += \"]}]\";\r\n      chartBottomAxisLabels += \"]\";\r\n      const imgTemplate = `https://quickchart.io/chart?width=${props.chartWidth}&height=${props.chartHeight}&chart={type:${chartType},data:{labels:${chartBottomAxisLabels}, datasets:${chartValues}}}`;\r\n      State.update({\r\n        imgSrc: imgTemplate,\r\n        currentQuery: props.query,\r\n      });\r\n    }\r\n  });\r\n}\r\nconsole.log(state.currentQuery != props.query);\r\nreturn (\r\n  <>{!state.imgSrc ? <div>Loading ...</div> : <img src={state.imgSrc} />}</>\r\n);\r\n", "metadata": null, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/reallyveryy.near/widget/Flipside-BarChart-V2.1"}