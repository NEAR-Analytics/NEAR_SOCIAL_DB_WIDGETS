{"tx_hash": "qD8wHSToD3ibZDVKGiqQ5d5V7EaERxSdx2Z3e4SzE3U", "action_id_social": "DNwmZn4gXEHyEBfdQxUGzkdfeEBZAVgn9VsWh1uNigCc-0-widget", "block_id": 87498697, "block_timestamp": "2023-03-17 13:50:14.799", "signer_id": "ciencia.near", "widget_name": "Kudos", "source_code": "State.init({\r\n  input: \"\",\r\n  url: \"\",\r\n  displayedCommentBoxes: [],\r\n  commentTextMap: {},\r\n  onChange: ({ content }) => {\r\n    console.log(content);\r\n    State.update({ content });\r\n  },\r\n});\r\nconst widgetOwner = \"ciencia.near\";\r\nconst widgetName = \"Kudos\";\r\nconst widgetPath = `webuidl.near/widget/${widgetName}`;\r\nconst metadata = props.metadata ?? Social.getr(`${widgetPath}/metadata`);\r\n\r\nconst card = {\r\n  background: \"linear-gradient(to right, #4deeea, #f000ff)\",\r\n  border: \"1px solid black\",\r\n  borderRadius: \"5px\",\r\n  textAlign: \"center\",\r\n  color: \"white\",\r\n  padding: \"10px\",\r\n};\r\n\r\nconst button = {\r\n  borderRadius: \"5px\",\r\n  margin: \"5px 0\",\r\n  padding: \"8px\",\r\n  textAlign: \"center\",\r\n  background: \"linear-gradient(to left, #FFD50D, #4498E0)\",\r\n  border: \"2px solid black\",\r\n  fontWeight: \"bold\",\r\n};\r\n\r\nconst imgWH = {\r\n  width: \"25px\",\r\n  height: \"25px\",\r\n};\r\n\r\nconst urlPrefix = \"https://\";\r\nconst accountId = props.accountId ?? \"*\";\r\n\r\nconst data = Social.index(\"kudo\", \"answer\");\r\nif (!data) {\r\n  return \"Loading answers\";\r\n}\r\nconst upvotes = Social.index(\"kudo\", \"upvote\");\r\nif (!upvotes) {\r\n  return \"Loading upvotes\";\r\n}\r\n\r\nconst commentAnswers = Social.index(\"kudo\", \"commentAnswers\");\r\nif (!upvotes) {\r\n  return \"Loading commentAnswers\";\r\n}\r\n\r\nconst blackList = [\"webuidl.near\"];\r\nconst whiteListData = data.filter((d) => !blackList.includes(d.accountId));\r\nconst whiteListComments = commentAnswers.filter(\r\n  (d) => !blackList.includes(d.accountId)\r\n);\r\nlet sortedData = whiteListData.sort(\r\n  (d1, d2) => d2.blockHeight - d1.blockHeight\r\n);\r\n\r\nsortedData.forEach((_, i) => {\r\n  sortedData[i].value.comments = [];\r\n});\r\n\r\nlet upvotesMap = {};\r\nfor (let i = 0; i < upvotes.length; i++) {\r\n  const vote = upvotes[i];\r\n  const upvoteBlockHeight = vote.value.blockHeight;\r\n  if (!upvotesMap[upvoteBlockHeight]) {\r\n    upvotesMap[upvoteBlockHeight] = 0;\r\n  }\r\n  upvotesMap[upvoteBlockHeight] += 1;\r\n}\r\n\r\nwhiteListComments.forEach((c) => {\r\n  const dataIndex = sortedData.findIndex(\r\n    (d) => d.blockHeight == c.value.blockHeight\r\n  );\r\n  if (dataIndex === -1) return;\r\n  sortedData[dataIndex].value.comments.push(c);\r\n});\r\n\r\nconst finalData = sortedData;\r\n// console.log(3, finalData);\r\n\r\n/* BEGIN Common.componse  */\r\nconst composeData = () => {\r\n  const data = {\r\n    post: {\r\n      main: JSON.stringify(state.content),\r\n    },\r\n    index: {\r\n      post: JSON.stringify({\r\n        key: \"main\",\r\n        value: {\r\n          type: \"md\",\r\n        },\r\n      }),\r\n    },\r\n  };\r\n\r\n  const item = {\r\n    type: \"social\",\r\n    path: `${context.accountId}/post/main`,\r\n  };\r\n\r\n  const notifications = state.extractMentionNotifications(\r\n    state.content.text,\r\n    item\r\n  );\r\n\r\n  if (notifications.length) {\r\n    data.index.notify = JSON.stringify(\r\n      notifications.length > 1 ? notifications : notifications[0]\r\n    );\r\n  }\r\n\r\n  const hashtags = state.extractHashtags(state.content.text);\r\n\r\n  if (hashtags.length) {\r\n    data.index.hashtag = JSON.stringify(\r\n      hashtags.map((hashtag) => ({\r\n        key: hashtag,\r\n        value: item,\r\n      }))\r\n    );\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\n/* END Common.componse  */\r\n\r\n/* BEGIN CommentButton  */\r\n\r\nconst startCommentTo = (blockHeight) => {\r\n  // console.log(\"startCommentTo\");\r\n  let cm = state.displayedCommentBoxes;\r\n  cm.push(blockHeight);\r\n  cm.remove;\r\n  State.update({ displayedCommentBoxes: cm });\r\n};\r\n\r\nconst RenderCommentInput = (blockHeight) => {\r\n  // console.log(\"RenderCommentInput\");\r\n  let cm = state.displayedCommentBoxes;\r\n  // console.log(cm, blockHeight);\r\n  return cm && cm.includes(blockHeight) ? (\r\n    <div\r\n      style={{\r\n        margin: \"10px 0px\",\r\n      }}\r\n    >\r\n      <textarea\r\n        style={{\r\n          backgroundColor: \"rgb(230, 230, 230)\",\r\n          border: \"1px solid #ced4da\",\r\n          borderRadius: \"0.375rem\",\r\n          width: \"50%\",\r\n          verticalAlign: \"middle\",\r\n        }}\r\n        rows=\"2\"\r\n        value={state.commentTextMap[blockHeight]}\r\n        onChange={(e) => {\r\n          const cm = state.commentTextMap;\r\n          // console.log(cm[blockHeight]);\r\n          cm[blockHeight] = e.target.value;\r\n          State.update({ commentTextMap: cm });\r\n          //   state.commentTextMap[blockHeight] = e.target.value;\r\n        }}\r\n      />\r\n      <CommitButton\r\n        style={button}\r\n        data={{\r\n          index: {\r\n            kudo: JSON.stringify(\r\n              {\r\n                key: \"commentAnswers\",\r\n                value: {\r\n                  commentAnswer: state.commentTextMap[blockHeight],\r\n                  blockHeight: blockHeight,\r\n                },\r\n              },\r\n              undefined,\r\n              0\r\n            ),\r\n          },\r\n        }}\r\n        onCommit={() => {\r\n          let ctm = state.commentTextMap;\r\n          ctm[blockHeight] = \"\";\r\n          State.update({\r\n            commentTextMap: ctm,\r\n            reloadData: true,\r\n          });\r\n        }}\r\n      >\r\n        Comment 1\r\n      </CommitButton>\r\n    </div>\r\n  ) : (\r\n    \"\"\r\n  );\r\n};\r\n\r\n/* END CommentButton  */\r\n\r\n/* START CommentBox */\r\nconst RenderAllCommentAnswerBox = (d) => {\r\n  return d.value.comments.map((c) => {\r\n    return (\r\n      <div style={{ ...card, marginLeft: \"30px\" }}>\r\n        <Widget\r\n          src=\"mob.near/widget/ProfileImage\"\r\n          props={{\r\n            accountId: c.accountId,\r\n            className: \"d-inline-block\",\r\n            style: { width: \"1.5em\", height: \"1.5em\" },\r\n          }}\r\n        />\r\n        <a href={`#/mob.near/widget/ProfilePage?accountId=${c.accountId}`}>\r\n          {c.accountId}\r\n        </a>\r\n        I BuiDL... <b>{c.value.commentAnswer}&nbsp;&nbsp;&nbsp;</b>\r\n        <Widget\r\n          src=\"mob.near/widget/FollowButton\"\r\n          props={{ accountId: c.accountId }}\r\n        />\r\n      </div>\r\n    );\r\n  });\r\n};\r\n\r\n/* END CommentBox  */\r\n\r\n/* START KudoBox */\r\nconst RenderKudoBox = (d) => {\r\n  return (\r\n    <>\r\n      <div style={card}>\r\n        <Widget\r\n          src=\"mob.near/widget/ProfileImage\"\r\n          props={{\r\n            accountId: d.accountId,\r\n            className: \"d-inline-block\",\r\n            style: { width: \"1.5em\", height: \"1.5em\" },\r\n          }}\r\n        />\r\n        <a href={`#/mob.near/widget/ProfilePage?accountId=${d.accountId}`}>\r\n          {d.accountId}\r\n        </a>\r\n        I BuiDL... <b>{d.value.answer}&nbsp;&nbsp;&nbsp;</b>\r\n        <b>\r\n          <a href={`${urlPrefix}${d.value.url}`} target=\"_blank\">\r\n            {d.value.url}\r\n          </a>\r\n          &nbsp;&nbsp;&nbsp;\r\n        </b>\r\n        <Widget\r\n          src=\"mob.near/widget/CommentButton\"\r\n          props={{\r\n            onClick: () => startCommentTo(d.blockHeight),\r\n          }}\r\n        />\r\n        <Widget\r\n          src=\"mob.near/widget/FollowButton\"\r\n          props={{ accountId: d.accountId }}\r\n        />\r\n        {RenderCommentInput(Number(d.blockHeight))}\r\n        <div>\r\n          <CommitButton\r\n            data={{\r\n              index: {\r\n                kudo: JSON.stringify(\r\n                  {\r\n                    key: \"upvote\",\r\n                    value: {\r\n                      blockHeight: d.blockHeight,\r\n                    },\r\n                  },\r\n                  undefined,\r\n                  0\r\n                ),\r\n              },\r\n            }}\r\n          >\r\n            Upvote\r\n          </CommitButton>\r\n          <span>\r\n            {upvotesMap[d.blockHeight] ? upvotesMap[d.blockHeight] : 0}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      {RenderAllCommentAnswerBox(d)}\r\n    </>\r\n  );\r\n};\r\n/* END KudoBox  */\r\n\r\nreturn (\r\n  <div>\r\n    <div className=\"d-inline-block\" style={{ width: \"10em\", height: \"10em\" }}>\r\n      <Widget\r\n        src=\"mob.near/widget/Image\"\r\n        props={{\r\n          image: metadata.image,\r\n          className: \"w-100 h-100 shadow\",\r\n          style: { objectFit: \"cover\", borderRadius: \"2em\" },\r\n          thumbnail: false,\r\n          fallbackUrl:\r\n            \"https://ipfs.near.social/ipfs/bafkreido7gsk4dlb63z3s5yirkkgrjs2nmyar5bxyet66chakt2h5jve6e\",\r\n          alt: widgetName,\r\n        }}\r\n      />\r\n    </div>\r\n    <br />\r\n    <br />\r\n    <p>An accolade, a Thank You, a Job Well Done. Give em a Kudo!\ud83d\udc4f </p>\r\n    <Widget\r\n      src={`${widgetOwner}/widget/Common.Compose`}\r\n      props={{\r\n        id: \"main\",\r\n        textAreaOnly: true,\r\n        onChange: state.onChange,\r\n        onHelper: ({ extractMentionNotifications, extractHashtags }) => {\r\n          State.update({ extractMentionNotifications, extractHashtags });\r\n        },\r\n      }}\r\n    />\r\n    {state.content && (\r\n      <div className=\"mt-3\">\r\n        <Widget\r\n          src=\"mob.near/widget/MainPage.Post\"\r\n          props={{\r\n            accountId: context.accountId,\r\n            content: state.content,\r\n            blockHeight: \"now\",\r\n          }}\r\n        />\r\n      </div>\r\n    )}\r\n    <div className=\"d-flex flex-column w-75 my-3 justify-content-around\">\r\n      <p>Url:</p>\r\n      <textarea\r\n        style={{\r\n          backgroundColor: \"#fafafa\",\r\n          border: \"1px solid #fafafa\",\r\n          borderRadius: \"0.375rem\",\r\n        }}\r\n        rows=\"1\"\r\n        value={state.url}\r\n        onChange={(e) => {\r\n          State.update({ url: e.target.value });\r\n        }}\r\n      />\r\n    </div>\r\n    <CommitButton\r\n      style={button}\r\n      data={{\r\n        index: {\r\n          kudo: JSON.stringify(\r\n            {\r\n              key: \"answer\",\r\n              value: {\r\n                answer: state.content.text,\r\n                url: state.url,\r\n              },\r\n            },\r\n            undefined,\r\n            0\r\n          ),\r\n        },\r\n      }}\r\n      onCommit={() => {\r\n        State.update({\r\n          reloadData: true,\r\n        });\r\n      }}\r\n    >\r\n      Kudos!\r\n    </CommitButton>\r\n    <br />\r\n    <br />\r\n    <div>\r\n      {sortedData ? sortedData.map((d) => RenderKudoBox(d)) : \"Loading...\"}\r\n    </div>\r\n  </div>\r\n);\r\n", "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/ciencia.near/widget/Kudos", "metadata.image.ipfs_cid": NaN, "metadata.name": NaN, "metadata.tags.app": NaN, "metadata.tags.great-job": NaN, "metadata.tags.kudo": NaN, "metadata.tags.lets-go": NaN, "metadata.tags.well-done": NaN, "metadata": NaN}