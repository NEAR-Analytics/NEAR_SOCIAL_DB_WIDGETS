{"tx_hash": "JEK9MkhhT48bXCaFQ1YELWKGA26BLXLSm3UXp2eMXZnx", "action_id_social": "XoKAyz4yGgFJcnmULHk6imcXZCCrGTUQtH1io2wKiAB-0-widget", "block_id": 93168371, "block_timestamp": "2023-05-31T23:54:16.242Z", "signer_id": "mattlock.near", "widget_name": "StethBalance", "source_code": "const sender = props.sender || `0x525521d79134822a342d330bd91da67976569af1`;\nconst message = props.message || `Balance is: `;\nconst unit = `STETH`;\n\n// FETCH LIDO ABI\n\nconst lidoContract = \"0xae7ab96520de3a18e5e111b5eaab095312d7fe84\";\nconst tokenDecimals = 18;\n\nconst lidoAbi = fetch(\n  \"https://raw.githubusercontent.com/lidofinance/lido-subgraph/master/abis/Lido.json\"\n);\nif (!lidoAbi.ok) {\n  return \"Loading\";\n}\n\nconst iface = new ethers.utils.Interface(lidoAbi.body);\n\n// HELPER FUNCTIONS\n\nconst getStakedBalance = (receiver) => {\n  const encodedData = iface.encodeFunctionData(\"balanceOf\", [receiver]);\n\n  return Ethers.provider()\n    .call({\n      to: lidoContract,\n      data: encodedData,\n    })\n    .then((rawBalance) => {\n      const receiverBalanceHex = iface.decodeFunctionResult(\n        \"balanceOf\",\n        rawBalance\n      );\n\n      return Big(receiverBalanceHex.toString())\n        .div(Big(10).pow(tokenDecimals))\n        .toFixed(2)\n        .replace(/\\d(?=(\\d{3})+\\.)/g, \"$&,\");\n    });\n};\n\nif (state.stakedBalance === undefined && sender) {\n  getStakedBalance(sender).then((stakedBalance) => {\n    State.update({ stakedBalance });\n  });\n}\n\nreturn (\n  <span>\n    {message}\n    {state.stakedBalance} {unit}\n  </span>\n);\n", "metadata": {"tags": {"ethdenver2023": ""}}, "branch": null, "widget_modules_used": null, "widget_url": "https://near.social/#/mattlock.near/widget/StethBalance", "__row_index": 0}